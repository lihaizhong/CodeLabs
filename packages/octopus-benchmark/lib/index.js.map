{"version":3,"file":"index.js","sources":["../../../node_modules/.pnpm/@rollup+plugin-typescript@12.1.4_rollup@4.45.1_tslib@2.8.1_typescript@5.8.3/node_modules/tslib/tslib.es6.js","../../octopus-platform/esm/index.js","../src/platform.ts","../src/index.ts"],"sourcesContent":["/******************************************************************************\r\nCopyright (c) Microsoft Corporation.\r\n\r\nPermission to use, copy, modify, and/or distribute this software for any\r\npurpose with or without fee is hereby granted.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH\r\nREGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY\r\nAND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,\r\nINDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM\r\nLOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR\r\nOTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR\r\nPERFORMANCE OF THIS SOFTWARE.\r\n***************************************************************************** */\r\n/* global Reflect, Promise, SuppressedError, Symbol, Iterator */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    if (typeof b !== \"function\" && b !== null)\r\n        throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __esDecorate(ctor, descriptorIn, decorators, contextIn, initializers, extraInitializers) {\r\n    function accept(f) { if (f !== void 0 && typeof f !== \"function\") throw new TypeError(\"Function expected\"); return f; }\r\n    var kind = contextIn.kind, key = kind === \"getter\" ? \"get\" : kind === \"setter\" ? \"set\" : \"value\";\r\n    var target = !descriptorIn && ctor ? contextIn[\"static\"] ? ctor : ctor.prototype : null;\r\n    var descriptor = descriptorIn || (target ? Object.getOwnPropertyDescriptor(target, contextIn.name) : {});\r\n    var _, done = false;\r\n    for (var i = decorators.length - 1; i >= 0; i--) {\r\n        var context = {};\r\n        for (var p in contextIn) context[p] = p === \"access\" ? {} : contextIn[p];\r\n        for (var p in contextIn.access) context.access[p] = contextIn.access[p];\r\n        context.addInitializer = function (f) { if (done) throw new TypeError(\"Cannot add initializers after decoration has completed\"); extraInitializers.push(accept(f || null)); };\r\n        var result = (0, decorators[i])(kind === \"accessor\" ? { get: descriptor.get, set: descriptor.set } : descriptor[key], context);\r\n        if (kind === \"accessor\") {\r\n            if (result === void 0) continue;\r\n            if (result === null || typeof result !== \"object\") throw new TypeError(\"Object expected\");\r\n            if (_ = accept(result.get)) descriptor.get = _;\r\n            if (_ = accept(result.set)) descriptor.set = _;\r\n            if (_ = accept(result.init)) initializers.unshift(_);\r\n        }\r\n        else if (_ = accept(result)) {\r\n            if (kind === \"field\") initializers.unshift(_);\r\n            else descriptor[key] = _;\r\n        }\r\n    }\r\n    if (target) Object.defineProperty(target, contextIn.name, descriptor);\r\n    done = true;\r\n};\r\n\r\nexport function __runInitializers(thisArg, initializers, value) {\r\n    var useValue = arguments.length > 2;\r\n    for (var i = 0; i < initializers.length; i++) {\r\n        value = useValue ? initializers[i].call(thisArg, value) : initializers[i].call(thisArg);\r\n    }\r\n    return useValue ? value : void 0;\r\n};\r\n\r\nexport function __propKey(x) {\r\n    return typeof x === \"symbol\" ? x : \"\".concat(x);\r\n};\r\n\r\nexport function __setFunctionName(f, name, prefix) {\r\n    if (typeof name === \"symbol\") name = name.description ? \"[\".concat(name.description, \"]\") : \"\";\r\n    return Object.defineProperty(f, \"name\", { configurable: true, value: prefix ? \"\".concat(prefix, \" \", name) : name });\r\n};\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g = Object.create((typeof Iterator === \"function\" ? Iterator : Object).prototype);\r\n    return g.next = verb(0), g[\"throw\"] = verb(1), g[\"return\"] = verb(2), typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport var __createBinding = Object.create ? (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    var desc = Object.getOwnPropertyDescriptor(m, k);\r\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\r\n        desc = { enumerable: true, get: function() { return m[k]; } };\r\n    }\r\n    Object.defineProperty(o, k2, desc);\r\n}) : (function(o, m, k, k2) {\r\n    if (k2 === undefined) k2 = k;\r\n    o[k2] = m[k];\r\n});\r\n\r\nexport function __exportStar(m, o) {\r\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(o, p)) __createBinding(o, m, p);\r\n}\r\n\r\nexport function __values(o) {\r\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\r\n    if (m) return m.call(o);\r\n    if (o && typeof o.length === \"number\") return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\n/** @deprecated */\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n}\r\n\r\nexport function __spreadArray(to, from, pack) {\r\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\r\n        if (ar || !(i in from)) {\r\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\r\n            ar[i] = from[i];\r\n        }\r\n    }\r\n    return to.concat(ar || Array.prototype.slice.call(from));\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = Object.create((typeof AsyncIterator === \"function\" ? AsyncIterator : Object).prototype), verb(\"next\"), verb(\"throw\"), verb(\"return\", awaitReturn), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function awaitReturn(f) { return function (v) { return Promise.resolve(v).then(f, reject); }; }\r\n    function verb(n, f) { if (g[n]) { i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; if (f) i[n] = f(i[n]); } }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: false } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nvar __setModuleDefault = Object.create ? (function(o, v) {\r\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\r\n}) : function(o, v) {\r\n    o[\"default\"] = v;\r\n};\r\n\r\nvar ownKeys = function(o) {\r\n    ownKeys = Object.getOwnPropertyNames || function (o) {\r\n        var ar = [];\r\n        for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;\r\n        return ar;\r\n    };\r\n    return ownKeys(o);\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== \"default\") __createBinding(result, mod, k[i]);\r\n    __setModuleDefault(result, mod);\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n\r\nexport function __classPrivateFieldGet(receiver, state, kind, f) {\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\r\n    return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\r\n}\r\n\r\nexport function __classPrivateFieldSet(receiver, state, value, kind, f) {\r\n    if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\r\n    if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\r\n    if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\r\n    return (kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;\r\n}\r\n\r\nexport function __classPrivateFieldIn(state, receiver) {\r\n    if (receiver === null || (typeof receiver !== \"object\" && typeof receiver !== \"function\")) throw new TypeError(\"Cannot use 'in' operator on non-object\");\r\n    return typeof state === \"function\" ? receiver === state : state.has(receiver);\r\n}\r\n\r\nexport function __addDisposableResource(env, value, async) {\r\n    if (value !== null && value !== void 0) {\r\n        if (typeof value !== \"object\" && typeof value !== \"function\") throw new TypeError(\"Object expected.\");\r\n        var dispose, inner;\r\n        if (async) {\r\n            if (!Symbol.asyncDispose) throw new TypeError(\"Symbol.asyncDispose is not defined.\");\r\n            dispose = value[Symbol.asyncDispose];\r\n        }\r\n        if (dispose === void 0) {\r\n            if (!Symbol.dispose) throw new TypeError(\"Symbol.dispose is not defined.\");\r\n            dispose = value[Symbol.dispose];\r\n            if (async) inner = dispose;\r\n        }\r\n        if (typeof dispose !== \"function\") throw new TypeError(\"Object not disposable.\");\r\n        if (inner) dispose = function() { try { inner.call(this); } catch (e) { return Promise.reject(e); } };\r\n        env.stack.push({ value: value, dispose: dispose, async: async });\r\n    }\r\n    else if (async) {\r\n        env.stack.push({ async: true });\r\n    }\r\n    return value;\r\n\r\n}\r\n\r\nvar _SuppressedError = typeof SuppressedError === \"function\" ? SuppressedError : function (error, suppressed, message) {\r\n    var e = new Error(message);\r\n    return e.name = \"SuppressedError\", e.error = error, e.suppressed = suppressed, e;\r\n};\r\n\r\nexport function __disposeResources(env) {\r\n    function fail(e) {\r\n        env.error = env.hasError ? new _SuppressedError(e, env.error, \"An error was suppressed during disposal.\") : e;\r\n        env.hasError = true;\r\n    }\r\n    var r, s = 0;\r\n    function next() {\r\n        while (r = env.stack.pop()) {\r\n            try {\r\n                if (!r.async && s === 1) return s = 0, env.stack.push(r), Promise.resolve().then(next);\r\n                if (r.dispose) {\r\n                    var result = r.dispose.call(r.value);\r\n                    if (r.async) return s |= 2, Promise.resolve(result).then(next, function(e) { fail(e); return next(); });\r\n                }\r\n                else s |= 1;\r\n            }\r\n            catch (e) {\r\n                fail(e);\r\n            }\r\n        }\r\n        if (s === 1) return env.hasError ? Promise.reject(env.error) : Promise.resolve();\r\n        if (env.hasError) throw env.error;\r\n    }\r\n    return next();\r\n}\r\n\r\nexport function __rewriteRelativeImportExtension(path, preserveJsx) {\r\n    if (typeof path === \"string\" && /^\\.\\.?\\//.test(path)) {\r\n        return path.replace(/\\.(tsx)$|((?:\\.d)?)((?:\\.[^./]+?)?)\\.([cm]?)ts$/i, function (m, tsx, d, ext, cm) {\r\n            return tsx ? preserveJsx ? \".jsx\" : \".js\" : d && (!ext || !cm) ? m : (d + ext + \".\" + cm.toLowerCase() + \"js\");\r\n        });\r\n    }\r\n    return path;\r\n}\r\n\r\nexport default {\r\n    __extends: __extends,\r\n    __assign: __assign,\r\n    __rest: __rest,\r\n    __decorate: __decorate,\r\n    __param: __param,\r\n    __esDecorate: __esDecorate,\r\n    __runInitializers: __runInitializers,\r\n    __propKey: __propKey,\r\n    __setFunctionName: __setFunctionName,\r\n    __metadata: __metadata,\r\n    __awaiter: __awaiter,\r\n    __generator: __generator,\r\n    __createBinding: __createBinding,\r\n    __exportStar: __exportStar,\r\n    __values: __values,\r\n    __read: __read,\r\n    __spread: __spread,\r\n    __spreadArrays: __spreadArrays,\r\n    __spreadArray: __spreadArray,\r\n    __await: __await,\r\n    __asyncGenerator: __asyncGenerator,\r\n    __asyncDelegator: __asyncDelegator,\r\n    __asyncValues: __asyncValues,\r\n    __makeTemplateObject: __makeTemplateObject,\r\n    __importStar: __importStar,\r\n    __importDefault: __importDefault,\r\n    __classPrivateFieldGet: __classPrivateFieldGet,\r\n    __classPrivateFieldSet: __classPrivateFieldSet,\r\n    __classPrivateFieldIn: __classPrivateFieldIn,\r\n    __addDisposableResource: __addDisposableResource,\r\n    __disposeResources: __disposeResources,\r\n    __rewriteRelativeImportExtension: __rewriteRelativeImportExtension,\r\n};\r\n","const noop = (() => { });\n\nfunction delay(callback, interval) {\n    return new Promise((resolve) => setTimeout(() => resolve(callback()), interval));\n}\nasync function retry(fn, intervals = [], \n/*\n * @private 不建议外部传入\n */\ntimes = 0) {\n    try {\n        return fn();\n    }\n    catch (err) {\n        if (times >= intervals.length) {\n            throw err;\n        }\n        return delay(() => retry(fn, intervals, ++times), intervals[times]);\n    }\n}\n\n// 使用静态缓冲区，避免重复创建\nconst BUFFER_SIZE = 4096; // 更大的缓冲区，减少字符串拼接次数\nconst STATIC_BUFFER = new Uint16Array(BUFFER_SIZE); // 预分配ASCII缓冲区\n/**\n * 优化的 UTF-8 解码函数\n * 主要优化点：\n * 1. 使用静态缓冲区减少内存分配\n * 2. 批量处理 ASCII 字符\n * 3. 优化循环结构和条件判断\n * 4. 使用 Uint16Array 代替普通数组提高性能\n */\nfunction utf8(buffer, start, end) {\n    // 边界检查\n    if (start < 0 || end > buffer.length)\n        throw new RangeError(\"Index out of range\");\n    if (end - start < 1)\n        return \"\";\n    const resultParts = [];\n    let bufferPos = 0;\n    const appendBuffer = (parts) => {\n        resultParts.push(String.fromCharCode.apply(null, Array.from(parts)));\n    };\n    // 快速路径：检查是否全是 ASCII\n    let allAscii = true;\n    for (let i = start; i < end; i++) {\n        if (buffer[i] > 0x7F) {\n            allAscii = false;\n            break;\n        }\n    }\n    // 全 ASCII 优化路径\n    if (allAscii) {\n        for (let i = start; i < end; i += BUFFER_SIZE) {\n            const chunkEnd = Math.min(i + BUFFER_SIZE, end);\n            const len = chunkEnd - i;\n            // 直接复制到 Uint16Array\n            for (let j = 0; j < len; j++) {\n                STATIC_BUFFER[j] = buffer[i + j];\n            }\n            appendBuffer(STATIC_BUFFER.subarray(0, len));\n        }\n        return resultParts.join('');\n    }\n    // 混合内容处理\n    for (let i = start; i < end;) {\n        const byte = buffer[i++];\n        // ASCII 字符处理\n        if (byte < 0x80) {\n            STATIC_BUFFER[bufferPos++] = byte;\n            // 如果缓冲区满了，提交并清空\n            if (bufferPos === BUFFER_SIZE) {\n                appendBuffer(STATIC_BUFFER);\n                bufferPos = 0;\n            }\n            continue;\n        }\n        // 提交之前的 ASCII 字符\n        if (bufferPos > 0) {\n            appendBuffer(STATIC_BUFFER.subarray(0, bufferPos));\n            bufferPos = 0;\n        }\n        // 变长编码处理 - 使用查表法代替多个条件判断\n        let codePoint;\n        // 2 字节序列: 110xxxxx 10xxxxxx\n        if ((byte & 0xE0) === 0xC0 && i < end) {\n            codePoint = ((byte & 0x1F) << 6) | (buffer[i++] & 0x3F);\n        }\n        // 3 字节序列: 1110xxxx 10xxxxxx 10xxxxxx\n        else if ((byte & 0xF0) === 0xE0 && i + 1 < end) {\n            codePoint = ((byte & 0x0F) << 12) |\n                ((buffer[i++] & 0x3F) << 6) |\n                (buffer[i++] & 0x3F);\n        }\n        // 4 字节序列: 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx\n        else if ((byte & 0xF8) === 0xF0 && i + 2 < end) {\n            codePoint = ((byte & 0x07) << 18) |\n                ((buffer[i++] & 0x3F) << 12) |\n                ((buffer[i++] & 0x3F) << 6) |\n                (buffer[i++] & 0x3F);\n            // 处理 Unicode 代理对\n            if (codePoint > 0xFFFF) {\n                codePoint -= 0x10000;\n                STATIC_BUFFER[bufferPos++] = 0xD800 + (codePoint >> 10);\n                STATIC_BUFFER[bufferPos++] = 0xDC00 + (codePoint & 0x3FF);\n                // 检查缓冲区是否需要提交\n                if (bufferPos >= BUFFER_SIZE - 2) { // 预留空间给下一个可能的代理对\n                    appendBuffer(STATIC_BUFFER.subarray(0, bufferPos));\n                    bufferPos = 0;\n                }\n                continue;\n            }\n        }\n        // 无效的 UTF-8 序列\n        else {\n            codePoint = 0xFFFD; // Unicode 替换字符\n            // 跳过可能的后续字节\n            while (i < end && (buffer[i] & 0xC0) === 0x80)\n                i++;\n        }\n        STATIC_BUFFER[bufferPos++] = codePoint;\n        // 检查缓冲区是否需要提交\n        if (bufferPos >= BUFFER_SIZE - 3) { // 预留空间给下一个可能的多字节字符\n            appendBuffer(STATIC_BUFFER.subarray(0, bufferPos));\n            bufferPos = 0;\n        }\n    }\n    // 提交剩余字符\n    if (bufferPos > 0) {\n        appendBuffer(STATIC_BUFFER.subarray(0, bufferPos));\n    }\n    return resultParts.join('');\n}\n\nclass OctopusPlatform {\n    /**\n     * 插件列表\n     */\n    plugins = [];\n    /**\n     * 平台版本\n     */\n    platformVersion = \"0.1.3\";\n    /**\n     * 应用版本\n     */\n    version = \"\";\n    /**\n     * 全局变量\n     */\n    globals = {\n        env: \"unknown\",\n        br: null,\n        dpr: 1,\n        system: \"\",\n    };\n    noop = noop;\n    retry = retry;\n    constructor(plugins, version) {\n        this.version = version || \"\";\n        this.plugins = plugins;\n        this.globals.env = this.autoEnv();\n    }\n    init() {\n        const { globals, plugins } = this;\n        const collection = new Map();\n        const names = [];\n        const installedPlugins = new Set();\n        globals.br = this.useBridge();\n        globals.dpr = this.usePixelRatio();\n        globals.system = this.useSystem();\n        for (const plugin of plugins) {\n            names.push(plugin.name);\n            collection.set(plugin.name, plugin);\n        }\n        this.usePlugins(collection, names, installedPlugins);\n        installedPlugins.clear();\n    }\n    autoEnv() {\n        if (typeof window !== \"undefined\") {\n            return \"h5\";\n        }\n        // FIXME：由于抖音场景支持wx对象，所以需要放在wx对象之前检查\n        if (typeof tt !== \"undefined\") {\n            return \"tt\";\n        }\n        if (typeof my !== \"undefined\") {\n            return \"alipay\";\n        }\n        if (typeof wx !== \"undefined\") {\n            return \"weapp\";\n        }\n        if (typeof has !== \"undefined\") {\n            return \"harmony\";\n        }\n        throw new Error(\"Unsupported platform！\");\n    }\n    useBridge() {\n        switch (this.globals.env) {\n            case \"alipay\":\n                return my;\n            case \"tt\":\n                return tt;\n            case \"weapp\":\n                return wx;\n        }\n        return globalThis;\n    }\n    usePixelRatio() {\n        const { env, br } = this.globals;\n        if (env === \"h5\") {\n            return devicePixelRatio;\n        }\n        if (\"getWindowInfo\" in br) {\n            return br.getWindowInfo().pixelRatio;\n        }\n        if (\"getSystemInfoSync\" in br) {\n            return br.getSystemInfoSync().pixelRatio;\n        }\n        return 1;\n    }\n    useSystem() {\n        const { env } = this.globals;\n        let system;\n        switch (env) {\n            case \"weapp\":\n                system = wx.getDeviceInfo().platform;\n                break;\n            case \"alipay\":\n                system = my.getDeviceBaseInfo().platform;\n                break;\n            case \"tt\":\n                system = tt.getDeviceInfoSync().platform;\n                break;\n            case \"harmony\":\n                system = has.getSystemInfoSync().platform;\n                break;\n            case \"h5\":\n                if (\"userAgentData\" in navigator) {\n                    // @ts-ignore\n                    system = navigator.userAgentData.platform;\n                }\n                else {\n                    const UA = navigator.userAgent;\n                    if (/(Android|Adr)/i.test(UA)) {\n                        system = \"android\";\n                    }\n                    else if (/\\(i[^;]+;( U;)? CPU.+Mac OS X/i.test(UA)) {\n                        system = \"ios\";\n                    }\n                    else if (/HarmonyOS/i.test(UA)) {\n                        system = \"harmony\";\n                    }\n                    else {\n                        system = \"unknown\";\n                    }\n                }\n                break;\n            default:\n                system = \"unknown\";\n        }\n        return system.toLowerCase();\n    }\n    usePlugins(plugins, pluginNames, installedPlugins) {\n        for (const pluginName of pluginNames) {\n            if (!plugins.has(pluginName)) {\n                throw new Error(`Plugin ${pluginName} not found`);\n            }\n            if (installedPlugins.has(pluginName)) {\n                return;\n            }\n            const plugin = plugins.get(pluginName);\n            // 递归调用依赖\n            if (Array.isArray(plugin.dependencies)) {\n                for (const dependency of plugin.dependencies) {\n                    if (typeof plugins.get(dependency)?.install !== \"function\") {\n                        throw new Error(`Plugin ${pluginName} depends on plugin ${dependency}, but ${dependency} is not found`);\n                    }\n                }\n                // 递归加载依赖\n                this.usePlugins(plugins, plugin.dependencies, installedPlugins);\n            }\n            this.installPlugin(plugin);\n            installedPlugins.add(pluginName);\n        }\n    }\n    switch(env) {\n        this.globals.env = env;\n        this.init();\n    }\n}\n\n/**\n * 定义平台插件\n */\nconst definePlugin = (plugin) => plugin;\n\nfunction installPlugin(platform, plugin) {\n    const value = plugin.install.call(platform);\n    Object.defineProperty(platform, plugin.name, {\n        get: () => value,\n        enumerable: true,\n        configurable: true,\n    });\n}\n\nvar pluginSelector = definePlugin({\n    name: \"getSelector\",\n    install() {\n        const { env, br } = this.globals;\n        if (env === \"h5\") {\n            return (selector) => document.querySelector(selector);\n        }\n        return (selector, component) => (component || br)\n            .createSelectorQuery()\n            .select(selector)\n            .fields({ node: true, size: true });\n    },\n});\n\n/**\n * 通过选择器匹配获取canvas实例\n * @returns\n */\nvar pluginCanvas = definePlugin({\n    name: \"getCanvas\",\n    dependencies: [\"getSelector\"],\n    install() {\n        const { retry, getSelector } = this;\n        const { env, br, dpr } = this.globals;\n        const intervals = [50, 100, 100];\n        function initCanvas(canvas, width, height) {\n            if (!canvas) {\n                throw new Error(\"canvas not found.\");\n            }\n            // const MAX_SIZE = 1365;\n            const context = canvas.getContext(\"2d\");\n            // let virtualWidth = width * dpr;\n            // let virtualHeight = height * dpr;\n            // // 微信小程序限制canvas最大尺寸为 1365 * 1365\n            // if (\n            //   env === \"weapp\" &&\n            //   (virtualWidth > MAX_SIZE || virtualHeight > MAX_SIZE)\n            // ) {\n            //   if (virtualWidth > virtualHeight) {\n            //     virtualHeight = (virtualHeight / virtualWidth) * MAX_SIZE;\n            //     virtualWidth = MAX_SIZE;\n            //   } else {\n            //     virtualWidth = (virtualWidth / virtualHeight) * MAX_SIZE;\n            //     virtualHeight = MAX_SIZE;\n            //   }\n            // }\n            // canvas!.width = virtualWidth;\n            // canvas!.height = virtualHeight;\n            canvas.width = width * dpr;\n            canvas.height = height * dpr;\n            return { canvas, context };\n        }\n        if (env === \"h5\") {\n            return (selector) => retry(() => {\n                // FIXME: Taro 对 canvas 做了特殊处理，canvas 元素的 id 会被加上 canvas-id 的前缀\n                const canvas = (getSelector(`canvas[canvas-id=${selector.slice(1)}]`) || getSelector(selector));\n                return initCanvas(canvas, canvas?.clientWidth, canvas?.clientHeight);\n            }, intervals);\n        }\n        return (selector, component) => retry(() => new Promise((resolve, reject) => {\n            let query = getSelector(selector, component);\n            query.exec((res) => {\n                const { node, width, height } = res[0] || {};\n                try {\n                    resolve(initCanvas(node, width, height));\n                }\n                catch (e) {\n                    reject(e);\n                }\n            });\n        }), intervals);\n    },\n});\n\n/**\n * 用于处理数据解码\n * @returns\n */\nvar pluginDecode = definePlugin({\n    name: \"decode\",\n    install() {\n        const { env, br } = this.globals;\n        const b64Wrap = (b64, type = \"image/png\") => `data:${type};base64,${b64}`;\n        const decode = {\n            toBuffer(data) {\n                const { buffer, byteOffset, byteLength } = data;\n                if (buffer instanceof ArrayBuffer) {\n                    return buffer.slice(byteOffset, byteOffset + byteLength);\n                }\n                const view = new Uint8Array(byteLength);\n                view.set(data);\n                return view.buffer;\n            },\n            bytesToString(data) {\n                const chunkSize = 8192; // 安全的块大小\n                let result = \"\";\n                for (let i = 0; i < data.length; i += chunkSize) {\n                    const chunk = data.slice(i, i + chunkSize);\n                    // 在安全的块上使用 String.fromCharCode\n                    result += String.fromCharCode.apply(null, Array.from(chunk));\n                }\n                return result;\n            },\n        };\n        if (env === \"h5\") {\n            const textDecoder = new TextDecoder(\"utf-8\", { fatal: true });\n            return {\n                ...decode,\n                toDataURL: (data) => b64Wrap(btoa(decode.bytesToString(data))),\n                utf8: (data, start, end) => textDecoder.decode(data.subarray(start, end)),\n            };\n        }\n        return {\n            ...decode,\n            toDataURL: (data) => b64Wrap(br.arrayBufferToBase64(decode.toBuffer(data))),\n            utf8,\n        };\n    },\n});\n\n/**\n * 用于处理远程文件读取\n * @returns\n */\nvar pluginDownload = definePlugin({\n    name: \"remote\",\n    install() {\n        const { env, br } = this.globals;\n        const isRemote = (url) => /^(blob:)?http(s)?:\\/\\//.test(url);\n        if (env === \"h5\") {\n            return {\n                is: isRemote,\n                fetch: (url) => fetch(url).then((response) => {\n                    if (response.ok) {\n                        return response.arrayBuffer();\n                    }\n                    throw new Error(`HTTP error, status=${response.status}, statusText=${response.statusText}`);\n                }),\n            };\n        }\n        function download(url, enableCache) {\n            return new Promise((resolve, reject) => {\n                br.request({\n                    url,\n                    // @ts-ignore 支付宝小程序必须有该字段\n                    dataType: \"arraybuffer\",\n                    responseType: \"arraybuffer\",\n                    enableCache,\n                    success: (res) => resolve(res.data),\n                    fail: reject,\n                });\n            }).catch((err) => {\n                const errorMessage = err.errMsg || err.errorMessage || err.message;\n                // FIXME: 可能存在写入网络缓存空间失败的情况，此时重新下载\n                if (errorMessage.includes(\"ERR_CACHE_WRITE_FAILURE\") ||\n                    errorMessage.includes(\"ERR_CACHE_WRITE_FAILED\")) {\n                    return download(url, false);\n                }\n                throw err;\n            });\n        }\n        return {\n            is: isRemote,\n            fetch: (url) => download(url, true),\n        };\n    },\n});\n\n/**\n * 用于处理本地文件存储\n * @returns\n */\nvar pluginFsm = definePlugin({\n    name: \"local\",\n    install() {\n        const { env, br } = this.globals;\n        if (env === \"h5\" || env === \"tt\") {\n            return null;\n        }\n        const fsm = br.getFileSystemManager();\n        return {\n            exists: (filepath) => new Promise((resolve) => {\n                fsm.access({\n                    path: filepath,\n                    success: () => resolve(true),\n                    fail: () => resolve(false),\n                });\n            }),\n            write: (data, filePath) => new Promise((resolve, reject) => {\n                fsm.writeFile({\n                    filePath,\n                    data,\n                    success: () => resolve(filePath),\n                    fail: reject,\n                });\n            }),\n            read: (filePath) => new Promise((resolve, reject) => {\n                fsm.readFile({\n                    filePath,\n                    success: (res) => resolve(res.data),\n                    fail: reject,\n                });\n            }),\n            remove: (filePath) => new Promise((resolve, reject) => {\n                fsm.unlink({\n                    filePath,\n                    success: () => resolve(filePath),\n                    fail: reject,\n                });\n            }),\n        };\n    },\n});\n\n/**\n * 图片加载插件\n * @package plugin-fsm 本地文件存储能力\n * @package plugin-path 路径处理能力\n * @package plugin-decode 解码能力\n */\nvar pluginImage = definePlugin({\n    name: \"image\",\n    dependencies: [\"local\", \"decode\"],\n    install() {\n        const { local, decode } = this;\n        const { env } = this.globals;\n        const printError = (msg) => console.error(`image error: ${msg}`);\n        let genImageSource = (data, _filepath) => (typeof data === \"string\" ? data : decode.toDataURL(data));\n        /**\n         * 加载图片\n         * @param img\n         * @param url\n         * @returns\n         */\n        function loadImage(img, url) {\n            return new Promise((resolve, reject) => {\n                img.onload = () => resolve(img);\n                img.onerror = () => reject(new Error(`SVGA LOADING FAILURE: ${url}`));\n                img.crossOrigin = \"anonymous\";\n                img.src = url;\n            });\n        }\n        function releaseImage(img) {\n            img.onload = null;\n            img.onerror = null;\n            img.src = \"\";\n        }\n        if (env === \"h5\") {\n            return {\n                create: (_) => new Image(),\n                load: async (createImage, data, filepath) => {\n                    // 由于ImageBitmap在图片渲染上有优势，故优先使用\n                    if (data instanceof Uint8Array && \"createImageBitmap\" in globalThis) {\n                        try {\n                            data = await createImageBitmap(new Blob([decode.toBuffer(data)]));\n                        }\n                        catch (ex) {\n                            printError(ex.message);\n                        }\n                    }\n                    if (data instanceof ImageBitmap) {\n                        return data;\n                    }\n                    return loadImage(createImage(), genImageSource(data, filepath));\n                },\n                release: releaseImage,\n            };\n        }\n        // FIXME: 支付宝小程序IDE保存临时文件会失败;抖音最大用户文件大小为10M\n        if (env === \"weapp\") {\n            genImageSource = async (data, filepath) => {\n                if (typeof data === \"string\") {\n                    return data;\n                }\n                // FIXME: IOS设备 微信小程序 Uint8Array转base64 时间较长，使用图片缓存形式速度会更快\n                return local\n                    .write(decode.toBuffer(data), filepath)\n                    .catch((ex) => {\n                    printError(ex.errorMessage || ex.errMsg || ex.message);\n                    return decode.toDataURL(data);\n                });\n            };\n        }\n        return {\n            create: (canvas) => canvas.createImage(),\n            load: async (createImage, data, filepath) => loadImage(createImage(), await genImageSource(data, filepath)),\n            release: releaseImage,\n        };\n    },\n});\n\nvar pluginNow = definePlugin({\n    name: \"now\",\n    install() {\n        const { env, br } = this.globals;\n        // performance可以提供更高精度的时间测量，且不受系统时间的调整（如更改系统时间或同步时间）的影响\n        const perf = env === \"h5\" || env === \"tt\" ? performance : br.getPerformance();\n        if (typeof perf?.now === \"function\") {\n            // 支付宝小程序的performance.now()获取的是当前时间戳，单位是微秒。\n            if (perf.now() - Date.now() > 1) {\n                return () => perf.now() / 1000;\n            }\n            // H5环境下，performance.now()获取的不是当前时间戳，而是从页面加载开始的时间戳，单位是毫秒。\n            return () => perf.now();\n        }\n        return () => Date.now();\n    },\n});\n\n/**\n * 用于创建离屏canvas\n * @returns\n */\nvar pluginOfsCanvas = definePlugin({\n    name: \"getOfsCanvas\",\n    install() {\n        const { env } = this.globals;\n        let createOffscreenCanvas;\n        if (env === \"h5\") {\n            createOffscreenCanvas = (options) => new OffscreenCanvas(options.width, options.height);\n        }\n        else if (env === \"alipay\") {\n            createOffscreenCanvas = (options) => my.createOffscreenCanvas(options);\n        }\n        else if (env === \"tt\") {\n            createOffscreenCanvas = (options) => {\n                const canvas = tt.createOffscreenCanvas();\n                canvas.width = options.width;\n                canvas.height = options.height;\n                return canvas;\n            };\n        }\n        else {\n            createOffscreenCanvas = (options) => wx.createOffscreenCanvas(options);\n        }\n        return (options) => {\n            const type = options.type || \"2d\";\n            const canvas = createOffscreenCanvas({ ...options, type });\n            const context = canvas.getContext(type);\n            return {\n                canvas,\n                context,\n            };\n        };\n    },\n});\n\n/**\n * 用于处理文件路径\n * @returns\n */\nvar pluginPath = definePlugin({\n    name: \"path\",\n    install() {\n        const { env, br } = this.globals;\n        const filename = (path) => {\n            const filepath = path.split(/\\?#/g)[0];\n            return filepath.substring(filepath.lastIndexOf(\"/\") + 1);\n        };\n        if (env === \"h5\" || env === \"tt\") {\n            return {\n                USER_DATA_PATH: \"\",\n                is: (_) => false,\n                filename,\n                resolve: (filename, prefix) => \"\",\n            };\n        }\n        const { USER_DATA_PATH } = br.env;\n        return {\n            USER_DATA_PATH,\n            is: (filepath) => filepath?.startsWith(USER_DATA_PATH),\n            filename,\n            resolve: (filename, prefix) => `${USER_DATA_PATH}/${prefix ? `${prefix}__` : \"\"}${filename}`,\n        };\n    },\n});\n\n/**\n * 用于处理requestAnimationFrame\n * @returns\n */\nvar pluginRaf = definePlugin({\n    name: \"rAF\",\n    install() {\n        const { env } = this.globals;\n        function requestAnimationFrameImpl() {\n            return (callback) => setTimeout(callback, Math.max(0, 16 - (Date.now() % 16)));\n        }\n        if (env === \"h5\") {\n            const rAF = \"requestAnimationFrame\" in globalThis\n                ? requestAnimationFrame\n                : requestAnimationFrameImpl();\n            return (_, callback) => rAF(callback);\n        }\n        return (canvas, callback) => {\n            // 检查canvas是否存在\n            try {\n                return canvas.requestAnimationFrame(callback);\n            }\n            catch (error) {\n                console.warn(error.message);\n                return requestAnimationFrameImpl()(callback);\n            }\n        };\n    },\n});\n\nvar pluginIntersectionObserver = definePlugin({\n    name: \"walkIn\",\n    install() {\n        const { env, br } = this.globals;\n        const thresholds = [0, 0.5, 1];\n        if (env === \"h5\") {\n            return (callback, selector, options = {}) => {\n                let observer = new IntersectionObserver((entries) => callback(entries[0].intersectionRatio > 0), {\n                    threshold: thresholds,\n                    root: options.root ? document.querySelector(options.root) : null,\n                });\n                if (options.observeAll) {\n                    document.querySelectorAll(selector)?.forEach((element) => observer.observe(element));\n                }\n                else {\n                    const element = document.querySelector(selector);\n                    if (element) {\n                        observer.observe(element);\n                    }\n                }\n                return () => {\n                    observer.disconnect();\n                    observer = null;\n                };\n            };\n        }\n        return (callback, selector, options = {}) => {\n            let observer = br.createIntersectionObserver(options.component, {\n                thresholds,\n                initialRatio: 0,\n                observeAll: options.observeAll,\n                // nativeMode: true,\n            });\n            if (options.root) {\n                observer.relativeTo(options.root);\n            }\n            else {\n                observer.relativeToViewport();\n            }\n            observer.observe(selector, (res) => callback(res.intersectionRatio > 0));\n            return () => {\n                observer.disconnect();\n                observer = null;\n            };\n        };\n    },\n});\n\nexport { OctopusPlatform, definePlugin, installPlugin, pluginCanvas, pluginDecode, pluginDownload, pluginFsm, pluginImage, pluginIntersectionObserver, pluginNow, pluginOfsCanvas, pluginPath, pluginRaf as pluginRAF, pluginSelector };\n//# sourceMappingURL=index.js.map\n","import {\n  OctopusPlatform,\n  installPlugin,\n  type OctopusPlatformPlugins,\n  type OctopusPlatformPluginOptions,\n  pluginNow,\n} from \"octopus-platform\";\n\nexport type PlatformProperties = \"now\";\n\nclass EnhancedPlatform extends OctopusPlatform<PlatformProperties> {\n  now!: OctopusPlatformPlugins[\"now\"];\n\n  constructor() {\n    super([pluginNow], __VERSION__);\n\n    this.init();\n  }\n\n  installPlugin(plugin: OctopusPlatformPluginOptions<PlatformProperties>) {\n    installPlugin<PlatformProperties>(this, plugin);\n  }\n}\n\nexport const platform = new EnhancedPlatform();\n","import { platform } from \"./platform\";\n\nconst logBadge = [\n  \"%cBENCHMARK\",\n  \"padding: 2px 4px; background: #68B984; color: #FFFFFF; border-radius: 4px;\",\n];\nconst infoBadge = [\n  \"%cBENCHMARK\",\n  \"padding: 2px 4px; background: #89CFF0; color: #FFFFFF; border-radius: 4px;\",\n]\n\nclass Stopwatch {\n  private readonly timeLabels: Map<string, number> = new Map();\n\n  private readonly markLabels: Map<string, number> = new Map();\n\n  start(label: string) {\n    this.timeLabels.set(label, platform.now());\n  }\n\n  stop(label: string) {\n    const nowTime = platform.now();\n    const { timeLabels } = this;\n\n    if (timeLabels.has(label)) {\n      console.log(`${label}: ${nowTime - timeLabels.get(label)!} ms`);\n      timeLabels.delete(label);\n    }\n  }\n\n  mark(label: string) {\n    const nowTime = platform.now();\n    const { markLabels } = this;\n\n    if (markLabels.has(label)) {\n      console.log(`${label}: ${nowTime - markLabels.get(label)!} ms`);\n    }\n\n    markLabels.set(label, nowTime);\n  }\n\n  reset(label: string) {\n    this.markLabels.delete(label);\n  }\n\n  clear() {\n    this.timeLabels.clear();\n    this.markLabels.clear();\n  }\n}\n\nexport interface Benchmark extends Stopwatch {\n  now: () => number;\n  time: <T extends any = any>(\n    label: string,\n    callback: () => Promise<T> | T\n  ) => Promise<T>;\n  line: (size: number) => void;\n  log: (...message: unknown[]) => void;\n  info: (...message: unknown[]) => void;\n}\n\nconst stopwatch = new Stopwatch();\nconst benchmark: Benchmark = Object.create(stopwatch);\n\nbenchmark.now = () => platform.now();\n\nbenchmark.time = async (label, callback) => {\n  stopwatch.start(label);\n  const result = await callback();\n  stopwatch.stop(label);\n\n  return result;\n};\n\nbenchmark.line = (size = 40) => {\n  console.log(\"-\".repeat(size));\n};\n\nbenchmark.log = (...message) => {\n  console.log(...logBadge, ...message);\n};\n\nbenchmark.info = (...message) => {\n  console.info(...infoBadge, ...message);\n};\n\nexport { benchmark };\n"],"names":["noop","EnhancedPlatform","_OctopusPlatform","_this","_classCallCheck","_callSuper","pluginNow","__VERSION__","init","_inherits","_createClass","key","value","installPlugin","plugin","OctopusPlatform","platform","logBadge","infoBadge","Stopwatch","timeLabels","Map","markLabels","start","label","set","now","stop","nowTime","has","console","log","concat","get","delete","mark","reset","clear","stopwatch","benchmark","Object","create","time","callback","__awaiter","_regenerator","m","_callee","result","w","_context","n","v","a","line","size","arguments","length","undefined","repeat","_console","_len","message","Array","_key","apply","info","_console2","_len2","_key2"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;CAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAkGA;AACO,SAAS,SAAS,CAAC,OAAO,EAAE,UAAU,EAAE,CAAC,EAAE,SAAS,EAAE;AAC7D,IAAI,SAAS,KAAK,CAAC,KAAK,EAAE,EAAE,OAAO,KAAK,YAAY,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,UAAU,OAAO,EAAE,EAAE,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AAChH,IAAI,OAAO,KAAK,CAAC,KAAK,CAAC,GAAG,OAAO,CAAC,EAAE,UAAU,OAAO,EAAE,MAAM,EAAE;AAC/D,QAAQ,SAAS,SAAS,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACnG,QAAQ,SAAS,QAAQ,CAAC,KAAK,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,EAAE,EAAE,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACtG,QAAQ,SAAS,IAAI,CAAC,MAAM,EAAE,EAAE,MAAM,CAAC,IAAI,GAAG,OAAO,CAAC,MAAM,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,CAAC,CAAC,CAAC,CAAC;AACtH,QAAQ,IAAI,CAAC,CAAC,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,OAAO,EAAE,UAAU,IAAI,EAAE,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;AAC9E,IAAI,CAAC,CAAC,CAAC;AACP,CAAC;AA6MD;AACuB,OAAO,eAAe,KAAK,UAAU,GAAG,eAAe,GAAG,UAAU,KAAK,EAAE,UAAU,EAAE,OAAO,EAAE;AACvH,IAAI,IAAI,CAAC,GAAG,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC;AAC/B,IAAI,OAAO,CAAC,CAAC,IAAI,GAAG,iBAAiB,EAAE,CAAC,CAAC,KAAK,GAAG,KAAK,EAAE,CAAC,CAAC,UAAU,GAAG,UAAU,EAAE,CAAC,CAAC;AACrF,EC3UO,IAAMA,IAAI,GAAI,SAARA,IAAIA,GAAS,CAAE,CAAuB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GCMzB,IAIpBC,gBAAiB,0BAAAC,gBAAA,EAAA;AAGrB,EAAA,SAAAD,mBAAA;AAAA,IAAA,IAAAE,KAAA;AAAAC,IAAAA,eAAA,OAAAH,gBAAA,CAAA;IACEE,KAAA,GAAAE,UAAA,CAAA,IAAA,EAAAJ,gBAAA,GAAM,CAACK,SAAS,CAAC,EAAEC,OAAW,CAAA,CAAA;IAE9BJ,KAAA,CAAKK,IAAI,EAAE;AAAC,IAAA,OAAAL,KAAA;AACd,EAAA;EAACM,SAAA,CAAAR,gBAAA,EAAAC,gBAAA,CAAA;EAAA,OAAAQ,YAAA,CAAAT,gBAAA,EAAA,CAAA;IAAAU,GAAA,EAAA,eAAA;AAAAC,IAAAA,KAAA,EAED,SAAAC,eAAaA,CAACC,MAAwD,EAAA;AACpED,MAAAA,aAAa,CAAqB,IAAI,EAAEC,MAAM,CAAC;AACjD,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,CAX4BC,eAAmC,CAAA;AAc3D,IAAMC,QAAQ,GAAG,IAAIf,gBAAgB,EAAE,CCtB9C,IAAMgB,QAAQ,GAAG,CACf,aAAa,EACb,4EAA4E,CAC7E;AACD,IAAMC,SAAS,GAAG,CAChB,aAAa,EACb,4EAA4E,CAC7E;AAAA,IAEKC,SAAS,gBAAA,YAAA;AAAf,EAAA,SAAAA,YAAA;AAAAf,IAAAA,eAAA,OAAAe,SAAA,CAAA;AACmB,IAAA,IAAA,CAAAC,UAAU,GAAwB,IAAIC,GAAG,EAAE;AAE3C,IAAA,IAAA,CAAAC,UAAU,GAAwB,IAAID,GAAG,EAAE;AAmC9D,EAAA;EAAC,OAAAX,YAAA,CAAAS,SAAA,EAAA,CAAA;IAAAR,GAAA,EAAA,OAAA;AAAAC,IAAAA,KAAA,EAjCC,SAAAW,KAAKA,CAACC,KAAa,EAAA;AACjB,MAAA,IAAI,CAACJ,UAAU,CAACK,GAAG,CAACD,KAAK,EAAER,QAAQ,CAACU,GAAG,EAAE,CAAC;AAC5C,IAAA;AAAC,GAAA,EAAA;IAAAf,GAAA,EAAA,MAAA;AAAAC,IAAAA,KAAA,EAED,SAAAe,IAAIA,CAACH,KAAa,EAAA;AAChB,MAAA,IAAMI,OAAO,GAAGZ,QAAQ,CAACU,GAAG,EAAE;AAC9B,MAAA,IAAQN,UAAU,GAAK,IAAI,CAAnBA,UAAU;AAElB,MAAA,IAAIA,UAAU,CAACS,GAAG,CAACL,KAAK,CAAC,EAAE;AACzBM,QAAAA,OAAO,CAACC,GAAG,CAAA,EAAA,CAAAC,MAAA,CAAIR,KAAK,QAAAQ,MAAA,CAAKJ,OAAO,GAAGR,UAAU,CAACa,GAAG,CAACT,KAAK,CAAE,QAAK,CAAC;AAC/DJ,QAAAA,UAAU,CAACc,MAAM,CAACV,KAAK,CAAC;AAC1B,MAAA;AACF,IAAA;AAAC,GAAA,EAAA;IAAAb,GAAA,EAAA,MAAA;AAAAC,IAAAA,KAAA,EAED,SAAAuB,IAAIA,CAACX,KAAa,EAAA;AAChB,MAAA,IAAMI,OAAO,GAAGZ,QAAQ,CAACU,GAAG,EAAE;AAC9B,MAAA,IAAQJ,UAAU,GAAK,IAAI,CAAnBA,UAAU;AAElB,MAAA,IAAIA,UAAU,CAACO,GAAG,CAACL,KAAK,CAAC,EAAE;AACzBM,QAAAA,OAAO,CAACC,GAAG,CAAA,EAAA,CAAAC,MAAA,CAAIR,KAAK,QAAAQ,MAAA,CAAKJ,OAAO,GAAGN,UAAU,CAACW,GAAG,CAACT,KAAK,CAAE,QAAK,CAAC;AACjE,MAAA;AAEAF,MAAAA,UAAU,CAACG,GAAG,CAACD,KAAK,EAAEI,OAAO,CAAC;AAChC,IAAA;AAAC,GAAA,EAAA;IAAAjB,GAAA,EAAA,OAAA;AAAAC,IAAAA,KAAA,EAED,SAAAwB,KAAKA,CAACZ,KAAa,EAAA;AACjB,MAAA,IAAI,CAACF,UAAU,CAACY,MAAM,CAACV,KAAK,CAAC;AAC/B,IAAA;AAAC,GAAA,EAAA;IAAAb,GAAA,EAAA,OAAA;AAAAC,IAAAA,KAAA,EAED,SAAAyB,KAAKA,GAAA;AACH,MAAA,IAAI,CAACjB,UAAU,CAACiB,KAAK,EAAE;AACvB,MAAA,IAAI,CAACf,UAAU,CAACe,KAAK,EAAE;AACzB,IAAA;AAAC,GAAA,CAAA,CAAA;AAAA,CAAA,EAAA;AAcH,IAAMC,SAAS,GAAG,IAAInB,SAAS,EAAE;AACjC,IAAMoB,SAAS,GAAcC,MAAM,CAACC,MAAM,CAACH,SAAS;AAEpDC,SAAS,CAACb,GAAG,GAAG,YAAA;AAAA,EAAA,OAAMV,QAAQ,CAACU,GAAG,EAAE;AAAA,CAAA;AAEpCa,SAAS,CAACG,IAAI,GAAG,UAAOlB,KAAK,EAAEmB,QAAQ,EAAA;AAAA,EAAA,OAAIC,SAAA,CAAA,MAAA,EAAA,MAAA,EAAA,MAAA,eAAAC,YAAA,EAAA,CAAAC,CAAA,CAAA,SAAAC,OAAAA,GAAA;AAAA,IAAA,IAAAC,MAAA;AAAA,IAAA,OAAAH,YAAA,EAAA,CAAAI,CAAA,CAAA,UAAAC,QAAA,EAAA;MAAA,OAAA,CAAA,EAAA,QAAAA,QAAA,CAAAC,CAAA;AAAA,QAAA,KAAA,CAAA;AACzCb,UAAAA,SAAS,CAACf,KAAK,CAACC,KAAK,CAAC;AAAC0B,UAAAA,QAAA,CAAAC,CAAA,GAAA,CAAA;UACR,OAAMR,QAAQ,EAAE;AAAA,QAAA,KAAA,CAAA;UAAzBK,MAAM,GAAAE,QAAA,CAAAE,CAAA;AACZd,UAAAA,SAAS,CAACX,IAAI,CAACH,KAAK,CAAC;AAAC,UAAA,OAAA0B,QAAA,CAAAG,CAAA,CAAA,CAAA,EAEfL,MAAM,CAAA;AAAA;AAAA,IAAA,CAAA,EAAAD,OAAA,CAAA;AAAA,EAAA,CACd,CAAA,CAAA;AAAA,CAAA;AAEDR,SAAS,CAACe,IAAI,GAAG,YAAc;AAAA,EAAA,IAAbC,IAAI,GAAAC,SAAA,CAAAC,MAAA,GAAA,CAAA,IAAAD,SAAA,CAAA,CAAA,CAAA,KAAAE,SAAA,GAAAF,SAAA,CAAA,CAAA,CAAA,GAAG,EAAE;EACzB1B,OAAO,CAACC,GAAG,CAAC,GAAG,CAAC4B,MAAM,CAACJ,IAAI,CAAC,CAAC;AAC/B,CAAC;AAEDhB,SAAS,CAACR,GAAG,GAAG,YAAe;AAAA,EAAA,IAAA6B,QAAA;AAAA,EAAA,KAAA,IAAAC,IAAA,GAAAL,SAAA,CAAAC,MAAA,EAAXK,OAAO,GAAA,IAAAC,KAAA,CAAAF,IAAA,GAAAG,IAAA,GAAA,CAAA,EAAAA,IAAA,GAAAH,IAAA,EAAAG,IAAA,EAAA,EAAA;AAAPF,IAAAA,OAAO,CAAAE,IAAA,CAAA,GAAAR,SAAA,CAAAQ,IAAA,CAAA;AAAA,EAAA;AACzB,EAAA,CAAAJ,QAAA,GAAA9B,OAAO,EAACC,GAAG,CAAAkC,KAAA,CAAAL,QAAA,EAAI3C,QAAQ,CAAAe,MAAA,CAAK8B,OAAO,CAAA,CAAC;AACtC,CAAC;AAEDvB,SAAS,CAAC2B,IAAI,GAAG,YAAe;AAAA,EAAA,IAAAC,SAAA;AAAA,EAAA,KAAA,IAAAC,KAAA,GAAAZ,SAAA,CAAAC,MAAA,EAAXK,OAAO,GAAA,IAAAC,KAAA,CAAAK,KAAA,GAAAC,KAAA,GAAA,CAAA,EAAAA,KAAA,GAAAD,KAAA,EAAAC,KAAA,EAAA,EAAA;AAAPP,IAAAA,OAAO,CAAAO,KAAA,CAAA,GAAAb,SAAA,CAAAa,KAAA,CAAA;AAAA,EAAA;AAC1B,EAAA,CAAAF,SAAA,GAAArC,OAAO,EAACoC,IAAI,CAAAD,KAAA,CAAAE,SAAA,EAAIjD,SAAS,CAAAc,MAAA,CAAK8B,OAAO,CAAA,CAAC;AACxC,CAAC","x_google_ignoreList":[0]}
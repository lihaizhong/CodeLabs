{"version":3,"file":"index.min.js","sources":["../src/platform.ts","../src/index.ts"],"sourcesContent":["import { Platform, pluginNow, pluginSystem } from \"octopus-platform\";\nimport { version } from \"../package.json\";\n\nexport type PlatformProperties = \"now\" | \"system\";\n\nclass EnhancedPlatform extends Platform<PlatformProperties> {\n  now!: OctopusPlatform.PlatformPlugin[\"now\"];\n\n  system!: OctopusPlatform.PlatformPlugin[\"system\"];\n\n  constructor() {\n    super([pluginNow, pluginSystem], version);\n\n    this.init();\n  }\n\n  installPlugin(\n    plugin: OctopusPlatform.PlatformPluginOptions<PlatformProperties>\n  ) {\n    const value = plugin.install.call<\n      EnhancedPlatform,\n      [],\n      OctopusPlatform.PlatformPluginValue<PlatformProperties>\n    >(this);\n\n    Object.defineProperty(this, plugin.name, {\n      get: () => value,\n      enumerable: true,\n      configurable: true,\n    });\n  }\n}\n\nexport const platform = new EnhancedPlatform();\n","import { platform } from \"./platform\";\n\nconst badge = [\n  \"%cBENCHMARK\",\n  \"padding: 2px 4px; background: #68B984; color: #FFFFFF; border-radius: 4px;\",\n];\n\nclass Stopwatch {\n  private readonly isRealMachine = [\"ios\", \"android\", \"openharmony\"].includes(\n    platform.system\n  );\n\n  private readonly timeLabels: Map<string, number> = new Map();\n\n  private readonly markLabels: Map<string, number> = new Map();\n\n  start(label: string) {\n    if (this.isRealMachine) {\n      this.timeLabels.set(label, platform.now());\n    } else {\n      console.time(label);\n    }\n  }\n\n  stop(label: string) {\n    if (this.isRealMachine) {\n      const nowTime = platform.now();\n\n      if (this.timeLabels.has(label)) {\n        console.log(\n          `${label}: ${nowTime - (this.timeLabels.get(label) as number)} ms`\n        );\n        this.timeLabels.delete(label);\n      }\n    } else {\n      console.timeEnd(label);\n    }\n  }\n\n  mark(label: string) {\n    const nowTime = platform.now();\n\n    if (this.markLabels.has(label)) {\n      console.log(\n        `${label}: ${nowTime - (this.markLabels.get(label) as number)} ms`\n      );\n    }\n\n    this.markLabels.set(label, nowTime);\n  }\n\n  reset(label: string) {\n    this.markLabels.delete(label);\n  }\n\n  clear() {\n    this.timeLabels.clear();\n    this.markLabels.clear();\n  }\n}\n\nexport interface Benchmark extends Stopwatch {\n  now: () => number;\n  time: <T extends any = any>(\n    label: string,\n    callback: () => Promise<T> | T\n  ) => Promise<T> | T;\n  line: (size: number) => void;\n  log: (...message: unknown[]) => void;\n}\n\nconst stopwatch = new Stopwatch();\nconst benchmark: Benchmark = Object.create(stopwatch);\n\nbenchmark.now = () => platform.now();\n\nbenchmark.time = async (label, callback) => {\n  stopwatch.start(label);\n  const result = await callback();\n  stopwatch.stop(label);\n\n  return result;\n};\n\nbenchmark.line = (size = 40) => {\n  console.log(\"-\".repeat(size));\n};\n\nbenchmark.log = (...message) => {\n  console.log(...badge, ...message);\n};\n\nexport default benchmark;\n"],"names":["platform","Platform","now","system","constructor","super","pluginNow","pluginSystem","this","init","installPlugin","plugin","value","install","call","Object","defineProperty","name","get","enumerable","configurable","badge","stopwatch","isRealMachine","includes","timeLabels","Map","markLabels","start","label","set","console","time","stop","nowTime","has","log","delete","timeEnd","mark","reset","clear","benchmark","create","async","callback","result","line","size","repeat","message"],"mappings":"6EAiCO,MAAMA,EAAW,IA5BxB,cAA+BC,EAC7BC,IAEAC,OAEA,WAAAC,GACEC,MAAM,CAACC,EAAWC,YAElBC,KAAKC,OAGP,aAAAC,CACEC,GAEA,MAAMC,EAAQD,EAAOE,QAAQC,KAI3BN,MAEFO,OAAOC,eAAeR,KAAMG,EAAOM,KAAM,CACvCC,IAAK,IAAMN,EACXO,YAAY,EACZC,cAAc,MC1BdC,EAAQ,CACZ,cACA,8EAmEF,MAAMC,EAAY,IAhElB,MACmBC,cAAgB,CAAC,MAAO,UAAW,eAAeC,SACjExB,EAASG,QAGMsB,WAAkC,IAAIC,IAEtCC,WAAkC,IAAID,IAEvD,KAAAE,CAAMC,GACArB,KAAKe,cACPf,KAAKiB,WAAWK,IAAID,EAAO7B,EAASE,OAEpC6B,QAAQC,KAAKH,GAIjB,IAAAI,CAAKJ,GACH,GAAIrB,KAAKe,cAAe,CACtB,MAAMW,EAAUlC,EAASE,MAErBM,KAAKiB,WAAWU,IAAIN,KACtBE,QAAQK,IACN,GAAGP,MAAUK,EAAW1B,KAAKiB,WAAWP,IAAIW,SAE9CrB,KAAKiB,WAAWY,OAAOR,SAGzBE,QAAQO,QAAQT,GAIpB,IAAAU,CAAKV,GACH,MAAMK,EAAUlC,EAASE,MAErBM,KAAKmB,WAAWQ,IAAIN,IACtBE,QAAQK,IACN,GAAGP,MAAUK,EAAW1B,KAAKmB,WAAWT,IAAIW,SAIhDrB,KAAKmB,WAAWG,IAAID,EAAOK,GAG7B,KAAAM,CAAMX,GACJrB,KAAKmB,WAAWU,OAAOR,GAGzB,KAAAY,GACEjC,KAAKiB,WAAWgB,QAChBjC,KAAKmB,WAAWc,UAedC,EAAuB3B,OAAO4B,OAAOrB,GAE3CoB,EAAUxC,IAAM,IAAMF,EAASE,MAE/BwC,EAAUV,KAAOY,MAAOf,EAAOgB,KAC7BvB,EAAUM,MAAMC,GAChB,MAAMiB,QAAeD,IAGrB,OAFAvB,EAAUW,KAAKJ,GAERiB,CAAM,EAGfJ,EAAUK,KAAO,CAACC,EAAO,MACvBjB,QAAQK,IAAI,IAAIa,OAAOD,GAAM,EAG/BN,EAAUN,IAAM,IAAIc,KAClBnB,QAAQK,OAAOf,KAAU6B,EAAQ"}
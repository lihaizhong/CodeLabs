{"version":3,"file":"index.js","sources":["../src/extensions/noop.ts","../src/extensions/retry.ts","../src/extensions/utf8.ts","../src/platform.ts","../src/definePlugin.ts","../src/plugins/plugin-canvas.ts","../src/plugins/plugin-decode.ts","../src/plugins/plugin-download.ts","../src/plugins/plugin-fsm.ts","../src/plugins/plugin-image.ts","../src/plugins/plugin-now.ts","../src/plugins/plugin-ofs-canvas.ts","../src/plugins/plugin-path.ts","../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","retry","async","fn","intervals","times","err","length","callback","interval","Promise","resolve","setTimeout","BUFFER_SIZE","STATIC_BUFFER","Uint16Array","utf8","buffer","start","end","RangeError","resultParts","bufferPos","appendBuffer","parts","push","String","fromCharCode","apply","Array","from","allAscii","i","len","Math","min","j","subarray","join","byte","codePoint","Platform","plugins","globalCanvas","platformVersion","version","globals","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","usePlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","installedPlugins","forEach","pluginName","undefined","isArray","dependencies","dependency","install","installPlugin","setGlobalCanvas","canvas","getGlobalCanvas","definePlugin","pluginCanvas","initCanvas","width","height","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","slice","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","type","decode","toBuffer","data","byteOffset","byteLength","bytesToString","result","chunk","textDecoder","TextDecoder","fatal","toDataURL","btoa","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","caches","point","loadImage","img","src","onload","onerror","createImage","Image","genImageSource","load","_filename","_prefix","Uint8Array","createImageBitmap","Blob","ImageBitmap","release","close","shift","filename","prefix","ex","console","warn","USER_DATA_PATH","Set","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","pluginPath","substring","lastIndexOf","getEnvInfoSync","common","pluginRaf","requestAnimationFrameImpl","max","rAF","requestAnimationFrame","error"],"mappings":"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"}
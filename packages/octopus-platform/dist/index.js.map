{"version":3,"file":"index.js","sources":["../../src/extensions/noop.ts","../../src/extensions/retry.ts","../../src/extensions/utf8.ts","../../src/platform.ts","../../src/definePlugin.ts","../../src/plugins/plugin-canvas.ts","../../src/plugins/plugin-decode.ts","../../src/plugins/plugin-download.ts","../../src/plugins/plugin-fsm.ts","../../src/plugins/plugin-image.ts","../../src/plugins/plugin-now.ts","../../src/plugins/plugin-ofs-canvas.ts","../../src/plugins/plugin-path.ts","../../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","async","retry","fn","intervals","times","err","length","Promise","resolve","setTimeout","utf8","buffer","start","end","RangeError","codes","asciiCodes","Array","fromCharCode","String","asciiPos","i","t","push","slice","codePoint","join","OctopusPlatform","plugins","platformVersion","version","global","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","installPlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","usedPlugins","forEach","pluginName","undefined","isArray","dependencies","value","install","call","Reflect","set","definePlugin","pluginCanvas","initCanvas","canvas","width","height","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","decode","toBuffer","data","byteOffset","byteLength","textDecoder","TextDecoder","toBitmap","createImageBitmap","Blob","toDataURL","btoa","subarray","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","cachedImages","Set","loadImage","img","src","onload","has","delete","onerror","createImage","_","Image","genImageSource","isImage","isImageBitmap","ImageBitmap","create","load","_filename","_prefix","Uint8Array","filename","prefix","add","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","type","pluginPath","substring","lastIndexOf","USER_DATA_PATH","getEnvInfoSync","common","pluginRaf","callback","requestAnimationFrame"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../src/extensions/noop.ts","../src/extensions/retry.ts","../src/extensions/utf8.ts","../src/platform.ts","../src/definePlugin.ts","../src/plugins/plugin-canvas.ts","../src/plugins/plugin-decode.ts","../src/plugins/plugin-download.ts","../src/plugins/plugin-fsm.ts","../src/plugins/plugin-image.ts","../src/plugins/plugin-now.ts","../src/plugins/plugin-ofs-canvas.ts","../src/plugins/plugin-path.ts","../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","retry","async","fn","intervals","times","err","length","callback","interval","Promise","resolve","setTimeout","utf8","buffer","start","end","RangeError","codes","asciiCodes","Array","fromCharCode","String","asciiPos","i","t","push","slice","codePoint","join","Platform","plugins","globalCanvas","platformVersion","version","globals","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","usePlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","installedPlugins","forEach","pluginName","undefined","isArray","dependencies","dependency","install","installPlugin","setGlobalCanvas","canvas","getGlobalCanvas","definePlugin","pluginCanvas","initCanvas","width","height","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","type","decode","toBuffer","data","byteOffset","byteLength","bytesToString","result","chunk","apply","from","textDecoder","TextDecoder","fatal","toDataURL","btoa","subarray","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","loadedFiles","Set","loadImage","img","src","onload","has","delete","onerror","createImage","Image","genImageSource","isImage","isImageBitmap","ImageBitmap","create","load","_filename","_prefix","Uint8Array","createImageBitmap","Blob","_","filename","prefix","add","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","pluginPath","substring","lastIndexOf","USER_DATA_PATH","getEnvInfoSync","common","pluginRaf","requestAnimationFrameImpl","Math","max","rAF","requestAnimationFrame","bind","error"],"mappings":"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"}
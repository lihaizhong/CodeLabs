{"version":3,"file":"index.js","sources":["../src/extensions/noop.ts","../src/extensions/retry.ts","../src/extensions/utf8.ts","../src/platform.ts","../src/definePlugin.ts","../src/plugins/plugin-canvas.ts","../src/plugins/plugin-decode.ts","../src/plugins/plugin-download.ts","../src/plugins/plugin-fsm.ts","../src/plugins/plugin-image.ts","../src/plugins/plugin-now.ts","../src/plugins/plugin-ofs-canvas.ts","../src/plugins/plugin-path.ts","../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","retry","async","fn","intervals","times","err","length","callback","interval","Promise","resolve","setTimeout","BUFFER_SIZE","STATIC_BUFFER","Uint16Array","utf8","buffer","start","end","RangeError","resultParts","bufferPos","appendBuffer","parts","push","String","fromCharCode","apply","Array","from","allAscii","i","len","Math","min","j","subarray","join","byte","codePoint","Platform","plugins","platformVersion","version","globals","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","usePlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","installedPlugins","forEach","pluginName","undefined","isArray","dependencies","dependency","install","installPlugin","definePlugin","pluginCanvas","initCanvas","canvas","width","height","context","getContext","querySelector","selector","document","slice","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","type","decode","toBuffer","data","byteOffset","byteLength","ArrayBuffer","buff","Uint8Array","set","bytesToString","result","chunk","textDecoder","TextDecoder","fatal","toDataURL","btoa","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","genImageSource","_filepath","loadImage","img","src","onload","onerror","releaseImage","create","_","Image","load","createImage","filepath","createImageBitmap","Blob","ImageBitmap","release","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","pluginPath","filename","path","substring","lastIndexOf","USER_DATA_PATH","prefix","getEnvInfoSync","common","startsWith","pluginRaf","requestAnimationFrameImpl","max","rAF","requestAnimationFrame","error"],"mappings":"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"}
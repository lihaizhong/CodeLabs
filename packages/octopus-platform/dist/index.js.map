{"version":3,"file":"index.js","sources":["../src/extensions/noop.ts","../src/extensions/retry.ts","../src/extensions/utf8.ts","../src/platform.ts","../src/definePlugin.ts","../src/plugins/plugin-canvas.ts","../src/plugins/plugin-decode.ts","../src/plugins/plugin-download.ts","../src/plugins/plugin-fsm.ts","../src/plugins/plugin-image.ts","../src/plugins/plugin-now.ts","../src/plugins/plugin-ofs-canvas.ts","../src/plugins/plugin-path.ts","../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","retry","async","fn","intervals","times","err","length","callback","interval","Promise","resolve","setTimeout","BUFFER_SIZE","STATIC_BUFFER","Uint16Array","utf8","buffer","start","end","RangeError","resultParts","bufferPos","appendBuffer","parts","push","String","fromCharCode","apply","Array","from","allAscii","i","len","Math","min","j","subarray","join","byte","codePoint","OctopusPlatform","plugins","platformVersion","version","globals","env","br","dpr","system","constructor","this","autoEnv","init","collection","Map","names","installedPlugins","Set","useBridge","usePixelRatio","useSystem","plugin","name","set","usePlugins","clear","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","getDeviceInfo","platform","getDeviceBaseInfo","getDeviceInfoSync","toLowerCase","pluginNames","pluginName","has","get","isArray","dependencies","dependency","install","installPlugin","add","definePlugin","pluginCanvas","initCanvas","canvas","width","height","context","getContext","querySelector","selector","document","slice","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","type","decode","toBuffer","data","byteOffset","byteLength","ArrayBuffer","buff","Uint8Array","bytesToString","result","chunk","textDecoder","TextDecoder","fatal","toDataURL","btoa","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","genImageSource","_filepath","loadImage","img","onload","onerror","src","releaseImage","create","_","Image","load","createImage","filepath","createImageBitmap","Blob","ImageBitmap","release","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","pluginPath","filename","path","substring","lastIndexOf","USER_DATA_PATH","prefix","getEnvInfoSync","common","startsWith","pluginRaf","requestAnimationFrameImpl","max","rAF","requestAnimationFrame","error"],"mappings":"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"}

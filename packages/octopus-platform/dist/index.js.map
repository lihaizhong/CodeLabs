{"version":3,"file":"index.js","sources":["../../src/extensions/noop.ts","../../src/extensions/retry.ts","../../src/extensions/utf8.ts","../../src/platform.ts","../../src/definePlugin.ts","../../src/plugins/plugin-canvas.ts","../../src/plugins/plugin-decode.ts","../../src/plugins/plugin-download.ts","../../src/plugins/plugin-fsm.ts","../../src/plugins/plugin-image.ts","../../src/plugins/plugin-now.ts","../../src/plugins/plugin-ofs-canvas.ts","../../src/plugins/plugin-path.ts","../../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","retry","async","fn","intervals","times","err","length","callback","interval","Promise","resolve","setTimeout","utf8","buffer","start","end","RangeError","codes","asciiCodes","Array","fromCharCode","String","asciiPos","i","t","push","slice","codePoint","join","OctopusPlatform","plugins","platformVersion","version","globals","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","usePlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","installedPlugins","forEach","pluginName","undefined","isArray","dependencies","dependency","installPlugin","definePlugin","pluginCanvas","install","initCanvas","canvas","width","height","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","pluginDecode","b64Wrap","b64","type","decode","toBuffer","data","byteOffset","byteLength","bytesToString","result","chunk","apply","from","textDecoder","TextDecoder","toBitmap","createImageBitmap","Blob","toDataURL","btoa","subarray","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","cachedImages","Set","loadImage","img","src","onload","has","delete","onerror","createImage","_","Image","genImageSource","isImage","isImageBitmap","ImageBitmap","create","load","_filename","_prefix","Uint8Array","filename","prefix","add","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","pluginPath","substring","lastIndexOf","USER_DATA_PATH","getEnvInfoSync","common","pluginRaf","requestAnimationFrame"],"mappings":"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"}
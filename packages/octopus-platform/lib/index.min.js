!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((n="undefined"!=typeof globalThis?globalThis:n||self).OctopusPlatform={})}(this,(function(n){"use strict";var e=function(){},t=function(){return t=Object.assign||function(n){for(var e,t=1,r=arguments.length;t<r;t++)for(var o in e=arguments[t])Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},t.apply(this,arguments)};function r(n,e,t,r){return new(t||(t=Promise))((function(o,i){function a(n){try{c(r.next(n))}catch(n){i(n)}}function u(n){try{c(r.throw(n))}catch(n){i(n)}}function c(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,u)}c((r=r.apply(n,e||[])).next())}))}function o(n,e){var t,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(t=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(n,i)}catch(n){u=[6,n],r=0}finally{t=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function i(n){return r(this,arguments,void 0,(function(n,e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),o(this,(function(r){try{return[2,n()]}catch(r){if(t>=e.length)throw r;return[2,(o=function(){return i(n,e,++t)},a=e[t],new Promise((function(n){return setTimeout((function(){return n(o())}),a)})))]}var o,a;return[2]}))}))}"function"==typeof SuppressedError&&SuppressedError;var a=4096,u=new Uint16Array(a);function c(n,e,t){if(e<0||t>n.length)throw new RangeError("Index out of range");if(t-e<1)return"";for(var r=[],o=0,i=function(n){r.push(String.fromCharCode.apply(null,Array.from(n)))},c=!0,s=e;s<t;s++)if(n[s]>127){c=!1;break}if(c){for(s=e;s<t;s+=a){for(var f=Math.min(s+a,t)-s,l=0;l<f;l++)u[l]=n[s+l];i(u.subarray(0,f))}return r.join("")}for(s=e;s<t;){var h=n[s++];if(h<128)u[o++]=h,o===a&&(i(u),o=0);else{o>0&&(i(u.subarray(0,o)),o=0);var v=void 0;if(192==(224&h)&&s<t)v=(31&h)<<6|63&n[s++];else if(224==(240&h)&&s+1<t)v=(15&h)<<12|(63&n[s++])<<6|63&n[s++];else if(240==(248&h)&&s+2<t){if((v=(7&h)<<18|(63&n[s++])<<12|(63&n[s++])<<6|63&n[s++])>65535){v-=65536,u[o++]=55296+(v>>10),u[o++]=56320+(1023&v),o>=4094&&(i(u.subarray(0,o)),o=0);continue}}else for(v=65533;s<t&&128==(192&n[s]);)s++;u[o++]=v,o>=4093&&(i(u.subarray(0,o)),o=0)}}return o>0&&i(u.subarray(0,o)),r.join("")}var s=function(){function n(n,t){this.plugins=[],this.platformVersion="0.1.2",this.version="",this.globals={env:"unknown",br:null,dpr:1,system:"unknown"},this.noop=e,this.retry=i,this.version=t||"",this.plugins=n,this.globals.env=this.autoEnv()}return n.prototype.init=function(){var n=this.globals,e=this.plugins,t=new Map,r=[],o=new Set;n.br=this.useBridge(),n.dpr=this.usePixelRatio(),n.system=this.useSystem();for(var i=0,a=e;i<a.length;i++){var u=a[i];r.push(u.name),t.set(u.name,u)}this.usePlugins(t,r,o),o.clear()},n.prototype.autoEnv=function(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported platform！")},n.prototype.useBridge=function(){switch(this.globals.env){case"alipay":return my;case"tt":return tt;case"weapp":return wx}return globalThis},n.prototype.usePixelRatio=function(){var n=this.globals,e=n.env,t=n.br;return"h5"===e?devicePixelRatio:"getWindowInfo"in t?t.getWindowInfo().pixelRatio:"getSystemInfoSync"in t?t.getSystemInfoSync().pixelRatio:1},n.prototype.useSystem=function(){var n;switch(this.globals.env){case"weapp":n=wx.getDeviceInfo().platform;break;case"alipay":n=my.getDeviceBaseInfo().platform;break;case"tt":n=tt.getDeviceInfoSync().platform;break;default:n="unknown"}return n.toLowerCase()},n.prototype.usePlugins=function(n,e,t){for(var r,o=0,i=e;o<i.length;o++){var a=i[o];if(!n.has(a))throw new Error("Plugin ".concat(a," not found"));if(t.has(a))return;var u=n.get(a);if(Array.isArray(u.dependencies)){for(var c=0,s=u.dependencies;c<s.length;c++){var f=s[c];if("function"!=typeof(null===(r=n.get(f))||void 0===r?void 0:r.install))throw new Error("Plugin ".concat(a," depends on plugin ").concat(f,", but ").concat(f," is not found"))}this.usePlugins(n,u.dependencies,t)}this.installPlugin(u),t.add(a)}},n.prototype.switch=function(n){this.globals.env=n,this.init()},n}(),f=function(n){return n};var l={name:"getSelector",install:function(){var n=this.globals,e=n.env,t=n.br;return"h5"===e?function(n){return document.querySelector(n)}:function(n,e){var r=t.createSelectorQuery();return e&&(r=r.in(e)),r.select(n).fields({node:!0,size:!0})}}},h={name:"getCanvas",dependencies:["getSelector"],install:function(){var n=this.retry,e=this.getSelector,t=this.globals,r=t.env;t.br;var o=t.dpr,i=[50,100,100];function a(n,e,t){if(!n)throw new Error("canvas not found.");var r=n.getContext("2d");return n.width=e*o,n.height=t*o,{canvas:n,context:r}}return"h5"===r?function(t){return n((function(){var n=e("canvas[canvas-id=".concat(t.slice(1),"]"))||e(t);return a(n,null==n?void 0:n.clientWidth,null==n?void 0:n.clientHeight)}),i)}:function(t,r){return n((function(){return new Promise((function(n,o){e(t,r).exec((function(e){var t=e[0]||{},r=t.node,i=t.width,u=t.height;try{n(a(r,i,u))}catch(n){o(n)}}))}))}),i)}}},v={name:"decode",install:function(){var n=this.globals,e=n.env,r=n.br,o=function(n,e){return void 0===e&&(e="image/png"),"data:".concat(e,";base64,").concat(n)},i={toBuffer:function(n){var e=n.buffer,t=n.byteOffset,r=n.byteLength;if(e instanceof ArrayBuffer)return e.slice(t,t+r);var o=new Uint8Array(r);return o.set(n),o.buffer},bytesToString:function(n){for(var e="",t=0;t<n.length;t+=8192){var r=n.slice(t,t+8192);e+=String.fromCharCode.apply(null,Array.from(r))}return e}};if("h5"===e){var a=new TextDecoder("utf-8",{fatal:!0});return t(t({},i),{toDataURL:function(n){return o(btoa(i.bytesToString(n)))},utf8:function(n,e,t){return a.decode(n.subarray(e,t))}})}return t(t({},i),{toDataURL:function(n){return o(r.arrayBufferToBase64(i.toBuffer(n)))},utf8:c})}},p={name:"remote",install:function(){var n=this.globals,e=n.env,t=n.br,r=function(n){return/^(blob:)?http(s)?:\/\//.test(n)};if("h5"===e)return{is:r,fetch:function(n){return fetch(n).then((function(n){if(n.ok)return n.arrayBuffer();throw new Error("HTTP error, status=".concat(n.status,", statusText=").concat(n.statusText))}))}};function o(n,e){return new Promise((function(r,o){t.request({url:n,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:e,success:function(n){return r(n.data)},fail:o})})).catch((function(e){var t=e.errMsg||e.errorMessage||e.message;if(t.includes("ERR_CACHE_WRITE_FAILURE")||t.includes("ERR_CACHE_WRITE_FAILED"))return o(n,!1);throw e}))}return{is:r,fetch:function(n){return o(n,!0)}}}},d={name:"local",install:function(){var n=this.globals,e=n.env,t=n.br;if("h5"===e||"tt"===e)return null;var r=t.getFileSystemManager();return{exists:function(n){return new Promise((function(e){r.access({path:n,success:function(){return e(!0)},fail:function(){return e(!1)}})}))},write:function(n,e){return new Promise((function(t,o){r.writeFile({filePath:e,data:n,success:function(){return t(e)},fail:o})}))},read:function(n){return new Promise((function(e,t){r.readFile({filePath:n,success:function(n){return e(n.data)},fail:t})}))},remove:function(n){return new Promise((function(e,t){r.unlink({filePath:n,success:function(){return e(n)},fail:t})}))}}}},g={name:"image",dependencies:["local","decode"],install:function(){var n=this,e=this.local,t=this.decode,i=this.globals.env,a=function(n,e){return"string"==typeof n?n:t.toDataURL(n)};function u(n,e){return new Promise((function(t,r){n.onload=function(){return t(n)},n.onerror=function(){return r(new Error("SVGA LOADING FAILURE: ".concat(e)))},n.src=e}))}function c(n){n.onload=null,n.onerror=null,n.src=""}return"h5"===i?{create:function(n){return new Image},load:function(n,e,r){return e instanceof Uint8Array&&"createImageBitmap"in globalThis?createImageBitmap(new Blob([t.toBuffer(e)])):e instanceof ImageBitmap?Promise.resolve(e):u(n(),a(e,r))},release:c}:("weapp"===i&&(a=function(i,a){return r(n,void 0,void 0,(function(){return o(this,(function(n){return"string"==typeof i?[2,i]:[2,e.write(t.toBuffer(i),a).catch((function(n){return console.warn("image write fail: ".concat(n.errorMessage||n.errMsg||n.message)),t.toDataURL(i)}))]}))}))}),{create:function(n){return n.createImage()},load:function(e,t,i){return r(n,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=u,r=[e()],[4,a(t,i)];case 1:return[2,n.apply(void 0,r.concat([o.sent()]))]}}))}))},release:c})}},y={name:"now",install:function(){var n=this.globals,e=n.env,t=n.br,r="h5"===e||"tt"===e?performance:t.getPerformance();return"function"==typeof(null==r?void 0:r.now)?r.now()-Date.now()>1?function(){return r.now()/1e3}:function(){return r.now()}:function(){return Date.now()}}},b={name:"getOfsCanvas",install:function(){var n,e=this.globals.env;return n="h5"===e?function(n){return new OffscreenCanvas(n.width,n.height)}:"alipay"===e?function(n){return my.createOffscreenCanvas(n)}:"tt"===e?function(n){var e=tt.createOffscreenCanvas();return e.width=n.width,e.height=n.height,e}:function(n){return wx.createOffscreenCanvas(n)},function(e){var r=e.type||"2d",o=n(t(t({},e),{type:r})),i=o.getContext(r);return{canvas:o,context:i}}}},m={name:"path",install:function(){var n=this.globals,e=n.env,t=n.br,r=function(n){var e=n.split(/\?#/g)[0];return e.substring(e.lastIndexOf("/")+1)};if("h5"===e||"tt"===e)return{USER_DATA_PATH:"",is:function(n){return!1},filename:r,resolve:function(n,e){return""}};var o=t.env.USER_DATA_PATH;return{USER_DATA_PATH:o,is:function(n){return null==n?void 0:n.startsWith(o)},filename:r,resolve:function(n,e){return"".concat(o,"/").concat(e?"".concat(e,"__"):"").concat(n)}}}},w={name:"rAF",install:function(){function n(){return function(n){return setTimeout(n,Math.max(0,16-Date.now()%16))}}if("h5"===this.globals.env){var e="requestAnimationFrame"in globalThis?requestAnimationFrame:n();return function(n,t){return e(t)}}return function(e,t){try{return e.requestAnimationFrame(t)}catch(e){return console.warn(e.message),n()(t)}}}},P={name:"walkIn",install:function(){var n=this.globals,e=n.env,t=n.br,r=[0,.5,1];return"h5"===e?function(n,e,t){var o;void 0===t&&(t={});var i=new IntersectionObserver((function(e){return n(e[0].intersectionRatio>0)}),{threshold:r,root:t.root?document.querySelector(t.root):null});if(t.observeAll)null===(o=document.querySelectorAll(e))||void 0===o||o.forEach((function(n){return i.observe(n)}));else{var a=document.querySelector(e);a&&i.observe(a)}return function(){i.disconnect(),i=null}}:function(n,e,o){void 0===o&&(o={});var i=t.createIntersectionObserver(o.component,{thresholds:r,initialRatio:0,observeAll:o.observeAll});return o.root?i.relativeTo(o.root):i.relativeToViewport(),i.observe(e,(function(e){return n(e.intersectionRatio>0)})),function(){i.disconnect(),i=null}}}};n.OctopusPlatform=s,n.definePlugin=f,n.installPlugin=function(n,e){var t=e.install.call(n);Object.defineProperty(n,e.name,{get:function(){return t},enumerable:!0,configurable:!0})},n.pluginCanvas=h,n.pluginDecode=v,n.pluginDownload=p,n.pluginFsm=d,n.pluginImage=g,n.pluginIntersectionObserver=P,n.pluginNow=y,n.pluginOfsCanvas=b,n.pluginPath=m,n.pluginRAF=w,n.pluginSelector=l,Object.defineProperty(n,"__esModule",{value:!0})}));//# sourceMappingURL=index.min.js.map

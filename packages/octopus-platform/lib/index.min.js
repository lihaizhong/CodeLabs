!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).OctopusPlatform={})}(this,(function(n){"use strict";var t=function(){},e=function(){return e=Object.assign||function(n){for(var t,e=1,r=arguments.length;e<r;e++)for(var o in t=arguments[e])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},e.apply(this,arguments)};function r(n,t,e,r){return new(e||(e=Promise))((function(o,i){function a(n){try{c(r.next(n))}catch(n){i(n)}}function u(n){try{c(r.throw(n))}catch(n){i(n)}}function c(n){var t;n.done?o(n.value):(t=n.value,t instanceof e?t:new e((function(n){n(t)}))).then(a,u)}c((r=r.apply(n,t||[])).next())}))}function o(n,t){var e,r,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(e)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(e=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=i.trys,(o=o.length>0&&o[o.length-1])||6!==u[0]&&2!==u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(n,i)}catch(n){u=[6,n],r=0}finally{e=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}}function i(n){return r(this,arguments,void 0,(function(n,t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),o(this,(function(r){try{return[2,n()]}catch(r){if(e>=t.length)throw r;return[2,(o=function(){return i(n,t,++e)},a=t[e],new Promise((function(n){return setTimeout((function(){return n(o())}),a)})))]}var o,a;return[2]}))}))}"function"==typeof SuppressedError&&SuppressedError;var a=4096,u=new Uint16Array(a);function c(n,t,e){if(t<0||e>n.length)throw new RangeError("Index out of range");if(e-t<1)return"";for(var r=[],o=0,i=function(n){r.push(String.fromCharCode.apply(null,Array.from(n)))},c=!0,s=t;s<e;s++)if(n[s]>127){c=!1;break}if(c){for(s=t;s<e;s+=a){for(var f=Math.min(s+a,e)-s,l=0;l<f;l++)u[l]=n[s+l];i(u.subarray(0,f))}return r.join("")}for(s=t;s<e;){var h=n[s++];if(h<128)u[o++]=h,o===a&&(i(u),o=0);else{o>0&&(i(u.subarray(0,o)),o=0);var p=void 0;if(192==(224&h)&&s<e)p=(31&h)<<6|63&n[s++];else if(224==(240&h)&&s+1<e)p=(15&h)<<12|(63&n[s++])<<6|63&n[s++];else if(240==(248&h)&&s+2<e){if((p=(7&h)<<18|(63&n[s++])<<12|(63&n[s++])<<6|63&n[s++])>65535){p-=65536,u[o++]=55296+(p>>10),u[o++]=56320+(1023&p),o>=4094&&(i(u.subarray(0,o)),o=0);continue}}else for(p=65533;s<e&&128==(192&n[s]);)s++;u[o++]=p,o>=4093&&(i(u.subarray(0,o)),o=0)}}return o>0&&i(u.subarray(0,o)),r.join("")}var s=function(){function n(n,e){this.plugins=[],this.platformVersion="0.0.1",this.version="",this.globals={env:"unknown",br:null,dpr:1,system:"unknown"},this.noop=t,this.retry=i,this.version=e||"",this.plugins=n,this.globals.env=this.autoEnv()}return n.prototype.init=function(){var n=this.globals,t=this.plugins,e=new Map,r=[],o=new Set;n.br=this.useBridge(),n.dpr=this.usePixelRatio(),n.system=this.useSystem();for(var i=0,a=t;i<a.length;i++){var u=a[i];r.push(u.name),e.set(u.name,u)}this.usePlugins(e,r,o),o.clear()},n.prototype.autoEnv=function(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported app")},n.prototype.useBridge=function(){switch(this.globals.env){case"h5":return globalThis;case"alipay":return my;case"tt":return tt;case"weapp":return wx}return{}},n.prototype.usePixelRatio=function(){var n=this.globals,t=n.env,e=n.br;return"h5"===t?devicePixelRatio:"getWindowInfo"in e?e.getWindowInfo().pixelRatio:"getSystemInfoSync"in e?e.getSystemInfoSync().pixelRatio:1},n.prototype.useSystem=function(){var n;switch(this.globals.env){case"weapp":n=wx.getDeviceInfo().platform;break;case"alipay":n=my.getDeviceBaseInfo().platform;break;case"tt":n=tt.getDeviceInfoSync().platform;break;default:n="unknown"}return n.toLowerCase()},n.prototype.usePlugins=function(n,t,e){for(var r,o=0,i=t;o<i.length;o++){var a=i[o];if(!n.has(a))throw new Error("Plugin ".concat(a," not found"));if(e.has(a))return;var u=n.get(a);if(Array.isArray(u.dependencies)){for(var c=0,s=u.dependencies;c<s.length;c++){var f=s[c];if("function"!=typeof(null===(r=n.get(f))||void 0===r?void 0:r.install))throw new Error("Plugin ".concat(a," depends on plugin ").concat(f,", but ").concat(f," is not found"))}this.usePlugins(n,u.dependencies,e)}this.installPlugin(u),e.add(a)}},n.prototype.switch=function(n){this.globals.env=n,this.init()},n}(),f=function(n){return n},l={name:"getCanvas",install:function(){var n=this.retry,t=this.globals,e=t.env,r=t.br,o=t.dpr,i=[50,100,100];function a(n,t,e){if(!n)throw new Error("canvas not found.");var r=n.getContext("2d");return n.width=t*o,n.height=e*o,{canvas:n,context:r}}if("h5"===e){var u=function(n){return document.querySelector(n)};return function(t){return n((function(){var n=u("canvas[canvas-id=".concat(t.slice(1),"]"))||u(t);return a(n,null==n?void 0:n.clientWidth,null==n?void 0:n.clientHeight)}),i)}}return function(t,e){return n((function(){return new Promise((function(n,o){var i=r.createSelectorQuery();e&&(i=i.in(e)),i.select(t).fields({node:!0,size:!0},(function(t){var e=t||{},r=e.node,i=e.width,u=e.height;try{n(a(r,i,u))}catch(n){o(n)}})).exec()}))}),i)}}},h={name:"decode",install:function(){var n=this.globals,t=n.env,r=n.br,o=function(n,t){return void 0===t&&(t="image/png"),"data:".concat(t,";base64,").concat(n)},i={toBuffer:function(n){var t=n.buffer,e=n.byteOffset,r=n.byteLength;if(t instanceof ArrayBuffer)return t.slice(e,e+r);var o=new ArrayBuffer(r);return new Uint8Array(o).set(n),o},bytesToString:function(n){for(var t="",e=0;e<n.length;e+=8192){var r=n.slice(e,e+8192);t+=String.fromCharCode.apply(null,Array.from(r))}return t}};if("h5"===t){var a=new TextDecoder("utf-8",{fatal:!0});return e(e({},i),{toDataURL:function(n){return o(btoa(i.bytesToString(n)))},utf8:function(n,t,e){return a.decode(n.subarray(t,e))}})}return e(e({},i),{toDataURL:function(n){return o(r.arrayBufferToBase64(i.toBuffer(n)))},utf8:c})}},p={name:"remote",install:function(){var n=this.globals,t=n.env,e=n.br,r=function(n){return/^(blob:)?http(s)?:\/\//.test(n)};if("h5"===t)return{is:r,fetch:function(n){return fetch(n).then((function(n){if(n.ok)return n.arrayBuffer();throw new Error("HTTP error, status=".concat(n.status,", statusText=").concat(n.statusText))}))}};function o(n,t){return new Promise((function(r,o){e.request({url:n,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:t,success:function(n){return r(n.data)},fail:o})})).catch((function(t){var e=t.errMsg||t.errorMessage||t.message;if(e.includes("ERR_CACHE_WRITE_FAILURE")||e.includes("ERR_CACHE_WRITE_FAILED"))return o(n,!1);throw t}))}return{is:r,fetch:function(n){return o(n,!0)}}}},d={name:"local",install:function(){var n=this.globals,t=n.env,e=n.br;if("h5"===t)return null;var r=e.getFileSystemManager();return{write:function(n,t){return new Promise((function(e,o){r.writeFile({filePath:t,data:n,success:function(){return e(t)},fail:o})}))},read:function(n){return new Promise((function(t,e){r.readFile({filePath:n,success:function(n){return t(n.data)},fail:e})}))},remove:function(n){return new Promise((function(t,e){r.unlink({filePath:n,success:function(){return t(n)},fail:e})}))}}}},v={name:"image",dependencies:["local","decode"],install:function(){var n=this,t=this.local,e=this.decode,i=this.globals.env,a=function(n,t){return"string"==typeof n?n:e.toDataURL(n)};function u(n,t){return new Promise((function(e,r){n.onload=function(){return e(n)},n.onerror=function(){return r(new Error("SVGA LOADING FAILURE: ".concat(t)))},n.src=t}))}function c(n){n.onload=null,n.onerror=null,n.src=""}return"h5"===i?{create:function(n){return new Image},load:function(n,t,r){return t instanceof Uint8Array&&"createImageBitmap"in globalThis?createImageBitmap(new Blob([e.toBuffer(t)])):t instanceof ImageBitmap?Promise.resolve(t):u(n(),a(t,r))},release:c}:("weapp"===i&&(a=function(i,a){return r(n,void 0,void 0,(function(){return o(this,(function(n){return"string"==typeof i?[2,i]:[2,t.write(e.toBuffer(i),a).catch((function(n){return console.warn("image write fail: ".concat(n.errorMessage||n.errMsg||n.message)),e.toDataURL(i)}))]}))}))}),{create:function(n){return n.createImage()},load:function(t,e,i){return r(n,void 0,void 0,(function(){var n,r;return o(this,(function(o){switch(o.label){case 0:return n=u,r=[t()],[4,a(e,i)];case 1:return[2,n.apply(void 0,r.concat([o.sent()]))]}}))}))},release:c})}},g={name:"now",install:function(){var n=this.globals,t=n.env,e=n.br,r="h5"===t||"tt"===t?performance:e.getPerformance();return"function"==typeof(null==r?void 0:r.now)?r.now()-Date.now()>1?function(){return r.now()/1e3}:function(){return r.now()}:function(){return Date.now()}}},y={name:"getOfsCanvas",install:function(){var n,t=this.globals.env;return n="h5"===t?function(n){return new OffscreenCanvas(n.width,n.height)}:"alipay"===t?function(n){return my.createOffscreenCanvas(n)}:"tt"===t?function(n){var t=tt.createOffscreenCanvas();return t.width=n.width,t.height=n.height,t}:function(n){return wx.createOffscreenCanvas(n)},function(t){var r=t.type||"2d",o=n(e(e({},t),{type:r})),i=o.getContext(r);return{canvas:o,context:i}}}},w={name:"path",install:function(){var n=this.globals,t=n.env,e=n.br,r=function(n){return n.substring(n.lastIndexOf("/")+1)};if("h5"===t)return{USER_DATA_PATH:"",is:function(n){return!1},filename:r,resolve:function(n,t){return"".concat(t?"".concat(t,"__"):"").concat(n)}};var o=("tt"===t?tt.getEnvInfoSync().common:e.env).USER_DATA_PATH;return{USER_DATA_PATH:o,is:function(n){return null==n?void 0:n.startsWith(o)},filename:r,resolve:function(n,t){return"".concat(o,"/").concat(t?"".concat(t,"__"):"").concat(n)}}}},m={name:"rAF",install:function(){function n(){return function(n){return setTimeout(n,Math.max(0,16-Date.now()%16))}}if("h5"===this.globals.env){var t="requestAnimationFrame"in globalThis?requestAnimationFrame:n();return function(n,e){return t(e)}}return function(t,e){try{return t.requestAnimationFrame(e)}catch(t){return console.warn(t.message),n()(e)}}}};n.OctopusPlatform=s,n.definePlugin=f,n.pluginCanvas=l,n.pluginDecode=h,n.pluginDownload=p,n.pluginFsm=d,n.pluginImage=v,n.pluginNow=g,n.pluginOfsCanvas=y,n.pluginPath=w,n.pluginRAF=m,Object.defineProperty(n,"__esModule",{value:!0})}));//# sourceMappingURL=index.min.js.map

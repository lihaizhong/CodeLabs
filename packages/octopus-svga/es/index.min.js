import t from"octopus-benchmark";export{default as benchmark}from"octopus-benchmark";import{OctopusPlatform as e,pluginCanvas as s,pluginOfsCanvas as r,pluginDecode as i,pluginDownload as n,pluginFsm as a,pluginImage as o,pluginNow as l,pluginPath as c,pluginRAF as h,installPlugin as u}from"octopus-platform";const f=new class extends e{now;path;remote;local;decode;image;rAF;getCanvas;getOfsCanvas;constructor(){super([s,r,i,n,a,o,l,c,h],"0.2.0"),this.init()}installPlugin(t){u(this,t)}};const d=function(){const t=Array(4).fill(0).map((()=>new DataView(new ArrayBuffer(8))));let e=0;return function(s,r){if(r<0||r+4>s.length)throw new RangeError("Index out of range");const i=t[e];e=(e+1)%4;const n=new Uint8Array(i.buffer);return n[0]=s[r],n[1]=s[r+1],n[2]=s[r+2],n[3]=s[r+3],i.getFloat32(0,!0)}}();function p(t,e,s,r){let i=0;for(let n=e;n<s;n+=r)i=(i<<5)-i+t[n],i|=0;return i=(i<<5)-i+s-e,i|=0,i.toString(36)}class m{caches=new Map;count=0;get size(){return this.caches.size}get hitCount(){return this.count}calculate(t,e){const{pos:s,buf:r}=t,i=Math.min(e,t.len);return p(r,s,i,Math.max(1,Math.floor((i-s)/100)))}has(t){const e=this.caches.has(t);return e&&this.count++,e}get(t){return this.caches.get(t)}set(t,e){this.caches.set(t,e)}clear(){this.count=0,this.caches.clear()}}class g{static EMPTY_UINT8ARRAY=new Uint8Array(0);buf;len;pos;preflight=new m;constructor(t){this.buf=t,this.pos=0,this.len=t.length}indexOutOfRange(t,e){return new RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}readVarint32Slow(){let t=this.buf[this.pos++],e=127&t,s=7;do{if(this.pos>=this.len)throw this.indexOutOfRange(this);t=this.buf[this.pos++],e|=(127&t)<<s,s+=7}while(t>=128&&s<32);return e>>>0}end(t){return void 0===t?this.len:this.pos+t}uint32(){const t=this.buf[this.pos];return t<128?(this.pos++,t):this.readVarint32Slow()}int32(){return 0|this.uint32()}float(){const t=this.pos+4;if(t>this.len)throw this.indexOutOfRange(this,4);const e=d(this.buf,this.pos);return this.pos=t,e}getBytesRange(){const t=this.uint32(),e=this.pos,s=e+t;if(s>this.len)throw this.indexOutOfRange(this,t);return[e,s,t]}bytes(){const[t,e,s]=this.getBytesRange();return this.pos+=s,0===s?g.EMPTY_UINT8ARRAY:this.buf.subarray(t,e)}string(){const[t,e]=this.getBytesRange(),s=f.decode.utf8(this.buf,t,e);return this.pos=e,s}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,this}const{buf:e,len:s}=this;let r=this.pos;for(;r<s;){if(!(128&e[r++]))return this.pos=r,this;if(r<s&&128&e[r]&&(r++,r<s&&128&e[r]&&(r++,r<s&&128&e[r]))){for(r++;r<s&&128&e[r];)if(r++,r-this.pos>=10)throw Error("invalid varint encoding");if(r<s)return this.pos=r+1,this}}throw this.indexOutOfRange(this)}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class y{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new y;let a;for(;t.pos<r;)switch(a=t.uint32(),a>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.width=t.float();break;case 4:n.height=t.float();break;default:t.skipType(7&a)}return s.set(i,y.format(n)),s.get(i)}static format(t){const{x:e=0,y:s=0,width:r=0,height:i=0}=t;return{x:e,y:s,width:r,height:i}}x=0;y=0;width=0;height=0}class w{static decode(t,e){const s=t.end(e),r=new w;let i;for(;t.pos<s;)switch(i=t.uint32(),i>>>3){case 1:r.a=t.float();break;case 2:r.b=t.float();break;case 3:r.c=t.float();break;case 4:r.d=t.float();break;case 5:r.tx=t.float();break;case 6:r.ty=t.float();break;default:t.skipType(7&i)}return r}a=0;b=0;c=0;d=0;tx=0;ty=0}class b{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new b;let a;for(;t.pos<r;)if(a=t.uint32(),a>>>3==1)n.d=t.string();else t.skipType(7&a);return s.set(i,n),s.get(i)}d=""}class k{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new k;let a;for(;t.pos<r;)switch(a=t.uint32(),a>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.width=t.float();break;case 4:n.height=t.float();break;case 5:n.cornerRadius=t.float();break;default:t.skipType(7&a)}return s.set(i,n),s.get(i)}x=0;y=0;width=0;height=0;cornerRadius=0}class x{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new x;let a;for(;t.pos<r;)switch(a=t.uint32(),a>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.radiusX=t.float();break;case 4:n.radiusY=t.float();break;default:t.skipType(7&a)}return s.set(i,n),s.get(i)}x=0;y=0;radiusX=0;radiusY=0}class C{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new C;let a;for(;t.pos<r;)switch(a=t.uint32(),a>>>3){case 1:n.r=t.float();break;case 2:n.g=t.float();break;case 3:n.b=t.float();break;case 4:n.a=t.float();break;default:t.skipType(7&a)}return s.set(i,C.format(n)),s.get(i)}static format(t){const{r:e,g:s,b:r,a:i}=t;return`rgba(${255*e|0}, ${255*s|0}, ${255*r|0}, ${1*i|0})`}r=0;g=0;b=0;a=0}class T{static decode(t,e){const{preflight:s}=t,r=t.end(e),i=s.calculate(t,r);if(s.has(i))return t.pos=r,s.get(i);const n=new T;let a;for(;t.pos<r;)switch(a=t.uint32(),a>>>3){case 1:n.fill=C.decode(t,t.uint32());break;case 2:n.stroke=C.decode(t,t.uint32());break;case 3:n.strokeWidth=t.float();break;case 4:n.lineCap=t.int32();break;case 5:n.lineJoin=t.int32();break;case 6:n.miterLimit=t.float();break;case 7:n.lineDashI=t.float();break;case 8:n.lineDashII=t.float();break;case 9:n.lineDashIII=t.float();break;default:t.skipType(7&a)}return s.set(i,T.format(n)),s.get(i)}static format(t){const{fill:e,stroke:s,strokeWidth:r,miterLimit:i,lineDashI:n,lineDashII:a,lineDashIII:o}=t,l=[];let c,h;switch(n>0&&l.push(n),a>0&&(l.length<1&&l.push(0),l.push(a)),o>0&&(l.length<2&&l.push(0,0),l.push(o)),t.lineCap){case 0:c="butt";break;case 1:c="round";break;case 2:c="square"}switch(t.lineJoin){case 0:h="miter";break;case 1:h="round";break;case 2:h="bevel"}return{lineDash:l,fill:e||null,stroke:s||null,lineCap:c,lineJoin:h,strokeWidth:r,miterLimit:i}}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0}class v{static decode(t,e){const s=t.end(e),r=new v;let i;for(;t.pos<s;)switch(i=t.uint32(),i>>>3){case 1:r.type=t.int32();break;case 2:r.shape=b.decode(t,t.uint32());break;case 3:r.rect=k.decode(t,t.uint32());break;case 4:r.ellipse=x.decode(t,t.uint32());break;case 10:r.styles=T.decode(t,t.uint32());break;case 11:r.transform=w.decode(t,t.uint32());break;default:t.skipType(7&i)}return v.format(r)}static format(t){const{type:e,shape:s,rect:r,ellipse:i,styles:n,transform:a}=t;switch(e){case 0:return{type:"shape",path:s,styles:n,transform:a};case 1:return{type:"rect",path:r,styles:n,transform:a};case 2:return{type:"ellipse",path:i,styles:n,transform:a}}return null}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null}class M{static HIDDEN_FRAME={alpha:0};static decode(t,e){const s=t.end(e),r=new M;let i;for(;t.pos<s;)switch(i=t.uint32(),i>>>3){case 1:r.alpha=t.float();break;case 2:r.layout=y.decode(t,t.uint32());break;case 3:r.transform=w.decode(t,t.uint32());break;case 4:r.clipPath=t.string();break;case 5:{const e=v.decode(t,t.uint32());null!==e&&r.shapes.push(e);break}default:t.skipType(7&i)}return 0===r.shapes.length?r.shapes=t.preflight.get("latest_shapes"):t.preflight.set("latest_shapes",r.shapes),M.format(r)}static format(t){if(t.alpha<.05)return M.HIDDEN_FRAME;const{alpha:e,layout:s,transform:r,shapes:i}=t;return{alpha:e,layout:s,transform:r,shapes:i}}shapes=[];alpha=0;layout=null;transform=null;clipPath=""}class E{static decode(t,e){const s=t.end(e),r=new E;let i;for(t.preflight.set("latest_shapes",[]);t.pos<s;)switch(i=t.uint32(),i>>>3){case 1:r.imageKey=t.string();break;case 2:r.frames&&r.frames.length||(r.frames=[]),r.frames.push(M.decode(t,t.uint32()));break;case 3:r.matteKey=t.string();break;default:t.skipType(7&i)}return E.format(r)}static format(t){return{imageKey:t.imageKey,frames:t.frames}}frames=[];imageKey="";matteKey=""}class A{static decode(t,e){const s=t.end(e),r=new A;let i;for(;t.pos<s;)switch(i=t.uint32(),i>>>3){case 1:r.viewBoxWidth=t.float();break;case 2:r.viewBoxHeight=t.float();break;case 3:r.fps=t.int32();break;case 4:r.frames=t.int32();break;default:t.skipType(7&i)}return r}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0}class R{static EMPTY_U8=new Uint8Array(0);static decode(t,e){const s=t.end(e),r=new R;let i,n,a,o,l;for(;t.pos<s;)switch(o=t.uint32(),o>>>3){case 1:r.version=t.string();break;case 2:r.params=A.decode(t,t.uint32());break;case 3:for(a=t.uint32()+t.pos,i="",n=R.EMPTY_U8;t.pos<a;)switch(l=t.uint32(),l>>>3){case 1:i=t.string();break;case 2:n=t.bytes();break;default:t.skipType(7&l)}r.images[i]=n;break;case 4:r.sprites.push(E.decode(t,t.uint32()));break;default:t.skipType(7&o)}return R.format(r)}static format(t){const{version:e,images:s,sprites:r}=t,{fps:i,frames:n,viewBoxWidth:a,viewBoxHeight:o}=t.params;return{version:e,filename:"",locked:!1,dynamicElements:{},size:{width:a,height:o},fps:i,frames:n,images:s,sprites:r}}version="";params=null;images={};sprites=[]}class P{pool=[];acquire(){const{pool:t}=this;return t.length>0?t.pop():{x:0,y:0,x1:0,y1:0,x2:0,y2:0}}release(t){t.x=t.y=t.x1=t.y1=t.x2=t.y2=0,this.pool.push(t)}}class S{context;static SVG_PATH=new Set(["M","L","H","V","Z","C","S","Q","m","l","h","v","z","c","s","q"]);static SVG_LETTER_REGEXP=/[a-zA-Z]/;static parseSVGPath(t){const{SVG_LETTER_REGEXP:e}=S,s=[];let r=0,i=0,n="",a="";for(;r<t.length;){const o=t[r];switch(i){case 0:e.test(o)&&(n=o,i=1);break;case 1:e.test(o)?(s.push({command:n,args:a.trim()}),n=o,a=""):a+=o}r++}return n&&1===i&&s.push({command:n,args:a.trim()}),s}static fillOrStroke(t,e){e&&(e.fill&&t.fill(),e.stroke&&t.stroke())}static resetShapeStyles(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}static calculateScale(t,e,s){const r=e.width/e.height,i=s.width/s.height,n="aspect-fit"===t,a=(t,e,s)=>({scaleX:t,scaleY:t,translateX:e,translateY:s});if(r>=i&&n||r<=i&&!n){const t=s.width/e.width;return a(t,0,(s.height-e.height*t)/2)}const o=s.height/e.height;return a(o,(s.width-e.width*o)/2,0)}pointPool=new P;currentPoint;lastResizeKey="";globalTransform=void 0;constructor(t){this.context=t,this.currentPoint=this.pointPool.acquire()}setTransform(t){t&&this.context&&this.context.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)}drawBezier(t,e,s){const{context:r,pointPool:i}=this;if(this.currentPoint=i.acquire(),r.save(),S.resetShapeStyles(r,s),this.setTransform(e),r.beginPath(),t){const e=S.parseSVGPath(t);for(const{command:t,args:s}of e)S.SVG_PATH.has(t)&&this.drawBezierElement(this.currentPoint,t,s.split(/[\s,]+/).filter(Boolean))}S.fillOrStroke(r,s),i.release(this.currentPoint),r.restore()}drawBezierElement(t,e,s){const{context:r}=this;switch(e){case"M":t.x=+s[0],t.y=+s[1],r.moveTo(t.x,t.y);break;case"m":t.x+=+s[0],t.y+=+s[1],r.moveTo(t.x,t.y);break;case"L":t.x=+s[0],t.y=+s[1],r.lineTo(t.x,t.y);break;case"l":t.x+=+s[0],t.y+=+s[1],r.lineTo(t.x,t.y);break;case"H":t.x=+s[0],r.lineTo(t.x,t.y);break;case"h":t.x+=+s[0],r.lineTo(t.x,t.y);break;case"V":t.y=+s[0],r.lineTo(t.x,t.y);break;case"v":t.y+=+s[0],r.lineTo(t.x,t.y);break;case"C":t.x1=+s[0],t.y1=+s[1],t.x2=+s[2],t.y2=+s[3],t.x=+s[4],t.y=+s[5],r.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"c":t.x1=t.x+ +s[0],t.y1=t.y+ +s[1],t.x2=t.x+ +s[2],t.y2=t.y+ +s[3],t.x+=+s[4],t.y+=+s[5],r.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"S":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=+s[0],t.y2=+s[1],t.x=+s[2],t.y=+s[3],r.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=+s[0],t.y1=+s[1],t.x=+s[2],t.y=+s[3],r.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"s":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=t.x+ +s[0],t.y2=t.y+ +s[1],t.x+=+s[2],t.y+=+s[3],r.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=t.x+ +s[0],t.y1=t.y+ +s[1],t.x+=+s[2],t.y+=+s[3],r.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"Q":t.x1=+s[0],t.y1=+s[1],t.x=+s[2],t.y=+s[3],r.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"q":t.x1=t.x+ +s[0],t.y1=t.y+ +s[1],t.x+=+s[2],t.y+=+s[3],r.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"Z":case"z":r.closePath()}}drawEllipse(t,e,s,r,i,n){const{context:a}=this;a.save(),S.resetShapeStyles(a,n),this.setTransform(i);const o=2*s,l=2*r,c=.5522848,h=o/2*c,u=l/2*c,f=(t-=s)+o,d=(e-=r)+l,p=t+o/2,m=e+l/2;a.beginPath(),a.moveTo(t,m),a.bezierCurveTo(t,m-u,p-h,e,p,e),a.bezierCurveTo(p+h,e,f,m-u,f,m),a.bezierCurveTo(f,m+u,p+h,d,p,d),a.bezierCurveTo(p-h,d,t,m+u,t,m),S.fillOrStroke(a,n),a.restore()}drawRect(t,e,s,r,i,n,a){const{context:o}=this;o.save(),S.resetShapeStyles(o,a),this.setTransform(n);let l=i;s<2*l&&(l=s/2),r<2*l&&(l=r/2),o.beginPath(),o.moveTo(t+l,e),o.arcTo(t+s,e,t+s,e+r,l),o.arcTo(t+s,e+r,t,e+r,l),o.arcTo(t,e+r,t,e,l),o.arcTo(t,e,t+s,e,l),o.closePath(),S.fillOrStroke(o,a),o.restore()}drawShape(t){const{type:e,path:s,transform:r,styles:i}=t;switch(e){case"shape":this.drawBezier(s.d,r,i);break;case"ellipse":this.drawEllipse(s.x??0,s.y??0,s.radiusX??0,s.radiusY??0,r,i);break;case"rect":this.drawRect(s.x??0,s.y??0,s.width??0,s.height??0,s.cornerRadius??0,r,i)}}drawSprite(t,e,s){if(0===t.alpha)return;const{context:r}=this,{alpha:i,transform:n,layout:a,shapes:o}=t,{a:l=1,b:c=0,c:h=0,d:u=1,tx:f=0,ty:d=0}=n??{};r.save(),this.setTransform(this.globalTransform),r.globalAlpha=i,r.transform(l,c,h,u,f,d),e&&r.drawImage(e,0,0,a.width,a.height),s&&r.drawImage(s,(a.width-s.width)/2,(a.height-s.height)/2);for(let t=0;t<o.length;t++)this.drawShape(o[t]);r.restore()}resize(t,e,s){const{width:r,height:i}=s,{width:n,height:a}=e,o=`${t}-${n}-${a}-${r}-${i}`,l=this.globalTransform;if(this.lastResizeKey===o&&l)return;let c={scaleX:1,scaleY:1,translateX:0,translateY:0};"fill"===t?(c.scaleX=r/n,c.scaleY=i/a):c=S.calculateScale(t,e,s),this.lastResizeKey=o,this.globalTransform={a:c.scaleX,b:0,c:0,d:c.scaleY,tx:c.translateX,ty:c.translateY}}render(t,e,s,r,i,n){let a,o,l,c;for(let h=i;h<n;h++)a=t.sprites[h],o=a.imageKey,l=e.get(o),c=s.get(o),this.drawSprite(a.frames[r],l,c)}destroy(){this.globalTransform=void 0,this.lastResizeKey="",this.context=null}}class I{isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onAnimate=f.noop;onStart=f.noop;onUpdate=f.noop;onEnd=f.noop;setConfig(t,e,s,r){this.duration=t,this.loopStart=e,this.loopDuration=t*s+r-e}start(){this.isRunning=!0,this.startTime=f.now(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=f.now(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(f.now()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1,this.loopStart=0}doFrame(){this.isRunning&&(this.doDeltaTime(f.now()-this.startTime),this.isRunning&&this.onAnimate((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:s,loopDuration:r}=this;let i,n=!1;t>=r?(i=1,n=!0,this.stop()):i=(t+s)%e/e,this.onUpdate(i),!this.isRunning&&n&&this.onEnd()}}const D=Uint8Array,F=Uint16Array,B=Int32Array,U=new D([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),O=new D([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L=new D([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),N=(t,e)=>{const s=new F(31);for(let r=0;r<31;++r)s[r]=e+=1<<t[r-1];const r=new B(s[30]);for(let t=1;t<30;++t)for(let e=s[t];e<s[t+1];++e)r[e]=e-s[t]<<5|t;return{b:s,r:r}},{b:z,r:H}=N(U,2);z[28]=258,H[258]=28;const{b:Y,r:_}=N(O,0),W=new F(32768);for(let t=0;t<32768;++t){let e=(43690&t)>>1|(21845&t)<<1;e=(52428&e)>>2|(13107&e)<<2,e=(61680&e)>>4|(3855&e)<<4,W[t]=((65280&e)>>8|(255&e)<<8)>>1}const X=(t,e,s)=>{const r=t.length;let i=0;const n=new F(e);for(;i<r;++i)t[i]&&++n[t[i]-1];const a=new F(e);for(i=1;i<e;++i)a[i]=a[i-1]+n[i-1]<<1;let o;if(s){o=new F(1<<e);const s=15-e;for(i=0;i<r;++i)if(t[i]){const r=i<<4|t[i],n=e-t[i];let l=a[t[i]-1]++<<n;for(const t=l|(1<<n)-1;l<=t;++l)o[W[l]>>s]=r}}else for(o=new F(r),i=0;i<r;++i)t[i]&&(o[i]=W[a[t[i]-1]++]>>15-t[i]);return o},$=new D(288);for(let t=0;t<144;++t)$[t]=8;for(let t=144;t<256;++t)$[t]=9;for(let t=256;t<280;++t)$[t]=7;for(let t=280;t<288;++t)$[t]=8;const V=new D(32);for(let t=0;t<32;++t)V[t]=5;const K=X($,9,0),q=X($,9,1),J=X(V,5,0),j=X(V,5,1),G=t=>{let e=t[0];for(let s=1;s<t.length;++s)t[s]>e&&(e=t[s]);return e},Q=(t,e,s)=>{const r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&s},Z=(t,e)=>{const s=e/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(7&e)},tt=t=>(t+7)/8|0,et=(t,e,s)=>((null==s||s>t.length)&&(s=t.length),new D(t.subarray(e,s))),st=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],rt=(t,e,s)=>{const r=new Error(e||st[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,rt),!s)throw r;return r},it=(t,e,s)=>{s<<=7&e;const r=e/8|0;t[r]|=s,t[r+1]|=s>>8},nt=(t,e,s)=>{s<<=7&e;const r=e/8|0;t[r]|=s,t[r+1]|=s>>8,t[r+2]|=s>>16},at=(t,e)=>{const s=[];for(let e=0;e<t.length;++e)t[e]&&s.push({s:e,f:t[e]});const r=s.length,i=s.slice();if(!r)return{t:dt,l:0};if(1==r){const t=new D(s[0].s+1);return t[s[0].s]=1,{t:t,l:1}}s.sort(((t,e)=>t.f-e.f)),s.push({s:-1,f:25001});let n=s[0],a=s[1],o=0,l=1,c=2;for(s[0]={s:-1,f:n.f+a.f,l:n,r:a};l!=r-1;)n=s[s[o].f<s[c].f?o++:c++],a=s[o!=l&&s[o].f<s[c].f?o++:c++],s[l++]={s:-1,f:n.f+a.f,l:n,r:a};let h=i[0].s;for(let t=1;t<r;++t)i[t].s>h&&(h=i[t].s);const u=new F(h+1);let f=ot(s[l-1],u,0);if(f>e){let t=0,s=0;const n=f-e,a=1<<n;for(i.sort(((t,e)=>u[e.s]-u[t.s]||t.f-e.f));t<r;++t){const r=i[t].s;if(!(u[r]>e))break;s+=a-(1<<f-u[r]),u[r]=e}for(s>>=n;s>0;){const r=i[t].s;u[r]<e?s-=1<<e-u[r]++-1:++t}for(;t>=0&&s;--t){const r=i[t].s;u[r]==e&&(--u[r],++s)}f=e}return{t:new D(u),l:f}},ot=(t,e,s)=>-1==t.s?Math.max(ot(t.l,e,s+1),ot(t.r,e,s+1)):e[t.s]=s,lt=t=>{let e=t.length;for(;e&&!t[--e];);const s=new F(++e);let r=0,i=t[0],n=1;const a=t=>{s[r++]=t};for(let s=1;s<=e;++s)if(t[s]==i&&s!=e)++n;else{if(!i&&n>2){for(;n>138;n-=138)a(32754);n>2&&(a(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(a(i),--n;n>6;n-=6)a(8304);n>2&&(a(n-3<<5|8208),n=0)}for(;n--;)a(i);n=1,i=t[s]}return{c:s.subarray(0,r),n:e}},ct=(t,e)=>{let s=0;for(let r=0;r<e.length;++r)s+=t[r]*e[r];return s},ht=(t,e,s)=>{const r=s.length,i=tt(e+2);t[i]=255&r,t[i+1]=r>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(let e=0;e<r;++e)t[i+e+4]=s[e];return 8*(i+4+r)},ut=(t,e,s,r,i,n,a,o,l,c,h)=>{it(e,h++,s),++i[256];const{t:u,l:f}=at(i,15),{t:d,l:p}=at(n,15),{c:m,n:g}=lt(u),{c:y,n:w}=lt(d),b=new F(19);for(let t=0;t<m.length;++t)++b[31&m[t]];for(let t=0;t<y.length;++t)++b[31&y[t]];const{t:k,l:x}=at(b,7);let C=19;for(;C>4&&!k[L[C-1]];--C);const T=c+5<<3,v=ct(i,$)+ct(n,V)+a,M=ct(i,u)+ct(n,d)+a+14+3*C+ct(b,k)+2*b[16]+3*b[17]+7*b[18];if(l>=0&&T<=v&&T<=M)return ht(e,h,t.subarray(l,l+c));let E,A,R,P;if(it(e,h,1+(M<v)),h+=2,M<v){E=X(u,f,0),A=u,R=X(d,p,0),P=d;const t=X(k,x,0);it(e,h,g-257),it(e,h+5,w-1),it(e,h+10,C-4),h+=14;for(let t=0;t<C;++t)it(e,h+3*t,k[L[t]]);h+=3*C;const s=[m,y];for(let r=0;r<2;++r){const i=s[r];for(let s=0;s<i.length;++s){const r=31&i[s];it(e,h,t[r]),h+=k[r],r>15&&(it(e,h,i[s]>>5&127),h+=i[s]>>12)}}}else E=K,A=$,R=J,P=V;for(let t=0;t<o;++t){const s=r[t];if(s>255){const t=s>>18&31;nt(e,h,E[t+257]),h+=A[t+257],t>7&&(it(e,h,s>>23&31),h+=U[t]);const r=31&s;nt(e,h,R[r]),h+=P[r],r>3&&(nt(e,h,s>>5&8191),h+=O[r])}else nt(e,h,E[s]),h+=A[s]}return nt(e,h,E[256]),h+A[256]},ft=new B([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),dt=new D(0),pt=()=>{let t=1,e=0;return{p(s){let r=t,i=e;const n=0|s.length;for(let t=0;t!=n;){const e=Math.min(t+2655,n);for(;t<e;++t)i+=r+=s[t];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}t=r,e=i},d:()=>(t%=65521,e%=65521,(255&t)<<24|(65280&t)<<8|(255&e)<<8|e>>8)}},mt=(t,e,s,r,i)=>{if(!i&&(i={l:1},e.dictionary)){const s=e.dictionary.subarray(-32768),r=new D(s.length+t.length);r.set(s),r.set(t,s.length),t=r,i.w=s.length}return((t,e,s,r,i,n)=>{const a=n.z||t.length,o=new D(r+a+5*(1+Math.ceil(a/7e3))+i),l=o.subarray(r,o.length-i),c=n.l;let h=7&(n.r||0);if(e){h&&(l[0]=n.r>>3);const r=ft[e-1],i=r>>13,o=8191&r,u=(1<<s)-1,f=n.p||new F(32768),d=n.h||new F(u+1),p=Math.ceil(s/3),m=2*p,g=e=>(t[e]^t[e+1]<<p^t[e+2]<<m)&u,y=new B(25e3),w=new F(288),b=new F(32);let k=0,x=0,C=n.i||0,T=0,v=n.w||0,M=0;for(;C+2<a;++C){const e=g(C);let s=32767&C,r=d[e];if(f[s]=r,d[e]=s,v<=C){const n=a-C;if((k>7e3||T>24576)&&(n>423||!c)){h=ut(t,l,0,y,w,b,x,T,M,C-M,h),T=k=x=0,M=C;for(let t=0;t<286;++t)w[t]=0;for(let t=0;t<30;++t)b[t]=0}let u=2,d=0,p=o,m=s-r&32767;if(n>2&&e==g(C-m)){const e=Math.min(i,n)-1,a=Math.min(32767,C),o=Math.min(258,n);for(;m<=a&&--p&&s!=r;){if(t[C+u]==t[C+u-m]){let s=0;for(;s<o&&t[C+s]==t[C+s-m];++s);if(s>u){if(u=s,d=m,s>e)break;const t=Math.min(m,s-2);let i=0;for(let e=0;e<t;++e){const t=C-m+e&32767,s=t-f[t]&32767;s>i&&(i=s,r=t)}}}s=r,r=f[s],m+=s-r&32767}}if(d){y[T++]=268435456|H[u]<<18|_[d];const t=31&H[u],e=31&_[d];x+=U[t]+O[e],++w[257+t],++b[e],v=C+u,++k}else y[T++]=t[C],++w[t[C]]}}for(C=Math.max(C,v);C<a;++C)y[T++]=t[C],++w[t[C]];h=ut(t,l,c,y,w,b,x,T,M,C-M,h),c||(n.r=7&h|l[h/8|0]<<3,h-=7,n.h=d,n.p=f,n.i=C,n.w=v)}else{for(let e=n.w||0;e<a+c;e+=65535){let s=e+65535;s>=a&&(l[h/8|0]=c,s=a),h=ht(l,h+1,t.subarray(e,s))}n.i=a}return et(o,0,r+tt(h)+i)})(t,null==e.level?6:e.level,null==e.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,s,r,i)},gt=(t,e,s)=>{for(;s;++e)t[e]=s,s>>>=8};function yt(t,e={}){const s=pt();s.p(t);const r=mt(t,e,e.dictionary?6:2,4);return((t,e)=>{const s=e.level??0,r=0==s?0:s<6?1:9==s?3:2;if(t[0]=120,t[1]=r<<6|((e.dictionary??0)&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){const s=pt();s.p(e.dictionary),gt(t,2,s.d())}})(r,e),gt(r,r.length-4,s.d()),r}function wt(t,e={}){return((t,e,s,r)=>{const i=t.length,n=r?r.length:0;if(!i||e.f&&!e.l)return s||new D(0);const a=!s,o=a||2!=e.i,l=e.i;a&&(s=new D(3*i));const c=t=>{let e=s.length;if(t>e){const r=new D(Math.max(2*e,t));r.set(s),s=r}};let h=e.f||0,u=e.p||0,f=e.b||0,d=e.l,p=e.d,m=e.m,g=e.n;const y=8*i;do{if(!d){h=Q(t,u,1);const r=Q(t,u+1,3);if(u+=3,!r){const r=tt(u)+4,n=t[r-4]|t[r-3]<<8,a=r+n;if(a>i){l&&rt(0);break}o&&c(f+n),s.set(t.subarray(r,a),f),e.b=f+=n,e.p=u=8*a,e.f=h;continue}if(1==r)d=q,p=j,m=9,g=5;else if(2==r){const e=Q(t,u,31)+257,s=Q(t,u+10,15)+4,r=e+Q(t,u+5,31)+1;u+=14;const i=new D(r),n=new D(19);for(let e=0;e<s;++e)n[L[e]]=Q(t,u+3*e,7);u+=3*s;const a=G(n),o=(1<<a)-1,l=X(n,a,1);for(let e=0;e<r;){const s=l[Q(t,u,o)];u+=15&s;const r=s>>4;if(r<16)i[e++]=r;else{let s=0,n=0;for(16==r?(n=3+Q(t,u,3),u+=2,s=i[e-1]):17==r?(n=3+Q(t,u,7),u+=3):18==r&&(n=11+Q(t,u,127),u+=7);n--;)i[e++]=s}}const c=i.subarray(0,e),h=i.subarray(e);m=G(c),g=G(h),d=X(c,m,1),p=X(h,g,1)}else rt(1);if(u>y){l&&rt(0);break}}o&&c(f+131072);const a=(1<<m)-1,w=(1<<g)-1;let b=u;for(;;b=u){const e=d[Z(t,u)&a],i=e>>4;if(u+=15&e,u>y){l&&rt(0);break}if(e||rt(2),i<256)s[f++]=i;else{if(256==i){b=u,d=void 0;break}{let e=i-254;if(i>264){const s=i-257,r=U[s];e=Q(t,u,(1<<r)-1)+z[s],u+=r}const a=p[Z(t,u)&w],h=a>>4;a||rt(3),u+=15&a;let d=Y[h];if(h>3){const e=O[h];d+=Z(t,u)&(1<<e)-1,u+=e}if(u>y){l&&rt(0);break}o&&c(f+131072);const m=f+e;if(f<d){const t=n-d,e=Math.min(d,m);for(t+f<0&&rt(3);f<e;++f)s[f]=r[t+f]}for(;f<m;++f)s[f]=s[f-d]}}}e.l=d,e.p=b,e.b=f,e.f=h,d&&(h=1,e.m=m,e.d=p,e.n=g)}while(!h);return f!=s.length&&a?et(s,0,f):s.subarray(0,f)})(t.subarray((s=t,r=e.dictionary,(8!=(15&s[0])||s[0]>>4>7||(s[0]<<8|s[1])%31)&&rt(6,"invalid zlib data"),(s[1]>>5&1)==+!r&&rt(6,"invalid zlib data: "+(32&s[1]?"need":"unexpected")+" dictionary"),2+(s[1]>>3&4)),-4),{i:2},e&&e.out,e&&e.dictionary);var s,r}class bt{static table=Uint32Array.from(Array(256),((t,e)=>{let s=e;for(let t=0;t<8;t++)s=1&s?3988292384^s>>>1:s>>>1;return s>>>0}));static WHITE_COLOR=4294967295;caches=new Map;calculate(t){if(!(t instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array");const{caches:e}=this,s=f.decode.bytesToString(t);if(e.has(s))return e.get(s);let r=bt.WHITE_COLOR;for(let e=0;e<t.length;e++)r=r>>>8^bt.table[255&(r^t[e])];return e.set(s,(r^bt.WHITE_COLOR)>>>0),e.get(s)}clear(){this.caches.clear()}}class kt{width;height;view;crc32=new bt;constructor(t,e){this.width=t,this.height=e,this.view=new DataView(new ArrayBuffer(4*t*e))}createChunk(t,e){const s=new Uint8Array(4);new DataView(s.buffer).setUint32(0,e.length,!1);const r=Uint8Array.from(t,(t=>t.charCodeAt(0))),i=new Uint8Array(r.length+e.length);i.set(r),i.set(e,r.length);const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,this.crc32.calculate(i)>>>0,!1);const a=new Uint8Array(s.length+i.length+n.length);return a.set(s),a.set(i,s.length),a.set(n,s.length+i.length),a}createIHDRChunk(){const t=new Uint8Array(13),e=new DataView(t.buffer);return e.setUint32(0,this.width,!1),e.setUint32(4,this.height,!1),e.setUint8(8,8),e.setUint8(9,6),e.setUint8(10,0),e.setUint8(11,0),e.setUint8(12,0),this.createChunk("IHDR",t)}createIDATChunk(){const{width:t,height:e}=this,s=4*t,r=s+1,i=new Uint8Array(r*e),n=new Uint8Array(this.view.buffer);let a,o;for(let t=0;t<e;t++)a=t*r,i[a]=0,o=t*s,i.set(n.subarray(o,o+s),a+1);return this.createChunk("IDAT",yt(i))}setPixel(t,e,s){this.view.setUint32(4*(e*this.width+t),s,!1)}write(t){const{width:e,height:s}=this;let r,i,n,a,o,l;for(let c=0;c<s;c++)for(let s=0;s<e;s++)r=4*(c*e+s),i=t[r],n=t[r+1],a=t[r+2],o=t[r+3],l=(i<<24|n<<16|a<<8|o)>>>0,this.setPixel(s,c,l);return this}flush(){const t=this.createIHDRChunk(),e=this.createIDATChunk(),s=this.createChunk("IEND",new Uint8Array(0)),r=new Uint8Array(8+t.length+e.length+s.length);let i=0;return r.set(new Uint8Array([137,80,78,71,13,10,26,10]),i),i+=8,r.set(t,i),i+=t.length,r.set(e,i),i+=e.length,r.set(s,i),this.crc32.clear(),r}}class xt{buffer=[];lengthInBits=0;getAt(t){const e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let s=0;s<e;s++)this.putBit(1==(t>>>e-s-1&1))}putBit(t){const{lengthInBits:e,buffer:s}=this,r=~~(e/8);s.length<=r&&s.push(0),t&&(s[r]|=128>>>e%8),this.lengthInBits+=1}}const Ct={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Tt={L:1,M:0,Q:3,H:2},vt={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};class Mt{bytes;constructor(t){let e=[];for(let s=0;s<t.length;s++){const r=[],i=t.charCodeAt(s);i>65536?(r[0]=240|(1835008&i)>>>18,r[1]=128|(258048&i)>>>12,r[2]=128|(4032&i)>>>6,r[3]=128|63&i):i>2048?(r[0]=224|(61440&i)>>>12,r[1]=128|(4032&i)>>>6,r[2]=128|63&i):i>128?(r[0]=192|(1984&i)>>>6,r[1]=128|63&i):r[0]=i,e.push(r)}this.bytes=e.flat(1);const{bytes:s}=this;s.length!==t.length&&(s.unshift(191),s.unshift(187),s.unshift(239))}get mode(){return Ct.MODE_8BIT_BYTE}get length(){return this.bytes.length}write(t){const{bytes:e}=this;for(let s=0;s<e.length;s++)t.put(e[s],8)}}const Et=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class At{getRSBlockTable(t,e){const{L:s,M:r,Q:i,H:n}=Tt,a=4*(t-1);switch(e){case s:return Et[a+0];case r:return Et[a+1];case i:return Et[a+2];case n:return Et[a+3];default:throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel: ${e}`)}}getRSBlocks(t,e){const s=this.getRSBlockTable(t,e),r=s.length/3,i=[];for(let t=0;t<r;t++){const e=s[3*t],r=s[3*t+1],n=s[3*t+2];for(let t=0;t<e;t++)i.push({totalCount:r,dataCount:n})}return i}}const Rt=new Array(256),Pt=new Array(256);for(let t=0;t<8;t++)Rt[t]=1<<t;for(let t=8;t<256;t++)Rt[t]=Rt[t-4]^Rt[t-5]^Rt[t-6]^Rt[t-8];for(let t=0;t<255;t++)Pt[Rt[t]]=t;const St={glog(t){if(t<1)throw new Error(`glog(${t})`);return Pt[t]},gexp:t=>(t<0?t=255+t%255:t>255&&(t%=255),Rt[t])};class It{num;constructor(t,e){const{length:s}=t;if(void 0===s)throw new Error(`${s}/${e}`);let r=0;for(;r<s&&0===t[r];)r++;const i=s-r;this.num=new Array(i+e);for(let e=0;e<i;e++)this.num[e]=t[e+r]}get length(){return this.num.length}getAt(t){return this.num[t]}multiply(t){const{glog:e,gexp:s}=St,r=[];for(let i=0;i<this.length;i++)for(let n=0;n<t.length;n++)r[i+n]^=s(e(this.getAt(i))+e(t.getAt(n)));return new It(r,0)}mod(t){if(this.length-t.length<0)return this;const{glog:e,gexp:s}=St,r=e(this.getAt(0))-e(t.getAt(0)),i=[];for(var n=0;n<this.length;n++){const a=this.getAt(n);i[n]=n<t.length?a^s(e(t.getAt(n))+r):a}return new It(i,0).mod(t)}}const Dt=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],Ft=t=>0===t?0:Math.log2(t),Bt=Ft(1335),Ut=Ft(7973),Ot={getBCHTypeInfo(t){let e=t<<10;for(;Ft(e)-Bt>=0;)e^=1335<<Ft(e)-Bt;return 21522^(t<<10|e)},getBCHTypeNumber(t){let e=t<<12;for(;Ft(e)-Ut>=0;)e^=7973<<Ft(e)-Ut;return t<<12|e},getPatternPosition:t=>Dt[t-1],getMaskFunction(t){const{PATTERN000:e,PATTERN001:s,PATTERN010:r,PATTERN011:i,PATTERN100:n,PATTERN101:a,PATTERN110:o,PATTERN111:l}=vt;switch(t){case e:return(t,e)=>(t+e)%2==0;case s:return t=>t%2==0;case r:return(t,e)=>e%3==0;case i:return(t,e)=>(t+e)%3==0;case n:return(t,e)=>(~~(t/2)+~~(e/3))%2==0;case a:return(t,e)=>t*e%2+t*e%3==0;case o:return(t,e)=>(t*e%2+t*e%3)%2==0;case l:return(t,e)=>(t*e%3+(t+e)%2)%2==0;default:throw new Error(`bad maskPattern: ${t}`)}},getErrorCorrectPolynomial(t){let e=new It([1],0);for(let s=0;s<t;s++)e=e.multiply(new It([1,St.gexp(s)],0));return e},getLengthInBits(t,e){const{MODE_NUMBER:s,MODE_ALPHA_NUM:r,MODE_8BIT_BYTE:i,MODE_KANJI:n}=Ct;if(e<1||e>40)throw new Error(`type: ${e}`);if(e>=1&&e<10)switch(t){case s:return 10;case r:return 9;case i:case n:return 8}if(e<27)switch(t){case s:return 12;case r:return 11;case i:return 16;case n:return 10}if(e<=40)switch(t){case s:return 14;case r:return 13;case i:return 16;case n:return 12}throw new Error(`mode: ${t}`)},getLostPoint(t){const e=t.getModuleCount();let s=0;for(let r=0;r<e;r++)for(let i=0;i<e;i++){const n=t.isDark(r,i);let a=0;for(let s=-1;s<=1;s++){const o=r+s;if(!(o<0||e<=o))for(let r=-1;r<=1;r++){const l=i+r;l<0||e<=l||(0===s&&0===r||n===t.isDark(o,l)&&a++)}}a>5&&(s+=a+3-5)}for(let r=0;r<e-1;r++)for(let i=0;i<e-1;i++){let e=0;t.isDark(r,i)&&e++,t.isDark(r+1,i)&&e++,t.isDark(r,i+1)&&e++,t.isDark(r+1,i+1)&&e++,0!==e&&4!==e||(s+=3)}for(let r=0;r<e;r++)for(let i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(s+=40);for(let r=0;r<e;r++)for(let i=0;i<e-6;i++)t.isDark(i,r)&&!t.isDark(i+1,r)&&t.isDark(i+2,r)&&t.isDark(i+3,r)&&t.isDark(i+4,r)&&!t.isDark(i+5,r)&&t.isDark(i+6,r)&&(s+=40);let r=0;for(let s=0;s<e;s++)for(let i=0;i<e;i++)t.isDark(i,s)&&r++;return s+10*(Math.abs(100*r/Math.pow(e,2)-50)/5)}};class Lt{typeNumber;errorCorrectLevel;modules=[];moduleCount=0;dataCache=null;dataList=[];constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=Tt[e]}makeImpl(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=(t=>{const e=[];for(let s=0;s<t;s++){e[s]=[];for(let r=0;r<t;r++)e[s][r]=null}return e})(this.moduleCount);const s=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(s,0),this.setupPositionProbePattern(0,s),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null===this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)}setupPositionProbePattern(t,e){const{modules:s,moduleCount:r}=this;for(let i=-1;i<=7;i++){const n=t+i;if(!(n<=-1||r<=n))for(let t=-1;t<=7;t++){const a=e+t;a<=-1||r<=a||(s[n][a]=i>=0&&i<=6&&(0===t||6===t)||t>=0&&t<=6&&(0===i||6===i)||i>=2&&i<=4&&t>=2&&t<=4)}}}setupPositionAdjustPattern(){const{typeNumber:t,modules:e}=this,s=Ot.getPatternPosition(t),{length:r}=s;for(let t=0;t<r;t++)for(let i=0;i<r;i++){const r=s[t],n=s[i];if(null==e[r][n])for(let t=-2;t<=2;t++)for(let s=-2;s<=2;s++)e[r+t][n+s]=-2===t||2===t||-2===s||2===s||0===t&&0===s}}setupTimingPattern(){const{moduleCount:t,modules:e}=this,s=t-8;for(let t=8;t<s;t++)null==e[t][6]&&(e[t][6]=t%2==0);for(let t=8;t<s;t++)null==e[6][t]&&(e[6][t]=t%2==0)}setupTypeInfo(t,e){const{errorCorrectLevel:s,modules:r,moduleCount:i}=this,n=s<<3|e,a=Ot.getBCHTypeInfo(n);for(let e=0;e<15;e++){const s=!t&&1==(a>>e&1);e<6?r[e][8]=s:e<8?r[e+1][8]=s:r[i-15+e][8]=s}for(let e=0;e<15;e++){const s=!t&&1==(a>>e&1);e<8?r[8][i-e-1]=s:e<9?r[8][15-e]=s:r[8][15-e-1]=s}r[i-8][8]=!t}getBestMaskPattern(){let t=0,e=0;for(let s=0;s<8;s++){this.makeImpl(!0,s);const r=Ot.getLostPoint(this);(0===s||t>r)&&(t=r,e=s)}return e}setupTypeNumber(t){const{typeNumber:e,modules:s,moduleCount:r}=this,i=Ot.getBCHTypeNumber(e);for(let e=0;e<18;e++){const n=!t&&1==(i>>e&1);s[~~(e/3)][e%3+r-8-3]=n,s[e%3+r-8-3][~~(e/3)]=n}}createData(t,e,s){const r=(new At).getRSBlocks(t,e),i=new xt;for(let e=0;e<s.length;e++){const r=s[e];i.put(r.mode,4),i.put(r.length,Ot.getLengthInBits(r.mode,t)),r.write(i)}let n=0;for(let t=0;t<r.length;t++)n+=r[t].dataCount;const a=8*n;if(i.lengthInBits>a)throw new Error(`code length overflow. (${i.lengthInBits} > ${a})`);for(i.lengthInBits+4<=a&&i.put(0,4);i.lengthInBits%8!=0;)i.putBit(!1);for(;!(i.lengthInBits>=a||(i.put(236,8),i.lengthInBits>=a));)i.put(17,8);return this.createBytes(i,r)}mapData(t,e){const{modules:s,moduleCount:r}=this,i=Ot.getMaskFunction(e);let n=-1,a=r-1,o=7,l=0;for(let e=a;e>0;e-=2)for(6===e&&(e-=1);;){for(let r=0;r<2;r++)if(null==s[a][e-r]){let n=!1;l<t.length&&(n=1==(t[l]>>>o&1)),i(a,e-r)&&(n=!n),s[a][e-r]=n,o--,-1===o&&(l++,o=7)}if(a+=n,a<0||r<=a){a-=n,n=-n;break}}}createBytes(t,e){const s=[],r=[];let i=0,n=0,a=0;for(let o=0;o<e.length;o++){const l=e[o].dataCount,c=e[o].totalCount-l;n=Math.max(n,l),a=Math.max(a,c),s[o]=[];for(let e=0;e<l;e++)s[o][e]=255&t.buffer[e+i];i+=l;const h=Ot.getErrorCorrectPolynomial(c),u=new It(s[o],h.length-1).mod(h);r[o]=new Array(h.length-1);for(let t=0;t<r[o].length;t++){const e=t+u.length-r[o].length;r[o][t]=e>=0?u.getAt(e):0}}let o=0;for(let t=0;t<e.length;t++)o+=e[t].totalCount;const l=new Array(o);let c=0;for(let t=0;t<n;t++)for(let r=0;r<e.length;r++)t<s[r].length&&(l[c++]=s[r][t]);for(let t=0;t<a;t++)for(let s=0;s<e.length;s++)t<r[s].length&&(l[c++]=r[s][t]);return l}isDark(t,e){const{moduleCount:s}=this;if(t<0||s<=t||e<0||s<=e)throw new Error(`${t}, ${e}`);return this.modules[t][e]}addData(t){this.dataList.push(new Mt(t)),this.dataCache=null}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}}class Nt{painter;static isBitmap(t){return"h5"===f.globals.env&&t instanceof ImageBitmap}static releaseOne(t){Nt.isBitmap(t)?t.close():""!==t.src&&("weapp"===f.globals.env&&t.src.includes(f.path.USER_DATA_PATH)&&f.local.remove(t.src),f.image.release(t))}caches=[];dynamicMaterials=new Map;materials=new Map;point=0;constructor(t){this.painter=t}createImage(){let t=null;return this.point>0&&(this.point--,t=this.caches.shift()),t||(t=f.image.create(this.painter.X)),this.caches.push(t),t}inertBitmapIntoCaches(t){Nt.isBitmap(t)&&this.caches.push(t)}loadExtImage(t,e){return f.image.load((()=>this.createImage()),t,f.path.resolve(e,"ext")).then((t=>(this.inertBitmapIntoCaches(t),t)))}async loadImagesWithRecord(t,e,s="normal"){const r=[];Object.entries(t).forEach((([t,i])=>{if(i instanceof Uint8Array&&i.byteLength<70)return;const n=f.image.load((()=>this.createImage()),i,f.path.resolve(`${e.replace(/\.svga$/g,"")}.png`,"dynamic"===s?`dyn_${t}`:t)).then((e=>{this.inertBitmapIntoCaches(e),"dynamic"===s?this.dynamicMaterials.set(t,e):this.materials.set(t,e)}));r.push(n)})),await Promise.all(r)}release(){for(const t of this.caches)Nt.releaseOne(t);this.materials.clear(),this.dynamicMaterials.clear(),"alipay"===f.globals.env?this.cleanup():this.tidyUp()}tidyUp(){this.caches=Array.from(new Set(this.caches)),this.point=this.caches.length}cleanup(){this.caches.length=0,this.point=0}}class zt{static hash(t){const e=new Uint8Array(t);return p(e,0,e.byteLength,Math.max(1,Math.floor(e.byteLength/100)))}static decompress(t){return wt(new Uint8Array(t)).buffer}static parseVideo(e,s,r=!0){return function(e,s){if(e instanceof Uint8Array){const r=new g(e),i=R.decode(r);return t.log("preflight cache size",r.preflight.size),t.log("preflight hit count",r.preflight.hitCount),i.filename=s,r.preflight.clear(),i}throw new Error("Invalid data type")}(new Uint8Array(r?this.decompress(e):e),f.path.filename(s))}static download(t){const{remote:e,path:s,local:r}=f;return s.is(t)?r.read(t):e.fetch(t)}static async load(t){return zt.parseVideo(await zt.download(t),t)}}const{noop:Ht}=f;class Yt{mode;X=null;XC=null;Y=null;YC=null;W;H;model={};constructor(t="animation",e=0,s=0){this.mode=t;const{dpr:r}=f.globals;this.W=e*r,this.H=s*r}setModel(t){const{model:e}=this,{env:s}=f.globals;e.type=t,"O"===t&&"h5"===s&&navigator.userAgent.includes("Firefox")?e.clear="CR":e.clear="O"===t&&"tt"===s||"alipay"===s?"CL":"RE"}async register(t,e,s){const{model:r,mode:i}=this,{getCanvas:n,getOfsCanvas:a}=f,{env:o}=f.globals;if("poster"!==i||"h5"===o&&!("OffscreenCanvas"in globalThis)){const{canvas:e,context:r}=await n(t,s),{width:a,height:o}=e;this.X=e,this.XC=r,"poster"===i?(e.width=a,e.height=o,this.setModel("C")):(this.W=a,this.H=o)}else{const{W:t,H:e}=this;if(!(t>0&&e>0))throw new Error("Poster mode must set width and height when create Brush instance");const{canvas:s,context:r}=a({width:t,height:e});this.X=s,this.XC=r,this.setModel("O")}if("poster"===i)this.Y=this.X,this.YC=this.XC;else{let t;"string"==typeof e&&""!==e?(t=await n(e,s),t.canvas.width=this.W,t.canvas.height=this.H,this.setModel("C")):(t=a({width:this.W,height:this.H}),this.setModel("O")),this.Y=t.canvas,this.YC=t.context}if("CL"===r.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===i)this.clearSecondary=this.stick=Ht;else switch(r.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:s,context:r}=a({width:t,height:e});this.Y=s,this.YC=r};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:s}=this;s.width=t,s.height=e}}}clearContainer=Ht;clearSecondary=Ht;stick(){const{W:t,H:e,mode:s}=this;"poster"!==s&&this.XC.drawImage(this.YC.canvas,0,0,t,e)}destroy(){this.clearContainer(),this.clearSecondary(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=Ht}}class _t{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards","none"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:s,startFrame:r,endFrame:i,fillMode:n,loop:a}=this,{fps:o,sprites:l}=t;let{frames:c}=t;const h=l.length,u=r>0?r:0,f=i>0&&i<c?i:c,d=1e3/o;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<c?c=f-u:u>0&&(c-=u);const p=Math.floor(c*d*10**6)/10**6;let m,g=0,y=0;return"forwards"===e?(g=Math.max(s,r),"forwards"===n&&(y=1),m=s>u?(s-u)*d:0):(g=Math.min(s,f-1),"backwards"===n&&(y=1),m=s<f?(f-s)*d:0),{currFrame:g,startFrame:u,endFrame:f,totalFrame:c,spriteCount:h,aniConfig:{duration:p,loopStart:m,loop:0===a?1/0:a,fillValue:y*d}}}}class Wt{entity;config=new _t;resource=null;painter=new Yt;animator=new I;renderer=null;async setConfig(t,e){const s="string"==typeof t?{container:t}:t;this.config.register(s),await this.painter.register(s.container,s.secondary,e),this.renderer=new S(this.painter.YC),this.resource=new Nt(this.painter),this.animator.onAnimate=f.rAF.bind(null,this.painter.X)}setItem(t,e){this.config.setItem(t,e)}async mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:s}=t;this.animator.stop(),this.painter.clearSecondary(),this.resource.release(),this.entity=t,await this.resource.loadImagesWithRecord(e,s)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.painter.clearContainer(),this.painter.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.painter.destroy(),this.renderer?.destroy(),this.resource?.release(),this.resource?.cleanup(),this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.start())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:s}=this.entity;let r=t<0?0:Math.round(t*s);r>=s&&(r=s-1),this.stepToFrame(r,e)}startAnimation(){const{entity:t,config:e,animator:s,painter:r,renderer:i,resource:n}=this,{W:a,H:o}=r,{fillMode:l,playMode:c,contentMode:h}=e,{currFrame:u,startFrame:d,endFrame:p,totalFrame:m,spriteCount:g,aniConfig:y}=e.getConfig(t),{duration:w,loopStart:b,loop:k,fillValue:x}=y,C="fallbacks"===c;let T,v,M,E,A,R,P=u,S=0;s.setConfig(w,b,k,x),i.resize(h,t.size,{width:a,height:o});let I,D,F,B=4;s.onUpdate=e=>{(e=>{for(I=f.now(),e();S<g;)if(D=Math.min(B,g-S),T=S+D|0,i.render(t,n.materials,n.dynamicMaterials,P,S,T),S=T,F=f.now()-I,F<3)B=Math.min(2*B,34);else if(F>8){B=Math.max(B/2,1);break}})((()=>{A=C?1-e:e,E=A*m,C?(M=(0===e?p:Math.ceil(E))-1,A=P/m):M=1===e?d:Math.floor(E),R=P===M})),R||(r.clearContainer(),r.stick(),r.clearSecondary(),v=P,P=M,S=0,this.onProcess?.(~~(100*A)/100,v))},s.onStart=()=>{t.locked=!0},s.onEnd=()=>{t.locked=!1,"none"===l&&r.clearContainer(),this.onEnd?.()},s.start()}}class Xt{entity;config={container:"",contentMode:"fill",frame:0};isConfigured=!1;painter;resource=null;renderer=null;constructor(t,e){this.painter=new Yt("poster",t,e)}async register(t="",e){await this.painter.register(t,"",e),this.renderer=new S(this.painter.YC),this.resource=new Nt(this.painter)}async setConfig(t={},e){"string"==typeof t?this.config.container=t:Object.assign(this.config,t),this.isConfigured=!0,await this.register(this.config.container,e)}setContentMode(t){this.config.contentMode=t}setFrame(t){this.config.frame=t}async mount(t){if(!t)throw new Error("videoEntity undefined");this.isConfigured||(await this.register(),this.isConfigured=!0);const{images:e,filename:s}=t;this.painter.clearContainer(),this.resource.release(),this.entity=t,await this.resource.loadImagesWithRecord(e,s)}draw(){if(!this.entity)return;const{painter:t,renderer:e,resource:s,entity:r,config:i}=this;e.resize(i.contentMode,r.size,t.X),e.render(r,s.materials,s.dynamicMaterials,i.frame,0,r.sprites.length)}toImageData(){const{XC:t,W:e,H:s}=this.painter;return t.getImageData(0,0,e,s)}destroy(){this.painter.destroy(),this.renderer?.destroy(),this.resource?.release(),this.resource?.cleanup(),this.entity=void 0}}function $t(t){const{code:e,typeNumber:s,correctLevel:r,size:i,codeColor:n,backgroundColor:a}=function(t){const e=t.typeNumber??4,s=t.correctLevel??"H",r=t.codeColor??"#000000",i=t.backgroundColor??"#FFFFFF";return{code:t.code,size:t.size,typeNumber:e,correctLevel:s,codeColor:r,backgroundColor:i}}(t);let o;try{o=new Lt(s,r),o.addData(e),o.make()}catch(t){if(s>=40)throw new Error("Text too long to encode");return arguments.callee({code:e,size:i,correctLevel:r,typeNumber:s+1,codeColor:n,backgroundColor:a})}const l=o.getModuleCount(),{padding:c,cellSize:h}=((t,e)=>{const s=~~(e/t);return{padding:~~((e-t*s)/2),cellSize:s||2}})(l,i),u=l*h+c,f=+`${n.replace("#","0x")}FF`,d=+`${a.replace("#","0x")}FF`,p=new kt(i,i);for(let t=0;t<i;t++)for(let e=0;e<i;e++)if(c<=e&&e<u&&c<=t&&t<u){const s=~~((e-c)/h),r=~~((t-c)/h);p.setPixel(e,t,o.isDark(r,s)?f:d)}else p.setPixel(e,t,d);return p.flush()}function Vt(t){const e=$t(t);return f.decode.toDataURL(e)}function Kt(t){const{width:e,height:s,data:r}=t;return new kt(e,s).write(r).flush()}function qt(t){const e=Kt(t);return f.decode.toDataURL(e)}class Jt{static async writeFileToUserDirectory(t,e){const{path:s,local:r}=f;if(s.is(t.local))try{await r.write(e,t.local)}catch(t){console.error(t)}}static async removeFileFromUserDirectory(t){const{path:e,local:s}=f;if(e.is(t.local))try{await s.remove(t.local)}catch(t){console.error(t)}}point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];options={preprocess:async e=>{const{local:s,remote:r}=f;return s&&await s.exists(e.local)?t.time(`${e.local} 读取时间`,(()=>s.read(e.local))):t.time(`${e.origin} 下载时间`,(()=>r.fetch(e.origin)))},postprocess:(e,s)=>t.time(`${e.origin} 解析时间`,(()=>zt.parseVideo(s,e.origin,!0)))};get size(){return this.buckets.length}constructor(t,e){"string"==typeof t&&(this.loadMode=t),Object.assign(this.options,e)}updateRemainRange(t,e,s){this.point=t<0?0:t>=s?s-1:t,"whole"===this.loadMode?(this.remainStart=0,this.remainEnd=s):(this.maxRemain=e<1?1:e>s?s:e,this.remainStart=this.point-Math.floor(this.maxRemain/2),this.remainStart<0&&(this.remainStart=s+this.remainStart),this.remainEnd=this.remainStart+this.maxRemain,this.remainEnd>s&&(this.remainEnd=this.remainEnd%s))}includeRemainRange(t){return this.remainStart<this.remainEnd?t>=this.remainStart&&t<this.remainEnd:!(this.remainStart>this.remainEnd)||(t>=this.remainStart||t<this.remainEnd)}async downloadAndParseVideo(t,e=!1){const{options:s}=this,r=await s.preprocess(t);return Jt.writeFileToUserDirectory(t,r),e?s.postprocess(t,r):r}async createBucket(t,e,s){const{path:r}=f,i={origin:t,local:r.resolve(r.filename(t),"full"),entity:null,promise:null};return this.buckets[e]=i,s?i.entity=await this.downloadAndParseVideo(i,!0):this.includeRemainRange(e)&&(i.promise=this.downloadAndParseVideo(i)),i}async prepare(e,s=0,r=3){this.updateRemainRange(s,r,e.length);const{loadMode:i,point:n}=this,a=await this.createBucket(e[n],n,!0);await t.time("资源加载时间",(()=>Promise.all(e.map(((t,e)=>e===n?a:this.createBucket(t,e,"whole"===i))))))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise.then((e=>this.options.postprocess(t,e))),t.promise=null):t.entity||(t.entity=await this.downloadAndParseVideo(t,!0)),t}getPoint(){return this.point}async go(t){const{size:e,buckets:s,loadMode:r}=this;return t<0||t>=e?s[this.point]:(this.updateRemainRange(t,this.maxRemain,s.length),"fast"===r&&this.maxRemain!==s.length&&s.forEach(((t,e)=>{this.includeRemainRange(e)?null===t.entity&&null===t.promise&&(t.promise=this.downloadAndParseVideo(t)):(t.entity=null,t.promise=null)})),this.get())}async clear(t=!0){const{buckets:e}=this;this.point=0,this.remainStart=0,this.remainEnd=0,this.maxRemain=3,this.buckets=[],t&&await Promise.all(e.map(Jt.removeFileFromUserDirectory))}}class jt{painter;resource;entity;constructor(t,e,s){this.painter=t,this.resource=e,this.entity=s}async set(t,e,s="R"){const{entity:r,resource:i}=this;"A"===s?await i.loadImagesWithRecord({[t]:e},r.filename,"dynamic"):r.images[t]=e}getContext(){return this.painter.YC}hasValidKey(t){const{images:e}=this.entity;return"function"==typeof Object.hasOwn?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t)}loadImage(t,e){return this.resource.loadExtImage(t,f.path.filename(e))}async setCanvas(t,e,s){if(this.entity.locked)return;const{canvas:r}=e,i=s?.width??r.width,n=s?.height??r.height,a=Kt(e.getImageData(0,0,i,n));await this.set(t,new Uint8Array(a),s?.mode)}async setImage(t,e,s){if(!this.entity.locked)if(e.startsWith("data:image"))await this.set(t,e,s?.mode);else{const r=await f.remote.fetch(e);await this.set(t,new Uint8Array(r),s?.mode)}}async setQRCode(t,e,s){if(this.entity.locked)return;const r=$t({...s,code:e});await this.set(t,new Uint8Array(r),s?.mode)}}export{Yt as Painter,zt as Parser,Wt as Player,Xt as Poster,jt as VideoEditor,Jt as VideoManager,$t as generateImageBufferFromCode,Vt as generateImageFromCode,Kt as getBufferFromImageData,qt as getDataURLFromImageData,f as platform};//# sourceMappingURL=index.min.js.map

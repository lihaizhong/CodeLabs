!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).OctopusSvga={})}(this,(function(t){"use strict";var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},e(t,r)};var r=function(){return r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},r.apply(this,arguments)};function n(t,e,r,n){return new(r||(r=Promise))((function(i,a){function o(t){try{u(n.next(t))}catch(t){a(t)}}function s(t){try{u(n.throw(t))}catch(t){a(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(o,s)}u((n=n.apply(t,e||[])).next())}))}function i(t,e){var r,n,i,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=s(0),o.throw=s(1),o.return=s(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}"function"==typeof SuppressedError&&SuppressedError;const a=()=>{};async function o(t,e=[],r=0){try{return t()}catch(a){if(r>=e.length)throw a;return n=()=>o(t,e,++r),i=e[r],new Promise((t=>setTimeout((()=>t(n())),i)))}var n,i}const s=4096,u=new Uint16Array(s);function c(t,e,r){if(e<0||r>t.length)throw new RangeError("Index out of range");if(r-e<1)return"";const n=[];let i=0;const a=t=>{n.push(String.fromCharCode.apply(null,Array.from(t)))};let o=!0;for(let n=e;n<r;n++)if(t[n]>127){o=!1;break}if(o){for(let n=e;n<r;n+=s){const e=Math.min(n+s,r)-n;for(let r=0;r<e;r++)u[r]=t[n+r];a(u.subarray(0,e))}return n.join("")}for(let n=e;n<r;){const e=t[n++];if(e<128){u[i++]=e,i===s&&(a(u),i=0);continue}let o;if(i>0&&(a(u.subarray(0,i)),i=0),192==(224&e)&&n<r)o=(31&e)<<6|63&t[n++];else if(224==(240&e)&&n+1<r)o=(15&e)<<12|(63&t[n++])<<6|63&t[n++];else if(240==(248&e)&&n+2<r){if(o=(7&e)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++],o>65535){o-=65536,u[i++]=55296+(o>>10),u[i++]=56320+(1023&o),i>=4094&&(a(u.subarray(0,i)),i=0);continue}}else for(o=65533;n<r&&128==(192&t[n]);)n++;u[i++]=o,i>=4093&&(a(u.subarray(0,i)),i=0)}return i>0&&a(u.subarray(0,i)),n.join("")}var h={name:"getCanvas",install(){const{retry:t}=this,{env:e,br:r,dpr:n}=this.globals,i=[50,100,100];function a(t,e,r){if(!t)throw new Error("canvas not found.");const i=t.getContext("2d");return t.width=e*n,t.height=r*n,{canvas:t,context:i}}if("h5"===e){const e=t=>document.querySelector(t);return r=>t((()=>{const t=e(`canvas[canvas-id=${r.slice(1)}]`)||e(r);return a(t,t?.clientWidth,t?.clientHeight)}),i)}return(e,n)=>t((()=>new Promise(((t,i)=>{let o=r.createSelectorQuery();n&&(o=o.in(n)),o.select(e).fields({node:!0,size:!0},(e=>{const{node:r,width:n,height:o}=e||{};try{t(a(r,n,o))}catch(t){i(t)}})).exec()}))),i)}},l={name:"decode",install(){const{env:t,br:e}=this.globals,r=(t,e="image/png")=>`data:${e};base64,${t}`,n={toBuffer(t){const{buffer:e,byteOffset:r,byteLength:n}=t;if(e instanceof ArrayBuffer)return e.slice(r,r+n);const i=new Uint8Array(n);return i.set(t),i.buffer},bytesToString(t){let e="";for(let r=0;r<t.length;r+=8192){const n=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,Array.from(n))}return e}};if("h5"===t){const t=new TextDecoder("utf-8",{fatal:!0});return{...n,toDataURL:t=>r(btoa(n.bytesToString(t))),utf8:(e,r,n)=>t.decode(e.subarray(r,n))}}return{...n,toDataURL:t=>r(e.arrayBufferToBase64(n.toBuffer(t))),utf8:c}}},f={name:"remote",install(){const{env:t,br:e}=this.globals,r=t=>/^(blob:)?http(s)?:\/\//.test(t);if("h5"===t)return{is:r,fetch:t=>fetch(t).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)}))};function n(t,r){return new Promise(((n,i)=>{e.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:r,success:t=>n(t.data),fail:i})})).catch((e=>{const r=e.errMsg||e.errorMessage||e.message;if(r.includes("ERR_CACHE_WRITE_FAILURE")||r.includes("ERR_CACHE_WRITE_FAILED"))return n(t,!1);throw e}))}return{is:r,fetch:t=>n(t,!0)}}},p={name:"local",install(){const{env:t,br:e}=this.globals;if("h5"===t||"tt"===t)return null;const r=e.getFileSystemManager();return{exists:t=>new Promise((e=>{r.access({path:t,success:()=>e(!0),fail:()=>e(!1)})})),write:(t,e)=>new Promise(((n,i)=>{r.writeFile({filePath:e,data:t,success:()=>n(e),fail:i})})),read:t=>new Promise(((e,n)=>{r.readFile({filePath:t,success:t=>e(t.data),fail:n})})),remove:t=>new Promise(((e,n)=>{r.unlink({filePath:t,success:()=>e(t),fail:n})}))}}},d={name:"image",dependencies:["local","decode"],install(){const{local:t,decode:e}=this,{env:r}=this.globals;let n=(t,r)=>"string"==typeof t?t:e.toDataURL(t);function i(t,e){return new Promise(((r,n)=>{t.onload=()=>r(t),t.onerror=()=>n(new Error(`SVGA LOADING FAILURE: ${e}`)),t.src=e}))}function a(t){t.onload=null,t.onerror=null,t.src=""}return"h5"===r?{create:t=>new Image,load:(t,r,a)=>r instanceof Uint8Array&&"createImageBitmap"in globalThis?createImageBitmap(new Blob([e.toBuffer(r)])):r instanceof ImageBitmap?Promise.resolve(r):i(t(),n(r,a)),release:a}:("weapp"===r&&(n=async(r,n)=>"string"==typeof r?r:t.write(e.toBuffer(r),n).catch((t=>(console.warn(`image write fail: ${t.errorMessage||t.errMsg||t.message}`),e.toDataURL(r))))),{create:t=>t.createImage(),load:async(t,e,r)=>i(t(),await n(e,r)),release:a})}},y={name:"now",install(){const{env:t,br:e}=this.globals,r="h5"===t||"tt"===t?performance:e.getPerformance();return"function"==typeof r?.now?r.now()-Date.now()>1?()=>r.now()/1e3:()=>r.now():()=>Date.now()}},v={name:"getOfsCanvas",install(){const{env:t}=this.globals;let e;return e="h5"===t?t=>new OffscreenCanvas(t.width,t.height):"alipay"===t?t=>my.createOffscreenCanvas(t):"tt"===t?t=>{const e=tt.createOffscreenCanvas();return e.width=t.width,e.height=t.height,e}:t=>wx.createOffscreenCanvas(t),t=>{const r=t.type||"2d",n=e({...t,type:r}),i=n.getContext(r);return{canvas:n,context:i}}}},g={name:"path",install(){const{env:t,br:e}=this.globals,r=t=>{const e=t.split(/\?#/g)[0];return e.substring(e.lastIndexOf("/")+1)};if("h5"===t||"tt"===t)return{USER_DATA_PATH:"",is:t=>!1,filename:r,resolve:(t,e)=>""};const{USER_DATA_PATH:n}=e.env;return{USER_DATA_PATH:n,is:t=>t?.startsWith(n),filename:r,resolve:(t,e)=>`${n}/${e?`${e}__`:""}${t}`}}},m={name:"rAF",install(){const{env:t}=this.globals;function e(){return t=>setTimeout(t,Math.max(0,16-Date.now()%16))}if("h5"===t){const t="requestAnimationFrame"in globalThis?requestAnimationFrame:e();return(e,r)=>t(r)}return(t,r)=>{try{return t.requestAnimationFrame(r)}catch(t){return console.warn(t.message),e()(r)}}}},w=function(t){function r(){var e=t.call(this,[h,v,l,f,p,d,y,g,m],"0.2.5")||this;return e.init(),e}return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}(r,t),r.prototype.installPlugin=function(t){!function(t,e){const r=e.install.call(t);Object.defineProperty(t,e.name,{get:()=>r,enumerable:!0,configurable:!0})}(this,t)},r}(class{plugins=[];platformVersion="0.0.1";version="";globals={env:"unknown",br:null,dpr:1,system:"unknown"};noop=a;retry=o;constructor(t,e){this.version=e||"",this.plugins=t,this.globals.env=this.autoEnv()}init(){const{globals:t,plugins:e}=this,r=new Map,n=[],i=new Set;t.br=this.useBridge(),t.dpr=this.usePixelRatio(),t.system=this.useSystem();for(const t of e)n.push(t.name),r.set(t.name,t);this.usePlugins(r,n,i),i.clear()}autoEnv(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported app")}useBridge(){switch(this.globals.env){case"h5":return globalThis;case"alipay":return my;case"tt":return tt;case"weapp":return wx}return{}}usePixelRatio(){const{env:t,br:e}=this.globals;return"h5"===t?devicePixelRatio:"getWindowInfo"in e?e.getWindowInfo().pixelRatio:"getSystemInfoSync"in e?e.getSystemInfoSync().pixelRatio:1}useSystem(){const{env:t}=this.globals;let e;switch(t){case"weapp":e=wx.getDeviceInfo().platform;break;case"alipay":e=my.getDeviceBaseInfo().platform;break;case"tt":e=tt.getDeviceInfoSync().platform;break;default:e="unknown"}return e.toLowerCase()}usePlugins(t,e,r){for(const n of e){if(!t.has(n))throw new Error(`Plugin ${n} not found`);if(r.has(n))return;const e=t.get(n);if(Array.isArray(e.dependencies)){for(const r of e.dependencies)if("function"!=typeof t.get(r)?.install)throw new Error(`Plugin ${n} depends on plugin ${r}, but ${r} is not found`);this.usePlugins(t,e.dependencies,r)}this.installPlugin(e),r.add(n)}}switch(t){this.globals.env=t,this.init()}}),b=new w;var k,x,C=(k=Array(4).fill(0).map((function(){return new DataView(new ArrayBuffer(8))})),x=0,function(t,e){if(e<0||e+4>t.length)throw new RangeError("Index out of range");var r=k[x];x=(x+1)%4;var n=new Uint8Array(r.buffer);return n[0]=t[e],n[1]=t[e+1],n[2]=t[e+2],n[3]=t[e+3],r.getFloat32(0,!0)});function T(t,e,r,n){for(var i=0,a=e;a<r;a+=n)i=(i<<5)-i+t[a],i|=0;return i=(i<<5)-i+r-e,(i|=0).toString(36)}var S=function(){function t(){this.caches=new Map,this.count=0}return Object.defineProperty(t.prototype,"size",{get:function(){return this.caches.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hitCount",{get:function(){return this.count},enumerable:!1,configurable:!0}),t.prototype.calculate=function(t,e){var r=t.pos,n=t.buf,i=Math.min(e,t.len);return T(n,r,i,Math.max(1,Math.floor((i-r)/100)))},t.prototype.has=function(t){var e=this.caches.has(t);return e&&this.count++,e},t.prototype.get=function(t){return this.caches.get(t)},t.prototype.set=function(t,e){this.caches.set(t,e)},t.prototype.clear=function(){this.count=0,this.caches.clear()},t}(),A=function(){function t(t){this.preflight=new S,this.buf=t,this.pos=0,this.len=t.length}return t.prototype.indexOutOfRange=function(t,e){return new RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)},t.prototype.readVarint32Slow=function(){var t=this.buf[this.pos++],e=127&t,r=7;do{if(this.pos>=this.len)throw this.indexOutOfRange(this);e|=(127&(t=this.buf[this.pos++]))<<r,r+=7}while(t>=128&&r<32);return e>>>0},t.prototype.end=function(t){return void 0===t?this.len:this.pos+t},t.prototype.uint32=function(){var t=this.buf[this.pos];return t<128?(this.pos++,t):this.readVarint32Slow()},t.prototype.int32=function(){return 0|this.uint32()},t.prototype.float=function(){var t=this.pos+4;if(t>this.len)throw this.indexOutOfRange(this,4);var e=C(this.buf,this.pos);return this.pos=t,e},t.prototype.getBytesRange=function(){var t=this.uint32(),e=this.pos,r=e+t;if(r>this.len)throw this.indexOutOfRange(this,t);return[e,r,t]},t.prototype.bytes=function(){var e=this.getBytesRange(),r=e[0],n=e[1],i=e[2];return this.pos+=i,0===i?t.EMPTY_UINT8ARRAY:this.buf.subarray(r,n)},t.prototype.string=function(){var t=this.getBytesRange(),e=t[0],r=t[1],n=b.decode.utf8(this.buf,e,r);return this.pos=r,n},t.prototype.skip=function(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,this}for(var e=this.buf,r=this.len,n=this.pos;n<r;){if(!(128&e[n++]))return this.pos=n,this;if(n<r&&128&e[n]&&++n<r&&128&e[n]&&++n<r&&128&e[n]){for(n++;n<r&&128&e[n];)if(++n-this.pos>=10)throw Error("invalid varint encoding");if(n<r)return this.pos=n+1,this}}throw this.indexOutOfRange(this)},t.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},t.EMPTY_UINT8ARRAY=new Uint8Array(0),t}(),P=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)switch((o=e.uint32())>>>3){case 1:s.x=e.float();break;case 2:s.y=e.float();break;case 3:s.width=e.float();break;case 4:s.height=e.float();break;default:e.skipType(7&o)}return n.set(a,t.format(s)),n.get(a)},t.format=function(t){var e=t.x,r=void 0===e?0:e,n=t.y,i=void 0===n?0:n,a=t.width,o=void 0===a?0:a,s=t.height;return{x:r,y:i,width:o,height:void 0===s?0:s}},t}(),M=function(){function t(){this.a=0,this.b=0,this.c=0,this.d=0,this.tx=0,this.ty=0}return t.decode=function(e,r){for(var n,i=e.end(r),a=new t;e.pos<i;)switch((n=e.uint32())>>>3){case 1:a.a=e.float();break;case 2:a.b=e.float();break;case 3:a.c=e.float();break;case 4:a.d=e.float();break;case 5:a.tx=e.float();break;case 6:a.ty=e.float();break;default:e.skipType(7&n)}return a},t}(),R=function(){function t(){this.d=""}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)if((o=e.uint32())>>>3==1)s.d=e.string();else e.skipType(7&o);return n.set(a,s),n.get(a)},t}(),I=function(){function t(){this.x=0,this.y=0,this.width=0,this.height=0,this.cornerRadius=0}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)switch((o=e.uint32())>>>3){case 1:s.x=e.float();break;case 2:s.y=e.float();break;case 3:s.width=e.float();break;case 4:s.height=e.float();break;case 5:s.cornerRadius=e.float();break;default:e.skipType(7&o)}return n.set(a,s),n.get(a)},t}(),E=function(){function t(){this.x=0,this.y=0,this.radiusX=0,this.radiusY=0}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)switch((o=e.uint32())>>>3){case 1:s.x=e.float();break;case 2:s.y=e.float();break;case 3:s.radiusX=e.float();break;case 4:s.radiusY=e.float();break;default:e.skipType(7&o)}return n.set(a,s),n.get(a)},t}(),D=function(){function t(){this.r=0,this.g=0,this.b=0,this.a=0}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)switch((o=e.uint32())>>>3){case 1:s.r=e.float();break;case 2:s.g=e.float();break;case 3:s.b=e.float();break;case 4:s.a=e.float();break;default:e.skipType(7&o)}return n.set(a,t.format(s)),n.get(a)},t.format=function(t){var e=t.r,r=t.g,n=t.b,i=t.a;return"rgba(".concat(255*e|0,", ").concat(255*r|0,", ").concat(255*n|0,", ").concat(1*i|0,")")},t}(),F=function(){function t(){this.fill=null,this.stroke=null,this.strokeWidth=0,this.lineCap=0,this.lineJoin=0,this.miterLimit=0,this.lineDashI=0,this.lineDashII=0,this.lineDashIII=0}return t.decode=function(e,r){var n=e.preflight,i=e.end(r),a=n.calculate(e,i);if(n.has(a))return e.pos=i,n.get(a);for(var o,s=new t;e.pos<i;)switch((o=e.uint32())>>>3){case 1:s.fill=D.decode(e,e.uint32());break;case 2:s.stroke=D.decode(e,e.uint32());break;case 3:s.strokeWidth=e.float();break;case 4:s.lineCap=e.int32();break;case 5:s.lineJoin=e.int32();break;case 6:s.miterLimit=e.float();break;case 7:s.lineDashI=e.float();break;case 8:s.lineDashII=e.float();break;case 9:s.lineDashIII=e.float();break;default:e.skipType(7&o)}return n.set(a,t.format(s)),n.get(a)},t.format=function(t){var e,r,n=t.fill,i=t.stroke,a=t.strokeWidth,o=t.miterLimit,s=t.lineDashI,u=t.lineDashII,c=t.lineDashIII,h=[];switch(s>0&&h.push(s),u>0&&(h.length<1&&h.push(0),h.push(u)),c>0&&(h.length<2&&h.push(0,0),h.push(c)),t.lineCap){case 0:e="butt";break;case 1:e="round";break;case 2:e="square"}switch(t.lineJoin){case 0:r="miter";break;case 1:r="round";break;case 2:r="bevel"}return{lineDash:h,fill:n||null,stroke:i||null,lineCap:e,lineJoin:r,strokeWidth:a,miterLimit:o}},t}(),O=function(){function t(){this.type=0,this.shape=null,this.rect=null,this.ellipse=null,this.styles=null,this.transform=null}return t.decode=function(e,r){for(var n,i=e.end(r),a=new t;e.pos<i;)switch((n=e.uint32())>>>3){case 1:a.type=e.int32();break;case 2:a.shape=R.decode(e,e.uint32());break;case 3:a.rect=I.decode(e,e.uint32());break;case 4:a.ellipse=E.decode(e,e.uint32());break;case 10:a.styles=F.decode(e,e.uint32());break;case 11:a.transform=M.decode(e,e.uint32());break;default:e.skipType(7&n)}return t.format(a)},t.format=function(t){var e=t.type,r=t.shape,n=t.rect,i=t.ellipse,a=t.styles,o=t.transform;switch(e){case 0:return{type:"shape",path:r,styles:a,transform:o};case 1:return{type:"rect",path:n,styles:a,transform:o};case 2:return{type:"ellipse",path:i,styles:a,transform:o}}return null},t}(),U=function(){function t(){this.shapes=[],this.alpha=0,this.layout=null,this.transform=null,this.clipPath=""}return t.decode=function(e,r){for(var n,i=e.end(r),a=new t;e.pos<i;)switch((n=e.uint32())>>>3){case 1:a.alpha=e.float();break;case 2:a.layout=P.decode(e,e.uint32());break;case 3:a.transform=M.decode(e,e.uint32());break;case 4:a.clipPath=e.string();break;case 5:var o=O.decode(e,e.uint32());null!==o&&a.shapes.push(o);break;default:e.skipType(7&n)}return 0===a.shapes.length?a.shapes=e.preflight.get("latest_shapes"):e.preflight.set("latest_shapes",a.shapes),t.format(a)},t.format=function(e){return e.alpha<.05?t.HIDDEN_FRAME:{alpha:e.alpha,layout:e.layout,transform:e.transform,shapes:e.shapes}},t.HIDDEN_FRAME={alpha:0},t}(),B=function(){function t(){this.frames=[],this.imageKey="",this.matteKey=""}return t.decode=function(e,r){var n,i=e.end(r),a=new t;for(e.preflight.set("latest_shapes",[]);e.pos<i;)switch((n=e.uint32())>>>3){case 1:a.imageKey=e.string();break;case 2:a.frames&&a.frames.length||(a.frames=[]),a.frames.push(U.decode(e,e.uint32()));break;case 3:a.matteKey=e.string();break;default:e.skipType(7&n)}return t.format(a)},t.format=function(t){return{imageKey:t.imageKey,frames:t.frames}},t}(),L=function(){function t(){this.viewBoxWidth=0,this.viewBoxHeight=0,this.fps=0,this.frames=0}return t.decode=function(e,r){for(var n,i=e.end(r),a=new t;e.pos<i;)switch((n=e.uint32())>>>3){case 1:a.viewBoxWidth=e.float();break;case 2:a.viewBoxHeight=e.float();break;case 3:a.fps=e.int32();break;case 4:a.frames=e.int32();break;default:e.skipType(7&n)}return a},t}(),_=function(){function t(){this.version="",this.params=null,this.images={},this.sprites=[]}return t.decode=function(e,r){for(var n,i,a,o,s,u=e.end(r),c=new t;e.pos<u;)switch((o=e.uint32())>>>3){case 1:c.version=e.string();break;case 2:c.params=L.decode(e,e.uint32());break;case 3:for(a=e.uint32()+e.pos,n="",i=t.EMPTY_U8;e.pos<a;)switch((s=e.uint32())>>>3){case 1:n=e.string();break;case 2:i=e.bytes();break;default:e.skipType(7&s)}c.images[n]=i;break;case 4:c.sprites.push(B.decode(e,e.uint32()));break;default:e.skipType(7&o)}return t.format(c)},t.format=function(t){var e=t.version,r=t.images,n=t.sprites,i=t.params,a=i.fps,o=i.frames;return{version:e,filename:"",locked:!1,dynamicElements:{},size:{width:i.viewBoxWidth,height:i.viewBoxHeight},fps:a,frames:o,images:r,sprites:n}},t.EMPTY_U8=new Uint8Array(0),t}();var z=function(){function t(){this.pool=[]}return t.prototype.acquire=function(){var t=this.pool;return t.length>0?t.pop():{x:0,y:0,x1:0,y1:0,x2:0,y2:0}},t.prototype.release=function(t){t.x=t.y=t.x1=t.y1=t.x2=t.y2=0,this.pool.push(t)},t}(),H=function(){function t(t){this.context=t,this.pointPool=new z,this.lastResizeKey="",this.globalTransform=void 0,this.currentPoint=this.pointPool.acquire()}return t.parseSVGPath=function(e){for(var r=t.SVG_LETTER_REGEXP,n=[],i=0,a=0,o="",s="";i<e.length;){var u=e[i];switch(a){case 0:r.test(u)&&(o=u,a=1);break;case 1:r.test(u)?(n.push({command:o,args:s.trim()}),o=u,s=""):s+=u}i++}return o&&1===a&&n.push({command:o,args:s.trim()}),n},t.fillOrStroke=function(t,e){e&&(e.fill&&t.fill(),e.stroke&&t.stroke())},t.resetShapeStyles=function(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))},t.calculateScale=function(t,e,r){var n=e.width/e.height,i=r.width/r.height,a="aspect-fit"===t,o=function(t,e,r){return{scaleX:t,scaleY:t,translateX:e,translateY:r}};if(n>=i&&a||n<=i&&!a){var s=r.width/e.width;return o(s,0,(r.height-e.height*s)/2)}var u=r.height/e.height;return o(u,(r.width-e.width*u)/2,0)},t.prototype.setTransform=function(t){t&&this.context&&this.context.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)},t.prototype.drawBezier=function(e,r,n){var i=this.context,a=this.pointPool;if(this.currentPoint=a.acquire(),i.save(),t.resetShapeStyles(i,n),this.setTransform(r),i.beginPath(),e)for(var o=0,s=t.parseSVGPath(e);o<s.length;o++){var u=s[o],c=u.command,h=u.args;t.SVG_PATH.has(c)&&this.drawBezierElement(this.currentPoint,c,h.split(/[\s,]+/).filter(Boolean))}t.fillOrStroke(i,n),a.release(this.currentPoint),i.restore()},t.prototype.drawBezierElement=function(t,e,r){var n=this.context;switch(e){case"M":t.x=+r[0],t.y=+r[1],n.moveTo(t.x,t.y);break;case"m":t.x+=+r[0],t.y+=+r[1],n.moveTo(t.x,t.y);break;case"L":t.x=+r[0],t.y=+r[1],n.lineTo(t.x,t.y);break;case"l":t.x+=+r[0],t.y+=+r[1],n.lineTo(t.x,t.y);break;case"H":t.x=+r[0],n.lineTo(t.x,t.y);break;case"h":t.x+=+r[0],n.lineTo(t.x,t.y);break;case"V":t.y=+r[0],n.lineTo(t.x,t.y);break;case"v":t.y+=+r[0],n.lineTo(t.x,t.y);break;case"C":t.x1=+r[0],t.y1=+r[1],t.x2=+r[2],t.y2=+r[3],t.x=+r[4],t.y=+r[5],n.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"c":t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x2=t.x+ +r[2],t.y2=t.y+ +r[3],t.x+=+r[4],t.y+=+r[5],n.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"S":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=+r[0],t.y2=+r[1],t.x=+r[2],t.y=+r[3],n.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=+r[0],t.y1=+r[1],t.x=+r[2],t.y=+r[3],n.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"s":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=t.x+ +r[0],t.y2=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],n.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],n.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"Q":t.x1=+r[0],t.y1=+r[1],t.x=+r[2],t.y=+r[3],n.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"q":t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],n.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"Z":case"z":n.closePath()}},t.prototype.drawEllipse=function(e,r,n,i,a,o){var s=this.context;s.save(),t.resetShapeStyles(s,o),this.setTransform(a);var u=2*n,c=2*i,h=.5522848,l=u/2*h,f=c/2*h,p=(e-=n)+u,d=(r-=i)+c,y=e+u/2,v=r+c/2;s.beginPath(),s.moveTo(e,v),s.bezierCurveTo(e,v-f,y-l,r,y,r),s.bezierCurveTo(y+l,r,p,v-f,p,v),s.bezierCurveTo(p,v+f,y+l,d,y,d),s.bezierCurveTo(y-l,d,e,v+f,e,v),t.fillOrStroke(s,o),s.restore()},t.prototype.drawRect=function(e,r,n,i,a,o,s){var u=this.context;u.save(),t.resetShapeStyles(u,s),this.setTransform(o);var c=a;n<2*c&&(c=n/2),i<2*c&&(c=i/2),u.beginPath(),u.moveTo(e+c,r),u.arcTo(e+n,r,e+n,r+i,c),u.arcTo(e+n,r+i,e,r+i,c),u.arcTo(e,r+i,e,r,c),u.arcTo(e,r,e+n,r,c),u.closePath(),t.fillOrStroke(u,s),u.restore()},t.prototype.drawShape=function(t){var e,r,n,i,a,o,s,u,c,h=t.type,l=t.path,f=t.transform,p=t.styles;switch(h){case"shape":this.drawBezier(l.d,f,p);break;case"ellipse":this.drawEllipse(null!==(e=l.x)&&void 0!==e?e:0,null!==(r=l.y)&&void 0!==r?r:0,null!==(n=l.radiusX)&&void 0!==n?n:0,null!==(i=l.radiusY)&&void 0!==i?i:0,f,p);break;case"rect":this.drawRect(null!==(a=l.x)&&void 0!==a?a:0,null!==(o=l.y)&&void 0!==o?o:0,null!==(s=l.width)&&void 0!==s?s:0,null!==(u=l.height)&&void 0!==u?u:0,null!==(c=l.cornerRadius)&&void 0!==c?c:0,f,p)}},t.prototype.drawSprite=function(t,e,r){if(0!==t.alpha){var n=this.context,i=t,a=i.alpha,o=i.transform,s=i.layout,u=i.shapes,c=null!=o?o:{},h=c.a,l=void 0===h?1:h,f=c.b,p=void 0===f?0:f,d=c.c,y=void 0===d?0:d,v=c.d,g=void 0===v?1:v,m=c.tx,w=void 0===m?0:m,b=c.ty,k=void 0===b?0:b;n.save(),this.setTransform(this.globalTransform),n.globalAlpha=a,n.transform(l,p,y,g,w,k),e&&n.drawImage(e,0,0,s.width,s.height),r&&n.drawImage(r,(s.width-r.width)/2,(s.height-r.height)/2);for(var x=0;x<u.length;x++)this.drawShape(u[x]);n.restore()}},t.prototype.resize=function(e,r,n){var i=n.width,a=n.height,o=r.width,s=r.height,u="".concat(e,"-").concat(o,"-").concat(s,"-").concat(i,"-").concat(a),c=this.globalTransform;if(this.lastResizeKey!==u||!c){var h={scaleX:1,scaleY:1,translateX:0,translateY:0};"fill"===e?(h.scaleX=i/o,h.scaleY=a/s):h=t.calculateScale(e,r,n),this.lastResizeKey=u,this.globalTransform={a:h.scaleX,b:0,c:0,d:h.scaleY,tx:h.translateX,ty:h.translateY}}},t.prototype.render=function(t,e,r,n,i,a){for(var o,s,u,c,h=i;h<a;h++)s=(o=t.sprites[h]).imageKey,u=e.get(s),c=r.get(s),this.drawSprite(o.frames[n],u,c)},t.prototype.destroy=function(){this.globalTransform=void 0,this.lastResizeKey="",this.context=null},t.SVG_PATH=new Set(["M","L","H","V","Z","C","S","Q","m","l","h","v","z","c","s","q"]),t.SVG_LETTER_REGEXP=/[a-zA-Z]/,t}(),W=function(){function t(){this.isRunning=!1,this.startTime=0,this.duration=0,this.loopStart=0,this.loopDuration=0,this.onAnimate=b.noop,this.onStart=b.noop,this.onUpdate=b.noop,this.onEnd=b.noop}return t.prototype.setConfig=function(t,e,r,n){this.duration=t,this.loopStart=e,this.loopDuration=t*r+n-e},t.prototype.start=function(){this.isRunning=!0,this.startTime=b.now(),this.onStart(),this.doFrame()},t.prototype.resume=function(){this.isRunning=!0,this.startTime=b.now(),this.doFrame()},t.prototype.pause=function(){this.isRunning=!1,this.loopStart=(b.now()-this.startTime+this.loopStart)%this.duration},t.prototype.stop=function(){this.isRunning=!1,this.loopStart=0},t.prototype.doFrame=function(){var t=this;this.isRunning&&(this.doDeltaTime(b.now()-this.startTime),this.isRunning&&this.onAnimate((function(){return t.doFrame()})))},t.prototype.doDeltaTime=function(t){var e,r=this,n=r.duration,i=r.loopStart,a=!1;t>=r.loopDuration?(e=1,a=!0,this.stop()):e=(t+i)%n/n,this.onUpdate(e),!this.isRunning&&a&&this.onEnd()},t}(),Y=Uint8Array,V=Uint16Array,X=Int32Array,j=new Y([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),N=new Y([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),$=new Y([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),q=function(t,e){for(var r=new V(31),n=0;n<31;++n)r[n]=e+=1<<t[n-1];var i=new X(r[30]);for(n=1;n<30;++n)for(var a=r[n];a<r[n+1];++a)i[a]=a-r[n]<<5|n;return{b:r,r:i}},K=q(j,2),G=K.b,J=K.r;G[28]=258,J[258]=28;for(var Q=q(N,0),Z=Q.b,et=Q.r,rt=new V(32768),nt=0;nt<32768;++nt){var it=(43690&nt)>>1|(21845&nt)<<1;it=(61680&(it=(52428&it)>>2|(13107&it)<<2))>>4|(3855&it)<<4,rt[nt]=((65280&it)>>8|(255&it)<<8)>>1}var at=function(t,e,r){for(var n=t.length,i=0,a=new V(e);i<n;++i)t[i]&&++a[t[i]-1];var o,s=new V(e);for(i=1;i<e;++i)s[i]=s[i-1]+a[i-1]<<1;if(r){o=new V(1<<e);var u=15-e;for(i=0;i<n;++i)if(t[i])for(var c=i<<4|t[i],h=e-t[i],l=s[t[i]-1]++<<h,f=l|(1<<h)-1;l<=f;++l)o[rt[l]>>u]=c}else for(o=new V(n),i=0;i<n;++i)t[i]&&(o[i]=rt[s[t[i]-1]++]>>15-t[i]);return o},ot=new Y(288);for(nt=0;nt<144;++nt)ot[nt]=8;for(nt=144;nt<256;++nt)ot[nt]=9;for(nt=256;nt<280;++nt)ot[nt]=7;for(nt=280;nt<288;++nt)ot[nt]=8;var st=new Y(32);for(nt=0;nt<32;++nt)st[nt]=5;var ut=at(ot,9,0),ct=at(ot,9,1),ht=at(st,5,0),lt=at(st,5,1),ft=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},pt=function(t,e,r){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&r},dt=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},yt=function(t){return(t+7)/8|0},vt=function(t,e,r){return(null==r||r>t.length)&&(r=t.length),new Y(t.subarray(e,r))},gt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],mt=function(t,e,r){var n=new Error(e||gt[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,mt),!r)throw n;return n},wt=function(t,e,r){r<<=7&e;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8},bt=function(t,e,r){r<<=7&e;var n=e/8|0;t[n]|=r,t[n+1]|=r>>8,t[n+2]|=r>>16},kt=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var i=r.length,a=r.slice();if(!i)return{t:Mt,l:0};if(1==i){var o=new Y(r[0].s+1);return o[r[0].s]=1,{t:o,l:1}}r.sort((function(t,e){return t.f-e.f})),r.push({s:-1,f:25001});var s=r[0],u=r[1],c=0,h=1,l=2;for(r[0]={s:-1,f:s.f+u.f,l:s,r:u};h!=i-1;)s=r[r[c].f<r[l].f?c++:l++],u=r[c!=h&&r[c].f<r[l].f?c++:l++],r[h++]={s:-1,f:s.f+u.f,l:s,r:u};var f=a[0].s;for(n=1;n<i;++n)a[n].s>f&&(f=a[n].s);var p=new V(f+1),d=xt(r[h-1],p,0);if(d>e){n=0;var y=0,v=d-e,g=1<<v;for(a.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));n<i;++n){var m=a[n].s;if(!(p[m]>e))break;y+=g-(1<<d-p[m]),p[m]=e}for(y>>=v;y>0;){var w=a[n].s;p[w]<e?y-=1<<e-p[w]++-1:++n}for(;n>=0&&y;--n){var b=a[n].s;p[b]==e&&(--p[b],++y)}d=e}return{t:new Y(p),l:d}},xt=function(t,e,r){return-1==t.s?Math.max(xt(t.l,e,r+1),xt(t.r,e,r+1)):e[t.s]=r},Ct=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new V(++e),n=0,i=t[0],a=1,o=function(t){r[n++]=t},s=1;s<=e;++s)if(t[s]==i&&s!=e)++a;else{if(!i&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(i),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(i);a=1,i=t[s]}return{c:r.subarray(0,n),n:e}},Tt=function(t,e){for(var r=0,n=0;n<e.length;++n)r+=t[n]*e[n];return r},St=function(t,e,r){var n=r.length,i=yt(e+2);t[i]=255&n,t[i+1]=n>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<n;++a)t[i+a+4]=r[a];return 8*(i+4+n)},At=function(t,e,r,n,i,a,o,s,u,c,h){wt(e,h++,r),++i[256];for(var l=kt(i,15),f=l.t,p=l.l,d=kt(a,15),y=d.t,v=d.l,g=Ct(f),m=g.c,w=g.n,b=Ct(y),k=b.c,x=b.n,C=new V(19),T=0;T<m.length;++T)++C[31&m[T]];for(T=0;T<k.length;++T)++C[31&k[T]];for(var S=kt(C,7),A=S.t,P=S.l,M=19;M>4&&!A[$[M-1]];--M);var R,I,E,D,F=c+5<<3,O=Tt(i,ot)+Tt(a,st)+o,U=Tt(i,f)+Tt(a,y)+o+14+3*M+Tt(C,A)+2*C[16]+3*C[17]+7*C[18];if(u>=0&&F<=O&&F<=U)return St(e,h,t.subarray(u,u+c));if(wt(e,h,1+(U<O)),h+=2,U<O){R=at(f,p,0),I=f,E=at(y,v,0),D=y;var B=at(A,P,0);wt(e,h,w-257),wt(e,h+5,x-1),wt(e,h+10,M-4),h+=14;for(T=0;T<M;++T)wt(e,h+3*T,A[$[T]]);h+=3*M;for(var L=[m,k],_=0;_<2;++_){var z=L[_];for(T=0;T<z.length;++T){var H=31&z[T];wt(e,h,B[H]),h+=A[H],H>15&&(wt(e,h,z[T]>>5&127),h+=z[T]>>12)}}}else R=ut,I=ot,E=ht,D=st;for(T=0;T<s;++T){var W=n[T];if(W>255){bt(e,h,R[(H=W>>18&31)+257]),h+=I[H+257],H>7&&(wt(e,h,W>>23&31),h+=j[H]);var Y=31&W;bt(e,h,E[Y]),h+=D[Y],Y>3&&(bt(e,h,W>>5&8191),h+=N[Y])}else bt(e,h,R[W]),h+=I[W]}return bt(e,h,R[256]),h+I[256]},Pt=new X([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Mt=new Y(0),Rt=function(){var t=1,e=0;return{p:function(r){for(var n=t,i=e,a=0|r.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)i+=n+=r[o];n=(65535&n)+15*(n>>16),i=(65535&i)+15*(i>>16)}t=n,e=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},It=function(t,e,r,n,i){if(!i&&(i={l:1},e.dictionary)){var a=e.dictionary.subarray(-32768),o=new Y(a.length+t.length);o.set(a),o.set(t,a.length),t=o,i.w=a.length}return function(t,e,r,n,i,a){var o=a.z||t.length,s=new Y(n+o+5*(1+Math.ceil(o/7e3))+i),u=s.subarray(n,s.length-i),c=a.l,h=7&(a.r||0);if(e){h&&(u[0]=a.r>>3);for(var l=Pt[e-1],f=l>>13,p=8191&l,d=(1<<r)-1,y=a.p||new V(32768),v=a.h||new V(d+1),g=Math.ceil(r/3),m=2*g,w=function(e){return(t[e]^t[e+1]<<g^t[e+2]<<m)&d},b=new X(25e3),k=new V(288),x=new V(32),C=0,T=0,S=a.i||0,A=0,P=a.w||0,M=0;S+2<o;++S){var R=w(S),I=32767&S,E=v[R];if(y[I]=E,v[R]=I,P<=S){var D=o-S;if((C>7e3||A>24576)&&(D>423||!c)){h=At(t,u,0,b,k,x,T,A,M,S-M,h),A=C=T=0,M=S;for(var F=0;F<286;++F)k[F]=0;for(F=0;F<30;++F)x[F]=0}var O=2,U=0,B=p,L=I-E&32767;if(D>2&&R==w(S-L))for(var _=Math.min(f,D)-1,z=Math.min(32767,S),H=Math.min(258,D);L<=z&&--B&&I!=E;){if(t[S+O]==t[S+O-L]){for(var W=0;W<H&&t[S+W]==t[S+W-L];++W);if(W>O){if(O=W,U=L,W>_)break;var $=Math.min(L,W-2),q=0;for(F=0;F<$;++F){var K=S-L+F&32767,G=K-y[K]&32767;G>q&&(q=G,E=K)}}}L+=(I=E)-(E=y[I])&32767}if(U){b[A++]=268435456|J[O]<<18|et[U];var Q=31&J[O],Z=31&et[U];T+=j[Q]+N[Z],++k[257+Q],++x[Z],P=S+O,++C}else b[A++]=t[S],++k[t[S]]}}for(S=Math.max(S,P);S<o;++S)b[A++]=t[S],++k[t[S]];h=At(t,u,c,b,k,x,T,A,M,S-M,h),c||(a.r=7&h|u[h/8|0]<<3,h-=7,a.h=v,a.p=y,a.i=S,a.w=P)}else{for(S=a.w||0;S<o+c;S+=65535){var tt=S+65535;tt>=o&&(u[h/8|0]=c,tt=o),h=St(u,h+1,t.subarray(S,tt))}a.i=o}return vt(s,0,n+yt(h)+i)}(t,null==e.level?6:e.level,null==e.mem?i.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,r,n,i)},Et=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function Dt(t,e){void 0===e&&(e={});var r=Rt();r.p(t);var n=It(t,e,e.dictionary?6:2,4);return function(t,e){var r,n,i=null!==(r=e.level)&&void 0!==r?r:0,a=0==i?0:i<6?1:9==i?3:2;if(t[0]=120,t[1]=a<<6|((null!==(n=e.dictionary)&&void 0!==n?n:0)&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var o=Rt();o.p(e.dictionary),Et(t,2,o.d())}}(n,e),Et(n,n.length-4,r.d()),n}function Ft(t,e){return void 0===e&&(e={}),function(t,e,r,n){var i=t.length,a=n?n.length:0;if(!i||e.f&&!e.l)return r||new Y(0);var o=!r,s=o||2!=e.i,u=e.i;o&&(r=new Y(3*i));var c=function(t){var e=r.length;if(t>e){var n=new Y(Math.max(2*e,t));n.set(r),r=n}},h=e.f||0,l=e.p||0,f=e.b||0,p=e.l,d=e.d,y=e.m,v=e.n,g=8*i;do{if(!p){h=pt(t,l,1);var m=pt(t,l+1,3);if(l+=3,!m){var w=t[(I=yt(l)+4)-4]|t[I-3]<<8,b=I+w;if(b>i){u&&mt(0);break}s&&c(f+w),r.set(t.subarray(I,b),f),e.b=f+=w,e.p=l=8*b,e.f=h;continue}if(1==m)p=ct,d=lt,y=9,v=5;else if(2==m){var k=pt(t,l,31)+257,x=pt(t,l+10,15)+4,C=k+pt(t,l+5,31)+1;l+=14;for(var T=new Y(C),S=new Y(19),A=0;A<x;++A)S[$[A]]=pt(t,l+3*A,7);l+=3*x;var P=ft(S),M=(1<<P)-1,R=at(S,P,1);for(A=0;A<C;){var I,E=R[pt(t,l,M)];if(l+=15&E,(I=E>>4)<16)T[A++]=I;else{var D=0,F=0;for(16==I?(F=3+pt(t,l,3),l+=2,D=T[A-1]):17==I?(F=3+pt(t,l,7),l+=3):18==I&&(F=11+pt(t,l,127),l+=7);F--;)T[A++]=D}}var O=T.subarray(0,k),U=T.subarray(k);y=ft(O),v=ft(U),p=at(O,y,1),d=at(U,v,1)}else mt(1);if(l>g){u&&mt(0);break}}s&&c(f+131072);for(var B=(1<<y)-1,L=(1<<v)-1,_=l;;_=l){var z=(D=p[dt(t,l)&B])>>4;if((l+=15&D)>g){u&&mt(0);break}if(D||mt(2),z<256)r[f++]=z;else{if(256==z){_=l,p=void 0;break}var H=z-254;if(z>264){var W=j[A=z-257];H=pt(t,l,(1<<W)-1)+G[A],l+=W}var V=d[dt(t,l)&L],X=V>>4;if(V||mt(3),l+=15&V,U=Z[X],X>3&&(W=N[X],U+=dt(t,l)&(1<<W)-1,l+=W),l>g){u&&mt(0);break}s&&c(f+131072);var q=f+H;if(f<U){var K=a-U,J=Math.min(U,q);for(K+f<0&&mt(3);f<J;++f)r[f]=n[K+f]}for(;f<q;++f)r[f]=r[f-U]}}e.l=p,e.p=_,e.b=f,e.f=h,p&&(h=1,e.m=y,e.d=d,e.n=v)}while(!h);return f!=r.length&&o?vt(r,0,f):r.subarray(0,f)}(t.subarray((r=t,n=e.dictionary,(8!=(15&r[0])||r[0]>>4>7||(r[0]<<8|r[1])%31)&&mt(6,"invalid zlib data"),(r[1]>>5&1)==+!n&&mt(6,"invalid zlib data: "+(32&r[1]?"need":"unexpected")+" dictionary"),2+(r[1]>>3&4)),-4),{i:2},e&&e.out,e&&e.dictionary);var r,n}for(var Ot=function(){function t(){this.caches=new Map}return t.prototype.calculate=function(e){if(!(e instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array");var r=this.caches,n=b.decode.bytesToString(e);if(r.has(n))return r.get(n);for(var i=t.WHITE_COLOR,a=0;a<e.length;a++)i=i>>>8^t.table[255&(i^e[a])];return r.set(n,(i^t.WHITE_COLOR)>>>0),r.get(n)},t.prototype.clear=function(){this.caches.clear()},t.table=Uint32Array.from(Array(256),(function(t,e){for(var r=e,n=0;n<8;n++)r=1&r?3988292384^r>>>1:r>>>1;return r>>>0})),t.WHITE_COLOR=4294967295,t}(),Ut=function(){function t(t,e){this.width=t,this.height=e,this.crc32=new Ot,this.view=new DataView(new ArrayBuffer(4*t*e))}return t.prototype.createChunk=function(t,e){var r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,e.length,!1);var n=Uint8Array.from(t,(function(t){return t.charCodeAt(0)})),i=new Uint8Array(n.length+e.length);i.set(n),i.set(e,n.length);var a=new Uint8Array(4);new DataView(a.buffer).setUint32(0,this.crc32.calculate(i)>>>0,!1);var o=new Uint8Array(r.length+i.length+a.length);return o.set(r),o.set(i,r.length),o.set(a,r.length+i.length),o},t.prototype.createIHDRChunk=function(){var t=new Uint8Array(13),e=new DataView(t.buffer);return e.setUint32(0,this.width,!1),e.setUint32(4,this.height,!1),e.setUint8(8,8),e.setUint8(9,6),e.setUint8(10,0),e.setUint8(11,0),e.setUint8(12,0),this.createChunk("IHDR",t)},t.prototype.createIDATChunk=function(){for(var t,e,r=this.width,n=this.height,i=4*r,a=i+1,o=new Uint8Array(a*n),s=new Uint8Array(this.view.buffer),u=0;u<n;u++)o[t=u*a]=0,e=u*i,o.set(s.subarray(e,e+i),t+1);return this.createChunk("IDAT",Dt(o))},t.prototype.setPixel=function(t,e,r){this.view.setUint32(4*(e*this.width+t),r,!1)},t.prototype.write=function(t){for(var e,r,n=this.width,i=this.height,a=0;a<i;a++)for(var o=0;o<n;o++)r=(t[e=4*(a*n+o)]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0,this.setPixel(o,a,r);return this},t.prototype.flush=function(){var t=this.createIHDRChunk(),e=this.createIDATChunk(),r=this.createChunk("IEND",new Uint8Array(0)),n=new Uint8Array(8+t.length+e.length+r.length),i=0;return n.set(new Uint8Array([137,80,78,71,13,10,26,10]),i),i+=8,n.set(t,i),i+=t.length,n.set(e,i),i+=e.length,n.set(r,i),this.crc32.clear(),n},t}(),Bt=function(){function t(){this.buffer=[],this.lengthInBits=0}return t.prototype.getAt=function(t){var e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},t.prototype.put=function(t,e){for(var r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))},t.prototype.putBit=function(t){var e=this.lengthInBits,r=this.buffer,n=~~(e/8);r.length<=n&&r.push(0),t&&(r[n]|=128>>>e%8),this.lengthInBits+=1},t}(),Lt=1,_t=2,zt=4,Ht=8,Wt={L:1,M:0,Q:3,H:2},Yt=0,Vt=1,Xt=2,jt=3,Nt=4,$t=5,qt=6,Kt=7,Gt=function(){function t(t){for(var e=[],r=0;r<t.length;r++){var n=[],i=t.charCodeAt(r);i>65536?(n[0]=240|(1835008&i)>>>18,n[1]=128|(258048&i)>>>12,n[2]=128|(4032&i)>>>6,n[3]=128|63&i):i>2048?(n[0]=224|(61440&i)>>>12,n[1]=128|(4032&i)>>>6,n[2]=128|63&i):i>128?(n[0]=192|(1984&i)>>>6,n[1]=128|63&i):n[0]=i,e.push(n)}this.bytes=e.flat(1);var a=this.bytes;a.length!==t.length&&(a.unshift(191),a.unshift(187),a.unshift(239))}return Object.defineProperty(t.prototype,"mode",{get:function(){return zt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this.bytes.length},enumerable:!1,configurable:!0}),t.prototype.write=function(t){for(var e=this.bytes,r=0;r<e.length;r++)t.put(e[r],8)},t}(),Jt=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],Qt=function(){function t(){}return t.prototype.getRSBlockTable=function(t,e){var r=4*(t-1);switch(e){case Wt.L:return Jt[r+0];case Wt.M:return Jt[r+1];case Wt.Q:return Jt[r+2];case Wt.H:return Jt[r+3];default:throw new Error("bad rs block @ typeNumber:".concat(t,"/errorCorrectLevel: ").concat(e))}},t.prototype.getRSBlocks=function(t,e){for(var r=this.getRSBlockTable(t,e),n=r.length/3,i=[],a=0;a<n;a++)for(var o=r[3*a],s=r[3*a+1],u=r[3*a+2],c=0;c<o;c++)i.push({totalCount:s,dataCount:u});return i},t}(),Zt=new Array(256),te=new Array(256),ee=0;ee<8;ee++)Zt[ee]=1<<ee;for(ee=8;ee<256;ee++)Zt[ee]=Zt[ee-4]^Zt[ee-5]^Zt[ee-6]^Zt[ee-8];for(ee=0;ee<255;ee++)te[Zt[ee]]=ee;var re=function(t){if(t<1)throw new Error("glog(".concat(t,")"));return te[t]},ne=function(t){return t<0?t=255+t%255:t>255&&(t%=255),Zt[t]},ie=function(){function t(t,e){var r=t.length;if(void 0===r)throw new Error("".concat(r,"/").concat(e));for(var n=0;n<r&&0===t[n];)n++;var i=r-n;this.num=new Array(i+e);for(var a=0;a<i;a++)this.num[a]=t[a+n]}return Object.defineProperty(t.prototype,"length",{get:function(){return this.num.length},enumerable:!1,configurable:!0}),t.prototype.getAt=function(t){return this.num[t]},t.prototype.multiply=function(e){for(var r=re,n=ne,i=[],a=0;a<this.length;a++)for(var o=0;o<e.length;o++)i[a+o]^=n(r(this.getAt(a))+r(e.getAt(o)));return new t(i,0)},t.prototype.mod=function(e){if(this.length-e.length<0)return this;for(var r=re,n=ne,i=r(this.getAt(0))-r(e.getAt(0)),a=[],o=0;o<this.length;o++){var s=this.getAt(o);a[o]=o<e.length?s^n(r(e.getAt(o))+i):s}return new t(a,0).mod(e)},t}(),ae=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],oe=function(t){return 0===t?0:Math.log2(t)},se=oe(1335),ue=oe(7973),ce=function(t){for(var e=t<<10;oe(e)-se>=0;)e^=1335<<oe(e)-se;return 21522^(t<<10|e)},he=function(t){for(var e=t<<12;oe(e)-ue>=0;)e^=7973<<oe(e)-ue;return t<<12|e},le=function(t){return ae[t-1]},fe=function(t){switch(t){case Yt:return function(t,e){return(t+e)%2==0};case Vt:return function(t){return t%2==0};case Xt:return function(t,e){return e%3==0};case jt:return function(t,e){return(t+e)%3==0};case Nt:return function(t,e){return(~~(t/2)+~~(e/3))%2==0};case $t:return function(t,e){return t*e%2+t*e%3==0};case qt:return function(t,e){return(t*e%2+t*e%3)%2==0};case Kt:return function(t,e){return(t*e%3+(t+e)%2)%2==0};default:throw new Error("bad maskPattern: ".concat(t))}},pe=function(t){for(var e=new ie([1],0),r=0;r<t;r++)e=e.multiply(new ie([1,ne(r)],0));return e},de=function(t,e){var r=Lt,n=_t,i=zt,a=Ht;if(e<1||e>40)throw new Error("type: ".concat(e));if(e>=1&&e<10)switch(t){case r:return 10;case n:return 9;case i:case a:return 8}if(e<27)switch(t){case r:return 12;case n:return 11;case i:return 16;case a:return 10}if(e<=40)switch(t){case r:return 14;case n:return 13;case i:return 16;case a:return 12}throw new Error("mode: ".concat(t))},ye=function(t){for(var e=t.getModuleCount(),r=0,n=0;n<e;n++)for(var i=0;i<e;i++){for(var a=t.isDark(n,i),o=0,s=-1;s<=1;s++){var u=n+s;if(!(u<0||e<=u))for(var c=-1;c<=1;c++){var h=i+c;h<0||e<=h||(0===s&&0===c||a===t.isDark(u,h)&&o++)}}o>5&&(r+=o+3-5)}for(n=0;n<e-1;n++)for(i=0;i<e-1;i++){var l=0;t.isDark(n,i)&&l++,t.isDark(n+1,i)&&l++,t.isDark(n,i+1)&&l++,t.isDark(n+1,i+1)&&l++,0!==l&&4!==l||(r+=3)}for(n=0;n<e;n++)for(i=0;i<e-6;i++)t.isDark(n,i)&&!t.isDark(n,i+1)&&t.isDark(n,i+2)&&t.isDark(n,i+3)&&t.isDark(n,i+4)&&!t.isDark(n,i+5)&&t.isDark(n,i+6)&&(r+=40);for(i=0;i<e;i++)for(n=0;n<e-6;n++)t.isDark(n,i)&&!t.isDark(n+1,i)&&t.isDark(n+2,i)&&t.isDark(n+3,i)&&t.isDark(n+4,i)&&!t.isDark(n+5,i)&&t.isDark(n+6,i)&&(r+=40);var f=0;for(i=0;i<e;i++)for(n=0;n<e;n++)t.isDark(n,i)&&f++;return r+10*(Math.abs(100*f/Math.pow(e,2)-50)/5)},ve=function(){function t(t,e){this.typeNumber=t,this.modules=[],this.moduleCount=0,this.dataCache=null,this.dataList=[],this.errorCorrectLevel=Wt[e]}return t.prototype.makeImpl=function(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=function(t){for(var e=[],r=0;r<t;r++){e[r]=[];for(var n=0;n<t;n++)e[r][n]=null}return e}(this.moduleCount);var r=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(r,0),this.setupPositionProbePattern(0,r),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null===this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)},t.prototype.setupPositionProbePattern=function(t,e){for(var r=this.modules,n=this.moduleCount,i=-1;i<=7;i++){var a=t+i;if(!(a<=-1||n<=a))for(var o=-1;o<=7;o++){var s=e+o;s<=-1||n<=s||(r[a][s]=i>=0&&i<=6&&(0===o||6===o)||o>=0&&o<=6&&(0===i||6===i)||i>=2&&i<=4&&o>=2&&o<=4)}}},t.prototype.setupPositionAdjustPattern=function(){for(var t=this.typeNumber,e=this.modules,r=le(t),n=r.length,i=0;i<n;i++)for(var a=0;a<n;a++){var o=r[i],s=r[a];if(null==e[o][s])for(var u=-2;u<=2;u++)for(var c=-2;c<=2;c++)e[o+u][s+c]=-2===u||2===u||-2===c||2===c||0===u&&0===c}},t.prototype.setupTimingPattern=function(){for(var t=this.moduleCount,e=this.modules,r=t-8,n=8;n<r;n++)null==e[n][6]&&(e[n][6]=n%2==0);for(var i=8;i<r;i++)null==e[6][i]&&(e[6][i]=i%2==0)},t.prototype.setupTypeInfo=function(t,e){for(var r=this,n=r.errorCorrectLevel,i=r.modules,a=r.moduleCount,o=ce(n<<3|e),s=0;s<15;s++){var u=!t&&1==(o>>s&1);s<6?i[s][8]=u:s<8?i[s+1][8]=u:i[a-15+s][8]=u}for(s=0;s<15;s++){u=!t&&1==(o>>s&1);s<8?i[8][a-s-1]=u:s<9?i[8][15-s]=u:i[8][15-s-1]=u}i[a-8][8]=!t},t.prototype.getBestMaskPattern=function(){for(var t=0,e=0,r=0;r<8;r++){this.makeImpl(!0,r);var n=ye(this);(0===r||t>n)&&(t=n,e=r)}return e},t.prototype.setupTypeNumber=function(t){for(var e=this,r=e.typeNumber,n=e.modules,i=e.moduleCount,a=he(r),o=0;o<18;o++){var s=!t&&1==(a>>o&1);n[~~(o/3)][o%3+i-8-3]=s,n[o%3+i-8-3][~~(o/3)]=s}},t.prototype.createData=function(t,e,r){for(var n=(new Qt).getRSBlocks(t,e),i=new Bt,a=0;a<r.length;a++){var o=r[a];i.put(o.mode,4),i.put(o.length,de(o.mode,t)),o.write(i)}var s=0;for(a=0;a<n.length;a++)s+=n[a].dataCount;var u=8*s;if(i.lengthInBits>u)throw new Error("code length overflow. (".concat(i.lengthInBits," > ").concat(u,")"));for(i.lengthInBits+4<=u&&i.put(0,4);i.lengthInBits%8!=0;)i.putBit(!1);for(;!(i.lengthInBits>=u||(i.put(236,8),i.lengthInBits>=u));)i.put(17,8);return this.createBytes(i,n)},t.prototype.mapData=function(t,e){for(var r=this.modules,n=this.moduleCount,i=fe(e),a=-1,o=n-1,s=7,u=0,c=o;c>0;c-=2)for(6===c&&(c-=1);;){for(var h=0;h<2;h++)if(null==r[o][c-h]){var l=!1;u<t.length&&(l=1==(t[u]>>>s&1)),i(o,c-h)&&(l=!l),r[o][c-h]=l,-1===--s&&(u++,s=7)}if((o+=a)<0||n<=o){o-=a,a=-a;break}}},t.prototype.createBytes=function(t,e){for(var r=[],n=[],i=0,a=0,o=0,s=0;s<e.length;s++){var u=e[s].dataCount,c=e[s].totalCount-u;a=Math.max(a,u),o=Math.max(o,c),r[s]=[];for(var h=0;h<u;h++)r[s][h]=255&t.buffer[h+i];i+=u;var l=pe(c),f=new ie(r[s],l.length-1).mod(l);n[s]=new Array(l.length-1);for(h=0;h<n[s].length;h++){var p=h+f.length-n[s].length;n[s][h]=p>=0?f.getAt(p):0}}var d=0;for(h=0;h<e.length;h++)d+=e[h].totalCount;var y=new Array(d),v=0;for(h=0;h<a;h++)for(s=0;s<e.length;s++)h<r[s].length&&(y[v++]=r[s][h]);for(h=0;h<o;h++)for(s=0;s<e.length;s++)h<n[s].length&&(y[v++]=n[s][h]);return y},t.prototype.isDark=function(t,e){var r=this.moduleCount;if(t<0||r<=t||e<0||r<=e)throw new Error("".concat(t,", ").concat(e));return this.modules[t][e]},t.prototype.addData=function(t){this.dataList.push(new Gt(t)),this.dataCache=null},t.prototype.getModuleCount=function(){return this.moduleCount},t.prototype.make=function(){this.makeImpl(!1,this.getBestMaskPattern())},t}(),ge=function(){function t(){}return t.hash=function(t){var e=new Uint8Array(t);return T(e,0,e.byteLength,Math.max(1,Math.floor(e.byteLength/100)))},t.decompress=function(t){return Ft(new Uint8Array(t)).buffer},t.parseVideo=function(t,e,r){return void 0===r&&(r=!0),function(t,e){if(t instanceof Uint8Array){var r=new A(t),n=_.decode(r);return n.filename=e,r.preflight.clear(),n}throw new Error("Invalid data type")}(new Uint8Array(r?this.decompress(t):t),b.path.filename(e))},t.download=function(t){return n(this,void 0,void 0,(function(){var e,r,n,a,o,s,u,c,h;return i(this,(function(i){switch(i.label){case 0:return e=b.globals,r=b.remote,n=b.path,a=b.local,o=e.env,s="h5"!==o&&"tt"!==o,u=n.is(t)?t:n.resolve(n.filename(t)),s?[4,a.exists(u)]:[3,2];case 1:if(i.sent())return[2,a.read(u)];i.label=2;case 2:return[4,r.fetch(t)];case 3:if(c=i.sent(),!s)return[3,7];i.label=4;case 4:return i.trys.push([4,6,,7]),[4,a.write(c,u)];case 5:return i.sent(),[3,7];case 6:return h=i.sent(),console.error(h),[3,7];case 7:return[2,c]}}))}))},t.load=function(e){return n(this,void 0,void 0,(function(){var r,n;return i(this,(function(i){switch(i.label){case 0:return n=(r=t).parseVideo,[4,t.download(e)];case 1:return[2,n.apply(r,[i.sent(),e])]}}))}))},t}(),me=b.noop,we=function(){function t(t,e,r){void 0===t&&(t="animation"),void 0===e&&(e=0),void 0===r&&(r=0),this.mode=t,this.X=null,this.XC=null,this.Y=null,this.YC=null,this.model={},this.clearContainer=me,this.clearSecondary=me;var n=b.globals.dpr;this.W=e*n,this.H=r*n}return t.prototype.setModel=function(t){var e=this.model,r=b.globals.env;e.type=t,"O"===t&&"h5"===r&&navigator.userAgent.includes("Firefox")?e.clear="CR":e.clear="O"===t&&"tt"===r||"alipay"===r?"CL":"RE"},t.prototype.register=function(t,e,r){return n(this,void 0,void 0,(function(){var n,a,o,s,u,c,h,l,f,p,d,y,v,g,m,w,k=this;return i(this,(function(i){switch(i.label){case 0:if(a=(n=this).model,o=n.mode,s=b.getCanvas,u=b.getOfsCanvas,c=b.globals.env,"poster"!==o||"h5"===c&&!("OffscreenCanvas"in globalThis))return[3,1];if(l=(h=this).W,f=h.H,!(l>0&&f>0))throw new Error("Poster mode must set width and height when create Brush instance");return p=u({width:l,height:f}),y=p.canvas,v=p.context,this.X=y,this.XC=v,this.setModel("O"),[3,3];case 1:return[4,s(t,r)];case 2:d=i.sent(),y=d.canvas,v=d.context,g=y.width,m=y.height,this.X=y,this.XC=v,"poster"===o?(y.width=g,y.height=m,this.setModel("C")):(this.W=g,this.H=m),i.label=3;case 3:return"poster"!==o?[3,4]:(this.Y=this.X,this.YC=this.XC,[3,8]);case 4:return w=void 0,"string"!=typeof e||""===e?[3,6]:[4,s(e,r)];case 5:return(w=i.sent()).canvas.width=this.W,w.canvas.height=this.H,this.setModel("C"),[3,7];case 6:w=u({width:this.W,height:this.H}),this.setModel("O"),i.label=7;case 7:this.Y=w.canvas,this.YC=w.context,i.label=8;case 8:if("CL"===a.clear?this.clearContainer=function(){var t=k,e=t.W,r=t.H;k.XC.clearRect(0,0,e,r)}:this.clearContainer=function(){var t=k,e=t.W,r=t.H;k.X.width=e,k.X.height=r},"poster"===o)this.clearSecondary=this.stick=me;else switch(a.clear){case"CR":this.clearSecondary=function(){var t=k,e=t.W,r=t.H,n=u({width:e,height:r}),i=n.canvas,a=n.context;k.Y=i,k.YC=a};break;case"CL":this.clearSecondary=function(){var t=k,e=t.W,r=t.H;k.YC.clearRect(0,0,e,r)};break;default:this.clearSecondary=function(){var t=k,e=t.W,r=t.H,n=t.Y;n.width=e,n.height=r}}return[2]}}))}))},t.prototype.stick=function(){var t=this,e=t.W,r=t.H;"poster"!==t.mode&&this.XC.drawImage(this.YC.canvas,0,0,e,r)},t.prototype.destroy=function(){this.clearContainer(),this.clearSecondary(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=me},t}(),be=function(){function t(){this.fillMode="backwards",this.playMode="forwards",this.contentMode="fill",this.startFrame=0,this.endFrame=0,this.loopStartFrame=0,this.loop=0}return t.prototype.register=function(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards","none"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)},t.prototype.setItem=function(t,e){var r;this.register(((r={})[t]=e,r))},t.prototype.getConfig=function(t){var e=this,r=e.playMode,n=e.loopStartFrame,i=e.startFrame,a=e.endFrame,o=e.fillMode,s=e.loop,u=t.fps,c=t.sprites,h=t.frames,l=c.length,f=i>0?i:0,p=a>0&&a<h?a:h,d=1e3/u;if(f>p)throw new Error("StartFrame should greater than EndFrame");p<h?h=p-f:f>0&&(h-=f);var y,v=Math.floor(h*d*Math.pow(10,6))/Math.pow(10,6),g=0,m=0;return"forwards"===r?(g=Math.max(n,i),"forwards"===o&&(m=1),y=n>f?(n-f)*d:0):(g=Math.min(n,p-1),"backwards"===o&&(m=1),y=n<p?(p-n)*d:0),{currFrame:g,startFrame:f,endFrame:p,totalFrame:h,spriteCount:l,aniConfig:{duration:v,loopStart:y,loop:0===s?1/0:s,fillValue:m*d}}},t}();function ke(t){var e,r=function(t){var e,r,n,i,a=null!==(e=t.typeNumber)&&void 0!==e?e:4,o=null!==(r=t.correctLevel)&&void 0!==r?r:"H",s=null!==(n=t.codeColor)&&void 0!==n?n:"#000000",u=null!==(i=t.backgroundColor)&&void 0!==i?i:"#FFFFFF";return{code:t.code,size:t.size,typeNumber:a,correctLevel:o,codeColor:s,backgroundColor:u}}(t),n=r.code,i=r.typeNumber,a=r.correctLevel,o=r.size,s=r.codeColor,u=r.backgroundColor;try{(e=new ve(i,a)).addData(n),e.make()}catch(t){if(i>=40)throw new Error("Text too long to encode");return arguments.callee({code:n,size:o,correctLevel:a,typeNumber:i+1,codeColor:s,backgroundColor:u})}for(var c=e.getModuleCount(),h=function(t,e){var r=~~(e/t);return{padding:~~((e-t*r)/2),cellSize:r||2}}(c,o),l=h.padding,f=h.cellSize,p=c*f+l,d=+"".concat(s.replace("#","0x"),"FF"),y=+"".concat(u.replace("#","0x"),"FF"),v=new Ut(o,o),g=0;g<o;g++)for(var m=0;m<o;m++)if(l<=m&&m<p&&l<=g&&g<p){var w=~~((m-l)/f),b=~~((g-l)/f);v.setPixel(m,g,e.isDark(b,w)?d:y)}else v.setPixel(m,g,y);return v.flush()}function xe(t){var e=t.width,r=t.height,n=t.data;return new Ut(e,r).write(n).flush()}var Ce=function(){function t(t,e){this.point=0,this.maxRemain=3,this.remainStart=0,this.remainEnd=0,this.loadMode="fast",this.buckets=[],this.options={preprocess:function(t){return ge.download(t.origin)},postprocess:function(t,e){return ge.parseVideo(e,t.origin,!0)},cleanup:function(t){b.globals;var e=b.local,r=b.path;t.forEach((function(t){r.is(t.local)&&e.remove(t.local)}))}},"string"==typeof t&&(this.loadMode=t),Object.assign(this.options,e)}return Object.defineProperty(t.prototype,"size",{get:function(){return this.buckets.length},enumerable:!1,configurable:!0}),t.prototype.updateRemainRange=function(t,e,r){this.point=t<0?0:t>=r?r-1:t,"whole"===this.loadMode?(this.remainStart=0,this.remainEnd=r):(this.maxRemain=e<1?1:e>r?r:e,this.remainStart=this.point-Math.floor(this.maxRemain/2),this.remainStart<0&&(this.remainStart=r+this.remainStart),this.remainEnd=this.remainStart+this.maxRemain,this.remainEnd>r&&(this.remainEnd=this.remainEnd%r))},t.prototype.includeRemainRange=function(t){return this.remainStart<this.remainEnd?t>=this.remainStart&&t<this.remainEnd:!(this.remainStart>this.remainEnd)||(t>=this.remainStart||t<this.remainEnd)},t.prototype.downloadAndParseVideo=function(t){return n(this,arguments,void 0,(function(t,e){var r,n;return void 0===e&&(e=!1),i(this,(function(i){switch(i.label){case 0:return[4,(r=this.options).preprocess(t)];case 1:return n=i.sent(),e?[2,r.postprocess(t,n)]:[2,n]}}))}))},t.prototype.createBucket=function(t,e,r){return n(this,void 0,void 0,(function(){var n,a,o;return i(this,(function(i){switch(i.label){case 0:return n=b.path,a={origin:t,local:n.resolve(n.filename(t)),entity:null,promise:null},this.buckets[e]=a,r?(o=a,[4,this.downloadAndParseVideo(a,!0)]):[3,2];case 1:return o.entity=i.sent(),[3,3];case 2:this.includeRemainRange(e)&&(a.promise=this.downloadAndParseVideo(a)),i.label=3;case 3:return[2,a]}}))}))},t.prototype.prepare=function(t){return n(this,arguments,void 0,(function(t,e,r){var n,a,o,s,u=this;return void 0===e&&(e=0),void 0===r&&(r=3),i(this,(function(i){switch(i.label){case 0:return this.updateRemainRange(e,r,t.length),a=(n=this).loadMode,o=n.point,[4,this.createBucket(t[o],o,!0)];case 1:return s=i.sent(),[4,Promise.all(t.map((function(t,e){return e===o?s:u.createBucket(t,e,"whole"===a)})))];case 2:return i.sent(),[2]}}))}))},t.prototype.get=function(){return n(this,void 0,void 0,(function(){var t,e,r,n=this;return i(this,(function(i){switch(i.label){case 0:return(t=this.buckets[this.point]).promise?(e=t,[4,t.promise.then((function(e){return n.options.postprocess(t,e)}))]):[3,2];case 1:return e.entity=i.sent(),t.promise=null,[3,4];case 2:return t.entity?[3,4]:(r=t,[4,this.downloadAndParseVideo(t,!0)]);case 3:r.entity=i.sent(),i.label=4;case 4:return[2,t]}}))}))},t.prototype.getPoint=function(){return this.point},t.prototype.go=function(t){return n(this,void 0,void 0,(function(){var e,r,n,a,o=this;return i(this,(function(i){return r=(e=this).size,n=e.buckets,a=e.loadMode,t<0||t>=r?[2,n[this.point]]:(this.updateRemainRange(t,this.maxRemain,n.length),"fast"===a&&this.maxRemain!==n.length&&n.forEach((function(t,e){o.includeRemainRange(e)?null===t.entity&&null===t.promise&&(t.promise=o.downloadAndParseVideo(t)):(t.entity=null,t.promise=null)})),[2,this.get()])}))}))},t.prototype.clear=function(){return n(this,arguments,void 0,(function(t){var e;return void 0===t&&(t=!0),i(this,(function(r){switch(r.label){case 0:return e=this.buckets,this.point=0,this.remainStart=0,this.remainEnd=0,this.maxRemain=3,this.buckets=[],t?[4,this.options.cleanup(e)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},t}(),Te=function(){function t(t,e,r){this.painter=t,this.resource=e,this.entity=r}return t.prototype.set=function(t,e){return n(this,arguments,void 0,(function(t,e,r){var n,a,o,s;return void 0===r&&(r="R"),i(this,(function(i){switch(i.label){case 0:return a=(n=this).entity,o=n.resource,"A"!==r?[3,2]:[4,o.loadImagesWithRecord((s={},s[t]=e,s),a.filename,"dynamic")];case 1:return i.sent(),[3,3];case 2:a.images[t]=e,i.label=3;case 3:return[2]}}))}))},t.prototype.getContext=function(){return this.painter.YC},t.prototype.hasValidKey=function(t){var e=this.entity.images;return"function"==typeof Object.hasOwn?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t)},t.prototype.loadImage=function(t,e){return this.resource.loadExtImage(t,b.path.filename(e))},t.prototype.setCanvas=function(t,e,r){return n(this,void 0,void 0,(function(){var n,a,o,s,u,c;return i(this,(function(i){switch(i.label){case 0:return this.entity.locked?[2]:(n=e.canvas,a=null!==(u=null==r?void 0:r.width)&&void 0!==u?u:n.width,o=null!==(c=null==r?void 0:r.height)&&void 0!==c?c:n.height,s=e.getImageData(0,0,a,o),[4,this.set(t,new Uint8Array(xe(s)),null==r?void 0:r.mode)]);case 1:return i.sent(),[2]}}))}))},t.prototype.setImage=function(t,e,r){return n(this,void 0,void 0,(function(){var n,a,o;return i(this,(function(i){switch(i.label){case 0:return this.entity.locked?[2]:e.startsWith("data:image")?[4,this.set(t,e,null==r?void 0:r.mode)]:[3,2];case 1:return i.sent(),[3,5];case 2:return n=this.set,a=[t],o=Uint8Array.bind,[4,ge.download(e)];case 3:return[4,n.apply(this,a.concat([new(o.apply(Uint8Array,[void 0,i.sent()])),null==r?void 0:r.mode]))];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},t.prototype.setQRCode=function(t,e,a){return n(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return this.entity.locked?[2]:[4,this.set(t,new Uint8Array(ke(r(r({},a),{code:e}))),null==a?void 0:a.mode)];case 1:return n.sent(),[2]}}))}))},t}(),Se=function(){function t(t){this.painter=t,this.caches=[],this.dynamicMaterials=new Map,this.materials=new Map,this.point=0}return t.isBitmap=function(t){return"h5"===b.globals.env&&t instanceof ImageBitmap},t.releaseOne=function(e){t.isBitmap(e)?e.close():""!==e.src&&("weapp"===b.globals.env&&e.src.includes(b.path.USER_DATA_PATH)&&b.local.remove(e.src),b.image.release(e))},t.prototype.createImage=function(){var t=null;return this.point>0&&(this.point--,t=this.caches.shift()),t||(t=b.image.create(this.painter.X)),this.caches.push(t),t},t.prototype.inertBitmapIntoCaches=function(e){t.isBitmap(e)&&this.caches.push(e)},t.prototype.loadExtImage=function(t,e){var r=this;return b.image.load((function(){return r.createImage()}),t,b.path.resolve(e,"ext")).then((function(t){return r.inertBitmapIntoCaches(t),t}))},t.prototype.loadImagesWithRecord=function(t,e){return n(this,arguments,void 0,(function(t,e,r){var n,a,o=this;return void 0===r&&(r="normal"),i(this,(function(i){switch(i.label){case 0:return n=[],a="".concat(e.replace(/\.svga$/g,""),".png"),Object.entries(t).forEach((function(t){var e=t[0],i=t[1];if(!(i instanceof Uint8Array&&i.byteLength<70)){var s=b.image.load((function(){return o.createImage()}),i,b.path.resolve(a,"dynamic"===r?"dyn_".concat(e):e)).then((function(t){o.inertBitmapIntoCaches(t),"dynamic"===r?o.dynamicMaterials.set(e,t):o.materials.set(e,t)}));n.push(s)}})),[4,Promise.all(n)];case 1:return i.sent(),[2]}}))}))},t.prototype.release=function(){for(var e=0,r=this.caches;e<r.length;e++){var n=r[e];t.releaseOne(n)}this.materials.clear(),this.dynamicMaterials.clear(),"alipay"===b.globals.env?this.cleanup():this.tidyUp()},t.prototype.tidyUp=function(){this.caches=Array.from(new Set(this.caches)),this.point=this.caches.length},t.prototype.cleanup=function(){this.caches.length=0,this.point=0},t}(),Ae=function(){function t(){this.config=new be,this.resource=null,this.painter=new we,this.animator=new W,this.renderer=null}return t.prototype.setConfig=function(t,e){return n(this,void 0,void 0,(function(){var r;return i(this,(function(n){switch(n.label){case 0:return r="string"==typeof t?{container:t}:t,this.config.register(r),[4,this.painter.register(r.container,r.secondary,e)];case 1:return n.sent(),this.renderer=new H(this.painter.YC),this.resource=new Se(this.painter),this.animator.onAnimate=b.rAF.bind(null,this.painter.X),[2]}}))}))},t.prototype.setItem=function(t,e){this.config.setItem(t,e)},t.prototype.mount=function(t){return n(this,void 0,void 0,(function(){var e,r;return i(this,(function(n){switch(n.label){case 0:if(!t)throw new Error("videoEntity undefined");return e=t.images,r=t.filename,this.animator.stop(),this.painter.clearSecondary(),this.resource.release(),this.entity=t,[4,this.resource.loadImagesWithRecord(e,r)];case 1:return n.sent(),[2]}}))}))},t.prototype.start=function(){var t;this.startAnimation(),null===(t=this.onStart)||void 0===t||t.call(this)},t.prototype.resume=function(){var t;this.animator.resume(),null===(t=this.onResume)||void 0===t||t.call(this)},t.prototype.pause=function(){var t;this.animator.pause(),null===(t=this.onPause)||void 0===t||t.call(this)},t.prototype.stop=function(){var t;this.animator.stop(),this.painter.clearContainer(),this.painter.clearSecondary(),null===(t=this.onStop)||void 0===t||t.call(this)},t.prototype.destroy=function(){var t,e,r;this.animator.stop(),this.painter.destroy(),null===(t=this.renderer)||void 0===t||t.destroy(),null===(e=this.resource)||void 0===e||e.release(),null===(r=this.resource)||void 0===r||r.cleanup(),this.entity=void 0},t.prototype.stepToFrame=function(t,e){void 0===e&&(e=!1),!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.start())},t.prototype.stepToPercentage=function(t,e){if(void 0===e&&(e=!1),this.entity){var r=this.entity.frames,n=t<0?0:Math.round(t*r);n>=r&&(n=r-1),this.stepToFrame(n,e)}},t.prototype.startAnimation=function(){var t,e,r,n,i,a,o=this,s=this,u=s.entity,c=s.config,h=s.animator,l=s.painter,f=s.renderer,p=s.resource,d=l.W,y=l.H,v=c.fillMode,g=c.playMode,m=c.contentMode,w=c.getConfig(u),k=w.currFrame,x=w.startFrame,C=w.endFrame,T=w.totalFrame,S=w.spriteCount,A=w.aniConfig,P=A.duration,M=A.loopStart,R=A.loop,I=A.fillValue,E="fallbacks"===g,D=k,F=0;h.setConfig(P,M,R,I),f.resize(m,u.size,{width:d,height:y});var O,U,B,L=4;h.onUpdate=function(s){var c;!function(e){for(O=b.now(),e();F<S;)if(U=Math.min(L,S-F),t=F+U|0,f.render(u,p.materials,p.dynamicMaterials,D,F,t),F=t,(B=b.now()-O)<3)L=Math.min(2*L,34);else if(B>8){L=Math.max(L/2,1);break}}((function(){n=(i=E?1-s:s)*T,E?(r=(0===s?C:Math.ceil(n))-1,i=D/T):r=1===s?x:Math.floor(n),a=D===r})),a||(l.clearContainer(),l.stick(),l.clearSecondary(),e=D,D=r,F=0,null===(c=o.onProcess)||void 0===c||c.call(o,~~(100*i)/100,e))},h.onStart=function(){u.locked=!0},h.onEnd=function(){var t;u.locked=!1,"none"===v&&l.clearContainer(),null===(t=o.onEnd)||void 0===t||t.call(o)},h.start()},t}(),Pe=function(){function t(t,e){this.config={container:"",contentMode:"fill",frame:0},this.isConfigured=!1,this.resource=null,this.renderer=null,this.painter=new we("poster",t,e)}return t.prototype.register=function(){return n(this,arguments,void 0,(function(t,e){return void 0===t&&(t=""),i(this,(function(r){switch(r.label){case 0:return[4,this.painter.register(t,"",e)];case 1:return r.sent(),this.renderer=new H(this.painter.YC),this.resource=new Se(this.painter),[2]}}))}))},t.prototype.setConfig=function(){return n(this,arguments,void 0,(function(t,e){return void 0===t&&(t={}),i(this,(function(r){switch(r.label){case 0:return"string"==typeof t?this.config.container=t:Object.assign(this.config,t),this.isConfigured=!0,[4,this.register(this.config.container,e)];case 1:return r.sent(),[2]}}))}))},t.prototype.setContentMode=function(t){this.config.contentMode=t},t.prototype.setFrame=function(t){this.config.frame=t},t.prototype.mount=function(t){return n(this,void 0,void 0,(function(){var e,r;return i(this,(function(n){switch(n.label){case 0:if(!t)throw new Error("videoEntity undefined");return this.isConfigured?[3,2]:[4,this.register()];case 1:n.sent(),this.isConfigured=!0,n.label=2;case 2:return e=t.images,r=t.filename,this.painter.clearContainer(),this.resource.release(),this.entity=t,[4,this.resource.loadImagesWithRecord(e,r)];case 3:return n.sent(),[2]}}))}))},t.prototype.draw=function(){if(this.entity){var t=this,e=t.painter,r=t.renderer,n=t.resource,i=t.entity,a=t.config;r.resize(a.contentMode,i.size,e.X),r.render(i,n.materials,n.dynamicMaterials,a.frame,0,i.sprites.length)}},t.prototype.toImageData=function(){var t=this.painter,e=t.XC,r=t.W,n=t.H;return e.getImageData(0,0,r,n)},t.prototype.destroy=function(){var t,e,r;this.painter.destroy(),null===(t=this.renderer)||void 0===t||t.destroy(),null===(e=this.resource)||void 0===e||e.release(),null===(r=this.resource)||void 0===r||r.cleanup(),this.entity=void 0},t}();t.Painter=we,t.Parser=ge,t.Player=Ae,t.Poster=Pe,t.ResourceManager=Se,t.VideoEditor=Te,t.VideoManager=Ce,t.generateImageBufferFromCode=ke,t.generateImageFromCode=function(t){var e=ke(t);return b.decode.toDataURL(e)},t.getBufferFromImageData=xe,t.getDataURLFromImageData=function(t){var e=xe(t);return b.decode.toDataURL(e)},t.isZlibCompressed=function(t){if(t.length<6)return!1;var e=t[0],r=t[1];if(8!=(15&e))return!1;if((256*e+r)%31!=0)return!1;if(!!(32&r))return!1;var n=t.slice(-4);if(4!==n.length)return!1;var i=n[0]<<24|n[1]<<16|n[2]<<8|n[3];return!(t.length>2&&0===i)},t.platform=b,Object.defineProperty(t,"__esModule",{value:!0})}));//# sourceMappingURL=index.min.js.map

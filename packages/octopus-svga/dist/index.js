var t=Uint8Array,e=Uint16Array,r=Int32Array,s=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),n=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),i=function(t,s){for(var n=new e(31),a=0;a<31;++a)n[a]=s+=1<<t[a-1];var i=new r(n[30]);for(a=1;a<30;++a)for(var o=n[a];o<n[a+1];++o)i[o]=o-n[a]<<5|a;return{b:n,r:i}},o=i(s,2),l=o.b,h=o.r;l[28]=258,h[258]=28;for(var c=i(n,0),u=c.b,f=c.r,d=new e(32768),m=0;m<32768;++m){var p=(43690&m)>>1|(21845&m)<<1;p=(61680&(p=(52428&p)>>2|(13107&p)<<2))>>4|(3855&p)<<4,d[m]=((65280&p)>>8|(255&p)<<8)>>1}var g=function(t,r,s){for(var n=t.length,a=0,i=new e(r);a<n;++a)t[a]&&++i[t[a]-1];var o,l=new e(r);for(a=1;a<r;++a)l[a]=l[a-1]+i[a-1]<<1;if(s){o=new e(1<<r);var h=15-r;for(a=0;a<n;++a)if(t[a])for(var c=a<<4|t[a],u=r-t[a],f=l[t[a]-1]++<<u,m=f|(1<<u)-1;f<=m;++f)o[d[f]>>h]=c}else for(o=new e(n),a=0;a<n;++a)t[a]&&(o[a]=d[l[t[a]-1]++]>>15-t[a]);return o},y=new t(288);for(m=0;m<144;++m)y[m]=8;for(m=144;m<256;++m)y[m]=9;for(m=256;m<280;++m)y[m]=7;for(m=280;m<288;++m)y[m]=8;var w=new t(32);for(m=0;m<32;++m)w[m]=5;var b=g(y,9,0),v=g(y,9,1),k=g(w,5,0),x=g(w,5,1),C=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},T=function(t,e,r){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&r},I=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},E=function(t){return(t+7)/8|0},M=function(e,r,s){return(null==s||s>e.length)&&(s=e.length),new t(e.subarray(r,s))},A=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(t,e,r){var s=new Error(e||A[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,P),!r)throw s;return s},D=function(t,e,r){r<<=7&e;var s=e/8|0;t[s]|=r,t[s+1]|=r>>8},R=function(t,e,r){r<<=7&e;var s=e/8|0;t[s]|=r,t[s+1]|=r>>8,t[s+2]|=r>>16},S=function(r,s){for(var n=[],a=0;a<r.length;++a)r[a]&&n.push({s:a,f:r[a]});var i=n.length,o=n.slice();if(!i)return{t:N,l:0};if(1==i){var l=new t(n[0].s+1);return l[n[0].s]=1,{t:l,l:1}}n.sort((function(t,e){return t.f-e.f})),n.push({s:-1,f:25001});var h=n[0],c=n[1],u=0,f=1,d=2;for(n[0]={s:-1,f:h.f+c.f,l:h,r:c};f!=i-1;)h=n[n[u].f<n[d].f?u++:d++],c=n[u!=f&&n[u].f<n[d].f?u++:d++],n[f++]={s:-1,f:h.f+c.f,l:h,r:c};var m=o[0].s;for(a=1;a<i;++a)o[a].s>m&&(m=o[a].s);var p=new e(m+1),g=B(n[f-1],p,0);if(g>s){a=0;var y=0,w=g-s,b=1<<w;for(o.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));a<i;++a){var v=o[a].s;if(!(p[v]>s))break;y+=b-(1<<g-p[v]),p[v]=s}for(y>>=w;y>0;){var k=o[a].s;p[k]<s?y-=1<<s-p[k]++-1:++a}for(;a>=0&&y;--a){var x=o[a].s;p[x]==s&&(--p[x],++y)}g=s}return{t:new t(p),l:g}},B=function(t,e,r){return-1==t.s?Math.max(B(t.l,e,r+1),B(t.r,e,r+1)):e[t.s]=r},F=function(t){for(var r=t.length;r&&!t[--r];);for(var s=new e(++r),n=0,a=t[0],i=1,o=function(t){s[n++]=t},l=1;l<=r;++l)if(t[l]==a&&l!=r)++i;else{if(!a&&i>2){for(;i>138;i-=138)o(32754);i>2&&(o(i>10?i-11<<5|28690:i-3<<5|12305),i=0)}else if(i>3){for(o(a),--i;i>6;i-=6)o(8304);i>2&&(o(i-3<<5|8208),i=0)}for(;i--;)o(a);i=1,a=t[l]}return{c:s.subarray(0,n),n:r}},U=function(t,e){for(var r=0,s=0;s<e.length;++s)r+=t[s]*e[s];return r},O=function(t,e,r){var s=r.length,n=E(e+2);t[n]=255&s,t[n+1]=s>>8,t[n+2]=255^t[n],t[n+3]=255^t[n+1];for(var a=0;a<s;++a)t[n+a+4]=r[a];return 8*(n+4+s)},L=function(t,r,i,o,l,h,c,u,f,d,m){D(r,m++,i),++l[256];for(var p=S(l,15),v=p.t,x=p.l,C=S(h,15),T=C.t,I=C.l,E=F(v),M=E.c,A=E.n,P=F(T),B=P.c,L=P.n,$=new e(19),N=0;N<M.length;++N)++$[31&M[N]];for(N=0;N<B.length;++N)++$[31&B[N]];for(var Y=S($,7),H=Y.t,W=Y.l,z=19;z>4&&!H[a[z-1]];--z);var X,_,K,V,J=d+5<<3,q=U(l,y)+U(h,w)+c,j=U(l,v)+U(h,T)+c+14+3*z+U($,H)+2*$[16]+3*$[17]+7*$[18];if(f>=0&&J<=q&&J<=j)return O(r,m,t.subarray(f,f+d));if(D(r,m,1+(j<q)),m+=2,j<q){X=g(v,x,0),_=v,K=g(T,I,0),V=T;var G=g(H,W,0);D(r,m,A-257),D(r,m+5,L-1),D(r,m+10,z-4),m+=14;for(N=0;N<z;++N)D(r,m+3*N,H[a[N]]);m+=3*z;for(var Q=[M,B],Z=0;Z<2;++Z){var tt=Q[Z];for(N=0;N<tt.length;++N){var et=31&tt[N];D(r,m,G[et]),m+=H[et],et>15&&(D(r,m,tt[N]>>5&127),m+=tt[N]>>12)}}}else X=b,_=y,K=k,V=w;for(N=0;N<u;++N){var rt=o[N];if(rt>255){R(r,m,X[(et=rt>>18&31)+257]),m+=_[et+257],et>7&&(D(r,m,rt>>23&31),m+=s[et]);var st=31&rt;R(r,m,K[st]),m+=V[st],st>3&&(R(r,m,rt>>5&8191),m+=n[st])}else R(r,m,X[rt]),m+=_[rt]}return R(r,m,X[256]),m+_[256]},$=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),N=new t(0),Y=function(){var t=1,e=0;return{p:function(r){for(var s=t,n=e,a=0|r.length,i=0;i!=a;){for(var o=Math.min(i+2655,a);i<o;++i)n+=s+=r[i];s=(65535&s)+15*(s>>16),n=(65535&n)+15*(n>>16)}t=s,e=n},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},H=function(a,i,o,l,c){if(!c&&(c={l:1},i.dictionary)){var u=i.dictionary.subarray(-32768),d=new t(u.length+a.length);d.set(u),d.set(a,u.length),a=d,c.w=u.length}return function(a,i,o,l,c,u){var d=u.z||a.length,m=new t(l+d+5*(1+Math.ceil(d/7e3))+c),p=m.subarray(l,m.length-c),g=u.l,y=7&(u.r||0);if(i){y&&(p[0]=u.r>>3);for(var w=$[i-1],b=w>>13,v=8191&w,k=(1<<o)-1,x=u.p||new e(32768),C=u.h||new e(k+1),T=Math.ceil(o/3),I=2*T,A=function(t){return(a[t]^a[t+1]<<T^a[t+2]<<I)&k},P=new r(25e3),D=new e(288),R=new e(32),S=0,B=0,F=u.i||0,U=0,N=u.w||0,Y=0;F+2<d;++F){var H=A(F),W=32767&F,z=C[H];if(x[W]=z,C[H]=W,N<=F){var X=d-F;if((S>7e3||U>24576)&&(X>423||!g)){y=L(a,p,0,P,D,R,B,U,Y,F-Y,y),U=S=B=0,Y=F;for(var _=0;_<286;++_)D[_]=0;for(_=0;_<30;++_)R[_]=0}var K=2,V=0,J=v,q=W-z&32767;if(X>2&&H==A(F-q))for(var j=Math.min(b,X)-1,G=Math.min(32767,F),Q=Math.min(258,X);q<=G&&--J&&W!=z;){if(a[F+K]==a[F+K-q]){for(var Z=0;Z<Q&&a[F+Z]==a[F+Z-q];++Z);if(Z>K){if(K=Z,V=q,Z>j)break;var tt=Math.min(q,Z-2),et=0;for(_=0;_<tt;++_){var rt=F-q+_&32767,st=rt-x[rt]&32767;st>et&&(et=st,z=rt)}}}q+=(W=z)-(z=x[W])&32767}if(V){P[U++]=268435456|h[K]<<18|f[V];var nt=31&h[K],at=31&f[V];B+=s[nt]+n[at],++D[257+nt],++R[at],N=F+K,++S}else P[U++]=a[F],++D[a[F]]}}for(F=Math.max(F,N);F<d;++F)P[U++]=a[F],++D[a[F]];y=L(a,p,g,P,D,R,B,U,Y,F-Y,y),g||(u.r=7&y|p[y/8|0]<<3,y-=7,u.h=C,u.p=x,u.i=F,u.w=N)}else{for(F=u.w||0;F<d+g;F+=65535){var it=F+65535;it>=d&&(p[y/8|0]=g,it=d),y=O(p,y+1,a.subarray(F,it))}u.i=d}return M(m,0,l+E(y)+c)}(a,null==i.level?6:i.level,null==i.mem?c.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):20:12+i.mem,o,l,c)},W=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function z(t,e){e||(e={});var r=Y();r.p(t);var s=H(t,e,e.dictionary?6:2,4);return function(t,e){var r=e.level,s=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=s<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var n=Y();n.p(e.dictionary),W(t,2,n.d())}}(s,e),W(s,s.length-4,r.d()),s}function X(e,r){return function(e,r,i,o){var h=e.length;if(!h||r.f&&!r.l)return i||new t(0);var c=!i,f=c||2!=r.i,d=r.i;c&&(i=new t(3*h));var m=function(e){var r=i.length;if(e>r){var s=new t(Math.max(2*r,e));s.set(i),i=s}},p=r.f||0,y=r.p||0,w=r.b||0,b=r.l,k=r.d,A=r.m,D=r.n,R=8*h;do{if(!b){p=T(e,y,1);var S=T(e,y+1,3);if(y+=3,!S){var B=e[(X=E(y)+4)-4]|e[X-3]<<8,F=X+B;if(F>h){d&&P(0);break}f&&m(w+B),i.set(e.subarray(X,F),w),r.b=w+=B,r.p=y=8*F,r.f=p;continue}if(1==S)b=v,k=x,A=9,D=5;else if(2==S){var U=T(e,y,31)+257,O=T(e,y+10,15)+4,L=U+T(e,y+5,31)+1;y+=14;for(var $=new t(L),N=new t(19),Y=0;Y<O;++Y)N[a[Y]]=T(e,y+3*Y,7);y+=3*O;var H=C(N),W=(1<<H)-1,z=g(N,H,1);for(Y=0;Y<L;){var X,_=z[T(e,y,W)];if(y+=15&_,(X=_>>4)<16)$[Y++]=X;else{var K=0,V=0;for(16==X?(V=3+T(e,y,3),y+=2,K=$[Y-1]):17==X?(V=3+T(e,y,7),y+=3):18==X&&(V=11+T(e,y,127),y+=7);V--;)$[Y++]=K}}var J=$.subarray(0,U),q=$.subarray(U);A=C(J),D=C(q),b=g(J,A,1),k=g(q,D,1)}else P(1);if(y>R){d&&P(0);break}}f&&m(w+131072);for(var j=(1<<A)-1,G=(1<<D)-1,Q=y;;Q=y){var Z=(K=b[I(e,y)&j])>>4;if((y+=15&K)>R){d&&P(0);break}if(K||P(2),Z<256)i[w++]=Z;else{if(256==Z){Q=y,b=null;break}var tt=Z-254;if(Z>264){var et=s[Y=Z-257];tt=T(e,y,(1<<et)-1)+l[Y],y+=et}var rt=k[I(e,y)&G],st=rt>>4;if(rt||P(3),y+=15&rt,q=u[st],st>3&&(et=n[st],q+=I(e,y)&(1<<et)-1,y+=et),y>R){d&&P(0);break}f&&m(w+131072);var nt=w+tt;if(w<q){var at=0-q,it=Math.min(q,nt);for(at+w<0&&P(3);w<it;++w)i[w]=o[at+w]}for(;w<nt;++w)i[w]=i[w-q]}}r.l=b,r.p=Q,r.b=w,r.f=p,b&&(p=1,r.m=A,r.d=k,r.n=D)}while(!p);return w!=i.length&&c?M(i,0,w):i.subarray(0,w)}(e.subarray(function(t){return(8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&P(6,"invalid zlib data"),1==(t[1]>>5&1)&&P(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)}(e),-4),{i:2},r,r)}var _="undefined"!=typeof TextDecoder&&new TextDecoder;try{_.decode(N,{stream:!0})}catch(K){}const K=()=>{},V=async(t,e=[],r=0)=>{try{return t()}catch(a){if(r>=e.length)throw a;return s=()=>V(t,e,++r),n=e[r],new Promise((t=>setTimeout((()=>t(s())),n)))}var s,n},J=4096,q=new Uint16Array(J);function j(t,e,r){if(e<0||r>t.length)throw new RangeError("Index out of range");if(r-e<1)return"";const s=[];let n=0;const a=t=>{s.push(String.fromCharCode.apply(null,Array.from(t)))};let i=!0;for(let s=e;s<r;s++)if(t[s]>127){i=!1;break}if(i){for(let s=e;s<r;s+=J){const e=Math.min(s+J,r)-s;for(let r=0;r<e;r++)q[r]=t[s+r];a(q.subarray(0,e))}return s.join("")}for(let s=e;s<r;){const e=t[s++];if(e<128){q[n++]=e,n===J&&(a(q),n=0);continue}let i;if(n>0&&(a(q.subarray(0,n)),n=0),192==(224&e)&&s<r)i=(31&e)<<6|63&t[s++];else if(224==(240&e)&&s+1<r)i=(15&e)<<12|(63&t[s++])<<6|63&t[s++];else if(240==(248&e)&&s+2<r){if(i=(7&e)<<18|(63&t[s++])<<12|(63&t[s++])<<6|63&t[s++],i>65535){i-=65536,q[n++]=55296+(i>>10),q[n++]=56320+(1023&i),n>=4094&&(a(q.subarray(0,n)),n=0);continue}}else for(i=65533;s<r&&128==(192&t[s]);)s++;q[n++]=i,n>=4093&&(a(q.subarray(0,n)),n=0)}return n>0&&a(q.subarray(0,n)),s.join("")}class G{plugins=[];globalCanvas=null;platformVersion="0.0.1";version="";globals={env:"unknown",br:null,dpr:1};noop=K;retry=V;constructor(t,e){this.version=e||"",this.plugins=t,this.globals.env=this.autoEnv()}init(){this.globals.br=this.useBridge(),this.globals.dpr=this.usePixelRatio();const t=this.plugins.reduce(((t,e)=>(t[e.name]=e,t)),{}),e=this.plugins.map((t=>t.name));this.usePlugins(t,e,{})}autoEnv(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported app")}useBridge(){switch(this.globals.env){case"h5":return globalThis;case"alipay":return my;case"tt":return tt;case"weapp":return wx}return{}}usePixelRatio(){const{env:t,br:e}=this.globals;return"h5"===t?devicePixelRatio:"getWindowInfo"in e?e.getWindowInfo().pixelRatio:"getSystemInfoSync"in e?e.getSystemInfoSync().pixelRatio:1}usePlugins(t,e,r){e.forEach((e=>{const s=t[e];if(!r[e]){if(void 0===s)throw new Error(`Plugin ${e} not found`);if(Array.isArray(s.dependencies)){for(const r of s.dependencies)if("function"!=typeof t[r]?.install)throw new Error(`Plugin ${e} depends on plugin ${r}, but ${r} is not found`);this.usePlugins(t,s.dependencies,r)}this.installPlugin(s),r[s.name]=!0}}))}setGlobalCanvas(t){this.globalCanvas=t}getGlobalCanvas(){if(!this.globalCanvas)throw new Error("requestAnimationFrame is not ready, please call `platform.setGlobalCanvas` first");return this.globalCanvas}switch(t){this.globals.env=t,this.init()}}var Q={name:"getCanvas",install(){const{retry:t}=this,{env:e,br:r,dpr:s}=this.globals,n=[50,100,100];function a(t,r,n){if(!t)throw new Error("canvas not found.");const a=1365,i=t.getContext("2d");let o=r*s,l=n*s;return"weapp"===e&&(o>a||l>a)&&(o>l?(l=l/o*a,o=a):(o=o/l*a,l=a)),t.width=o,t.height=l,{canvas:t,context:i}}if("h5"===e){const e=t=>document.querySelector(t);return r=>t((()=>{const t=e(`canvas[canvas-id=${r.slice(1)}]`)||e(r);return a(t,t?.clientWidth,t?.clientHeight)}),n)}return(e,s)=>t((()=>new Promise(((t,n)=>{let i=r.createSelectorQuery();s&&(i=i.in(s)),i.select(e).fields({node:!0,size:!0},(e=>{const{node:r,width:s,height:i}=e||{};try{t(a(r,s,i))}catch(t){n(t)}})).exec()}))),n)}},Z={name:"decode",install(){const{env:t,br:e}=this.globals,r=(t,e="image/png")=>`data:${e};base64,${t}`,s={toBuffer(t){const{buffer:e,byteOffset:r,byteLength:s}=t;return e.slice(r,r+s)},bytesToString(t){let e="";for(let r=0;r<t.length;r+=8192){const s=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,Array.from(s))}return e}};if("h5"===t){const t=new TextDecoder("utf-8",{fatal:!0});s.toDataURL=t=>r(btoa(s.bytesToString(t))),s.utf8=(e,r,s)=>t.decode(e.subarray(r,s))}else s.toDataURL=t=>r(e.arrayBufferToBase64(s.toBuffer(t))),s.utf8=j;return s}},et={name:"remote",install(){const{env:t,br:e}=this.globals,r=t=>/^(blob:)?http(s)?:\/\//.test(t);if("h5"===t)return{is:r,fetch:t=>fetch(t).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)}))};function s(t,r){return new Promise(((s,n)=>{e.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:r,success:t=>s(t.data),fail:n})})).catch((e=>{const r=e.errMsg||e.errorMessage||e.message;if(r.includes("ERR_CACHE_WRITE_FAILURE")||r.includes("ERR_CACHE_WRITE_FAILED"))return s(t,!1);throw e}))}return{is:r,fetch:t=>s(t,!0)}}},rt={name:"local",install(){const{env:t,br:e}=this.globals;if("h5"===t)return null;const r=e.getFileSystemManager();return{write:(t,e)=>new Promise(((s,n)=>{r.writeFile({filePath:e,data:t,success:()=>s(e),fail:n})})),read:t=>new Promise(((e,s)=>{r.readFile({filePath:t,success:t=>e(t.data),fail:s})})),remove:t=>new Promise(((e,s)=>{r.unlink({filePath:t,success:()=>e(t),fail:s})}))}}},st={name:"image",dependencies:["local","path","decode"],install(){const{local:t,path:e,decode:r,noop:s}=this,{env:n}=this.globals,a=new Set;function i(e,r){return new Promise(((n,i)=>{e.onload=()=>{n(e),a.has(r)&&t.remove(r).catch(s).then((()=>a.delete(r)))},e.onerror=()=>i(new Error(`SVGA LOADING FAILURE: ${e.src}`)),e.src=r}))}if("h5"===n){const t=()=>new Image,e=t=>"string"==typeof t?t:r.toDataURL(t);return{isImage:t=>t instanceof Image,isImageBitmap:t=>t instanceof ImageBitmap,create:t,load:(s,n,a)=>s instanceof Uint8Array&&"createImageBitmap"in globalThis?createImageBitmap(new Blob([r.toBuffer(s)])):s instanceof ImageBitmap?Promise.resolve(s):i(t(),e(s))}}const o=()=>this.getGlobalCanvas().createImage();return{isImage:t=>!(!t||void 0===t.src||void 0===t.width||void 0===t.height),isImageBitmap:t=>!1,create:o,load:async(s,l,h)=>{const c=await(async(s,i,o)=>{if("string"==typeof s)return s;if("tt"===n||"alipay"===n)return r.toDataURL(s);try{const n=e.resolve(i,o);return await t.write(r.toBuffer(s),n),a.add(n),n}catch(t){return console.warn(`图片缓存失败：${t.message}`),r.toDataURL(s)}})(s,l,h);return i(o(),c)}}}},nt={name:"now",install(){const{env:t,br:e}=this.globals,r="h5"===t?performance:"tt"===t?e.performance:e.getPerformance();return"function"==typeof r?.now?r.now()-Date.now()>0?()=>r.now()/1e3:()=>r.now():()=>Date.now()}},at={name:"getOfsCanvas",install(){const{env:t}=this.globals;let e;return e="h5"===t?t=>new OffscreenCanvas(t.width,t.height):"alipay"===t?t=>my.createOffscreenCanvas(t):"tt"===t?t=>{const e=tt.createOffscreenCanvas();return e.width=t.width,e.height=t.height,e}:t=>wx.createOffscreenCanvas(t),t=>{const r=t.type||"2d",s=e({...t,type:r}),n=s.getContext(r);return{canvas:s,context:n}}}},it={name:"path",install(){const{env:t,br:e}=this.globals,r=t=>t.substring(t.lastIndexOf("/")+1);if("h5"===t)return{USER_DATA_PATH:"",filename:r,resolve:(t,e)=>""};const{USER_DATA_PATH:s}="tt"===t?tt.getEnvInfoSync().common:e.env;return{USER_DATA_PATH:s,filename:r,resolve:(t,e)=>`${s}/${e?`${e}.`:""}${t}`}}},ot={name:"rAF",dependencies:["now"],install(){const{env:t}=this.globals;function e(){return t=>setTimeout(t,Math.max(0,16-Date.now()%16))}if("h5"===t){const t="requestAnimationFrame"in globalThis?requestAnimationFrame:e();return e=>t(e)}let r=null;return t=>{if(null===r)try{const t=this.getGlobalCanvas();r=t.requestAnimationFrame.bind(t)}catch(t){console.warn(t.message),r=e()}return r(t)}}};const lt=new class extends G{now;path;remote;local;decode;image;rAF;getCanvas;getOfsCanvas;constructor(){super([Q,at,Z,et,rt,st,nt,it,ot],"0.2.0"),this.init()}installPlugin(t){const e=t.install.call(this);Object.defineProperty(this,t.name,{get:()=>e,enumerable:!0,configurable:!0})}},ht=Array(4).fill(0).map((()=>new DataView(new ArrayBuffer(8))));let ct=0;var ut={readFloatLE(t,e){if(e<0||e+4>t.length)throw new RangeError("Index out of range");const r=ht[ct];ct=(ct+1)%4;const s=new Uint8Array(r.buffer);return s[0]=t[e],s[1]=t[e+1],s[2]=t[e+2],s[3]=t[e+3],r.getFloat32(0,!0)}};class ft{static EMPTY_UINT8ARRAY=new Uint8Array(0);static create(t){if(t instanceof ft)return t;if(t instanceof Uint8Array)return new ft(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}slice(t,e,r){return t.subarray(e,r)}indexOutOfRange(t,e){return new RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}readVarint32Slow(){let t=this.buf[this.pos++],e=127&t,r=7;do{if(this.pos>=this.len)throw this.indexOutOfRange(this);t=this.buf[this.pos++],e|=(127&t)<<r,r+=7}while(t>=128&&r<32);return e>>>0}uint32(){const t=this.buf[this.pos];return t<128?(this.pos++,t):this.readVarint32Slow()}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=ut.readFloatLE(this.buf,this.pos);return this.pos+=4,t}getBytesRange(){const t=this.uint32(),e=this.pos,r=e+t;if(r>this.len)throw this.indexOutOfRange(this,t);return[e,r,t]}bytes(){const[t,e,r]=this.getBytesRange();return this.pos+=r,0===r?ft.EMPTY_UINT8ARRAY:this.slice(this.buf,t,e)}string(){const[t,e]=this.getBytesRange(),r=lt.decode.utf8(this.buf,t,e);return this.pos=e,r}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,this}const e=this.buf;let r=this.pos;const s=this.len;for(;r<s;){if(!(128&e[r++]))return this.pos=r,this;if(r<s&&128&e[r]&&(r++,r<s&&128&e[r]&&(r++,r<s&&128&e[r]))){for(r++;r<s&&128&e[r];)if(r++,r-this.pos>=10)throw Error("invalid varint encoding");if(r<s)return this.pos=r+1,this}}throw this.indexOutOfRange(this)}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class dt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new dt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;width=0;height=0;constructor(t){t&&(null!==t.x&&(this.x=t.x),null!==t.y&&(this.y=t.y),null!==t.width&&(this.width=t.width),null!==t.height&&(this.height=t.height))}}class mt{static decode(t,e){t=ft.create(t);let r=void 0===e?t.len:t.pos+e,s=new mt;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.a=t.float();break;case 2:s.b=t.float();break;case 3:s.c=t.float();break;case 4:s.d=t.float();break;case 5:s.tx=t.float();break;case 6:s.ty=t.float();break;default:t.skipType(7&e)}}return s}a=0;b=0;c=0;d=0;tx=0;ty=0;constructor(t){t&&(null!==t.a&&(this.a=t.a),null!==t.b&&(this.b=t.b),null!==t.c&&(this.c=t.c),null!==t.d&&(this.d=t.d),null!==t.tx&&(this.tx=t.tx),null!==t.ty&&(this.ty=t.ty))}}class pt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new pt;for(;t.pos<r;){const e=t.uint32();if(e>>>3==1)s.d=t.string();else t.skipType(7&e)}return s}d="";constructor(t){t&&null!==t.d&&(this.d=t.d)}}class gt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new gt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;case 5:s.cornerRadius=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;width=0;height=0;cornerRadius=0;constructor(t){t&&(null!==t.x&&(this.x=t.x),null!==t.y&&(this.y=t.y),null!==t.width&&(this.width=t.width),null!==t.height&&(this.height=t.height),null!==t.cornerRadius&&(this.cornerRadius=t.cornerRadius))}}class yt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new yt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.radiusX=t.float();break;case 4:s.radiusY=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;radiusX=0;radiusY=0;constructor(t){t&&(null!==t.x&&(this.x=t.x),null!==t.y&&(this.y=t.y),null!==t.radiusX&&(this.radiusX=t.radiusX),null!==t.radiusY&&(this.radiusY=t.radiusY))}}class wt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new wt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.r=t.float();break;case 2:s.g=t.float();break;case 3:s.b=t.float();break;case 4:s.a=t.float();break;default:t.skipType(7&e)}}return s}r=0;g=0;b=0;a=0;constructor(t){t&&(null!==t.r&&(this.r=t.r),null!==t.g&&(this.g=t.g),null!==t.b&&(this.b=t.b),null!==t.a&&(this.a=t.a))}}class bt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new bt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.fill=wt.decode(t,t.uint32());break;case 2:s.stroke=wt.decode(t,t.uint32());break;case 3:s.strokeWidth=t.float();break;case 4:s.lineCap=t.int32();break;case 5:s.lineJoin=t.int32();break;case 6:s.miterLimit=t.float();break;case 7:s.lineDashI=t.float();break;case 8:s.lineDashII=t.float();break;case 9:s.lineDashIII=t.float();break;default:t.skipType(7&e)}}return s}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0;constructor(t){t&&(null!==t.fill&&(this.fill=t.fill),null!==t.lineCap&&(this.lineCap=t.lineCap),null!==t.lineDashI&&(this.lineDashI=t.lineDashI),null!==t.lineDashII&&(this.lineDashII=t.lineDashII),null!==t.lineDashIII&&(this.lineDashIII=t.lineDashIII),null!==t.lineJoin&&(this.lineJoin=t.lineJoin),null!==t.miterLimit&&(this.miterLimit=t.miterLimit),null!==t.stroke&&(this.stroke=t.stroke),null!==t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}}class vt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new vt;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.type=t.int32();break;case 2:s.shape=pt.decode(t,t.uint32());break;case 3:s.rect=gt.decode(t,t.uint32());break;case 4:s.ellipse=yt.decode(t,t.uint32());break;case 10:s.styles=bt.decode(t,t.uint32());break;case 11:s.transform=mt.decode(t,t.uint32());break;default:t.skipType(7&e)}}return s}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null;$oneOfFields=["shape","rect","ellipse"];$fieldMap={};get args(){const t=Object.keys(this);for(let e=t.length-1;e>-1;--e){const r=t[e],s=this[r];if(1===this.$fieldMap[r]&&null!==s)return r}return""}set args(t){for(var e=0;e<this.$oneOfFields.length;++e){const r=this.$oneOfFields[e];r!==t&&delete this[r]}}constructor(t){t&&(null!==t.type&&(this.type=t.type),null!==t.ellipse&&(this.ellipse=t.ellipse),null!==t.rect&&(this.rect=t.rect),null!==t.shape&&(this.shape=t.shape),null!==t.styles&&(this.styles=t.styles),null!==t.transform&&(this.transform=t.transform));for(var e=0;e<this.$oneOfFields.length;++e)this.$fieldMap[this.$oneOfFields[e]]=1}}class kt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new kt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.alpha=t.float();break;case 2:s.layout=dt.decode(t,t.uint32());break;case 3:s.transform=mt.decode(t,t.uint32());break;case 4:s.clipPath=t.string();break;case 5:s.shapes&&s.shapes.length||(s.shapes=[]),s.shapes.push(vt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return s}shapes=[];alpha=0;layout=null;transform=null;clipPath="";constructor(t){t&&(null!==t.alpha&&(this.alpha=t.alpha),null!==t.clipPath&&(this.clipPath=t.clipPath),null!==t.layout&&(this.layout=t.layout),null!==t.shapes&&(this.shapes=t.shapes),null!==t.transform&&(this.transform=t.transform))}}class xt{static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new xt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.imageKey=t.string();break;case 2:s.frames&&s.frames.length||(s.frames=[]),s.frames.push(kt.decode(t,t.uint32()));break;case 3:s.matteKey=t.string();break;default:t.skipType(7&e)}}return s}frames=[];imageKey="";matteKey="";constructor(t){t&&(null!==t.frames&&(this.frames=t.frames),null!==t.imageKey&&(this.imageKey=t.imageKey),null!==t.matteKey&&(this.matteKey=t.matteKey))}}class Ct{static decode(t,e){t=ft.create(t);let r=void 0===e?t.len:t.pos+e,s=new Ct;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.viewBoxWidth=t.float();break;case 2:s.viewBoxHeight=t.float();break;case 3:s.fps=t.int32();break;case 4:s.frames=t.int32();break;default:t.skipType(7&e)}}return s}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0;constructor(t){t&&(null!==t.viewBoxWidth&&(this.viewBoxWidth=t.viewBoxWidth),null!==t.viewBoxHeight&&(this.viewBoxHeight=t.viewBoxHeight),null!==t.fps&&(this.fps=t.fps),null!==t.frames&&(this.frames=t.frames))}}class Tt{static EMPTY_OBJECT=Object.freeze({});static decode(t,e){t=ft.create(t);const r=void 0===e?t.len:t.pos+e,s=new Tt;let n,a;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.version=t.string();break;case 2:s.params=Ct.decode(t,t.uint32());break;case 3:{s.images===Tt.EMPTY_OBJECT&&(s.images={});const e=t.uint32()+t.pos;for(n="",a=[];t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:n=t.string();break;case 2:a=t.bytes();break;default:t.skipType(7&e)}}s.images[n]=a;break}case 4:s.sprites&&s.sprites.length||(s.sprites=[]),s.sprites.push(xt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return s}version="";params=null;images=Tt.EMPTY_OBJECT;sprites=[];constructor(t){t&&(null!==t.version&&(this.version=t.version),null!==t.images&&(this.images=t.images),null!==t.params&&(this.params=t.params),null!==t.sprites&&(this.sprites=t.sprites))}}class It{version;filename;size={width:0,height:0};fps=20;locked=!1;frames=0;images={};dynamicElements={};sprites=[];constructor(t,e){const{viewBoxWidth:r,viewBoxHeight:s,fps:n,frames:a}=t.params;this.version=t.version,this.filename=e,this.size.width=r,this.size.height=s,this.fps=n,this.frames=a,this.images=t.images||{},this.sprites=this.formatSprites(t.sprites||[])}formatSprites(t){return t.map((t=>({imageKey:t.imageKey,frames:this.formatFrames(t.frames||[])})))}formatFrames(t){let e;return t.map((t=>{const{layout:r,transform:s,alpha:n}=t,a={x:r?.x+.5|0,y:r?.y+.5|0,width:r?.width+.5|0,height:r?.height+.5|0},i={a:s?.a??1,b:s?.b??0,c:s?.c??0,d:s?.d??1,tx:s?.tx??0,ty:s?.ty??0};let o=this.formatShapes(t.shapes||[]);3===t.shapes[0]?.type&&e?o=e:e=o;const l=i.a*a.x+i.c*a.y+i.tx,h=i.a*(a.x+a.width)+i.c*a.y+i.tx,c=i.a*a.x+i.c*(a.y+a.height)+i.tx,u=i.a*(a.x+a.width)+i.c*(a.y+a.height)+i.tx,f=i.b*a.x+i.d*a.y+i.ty,d=i.b*(a.x+a.width)+i.d*a.y+i.ty,m=i.b*a.x+i.d*(a.y+a.height)+i.ty,p=i.b*(a.x+a.width)+i.d*(a.y+a.height)+i.ty,g=Math.min(c,u,l,h)+.5|0,y=Math.min(m,p,f,d)+.5|0,w=t.clipPath??"";return{alpha:n??0,layout:a,transform:i,clipPath:w,shapes:o,nx:g,ny:y,maskPath:w.length>0?{d:w,transform:void 0,styles:{fill:"rgba(0, 0, 0, 0)",stroke:null,strokeWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null}}:null}}))}formatShapes(t){const e=[];for(let r of t){const t=r.styles;if(null==t)continue;const s=[],{lineDashI:n,lineDashII:a,lineDashIII:i}=t;n>0&&s.push(n),a>0&&(s.length<1&&s.push(0),s.push(a)),i>0&&(s.length<2&&(s.push(0),s.push(0)),s[2]=i);let o=null;switch(t.lineCap){case 0:o="butt";break;case 1:o="round";break;case 2:o="square"}let l=null;switch(t.lineJoin){case 2:l="bevel";break;case 1:l="round";break;case 0:l="miter"}const{fill:h,stroke:c}=t;let u=null;h&&(u=`rgba(${255*h.r|0}, ${255*h.g|0}, ${255*h.b|0}, ${1*h.a|0})`);let f=null;c&&(f=`rgba(${255*c.r|0}, ${255*c.g|0}, ${255*c.b|0}, ${1*c.a|0})`);const d={lineDash:s,fill:u,stroke:f,lineCap:o,lineJoin:l,strokeWidth:t.strokeWidth,miterLimit:t.miterLimit},{transform:m,shape:p,rect:g,ellipse:y}=r,w={a:m?.a??1,b:m?.b??0,c:m?.c??0,d:m?.d??1,tx:m?.tx??0,ty:m?.ty??0};0===r.type&&p?e.push({type:"shape",path:p,styles:d,transform:w}):1===r.type&&g?e.push({type:"rect",path:g,styles:d,transform:w}):2===r.type&&y&&e.push({type:"ellipse",path:y,styles:d,transform:w})}return e}}class Et{static parseVideo(t,e){const r=new Uint8Array(t,0,4),s=new Uint8Array(t);if("80,75,3,4"===r.toString())throw new Error("this parser only support version@2 of SVGA.");const n=X(s),a=Tt.decode(n);return new It(a,lt.path.filename(e))}download(t){const{remote:e,local:r,globals:s}=lt;return e.is(t)?e.fetch(t):"h5"!==s.env?r.read(t):Promise.resolve(null)}async load(t){return Et.parseVideo(await this.download(t),t)}}class Mt{pool=[];static instance;static getInstance(){return Mt.instance||(Mt.instance=new Mt),Mt.instance}acquire(){return this.pool.length>0?this.pool.pop():{x:0,y:0,x1:0,y1:0,x2:0,y2:0}}release(t){t.x=0,t.y=0,t.x1=0,t.y1=0,t.x2=0,t.y2=0,this.pool.push(t)}}function At(t,e,r,s,n,a){const i=e.frames[r];if(!(i.alpha<.05)){t.save(),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty),t.globalAlpha=i.alpha,t.transform(i.transform?.a??1,i.transform?.b??0,i.transform?.c??0,i.transform?.d??1,i.transform?.tx??0,i.transform?.ty??0),s&&(i.maskPath&&(Rt(t,i.maskPath.d,i.maskPath.transform,i.maskPath.styles),t.clip()),t.drawImage(s,0,0,i.layout.width,i.layout.height)),n&&t.drawImage(n,(i.layout.width-n.width)/2,(i.layout.height-n.height)/2);for(let e=0;e<i.shapes.length;e++)Pt(t,i.shapes[e]);t.restore()}}function Pt(t,e){switch(e.type){case"shape":Rt(t,e.path.d,e.transform,e.styles);break;case"ellipse":!function(t,e,r,s,n,a,i){t.save(),Dt(t,i),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty);e-=s;const o=2*s,l=2*n,h=.5522848,c=o/2*h,u=l/2*h,f=e+o,d=(r-=n)+l,m=e+o/2,p=r+l/2;t.beginPath(),t.moveTo(e,p),t.bezierCurveTo(e,p-u,m-c,r,m,r),t.bezierCurveTo(m+c,r,f,p-u,f,p),t.bezierCurveTo(f,p+u,m+c,d,m,d),t.bezierCurveTo(m-c,d,e,p+u,e,p),i.fill&&t.fill();i.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.radiusX??0,e.path.radiusY??0,e.transform,e.styles);break;case"rect":!function(t,e,r,s,n,a,i,o){t.save(),Dt(t,o),i&&t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);let l=a;s<2*l&&(l=s/2);n<2*l&&(l=n/2);t.beginPath(),t.moveTo(e+l,r),t.arcTo(e+s,r,e+s,r+n,l),t.arcTo(e+s,r+n,e,r+n,l),t.arcTo(e,r+n,e,r,l),t.arcTo(e,r,e+s,r,l),t.closePath(),o.fill&&t.fill();o.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.width??0,e.path.height??0,e.path.cornerRadius??0,e.transform,e.styles)}}function Dt(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}function Rt(t,e,r,s){t.save(),Dt(t,s),r&&t.transform(r.a,r.b,r.c,r.d,r.tx,r.ty);const n=Mt.getInstance(),a=n.acquire();if(t.beginPath(),e){const r=e.match(/[a-zA-Z][^a-zA-Z]*/g)||[];for(const e of r){const r=e[0];if("MLHVCSQZmlhvcsqz".includes(r)){St(t,a,r,e.substring(1).trim().split(/[\s,]+/).filter(Boolean))}}}s.fill&&t.fill(),s.stroke&&t.stroke(),n.release(a),t.restore()}function St(t,e,r,s){switch(r){case"M":e.x=+s[0],e.y=+s[1],t.moveTo(e.x,e.y);break;case"m":e.x+=+s[0],e.y+=+s[1],t.moveTo(e.x,e.y);break;case"L":e.x=+s[0],e.y=+s[1],t.lineTo(e.x,e.y);break;case"l":e.x+=+s[0],e.y+=+s[1],t.lineTo(e.x,e.y);break;case"H":e.x=+s[0],t.lineTo(e.x,e.y);break;case"h":e.x+=+s[0],t.lineTo(e.x,e.y);break;case"V":e.y=+s[0],t.lineTo(e.x,e.y);break;case"v":e.y+=+s[0],t.lineTo(e.x,e.y);break;case"C":e.x1=+s[0],e.y1=+s[1],e.x2=+s[2],e.y2=+s[3],e.x=+s[4],e.y=+s[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"c":e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x2=e.x+ +s[2],e.y2=e.y+ +s[3],e.x+=+s[4],e.y+=+s[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"S":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=+s[0],e.y2=+s[1],e.x=+s[2],e.y=+s[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=+s[0],e.y1=+s[1],e.x=+s[2],e.y=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"s":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=e.x+ +s[0],e.y2=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"Q":e.x1=+s[0],e.y1=+s[1],e.x=+s[2],e.y=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"q":e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"Z":case"z":t.closePath()}}class Bt{images=[];dynamicMaterials=new Map;materials=new Map;getReleaseImage(){return this.images.shift()}loadAll(t,e){const{load:r,isImage:s}=lt.image,n=[];return Object.keys(t).forEach((a=>{const i=t[a];if(s(i))this.materials.set(a,i);else{const t=r(i,e,a).then((t=>{this.materials.set(a,t)}));n.push(t)}})),Promise.all(n)}appendAll(t){this.dynamicMaterials=new Map(Object.entries(t))}release(){const{env:t}=lt.globals,{isImage:e,isImageBitmap:r}=lt.image;if("alipay"!==t){const t=t=>{e(t)?(t.onload=null,t.onerror=null,t.src="",this.images.push(t)):r(t)&&t.close()};this.materials.forEach(t),this.dynamicMaterials.forEach(t)}this.materials.clear(),this.dynamicMaterials.clear(),this.images=Array.from(new Set(this.images))}}const{noop:Ft}=lt;class Ut{mode;X=null;XC=null;Y=null;YC=null;W;H;model={};IM=new Bt;lastResizeKey="";lastTransform;globalTransform;constructor(t="animation",e=0,r=0){this.mode=t;const{dpr:s}=lt.globals;this.W=e*s,this.H=r*s}setModel(t){const{model:e}=this,{env:r}=lt.globals;e.type=t,"O"===t&&"h5"===r&&navigator.userAgent.includes("Firefox")?e.clear="CR":e.clear="O"===t&&"tt"===r||"alipay"===r?"CL":"RE"}async register(t,e,r){const{model:s,mode:n}=this,{getCanvas:a,getOfsCanvas:i}=lt,{env:o}=lt.globals;if("poster"!==n||"h5"===o&&!("OffscreenCanvas"in globalThis)){const{canvas:e,context:s}=await a(t,r),{width:i,height:o}=e;this.X=e,this.XC=s,"poster"===n?(e.width=i,e.height=o,this.setModel("C")):(this.W=i,this.H=o)}else{const{W:t,H:e}=this;if(!(t>0&&e>0))throw new Error("Poster mode must set width and height when create Brush instance");const{canvas:r,context:s}=i({width:t,height:e});this.X=r,this.XC=s,this.setModel("O")}if("h5"!==o){const{X:t,IM:e}=this,{createImage:r}=t;Object.defineProperty(t,"createImage",{get:()=>()=>e.getReleaseImage()||r.call(t)}),lt.setGlobalCanvas(t)}if("poster"===n)this.Y=this.X,this.YC=this.XC;else{let t;"string"==typeof e&&""!==e?(t=await a(e,r),t.canvas.width=this.W,t.canvas.height=this.H,this.setModel("C")):(t=i({width:this.W,height:this.H}),this.setModel("O")),this.Y=t.canvas,this.YC=t.context}if("CL"===s.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===n)this.clearSecondary=this.stick=Ft;else switch(s.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:r,context:s}=i({width:t,height:e});this.Y=r,this.YC=s};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:r}=this;r.width=t,r.height=e}}}updateDynamicImages(t){this.IM.appendAll(t)}loadImages(t,e){return this.IM.loadAll(t,e)}getImageData(){return this.XC.getImageData(0,0,this.W,this.H)}calculateScale(t,e){const{Y:r}=this,s=e.width/e.height,n=r.width/r.height,a="aspect-fit"===t;if(s>=n&&a||s<=n&&!a){const t=r.width/e.width;return{scaleX:t,scaleY:t,translateX:0,translateY:(r.height-e.height*t)/2}}const i=r.height/e.height;return{scaleX:i,scaleY:i,translateX:(r.width-e.width*i)/2,translateY:0}}resize(t,e){const{width:r,height:s}=this.Y,{width:n,height:a}=e,i=`${t}-${n}-${a}-${r}-${s}`;if(this.lastResizeKey===i&&this.lastTransform)return void(this.globalTransform=this.lastTransform);let o={scaleX:1,scaleY:1,translateX:0,translateY:0};"fill"===t?(o.scaleX=r/n,o.scaleY=s/a):o=this.calculateScale(t,e),this.lastResizeKey=i,this.globalTransform=this.lastTransform={a:o.scaleX,b:0,c:0,d:o.scaleY,tx:o.translateX,ty:o.translateY}}clearContainer=Ft;clearSecondary=Ft;clearMaterials(){this.IM.release()}draw(t,e,r,s){const{materials:n,dynamicMaterials:a}=this.IM;!function(t,e,r,s,n,a,i,o){const{sprites:l}=s;for(let s=a;s<i;s++){const a=l[s],{imageKey:i}=a;At(t,a,n,e.get(i),r.get(i),o)}}(this.YC,n,a,t,e,r,s,this.globalTransform)}stick(){const{W:t,H:e,mode:r}=this;"poster"!==r&&this.XC.drawImage(this.YC.canvas||this.Y,0,0,t,e)}destroy(){this.clearContainer(),this.clearSecondary(),this.clearMaterials(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=Ft}}const{noop:Ot}=lt;class Lt{isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onStart=Ot;onUpdate=Ot;onEnd=Ot;setConfig(t,e,r,s){this.duration=t,this.loopStart=e,this.loopDuration=t*r+s-e}start(){this.isRunning=!0,this.startTime=lt.now(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=lt.now(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(lt.now()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1,this.loopStart=0}doFrame(){this.isRunning&&(this.doDeltaTime(lt.now()-this.startTime),this.isRunning&&lt.rAF((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:r,loopDuration:s}=this;let n,a=!1;t>=s?(n=1,a=!0,this.stop()):n=(t+r)%e/e,this.onUpdate(n),!this.isRunning&&a&&this.onEnd()}}class $t{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards","none"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:r,startFrame:s,endFrame:n,fillMode:a,loop:i}=this,{fps:o,sprites:l}=t;let{frames:h}=t;const c=l.length,u=s>0?s:0,f=n>0&&n<h?n:h;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<h?h=f-u:u>0&&(h-=u);let d=r,m=0;"forwards"===e?(d===f-1&&(d=u),"forwards"===a&&(m=1)):(0===d&&(d=f-1),"backwards"===a&&(m=1));const p=1e3/o;return{currFrame:d,startFrame:u,endFrame:f,totalFrame:h,spriteCount:c,aniConfig:{duration:Math.floor(h*p*10**6)/10**6,loopStart:r>u?(r-u)*p:0,loop:0===i?1/0:i,fillValue:m*p}}}}class Nt{entity;config=new $t;animator=null;painter=new Ut;async setConfig(t,e){const r="string"==typeof t?{container:t}:t;this.config.register(r),this.animator=new Lt,await this.painter.register(r.container,r.secondary,e)}setItem(t,e){this.config.setItem(t,e)}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:r}=t;return this.animator.stop(),this.painter.clearSecondary(),this.painter.clearMaterials(),this.painter.updateDynamicImages(t.dynamicElements),this.entity=t,this.painter.loadImages(e,r)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.painter.clearContainer(),this.painter.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.painter.destroy(),this.animator=null,this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.start())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:r}=this.entity;this.stepToFrame(Math.round((t<0?0:t)*r)%r,e)}startAnimation(){const{entity:t,config:e,animator:r,painter:s}=this,{now:n}=lt,{fillMode:a,playMode:i,contentMode:o}=e,{currFrame:l,startFrame:h,endFrame:c,totalFrame:u,spriteCount:f,aniConfig:d}=e.getConfig(t),{duration:m,loopStart:p,loop:g,fillValue:y}=d,w="fallbacks"===i;let b,v,k,x,C,T,I=l,E=0;r.setConfig(m,p,g,y),s.resize(o,t.size);let M,A,P,D=4;r.onUpdate=e=>{(e=>{for(M=n(),e();E<f;)if(A=Math.min(D,f-E),b=E+A|0,s.draw(t,I,E,b),E=b,P=n()-M,P<3)D=Math.min(2*D,34);else if(P>8){D=Math.max(D/2,1);break}})((()=>{C=w?1-e:e,x=C*u,w?(k=(0===e?c:Math.ceil(x))-1,C=I/u):k=1===e?h:Math.floor(x),T=I===k})),T||(s.clearContainer(),s.stick(),s.clearSecondary(),v=I,I=k,E=0,this.onProcess?.(~~(100*C)/100,v))},r.onStart=()=>{t.locked=!0},r.onEnd=()=>{t.locked=!1,"none"===a&&s.clearContainer(),this.onEnd?.()},r.start()}}class Yt{static table=function(){return Uint32Array.from(Array(256),((t,e)=>{let r=e;for(let t=0;t<8;t++)r=1&r?3988292384^r>>>1:r>>>1;return r>>>0}))}();cache=new Map;calculate(t){if(!(t&&t instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array");const{table:e}=Yt,{cache:r}=this,s=lt.decode.bytesToString(t);if(r.has(s))return r.get(s);let n=4294967295;const{length:a}=t;for(let r=0;r<a;r++)n=n>>>8^e[255&(n^t[r])];const i=(4294967295^n)>>>0;return r.set(s,i),i}clear(){this.cache.clear()}}class Ht{width;height;view;crc32=new Yt;constructor(t,e){this.width=t,this.height=e,this.view=new DataView(new ArrayBuffer(4*t*e))}createChunk(t,e){const r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,e.length,!1);const s=Uint8Array.from(t,(t=>t.charCodeAt(0))),n=new Uint8Array(s.length+e.length);n.set(s),n.set(e,s.length);const a=new Uint8Array(4);new DataView(a.buffer).setUint32(0,this.crc32.calculate(n)>>>0,!1);const i=new Uint8Array(r.length+n.length+a.length);return i.set(r),i.set(n,r.length),i.set(a,r.length+n.length),i}createIHDRChunk(){const t=new Uint8Array(13),e=new DataView(t.buffer);return e.setUint32(0,this.width,!1),e.setUint32(4,this.height,!1),e.setUint8(8,8),e.setUint8(9,6),e.setUint8(10,0),e.setUint8(11,0),e.setUint8(12,0),this.createChunk("IHDR",t)}createIDATChunk(){const{width:t,height:e,view:r}=this,s=4*t+1,n=new Uint8Array(s*e),a=new Uint8Array(r.buffer);for(let r=0;r<e;r++){const e=r*s;n[e]=0;const i=r*t*4,o=i+4*t;n.set(a.subarray(i,o),e+1)}return this.createChunk("IDAT",z(n))}createIENDChunk(){return this.createChunk("IEND",new Uint8Array(0))}setPixel(t,e,r){this.view.setUint32(4*(e*this.width+t),r,!1)}write(t){const{width:e,height:r}=this;for(let s=0;s<r;s++)for(let r=0;r<e;r++){const n=4*(s*e+r),a=(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0;this.setPixel(r,s,a)}return this}flush(){const t=new Uint8Array([137,80,78,71,13,10,26,10]),e=this.createIHDRChunk(),r=this.createIDATChunk(),s=this.createIENDChunk(),n=8+e.length+r.length+s.length,a=new Uint8Array(n);let i=0;return a.set(t,i),i+=t.length,a.set(e,i),i+=e.length,a.set(r,i),i+=r.length,a.set(s,i),this.crc32.clear(),a}}class Wt{buffer=[];lengthInBits=0;getAt(t){const e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))}putBit(t){const{lengthInBits:e,buffer:r}=this,s=~~(e/8);r.length<=s&&r.push(0),t&&(r[s]|=128>>>e%8),this.lengthInBits+=1}}const zt={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Xt={L:1,M:0,Q:3,H:2},_t={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};class Kt{bytes;constructor(t){let e=[];for(let r=0;r<t.length;r++){const s=[],n=t.charCodeAt(r);n>65536?(s[0]=240|(1835008&n)>>>18,s[1]=128|(258048&n)>>>12,s[2]=128|(4032&n)>>>6,s[3]=128|63&n):n>2048?(s[0]=224|(61440&n)>>>12,s[1]=128|(4032&n)>>>6,s[2]=128|63&n):n>128?(s[0]=192|(1984&n)>>>6,s[1]=128|63&n):s[0]=n,e.push(s)}this.bytes=e.flat(1);const{bytes:r}=this;r.length!==t.length&&(r.unshift(191),r.unshift(187),r.unshift(239))}get mode(){return zt.MODE_8BIT_BYTE}get length(){return this.bytes.length}write(t){const{bytes:e}=this;for(let r=0;r<e.length;r++)t.put(e[r],8)}}const Vt=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class Jt{getRSBlockTable(t,e){const{L:r,M:s,Q:n,H:a}=Xt,i=4*(t-1);switch(e){case r:return Vt[i+0];case s:return Vt[i+1];case n:return Vt[i+2];case a:return Vt[i+3];default:throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel: ${e}`)}}getRSBlocks(t,e){const r=this.getRSBlockTable(t,e),s=r.length/3,n=[];for(let t=0;t<s;t++){const e=r[3*t],s=r[3*t+1],a=r[3*t+2];for(let t=0;t<e;t++)n.push({totalCount:s,dataCount:a})}return n}}const qt=new Array(256),jt=new Array(256);for(let t=0;t<8;t++)qt[t]=1<<t;for(let t=8;t<256;t++)qt[t]=qt[t-4]^qt[t-5]^qt[t-6]^qt[t-8];for(let t=0;t<255;t++)jt[qt[t]]=t;const Gt={glog(t){if(t<1)throw new Error(`glog(${t})`);return jt[t]},gexp:t=>(t<0?t=255+t%255:t>255&&(t%=255),qt[t])};class Qt{num;constructor(t,e){const{length:r}=t;if(void 0===r)throw new Error(`${r}/${e}`);let s=0;for(;s<r&&0===t[s];)s++;const n=r-s;this.num=new Array(n+e);for(let e=0;e<n;e++)this.num[e]=t[e+s]}get length(){return this.num.length}getAt(t){return this.num[t]}multiply(t){const{glog:e,gexp:r}=Gt,s=[];for(let n=0;n<this.length;n++)for(let a=0;a<t.length;a++)s[n+a]^=r(e(this.getAt(n))+e(t.getAt(a)));return new Qt(s,0)}mod(t){if(this.length-t.length<0)return this;const{glog:e,gexp:r}=Gt,s=e(this.getAt(0))-e(t.getAt(0)),n=[];for(var a=0;a<this.length;a++){const i=this.getAt(a);n[a]=a<t.length?i^r(e(t.getAt(a))+s):i}return new Qt(n,0).mod(t)}}const Zt=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],te=t=>0===t?0:Math.log2(t),ee=te(1335),re=te(7973),se={getBCHTypeInfo(t){let e=t<<10;for(;te(e)-ee>=0;)e^=1335<<te(e)-ee;return 21522^(t<<10|e)},getBCHTypeNumber(t){let e=t<<12;for(;te(e)-re>=0;)e^=7973<<te(e)-re;return t<<12|e},getPatternPosition:t=>Zt[t-1],getMaskFunction(t){const{PATTERN000:e,PATTERN001:r,PATTERN010:s,PATTERN011:n,PATTERN100:a,PATTERN101:i,PATTERN110:o,PATTERN111:l}=_t;switch(t){case e:return(t,e)=>(t+e)%2==0;case r:return t=>t%2==0;case s:return(t,e)=>e%3==0;case n:return(t,e)=>(t+e)%3==0;case a:return(t,e)=>(~~(t/2)+~~(e/3))%2==0;case i:return(t,e)=>t*e%2+t*e%3==0;case o:return(t,e)=>(t*e%2+t*e%3)%2==0;case l:return(t,e)=>(t*e%3+(t+e)%2)%2==0;default:throw new Error(`bad maskPattern: ${t}`)}},getErrorCorrectPolynomial(t){let e=new Qt([1],0);for(let r=0;r<t;r++)e=e.multiply(new Qt([1,Gt.gexp(r)],0));return e},getLengthInBits(t,e){const{MODE_NUMBER:r,MODE_ALPHA_NUM:s,MODE_8BIT_BYTE:n,MODE_KANJI:a}=zt;if(e<1||e>40)throw new Error(`type: ${e}`);if(e>=1&&e<10)switch(t){case r:return 10;case s:return 9;case n:case a:return 8}if(e<27)switch(t){case r:return 12;case s:return 11;case n:return 16;case a:return 10}if(e<=40)switch(t){case r:return 14;case s:return 13;case n:return 16;case a:return 12}throw new Error(`mode: ${t}`)},getLostPoint(t){const e=t.getModuleCount();let r=0;for(let s=0;s<e;s++)for(let n=0;n<e;n++){const a=t.isDark(s,n);let i=0;for(let r=-1;r<=1;r++){const o=s+r;if(!(o<0||e<=o))for(let s=-1;s<=1;s++){const l=n+s;l<0||e<=l||(0===r&&0===s||a===t.isDark(o,l)&&i++)}}i>5&&(r+=i+3-5)}for(let s=0;s<e-1;s++)for(let n=0;n<e-1;n++){let e=0;t.isDark(s,n)&&e++,t.isDark(s+1,n)&&e++,t.isDark(s,n+1)&&e++,t.isDark(s+1,n+1)&&e++,0!==e&&4!==e||(r+=3)}for(let s=0;s<e;s++)for(let n=0;n<e-6;n++)t.isDark(s,n)&&!t.isDark(s,n+1)&&t.isDark(s,n+2)&&t.isDark(s,n+3)&&t.isDark(s,n+4)&&!t.isDark(s,n+5)&&t.isDark(s,n+6)&&(r+=40);for(let s=0;s<e;s++)for(let n=0;n<e-6;n++)t.isDark(n,s)&&!t.isDark(n+1,s)&&t.isDark(n+2,s)&&t.isDark(n+3,s)&&t.isDark(n+4,s)&&!t.isDark(n+5,s)&&t.isDark(n+6,s)&&(r+=40);let s=0;for(let r=0;r<e;r++)for(let n=0;n<e;n++)t.isDark(n,r)&&s++;return r+10*(Math.abs(100*s/Math.pow(e,2)-50)/5)}};class ne{typeNumber;errorCorrectLevel;modules=[];moduleCount=0;dataCache=null;dataList=[];constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=Xt[e]}makeImpl(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=(t=>{const e=[];for(let r=0;r<t;r++){e[r]=[];for(let s=0;s<t;s++)e[r][s]=null}return e})(this.moduleCount);const r=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(r,0),this.setupPositionProbePattern(0,r),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null===this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)}setupPositionProbePattern(t,e){const{modules:r,moduleCount:s}=this;for(let n=-1;n<=7;n++){const a=t+n;if(!(a<=-1||s<=a))for(let t=-1;t<=7;t++){const i=e+t;i<=-1||s<=i||(r[a][i]=n>=0&&n<=6&&(0===t||6===t)||t>=0&&t<=6&&(0===n||6===n)||n>=2&&n<=4&&t>=2&&t<=4)}}}setupPositionAdjustPattern(){const{typeNumber:t,modules:e}=this,r=se.getPatternPosition(t),{length:s}=r;for(let t=0;t<s;t++)for(let n=0;n<s;n++){const s=r[t],a=r[n];if(null==e[s][a])for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)e[s+t][a+r]=-2===t||2===t||-2===r||2===r||0===t&&0===r}}setupTimingPattern(){const{moduleCount:t,modules:e}=this,r=t-8;for(let t=8;t<r;t++)null==e[t][6]&&(e[t][6]=t%2==0);for(let t=8;t<r;t++)null==e[6][t]&&(e[6][t]=t%2==0)}setupTypeInfo(t,e){const{errorCorrectLevel:r,modules:s,moduleCount:n}=this,a=r<<3|e,i=se.getBCHTypeInfo(a);for(let e=0;e<15;e++){const r=!t&&1==(i>>e&1);e<6?s[e][8]=r:e<8?s[e+1][8]=r:s[n-15+e][8]=r}for(let e=0;e<15;e++){const r=!t&&1==(i>>e&1);e<8?s[8][n-e-1]=r:e<9?s[8][15-e]=r:s[8][15-e-1]=r}s[n-8][8]=!t}getBestMaskPattern(){let t=0,e=0;for(let r=0;r<8;r++){this.makeImpl(!0,r);const s=se.getLostPoint(this);(0===r||t>s)&&(t=s,e=r)}return e}setupTypeNumber(t){const{typeNumber:e,modules:r,moduleCount:s}=this,n=se.getBCHTypeNumber(e);for(let e=0;e<18;e++){const a=!t&&1==(n>>e&1);r[~~(e/3)][e%3+s-8-3]=a,r[e%3+s-8-3][~~(e/3)]=a}}createData(t,e,r){const s=(new Jt).getRSBlocks(t,e),n=new Wt;for(let e=0;e<r.length;e++){const s=r[e];n.put(s.mode,4),n.put(s.length,se.getLengthInBits(s.mode,t)),s.write(n)}let a=0;for(let t=0;t<s.length;t++)a+=s[t].dataCount;const i=8*a;if(n.lengthInBits>i)throw new Error(`code length overflow. (${n.lengthInBits} > ${i})`);for(n.lengthInBits+4<=i&&n.put(0,4);n.lengthInBits%8!=0;)n.putBit(!1);for(;!(n.lengthInBits>=i||(n.put(236,8),n.lengthInBits>=i));)n.put(17,8);return this.createBytes(n,s)}mapData(t,e){const{modules:r,moduleCount:s}=this,n=se.getMaskFunction(e);let a=-1,i=s-1,o=7,l=0;for(let e=i;e>0;e-=2)for(6===e&&(e-=1);;){for(let s=0;s<2;s++)if(null==r[i][e-s]){let a=!1;l<t.length&&(a=1==(t[l]>>>o&1)),n(i,e-s)&&(a=!a),r[i][e-s]=a,o--,-1===o&&(l++,o=7)}if(i+=a,i<0||s<=i){i-=a,a=-a;break}}}createBytes(t,e){const r=[],s=[];let n=0,a=0,i=0;for(let o=0;o<e.length;o++){const l=e[o].dataCount,h=e[o].totalCount-l;a=Math.max(a,l),i=Math.max(i,h),r[o]=[];for(let e=0;e<l;e++)r[o][e]=255&t.buffer[e+n];n+=l;const c=se.getErrorCorrectPolynomial(h),u=new Qt(r[o],c.length-1).mod(c);s[o]=new Array(c.length-1);for(let t=0;t<s[o].length;t++){const e=t+u.length-s[o].length;s[o][t]=e>=0?u.getAt(e):0}}let o=0;for(let t=0;t<e.length;t++)o+=e[t].totalCount;const l=new Array(o);let h=0;for(let t=0;t<a;t++)for(let s=0;s<e.length;s++)t<r[s].length&&(l[h++]=r[s][t]);for(let t=0;t<i;t++)for(let r=0;r<e.length;r++)t<s[r].length&&(l[h++]=s[r][t]);return l}isDark(t,e){const{moduleCount:r}=this;if(t<0||r<=t||e<0||r<=e)throw new Error(`${t}, ${e}`);return this.modules[t][e]}addData(t){this.dataList.push(new Kt(t)),this.dataCache=null}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}}function ae(t){const{code:e,typeNumber:r,correctLevel:s,size:n,codeColor:a,backgroundColor:i}=function(t){const e=t.typeNumber??4,r=t.correctLevel??"H",s=t.codeColor??"#000000",n=t.backgroundColor??"#FFFFFF";return{code:t.code,size:t.size,typeNumber:e,correctLevel:r,codeColor:s,backgroundColor:n}}(t);let o;try{o=new ne(r,s),o.addData(e),o.make()}catch(t){if(r>=40)throw new Error("Text too long to encode");return arguments.callee({code:e,size:n,correctLevel:s,typeNumber:r+1,codeColor:a,backgroundColor:i})}const l=o.getModuleCount(),{padding:h,cellSize:c}=((t,e)=>{const r=~~(e/t);return{padding:~~((e-t*r)/2),cellSize:r||2}})(l,n),u=l*c+h,f=+`${a.replace("#","0x")}FF`,d=+`${i.replace("#","0x")}FF`,m=new Ht(n,n);for(let t=0;t<n;t++)for(let e=0;e<n;e++)if(h<=e&&e<u&&h<=t&&t<u){const r=~~((e-h)/c),s=~~((t-h)/c);m.setPixel(e,t,o.isDark(s,r)?f:d)}else m.setPixel(e,t,d);return m.flush()}function ie(t){const e=ae(t);return lt.decode.toDataURL(e)}function oe(t){const{width:e,height:r,data:s}=t;return new Ht(e,r).write(s).flush()}function le(t){const e=oe(t);return lt.decode.toDataURL(e)}class he{point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];parser=new Et;get length(){return this.buckets.length}updateRemainPoints(){this.point<Math.ceil(this.maxRemain/2)?(this.remainStart=0,this.remainEnd=this.maxRemain):this.length-this.point<Math.floor(this.maxRemain/2)?(this.remainStart=this.remainEnd-this.maxRemain,this.remainEnd=this.length):(this.remainStart=Math.floor(this.point-this.maxRemain/2),this.remainEnd=this.remainStart+this.maxRemain)}updateBucketOperators(t){const{remainStart:e,remainEnd:r}=this;return this.point=t,this.updateRemainPoints(),e===r?[{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>r||this.remainEnd<e?[{action:"remove",start:e,end:r},{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>e&&this.remainEnd>r?[{action:"remove",start:e,end:this.remainStart},{action:"add",start:r,end:this.remainEnd}]:this.remainStart<e&&this.remainEnd<r?[{action:"remove",start:this.remainEnd,end:r},{action:"add",start:this.remainStart,end:e}]:[]}async getBucket(t){const{length:e,buckets:r,parser:s,loadMode:n}=this;if(t<0||t>=e)return r[t];const a=this.updateBucketOperators(t);if(a.length){const e=[];a.forEach((({action:a,start:i,end:o})=>{for(let l=i;l<o;l++){const i=r[l];"remove"===a?i.entity=null:"add"===a&&null===i.entity&&(i.promise=s.load(i.local||i.origin),"whole"!==n&&t!==l||e.push(i.promise))}})),await Promise.all(e)}return this.get()}async createBucket(t,e=!0,r=!0){const{parser:s}=this,{globals:n,path:a,local:i}=lt,{env:o}=n,l={origin:t,local:"",entity:null,promise:null};if("h5"===o||"tt"===o)return l.local=t,e&&(r?l.entity=await s.load(t):l.promise=s.load(t)),l;const h=a.resolve(a.filename(t),"full"),c=s.download(l.origin),u=async r=>{if(r){try{await i.write(r,h),l.local=h}catch(t){console.error(t)}if(e)return Et.parseVideo(r,t)}return null};return r?l.entity=await u(await c):l.promise=c.then(u),l}setLoadMode(t){this.loadMode=t}async prepare(t,e,r){let s=null;this.point="number"==typeof e&&e>0&&e<t.length?e:0,this.maxRemain="number"==typeof r&&r>0?r:3,this.updateRemainPoints(),"fast"===this.loadMode&&(s=await this.createBucket(t[this.point])),this.buckets=await Promise.all(t.map(((t,e)=>{if(s&&e===this.point)return s;const{loadMode:r,remainStart:n,remainEnd:a,point:i}=this;return this.createBucket(t,n<=e&&e<a,"whole"===r||e===i)})))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise,t.promise=null,t):null===t.entity?(t.entity=await this.parser.load(t.local||t.origin),t):t}go(t){return this.getBucket(t)}getPoint(){return this.point}clear(){const{globals:t,local:e}=lt,{env:r}=t,{buckets:s}=this;return this.buckets=[],this.point=this.remainStart=this.remainEnd=0,this.maxRemain=3,Promise.all(s.map((t=>"h5"!==r&&"tt"!==r?e.remove(t.local):t.local)))}}class ce{entity;options;constructor(t,e={}){this.entity=t,this.options=e}async set(t,e,r="R"){"A"===r?this.entity.dynamicElements[t]=await lt.image.load(e,this.entity.filename,`dynamic.${t}`):this.entity.images[t]=e}async createContext(t,e){if("h5"!==lt.globals.env||"OffscreenCanvas"in globalThis)return lt.getOfsCanvas({width:t,height:e});const{container:r,component:s}=this.options;if(r){const n=await lt.getCanvas(r,s);return n.context&&(n.canvas.width=t,n.canvas.height=e),n}throw new Error("Don't support OffscreenCanvas, and please provide a container")}async setCanvas(t,e,r){if(this.entity.locked)return;const{width:s,height:n}=e.canvas,a=oe(e.getImageData(0,0,s,n));await this.set(t,new Uint8Array(a),r?.mode)}async setImage(t,e,r){if(!this.entity.locked)if(e.startsWith("data:image"))await this.set(t,e,r?.mode);else{const s=await lt.remote.fetch(e);await this.set(t,new Uint8Array(s),r?.mode)}}async setQRCode(t,e,r){if(this.entity.locked)return;const s=ae({...r,code:e});await this.set(t,new Uint8Array(s),r?.mode)}}class ue{entity;frame=0;contentMode="fill";isConfigured=!1;painter;constructor(t,e){this.painter=new Ut("poster",t,e)}setConfig(t={},e){const r="string"==typeof t?{container:t}:t;return void 0===r.container&&(r.container=""),void 0!==r.contentMode&&(this.contentMode=r.contentMode),this.frame="number"==typeof r.frame?r.frame:0,this.isConfigured=!0,this.painter.register(r.container,"",e)}setContentMode(t){this.contentMode=t}setFrame(t){this.frame=t}async mount(t){if(!t)throw new Error("videoEntity undefined");this.isConfigured||(await this.painter.register("","",null),this.isConfigured=!0);const{images:e,filename:r}=t;return this.painter.clearContainer(),this.painter.clearMaterials(),this.painter.updateDynamicImages(t.dynamicElements),this.entity=t,this.painter.loadImages(e,r)}draw(){if(!this.entity)return;const{painter:t,entity:e,contentMode:r,frame:s}=this;t.resize(r,e.size),t.draw(e,s,0,e.sprites.length)}toDataURL(){return le(this.painter.getImageData())}destroy(){this.painter.destroy(),this.entity=void 0}}export{Ht as PNGEncoder,Et as Parser,Nt as Player,ue as Poster,ne as QRCode,Tt as SVGADecoder,ce as VideoEditor,he as VideoManager,ut as float,ae as generateImageBufferFromCode,ie as generateImageFromCode,oe as getBufferFromImageData,le as getDataURLFromImageData,lt as platform};
//# sourceMappingURL=index.js.map

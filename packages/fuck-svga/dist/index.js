var t=Uint8Array,e=Uint16Array,s=Int32Array,r=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),n=function(t,r){for(var i=new e(31),a=0;a<31;++a)i[a]=r+=1<<t[a-1];var n=new s(i[30]);for(a=1;a<30;++a)for(var o=i[a];o<i[a+1];++o)n[o]=o-i[a]<<5|a;return{b:i,r:n}},o=n(r,2),l=o.b,h=o.r;l[28]=258,h[258]=28;for(var c=n(i,0),u=c.b,f=c.r,d=new e(32768),m=0;m<32768;++m){var p=(43690&m)>>1|(21845&m)<<1;p=(61680&(p=(52428&p)>>2|(13107&p)<<2))>>4|(3855&p)<<4,d[m]=((65280&p)>>8|(255&p)<<8)>>1}var g=function(t,s,r){for(var i=t.length,a=0,n=new e(s);a<i;++a)t[a]&&++n[t[a]-1];var o,l=new e(s);for(a=1;a<s;++a)l[a]=l[a-1]+n[a-1]<<1;if(r){o=new e(1<<s);var h=15-s;for(a=0;a<i;++a)if(t[a])for(var c=a<<4|t[a],u=s-t[a],f=l[t[a]-1]++<<u,m=f|(1<<u)-1;f<=m;++f)o[d[f]>>h]=c}else for(o=new e(i),a=0;a<i;++a)t[a]&&(o[a]=d[l[t[a]-1]++]>>15-t[a]);return o},y=new t(288);for(m=0;m<144;++m)y[m]=8;for(m=144;m<256;++m)y[m]=9;for(m=256;m<280;++m)y[m]=7;for(m=280;m<288;++m)y[m]=8;var b=new t(32);for(m=0;m<32;++m)b[m]=5;var w=g(y,9,0),v=g(y,9,1),k=g(b,5,0),x=g(b,5,1),C=function(t){for(var e=t[0],s=1;s<t.length;++s)t[s]>e&&(e=t[s]);return e},T=function(t,e,s){var r=e/8|0;return(t[r]|t[r+1]<<8)>>(7&e)&s},I=function(t,e){var s=e/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(7&e)},E=function(t){return(t+7)/8|0},D=function(e,s,r){return(null==r||r>e.length)&&(r=e.length),new t(e.subarray(s,r))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],P=function(t,e,s){var r=new Error(e||M[t]);if(r.code=t,Error.captureStackTrace&&Error.captureStackTrace(r,P),!s)throw r;return r},A=function(t,e,s){s<<=7&e;var r=e/8|0;t[r]|=s,t[r+1]|=s>>8},S=function(t,e,s){s<<=7&e;var r=e/8|0;t[r]|=s,t[r+1]|=s>>8,t[r+2]|=s>>16},R=function(s,r){for(var i=[],a=0;a<s.length;++a)s[a]&&i.push({s:a,f:s[a]});var n=i.length,o=i.slice();if(!n)return{t:$,l:0};if(1==n){var l=new t(i[0].s+1);return l[i[0].s]=1,{t:l,l:1}}i.sort((function(t,e){return t.f-e.f})),i.push({s:-1,f:25001});var h=i[0],c=i[1],u=0,f=1,d=2;for(i[0]={s:-1,f:h.f+c.f,l:h,r:c};f!=n-1;)h=i[i[u].f<i[d].f?u++:d++],c=i[u!=f&&i[u].f<i[d].f?u++:d++],i[f++]={s:-1,f:h.f+c.f,l:h,r:c};var m=o[0].s;for(a=1;a<n;++a)o[a].s>m&&(m=o[a].s);var p=new e(m+1),g=B(i[f-1],p,0);if(g>r){a=0;var y=0,b=g-r,w=1<<b;for(o.sort((function(t,e){return p[e.s]-p[t.s]||t.f-e.f}));a<n;++a){var v=o[a].s;if(!(p[v]>r))break;y+=w-(1<<g-p[v]),p[v]=r}for(y>>=b;y>0;){var k=o[a].s;p[k]<r?y-=1<<r-p[k]++-1:++a}for(;a>=0&&y;--a){var x=o[a].s;p[x]==r&&(--p[x],++y)}g=r}return{t:new t(p),l:g}},B=function(t,e,s){return-1==t.s?Math.max(B(t.l,e,s+1),B(t.r,e,s+1)):e[t.s]=s},F=function(t){for(var s=t.length;s&&!t[--s];);for(var r=new e(++s),i=0,a=t[0],n=1,o=function(t){r[i++]=t},l=1;l<=s;++l)if(t[l]==a&&l!=s)++n;else{if(!a&&n>2){for(;n>138;n-=138)o(32754);n>2&&(o(n>10?n-11<<5|28690:n-3<<5|12305),n=0)}else if(n>3){for(o(a),--n;n>6;n-=6)o(8304);n>2&&(o(n-3<<5|8208),n=0)}for(;n--;)o(a);n=1,a=t[l]}return{c:r.subarray(0,i),n:s}},U=function(t,e){for(var s=0,r=0;r<e.length;++r)s+=t[r]*e[r];return s},O=function(t,e,s){var r=s.length,i=E(e+2);t[i]=255&r,t[i+1]=r>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<r;++a)t[i+a+4]=s[a];return 8*(i+4+r)},L=function(t,s,n,o,l,h,c,u,f,d,m){A(s,m++,n),++l[256];for(var p=R(l,15),v=p.t,x=p.l,C=R(h,15),T=C.t,I=C.l,E=F(v),D=E.c,M=E.n,P=F(T),B=P.c,L=P.n,N=new e(19),$=0;$<D.length;++$)++N[31&D[$]];for($=0;$<B.length;++$)++N[31&B[$]];for(var H=R(N,7),W=H.t,z=H.l,Y=19;Y>4&&!W[a[Y-1]];--Y);var X,_,K,V,J=d+5<<3,q=U(l,y)+U(h,b)+c,j=U(l,v)+U(h,T)+c+14+3*Y+U(N,W)+2*N[16]+3*N[17]+7*N[18];if(f>=0&&J<=q&&J<=j)return O(s,m,t.subarray(f,f+d));if(A(s,m,1+(j<q)),m+=2,j<q){X=g(v,x,0),_=v,K=g(T,I,0),V=T;var Q=g(W,z,0);A(s,m,M-257),A(s,m+5,L-1),A(s,m+10,Y-4),m+=14;for($=0;$<Y;++$)A(s,m+3*$,W[a[$]]);m+=3*Y;for(var G=[D,B],Z=0;Z<2;++Z){var tt=G[Z];for($=0;$<tt.length;++$){var et=31&tt[$];A(s,m,Q[et]),m+=W[et],et>15&&(A(s,m,tt[$]>>5&127),m+=tt[$]>>12)}}}else X=w,_=y,K=k,V=b;for($=0;$<u;++$){var st=o[$];if(st>255){S(s,m,X[(et=st>>18&31)+257]),m+=_[et+257],et>7&&(A(s,m,st>>23&31),m+=r[et]);var rt=31&st;S(s,m,K[rt]),m+=V[rt],rt>3&&(S(s,m,st>>5&8191),m+=i[rt])}else S(s,m,X[st]),m+=_[st]}return S(s,m,X[256]),m+_[256]},N=new s([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),$=new t(0),H=function(){var t=1,e=0;return{p:function(s){for(var r=t,i=e,a=0|s.length,n=0;n!=a;){for(var o=Math.min(n+2655,a);n<o;++n)i+=r+=s[n];r=(65535&r)+15*(r>>16),i=(65535&i)+15*(i>>16)}t=r,e=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},W=function(a,n,o,l,c){if(!c&&(c={l:1},n.dictionary)){var u=n.dictionary.subarray(-32768),d=new t(u.length+a.length);d.set(u),d.set(a,u.length),a=d,c.w=u.length}return function(a,n,o,l,c,u){var d=u.z||a.length,m=new t(l+d+5*(1+Math.ceil(d/7e3))+c),p=m.subarray(l,m.length-c),g=u.l,y=7&(u.r||0);if(n){y&&(p[0]=u.r>>3);for(var b=N[n-1],w=b>>13,v=8191&b,k=(1<<o)-1,x=u.p||new e(32768),C=u.h||new e(k+1),T=Math.ceil(o/3),I=2*T,M=function(t){return(a[t]^a[t+1]<<T^a[t+2]<<I)&k},P=new s(25e3),A=new e(288),S=new e(32),R=0,B=0,F=u.i||0,U=0,$=u.w||0,H=0;F+2<d;++F){var W=M(F),z=32767&F,Y=C[W];if(x[z]=Y,C[W]=z,$<=F){var X=d-F;if((R>7e3||U>24576)&&(X>423||!g)){y=L(a,p,0,P,A,S,B,U,H,F-H,y),U=R=B=0,H=F;for(var _=0;_<286;++_)A[_]=0;for(_=0;_<30;++_)S[_]=0}var K=2,V=0,J=v,q=z-Y&32767;if(X>2&&W==M(F-q))for(var j=Math.min(w,X)-1,Q=Math.min(32767,F),G=Math.min(258,X);q<=Q&&--J&&z!=Y;){if(a[F+K]==a[F+K-q]){for(var Z=0;Z<G&&a[F+Z]==a[F+Z-q];++Z);if(Z>K){if(K=Z,V=q,Z>j)break;var tt=Math.min(q,Z-2),et=0;for(_=0;_<tt;++_){var st=F-q+_&32767,rt=st-x[st]&32767;rt>et&&(et=rt,Y=st)}}}q+=(z=Y)-(Y=x[z])&32767}if(V){P[U++]=268435456|h[K]<<18|f[V];var it=31&h[K],at=31&f[V];B+=r[it]+i[at],++A[257+it],++S[at],$=F+K,++R}else P[U++]=a[F],++A[a[F]]}}for(F=Math.max(F,$);F<d;++F)P[U++]=a[F],++A[a[F]];y=L(a,p,g,P,A,S,B,U,H,F-H,y),g||(u.r=7&y|p[y/8|0]<<3,y-=7,u.h=C,u.p=x,u.i=F,u.w=$)}else{for(F=u.w||0;F<d+g;F+=65535){var nt=F+65535;nt>=d&&(p[y/8|0]=g,nt=d),y=O(p,y+1,a.subarray(F,nt))}u.i=d}return D(m,0,l+E(y)+c)}(a,null==n.level?6:n.level,null==n.mem?c.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):20:12+n.mem,o,l,c)},z=function(t,e,s){for(;s;++e)t[e]=s,s>>>=8};function Y(t,e){e||(e={});var s=H();s.p(t);var r=W(t,e,e.dictionary?6:2,4);return function(t,e){var s=e.level,r=0==s?0:s<6?1:9==s?3:2;if(t[0]=120,t[1]=r<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var i=H();i.p(e.dictionary),z(t,2,i.d())}}(r,e),z(r,r.length-4,s.d()),r}function X(e,s){return function(e,s,n,o){var h=e.length;if(!h||s.f&&!s.l)return n||new t(0);var c=!n,f=c||2!=s.i,d=s.i;c&&(n=new t(3*h));var m=function(e){var s=n.length;if(e>s){var r=new t(Math.max(2*s,e));r.set(n),n=r}},p=s.f||0,y=s.p||0,b=s.b||0,w=s.l,k=s.d,M=s.m,A=s.n,S=8*h;do{if(!w){p=T(e,y,1);var R=T(e,y+1,3);if(y+=3,!R){var B=e[(X=E(y)+4)-4]|e[X-3]<<8,F=X+B;if(F>h){d&&P(0);break}f&&m(b+B),n.set(e.subarray(X,F),b),s.b=b+=B,s.p=y=8*F,s.f=p;continue}if(1==R)w=v,k=x,M=9,A=5;else if(2==R){var U=T(e,y,31)+257,O=T(e,y+10,15)+4,L=U+T(e,y+5,31)+1;y+=14;for(var N=new t(L),$=new t(19),H=0;H<O;++H)$[a[H]]=T(e,y+3*H,7);y+=3*O;var W=C($),z=(1<<W)-1,Y=g($,W,1);for(H=0;H<L;){var X,_=Y[T(e,y,z)];if(y+=15&_,(X=_>>4)<16)N[H++]=X;else{var K=0,V=0;for(16==X?(V=3+T(e,y,3),y+=2,K=N[H-1]):17==X?(V=3+T(e,y,7),y+=3):18==X&&(V=11+T(e,y,127),y+=7);V--;)N[H++]=K}}var J=N.subarray(0,U),q=N.subarray(U);M=C(J),A=C(q),w=g(J,M,1),k=g(q,A,1)}else P(1);if(y>S){d&&P(0);break}}f&&m(b+131072);for(var j=(1<<M)-1,Q=(1<<A)-1,G=y;;G=y){var Z=(K=w[I(e,y)&j])>>4;if((y+=15&K)>S){d&&P(0);break}if(K||P(2),Z<256)n[b++]=Z;else{if(256==Z){G=y,w=null;break}var tt=Z-254;if(Z>264){var et=r[H=Z-257];tt=T(e,y,(1<<et)-1)+l[H],y+=et}var st=k[I(e,y)&Q],rt=st>>4;if(st||P(3),y+=15&st,q=u[rt],rt>3&&(et=i[rt],q+=I(e,y)&(1<<et)-1,y+=et),y>S){d&&P(0);break}f&&m(b+131072);var it=b+tt;if(b<q){var at=0-q,nt=Math.min(q,it);for(at+b<0&&P(3);b<nt;++b)n[b]=o[at+b]}for(;b<it;++b)n[b]=n[b-q]}}s.l=w,s.p=G,s.b=b,s.f=p,w&&(p=1,s.m=M,s.d=k,s.n=A)}while(!p);return b!=n.length&&c?D(n,0,b):n.subarray(0,b)}(e.subarray(((8!=(15&(n=e)[0])||n[0]>>4>7||(n[0]<<8|n[1])%31)&&P(6,"invalid zlib data"),1==(n[1]>>5&1)&&P(6,"invalid zlib data: "+(32&n[1]?"need":"unexpected")+" dictionary"),2+(n[1]>>3&4)),-4),{i:2},s,s);var n}var _="undefined"!=typeof TextDecoder&&new TextDecoder;try{_.decode($,{stream:!0})}catch(t){}var K={name:"path",install(){const{env:t,br:e}=this.global,s=t=>t.substring(t.lastIndexOf("/")+1);if("h5"===t)return{USER_DATA_PATH:"",filename:s,resolve:(t,e)=>""};const{USER_DATA_PATH:r}="tt"===t?tt.getEnvInfoSync().common:e.env;return{USER_DATA_PATH:r,filename:s,resolve:(t,e)=>`${r}/${e?`${e}.`:""}${t}`}}},V={name:"now",install(){const{env:t,br:e}=this.global,s="h5"===t?globalThis.performance:"tt"===t?e.performance:e.getPerformance();return"function"==typeof s?.now?(this.global.isPerf=!0,s.now()-Date.now()>0?()=>s.now()/1e3:()=>s.now()):()=>Date.now()}};function J(t,e,s){if(s>t.length)throw new RangeError("End exceeds buffer length");if(s-e<1)return"";const r=[];let i="";const a=String.fromCharCode;for(let n=e;n<s;){const e=t[n++];if(e<=127)i+=a(e),(i.length>=1024||n<s&&t[n]>127)&&(r.push(...i.split("").map((t=>t.charCodeAt(0)))),i="");else{let s;if(i.length>0&&(r.push(...i.split("").map((t=>t.charCodeAt(0)))),i=""),e>=192&&e<224)s=(31&e)<<6|63&t[n++];else{if(!(e>=224&&e<240)){s=((7&e)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536,r.push(55296+(s>>10),56320+(1023&s));continue}s=(15&e)<<12|(63&t[n++])<<6|63&t[n++]}r.push(s)}}return i.length>0&&r.push(...i.split("").map((t=>t.charCodeAt(0)))),String.fromCharCode(...r)}var q={name:"decode",install(){const{env:t,br:e}=this.global,s=t=>`data:image/png;base64,${t}`,r={toBuffer(t){const{buffer:e,byteOffset:s,byteLength:r}=t;return e.slice(s,s+r)}};if("h5"===t){const t=new TextDecoder;r.toBitmap=t=>globalThis.createImageBitmap(new Blob([r.toBuffer(t)])),r.toDataURL=t=>s(globalThis.btoa(String.fromCharCode(...t))),r.utf8=(e,s,r)=>t.decode(e.subarray(s,r))}else r.toDataURL=t=>s(e.arrayBufferToBase64(r.toBuffer(t))),r.utf8=J;return r}},j={name:"remote",install(){const{env:t,br:e}=this.global,s=t=>/^http(s)?:\/\//.test(t);return"h5"===t?{is:s,read:t=>fetch(t).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)}))}:{is:s,fetch:t=>new Promise(((s,r)=>{e.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:!0,success:t=>s(t.data),fail:r})}))}}};function Q(t,e,s,r){if(!t)throw new Error("canvas not found.");const i=t.getContext("2d");return t.width=e*r,t.height=s*r,{canvas:t,context:i}}var G={name:"getCanvas",install(){const{env:t,br:e,dpr:s}=this.global;return"h5"===t?t=>new Promise((e=>{const r=document.querySelector(t),{clientWidth:i,clientHeight:a}=r;e(Q(r,i,a,s))})):(t,r)=>new Promise((i=>{let a=e.createSelectorQuery();r&&(a=a.in(r)),a.select(t).fields({node:!0,size:!0},(t=>{const{node:e,width:r,height:a}=t||{};i(Q(e,r,a,s))})).exec()}))}},Z={name:"getOfsCanvas",install(){const{env:t}=this.global;let e;return e="h5"===t?t=>new OffscreenCanvas(t.width,t.height):"alipay"===t?t=>my.createOffscreenCanvas({width:t.width,height:t.height}):"tt"===t?t=>{const e=tt.createOffscreenCanvas();return e.width=t.width,e.height=t.height,e}:t=>wx.createOffscreenCanvas({...t,type:"2d"}),t=>{const s=e(t),r=s.getContext("2d");return{canvas:s,context:r}}}},et={name:"image",install(){const{local:t,path:e,decode:s}=this,{env:r,br:i}=this.global;function a(e,s){return new Promise(((r,i)=>{e.onload=()=>{/^(?:data:|http(s)?:\/\/)/.test(s)?r(e):t.remove(s).then((()=>r(e))).catch((()=>r(e)))},e.onerror=()=>i(new Error(`SVGA LOADING FAILURE: ${e.src}`)),e.src=s}))}if("h5"===r){const t=t=>new Image,e=t=>"string"==typeof t?t:s.toDataURL(t);return{isImage:t=>t instanceof Image,isImageBitmap:t=>t instanceof ImageBitmap,create:t,load:(r,i,n,o)=>i instanceof Uint8Array&&"createImageBitmap"in globalThis?s.toBitmap(i):i instanceof ImageBitmap?Promise.resolve(i):a(t(),e(i))}}const n=t=>t.createImage();return{isImage:t=>!(!t||void 0===t.src||void 0===t.width||void 0===t.height),isImageBitmap:t=>!1,create:n,load:async(o,l,h,c)=>{const u=await(async(a,n,o)=>{if("string"==typeof a)return a;if("tt"===r||"alipay"===r&&i.isIDE)return s.toDataURL(a);try{return t.write(s.toBuffer(a),e.resolve(n,o))}catch(t){return console.warn(`图片缓存失败：${t.message}`),s.toDataURL(a)}})(l,h,c);return a(n(o),u)}}}},st={name:"rAF",install(){const{env:t}=this.global;return"h5"===t?(t,e)=>globalThis.requestAnimationFrame(e):(t,e)=>t.requestAnimationFrame(e)}};const rt={time(t){console.time?.(t)},timeEnd(t){console.timeEnd?.(t)}};var it={count:20,label(t){console.log(t)},async time(t,e){rt.time(t);const s=await e();return rt.timeEnd(t),s},line(t=40){console.log("-".repeat(t))},log(...t){console.log("【benchmark】",...t)}},at={name:"local",install(){const{env:t,fsm:e}=this.global;return"h5"!==t?{write:(t,s)=>(it.log(`write file: ${s}`),new Promise(((r,i)=>{e.access({path:s,success(){r(s)},fail(){e.writeFile({filePath:s,data:t,success(){r(s)},fail(t){it.log(`write fail: ${s}`,t),i(t)}})}})}))),read:t=>new Promise(((s,r)=>{e.access({path:t,success(){e.readFile({filePath:t,success:t=>s(t.data),fail:r})},fail:r})})),remove:t=>new Promise((s=>{e.access({path:t,success(){it.log(`remove file: ${t}`),e.unlink({filePath:t,success:()=>s(t),fail(e){it.log(`remove fail: ${t}`,e),s(t)}})},fail(e){it.log(`access fail: ${t}`,e),s(t)}})}))}:null}};const nt=()=>{};const ot=new class{plugins=[K,V,q,at,j,st,G,Z,et];global={env:"unknown",br:null,fsm:null,dpr:1,isPerf:!1,sys:"UNKNOWN"};noop=nt;now=nt;path={};local={};remote={};decode={};image={};rAF=nt;getCanvas=nt;getOfsCanvas=nt;constructor(){this.global.env=this.autoEnv(),this.init()}init(){this.global.br=this.useBridge(),this.global.dpr=this.usePixelRatio(),this.global.fsm=this.useFileSystemManager(),this.global.sys=this.useSystem().toLocaleLowerCase(),this.usePlugins()}autoEnv(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported app")}useBridge(){switch(this.global.env){case"h5":return globalThis;case"alipay":return my;case"tt":return tt;case"weapp":return wx}return{}}usePixelRatio(){const{env:t,br:e}=this.global;return"h5"===t?globalThis.devicePixelRatio:"getWindowInfo"in e?e.getWindowInfo().pixelRatio:"getSystemInfoSync"in e?e.getSystemInfoSync().pixelRatio:1}useFileSystemManager(){const{br:t}=this.global;return"getFileSystemManager"in t?t.getFileSystemManager():null}useSystem(){const{env:t,br:e}=this.global;if("h5"===t){const t=navigator.userAgent;if(/(Android)/i.test(t))return"Android";if(/(iPhone|iPad|iPod|iOS)/i.test(t))return"iOS";if(/(OpenHarmony|ArkWeb)/i.test(t))return"OpenHarmony"}else{if("alipay"===t)return e.getDeviceBaseInfo().platform;if("tt"===t)return e.getDeviceInfoSync().platform;if("weapp"===t)return e.getDeviceInfo().platform}return"UNKNOWN"}usePlugins(){this.plugins.forEach((t=>{const e=t.install.call(this);void 0!==e&&Reflect.set(this,t.name,e)}))}switch(t){this.global.env=t,this.init()}},lt=new DataView(new ArrayBuffer(4));var ht={readFloatLE:(t,e)=>(new Uint8Array(lt.buffer).set(t.subarray(e,e+4)),lt.getFloat32(0,!0))};class ct{static create(t){if(t instanceof ct)return t;if(t instanceof Uint8Array)return new ct(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}slice(t,e,s){return t.subarray(e,s)}indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}uint32(){let t=4294967295;if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,this.indexOutOfRange(this,10);return t}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=ht.readFloatLE(this.buf,this.pos);return this.pos+=4,t}bytes(){const t=this.uint32(),e=this.pos,s=this.pos+t;if(s>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,e==s?new Uint8Array(0):this.slice(this.buf,e,s)}string(){const t=this.bytes();return ot.decode.utf8(t,0,t.length)}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw this.indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class ut{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new ut;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.x=t.float();break;case 2:r.y=t.float();break;case 3:r.width=t.float();break;case 4:r.height=t.float();break;default:t.skipType(7&e)}}return r}x=0;y=0;width=0;height=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height))}}class ft{static decode(t,e){t=ct.create(t);let s=null==e?t.len:t.pos+e,r=new ft;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:r.a=t.float();break;case 2:r.b=t.float();break;case 3:r.c=t.float();break;case 4:r.d=t.float();break;case 5:r.tx=t.float();break;case 6:r.ty=t.float();break;default:t.skipType(7&e)}}return r}a=0;b=0;c=0;d=0;tx=0;ty=0;constructor(t){t&&(null!=t.a&&(this.a=t.a),null!=t.b&&(this.b=t.b),null!=t.c&&(this.c=t.c),null!=t.d&&(this.d=t.d),null!=t.tx&&(this.tx=t.tx),null!=t.ty&&(this.ty=t.ty))}}class dt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new dt;for(;t.pos<s;){const e=t.uint32();if(e>>>3==1)r.d=t.string();else t.skipType(7&e)}return r}d="";constructor(t){t&&null!=t.d&&(this.d=t.d)}}class mt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new mt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.x=t.float();break;case 2:r.y=t.float();break;case 3:r.width=t.float();break;case 4:r.height=t.float();break;case 5:r.cornerRadius=t.float();break;default:t.skipType(7&e)}}return r}x=0;y=0;width=0;height=0;cornerRadius=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.cornerRadius&&(this.cornerRadius=t.cornerRadius))}}class pt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new pt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.x=t.float();break;case 2:r.y=t.float();break;case 3:r.radiusX=t.float();break;case 4:r.radiusY=t.float();break;default:t.skipType(7&e)}}return r}x=0;y=0;radiusX=0;radiusY=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.radiusX&&(this.radiusX=t.radiusX),null!=t.radiusY&&(this.radiusY=t.radiusY))}}class gt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new gt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.r=t.float();break;case 2:r.g=t.float();break;case 3:r.b=t.float();break;case 4:r.a=t.float();break;default:t.skipType(7&e)}}return r}r=0;g=0;b=0;a=0;constructor(t){t&&(null!=t.r&&(this.r=t.r),null!=t.g&&(this.g=t.g),null!=t.b&&(this.b=t.b),null!=t.a&&(this.a=t.a))}}class yt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new yt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.fill=gt.decode(t,t.uint32());break;case 2:r.stroke=gt.decode(t,t.uint32());break;case 3:r.strokeWidth=t.float();break;case 4:r.lineCap=t.int32();break;case 5:r.lineJoin=t.int32();break;case 6:r.miterLimit=t.float();break;case 7:r.lineDashI=t.float();break;case 8:r.lineDashII=t.float();break;case 9:r.lineDashIII=t.float();break;default:t.skipType(7&e)}}return r}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0;constructor(t){t&&(null!=t.fill&&(this.fill=t.fill),null!=t.lineCap&&(this.lineCap=t.lineCap),null!=t.lineDashI&&(this.lineDashI=t.lineDashI),null!=t.lineDashII&&(this.lineDashII=t.lineDashII),null!=t.lineDashIII&&(this.lineDashIII=t.lineDashIII),null!=t.lineJoin&&(this.lineJoin=t.lineJoin),null!=t.miterLimit&&(this.miterLimit=t.miterLimit),null!=t.stroke&&(this.stroke=t.stroke),null!=t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}}class bt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new bt;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:r.type=t.int32();break;case 2:r.shape=dt.decode(t,t.uint32());break;case 3:r.rect=mt.decode(t,t.uint32());break;case 4:r.ellipse=pt.decode(t,t.uint32());break;case 10:r.styles=yt.decode(t,t.uint32());break;case 11:r.transform=ft.decode(t,t.uint32());break;default:t.skipType(7&e)}}return r}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null;$oneOfFields=["shape","rect","ellipse"];$fieldMap={};get args(){const t=Object.keys(this);for(let e=t.length-1;e>-1;--e){const s=t[e],r=this[s];if(1==this.$fieldMap[s]&&null!=r)return s}return""}set args(t){for(var e=0;e<this.$oneOfFields.length;++e){const s=this.$oneOfFields[e];s!=t&&delete this[s]}}constructor(t){t&&(null!=t.type&&(this.type=t.type),null!=t.ellipse&&(this.ellipse=t.ellipse),null!=t.rect&&(this.rect=t.rect),null!=t.shape&&(this.shape=t.shape),null!=t.styles&&(this.styles=t.styles),null!=t.transform&&(this.transform=t.transform));for(var e=0;e<this.$oneOfFields.length;++e)this.$fieldMap[this.$oneOfFields[e]]=1}}class wt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new wt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.alpha=t.float();break;case 2:r.layout=ut.decode(t,t.uint32());break;case 3:r.transform=ft.decode(t,t.uint32());break;case 4:r.clipPath=t.string();break;case 5:r.shapes&&r.shapes.length||(r.shapes=[]),r.shapes.push(bt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return r}shapes=[];alpha=0;layout=null;transform=null;clipPath="";constructor(t){t&&(null!=t.alpha&&(this.alpha=t.alpha),null!=t.clipPath&&(this.clipPath=t.clipPath),null!=t.layout&&(this.layout=t.layout),null!=t.shapes&&(this.shapes=t.shapes),null!=t.transform&&(this.transform=t.transform))}}class vt{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new vt;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.imageKey=t.string();break;case 2:r.frames&&r.frames.length||(r.frames=[]),r.frames.push(wt.decode(t,t.uint32()));break;case 3:r.matteKey=t.string();break;default:t.skipType(7&e)}}return r}frames=[];imageKey="";matteKey="";constructor(t){t&&(null!=t.frames&&(this.frames=t.frames),null!=t.imageKey&&(this.imageKey=t.imageKey),null!=t.matteKey&&(this.matteKey=t.matteKey))}}class kt{static decode(t,e){t=ct.create(t);let s=null==e?t.len:t.pos+e,r=new kt;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:r.viewBoxWidth=t.float();break;case 2:r.viewBoxHeight=t.float();break;case 3:r.fps=t.int32();break;case 4:r.frames=t.int32();break;default:t.skipType(7&e)}}return r}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0;constructor(t){t&&(null!=t.viewBoxWidth&&(this.viewBoxWidth=t.viewBoxWidth),null!=t.viewBoxHeight&&(this.viewBoxHeight=t.viewBoxHeight),null!=t.fps&&(this.fps=t.fps),null!=t.frames&&(this.frames=t.frames))}}const xt=Object.freeze({});class Ct{static decode(t,e){t=ct.create(t);const s=null==e?t.len:t.pos+e,r=new Ct;let i,a;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:r.version=t.string();break;case 2:r.params=kt.decode(t,t.uint32());break;case 3:{r.images==xt&&(r.images={});const e=t.uint32()+t.pos;for(i="",a=[];t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:i=t.string();break;case 2:a=t.bytes();break;default:t.skipType(7&e)}}r.images[i]=a;break}case 4:r.sprites&&r.sprites.length||(r.sprites=[]),r.sprites.push(vt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return r}version="";params=null;images=xt;sprites=[];constructor(t){t&&(null!=t.version&&(this.version=t.version),null!=t.images&&(this.images=t.images),null!=t.params&&(this.params=t.params),null!=t.sprites&&(this.sprites=t.sprites))}}class Tt{version;filename;size={width:0,height:0};fps=20;frames=0;images={};replaceElements={};dynamicElements={};sprites=[];constructor(t,e){const{viewBoxWidth:s,viewBoxHeight:r,fps:i,frames:a}=t.params;this.version=t.version,this.filename=e,this.size.width=s,this.size.height=r,this.fps=i,this.frames=a,this.images=t.images||{},this.sprites=this.formatSprites(t.sprites||[])}formatSprites(t){return t.map((t=>({imageKey:t.imageKey,frames:this.formatFrames(t.frames||[])})))}formatFrames(t){let e;return t.map((t=>{const{layout:s,transform:r,alpha:i}=t,a={x:s?.x+.5|0,y:s?.y+.5|0,width:s?.width+.5|0,height:s?.height+.5|0},n={a:r?.a??1,b:r?.b??0,c:r?.c??0,d:r?.d??1,tx:r?.tx??0,ty:r?.ty??0};let o=this.formatShapes(t.shapes||[]);3===t.shapes[0]?.type&&e?o=e:e=o;const l=n.a*a.x+n.c*a.y+n.tx,h=n.a*(a.x+a.width)+n.c*a.y+n.tx,c=n.a*a.x+n.c*(a.y+a.height)+n.tx,u=n.a*(a.x+a.width)+n.c*(a.y+a.height)+n.tx,f=n.b*a.x+n.d*a.y+n.ty,d=n.b*(a.x+a.width)+n.d*a.y+n.ty,m=n.b*a.x+n.d*(a.y+a.height)+n.ty,p=n.b*(a.x+a.width)+n.d*(a.y+a.height)+n.ty,g=Math.min(c,u,l,h)+.5|0,y=Math.min(m,p,f,d)+.5|0,b=t.clipPath??"";return{alpha:i??0,layout:a,transform:n,clipPath:b,shapes:o,nx:g,ny:y,maskPath:b.length>0?{d:b,transform:void 0,styles:{fill:"rgba(0, 0, 0, 0)",stroke:null,strokeWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null}}:null}}))}formatShapes(t){const e=[];for(let s of t){const t=s.styles;if(null==t)continue;const r=[],{lineDashI:i,lineDashII:a,lineDashIII:n}=t;i>0&&r.push(i),a>0&&(r.length<1&&r.push(0),r.push(a)),n>0&&(r.length<2&&(r.push(0),r.push(0)),r[2]=n);let o=null;switch(t.lineCap){case 0:o="butt";break;case 1:o="round";break;case 2:o="square"}let l=null;switch(t.lineJoin){case 2:l="bevel";break;case 1:l="round";break;case 0:l="miter"}const{fill:h,stroke:c}=t;let u=null;h&&(u=`rgba(${255*h.r|0}, ${255*h.g|0}, ${255*h.b|0}, ${1*h.a|0})`);let f=null;c&&(f=`rgba(${255*c.r|0}, ${255*c.g|0}, ${255*c.b|0}, ${1*c.a|0})`);const d={lineDash:r,fill:u,stroke:f,lineCap:o,lineJoin:l,strokeWidth:t.strokeWidth,miterLimit:t.miterLimit},{transform:m,shape:p,rect:g,ellipse:y}=s,b={a:m?.a??1,b:m?.b??0,c:m?.c??0,d:m?.d??1,tx:m?.tx??0,ty:m?.ty??0};0===s.type&&p?e.push({type:"shape",path:p,styles:d,transform:b}):1===s.type&&g?e.push({type:"rect",path:g,styles:d,transform:b}):2===s.type&&y&&e.push({type:"ellipse",path:y,styles:d,transform:b})}return e}}class It{static parseVideo(t,e){const s=new Uint8Array(t,0,4),r=new Uint8Array(t);if("80,75,3,4"===s.toString())throw new Error("this parser only support version@2 of SVGA.");let i;return it.time("unzlibSync",(()=>{const t=X(r),s=Ct.decode(t);i=new Tt(s,ot.path.filename(e))})),i}download(t){const{remote:e,local:s,global:r}=ot;return e.is(t)?e.fetch(t):"h5"!==r.env?s.read(t):Promise.resolve(null)}async load(t){const e=await this.download(t);return it.label(t),it.line(),It.parseVideo(e,t)}}function Et(t,e,s,r,i,a,n){const o=e.frames[s];if(!(o.alpha<.05)){t.save(),n&&t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),t.globalAlpha=o.alpha,t.transform(o.transform?.a??1,o.transform?.b??0,o.transform?.c??0,o.transform?.d??1,o.transform?.tx??0,o.transform?.ty??0),r&&(o.maskPath&&(Pt(t,o.maskPath.d,o.maskPath.transform,o.maskPath.styles),t.clip()),t.drawImage(i||r,0,0,o.layout.width,o.layout.height)),a&&t.drawImage(a,(o.layout.width-a.width)/2,(o.layout.height-a.height)/2);for(let e=0;e<o.shapes.length;e++)Dt(t,o.shapes[e]);t.restore()}}function Dt(t,e){switch(e.type){case"shape":Pt(t,e.path.d,e.transform,e.styles);break;case"ellipse":!function(t,e,s,r,i,a,n){t.save(),Mt(t,n),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty);e-=r;const o=2*r,l=2*i,h=.5522848,c=o/2*h,u=l/2*h,f=e+o,d=(s-=i)+l,m=e+o/2,p=s+l/2;t.beginPath(),t.moveTo(e,p),t.bezierCurveTo(e,p-u,m-c,s,m,s),t.bezierCurveTo(m+c,s,f,p-u,f,p),t.bezierCurveTo(f,p+u,m+c,d,m,d),t.bezierCurveTo(m-c,d,e,p+u,e,p),n.fill&&t.fill();n.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.radiusX??0,e.path.radiusY??0,e.transform,e.styles);break;case"rect":!function(t,e,s,r,i,a,n,o){t.save(),Mt(t,o),n&&t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty);let l=a;r<2*l&&(l=r/2);i<2*l&&(l=i/2);t.beginPath(),t.moveTo(e+l,s),t.arcTo(e+r,s,e+r,s+i,l),t.arcTo(e+r,s+i,e,s+i,l),t.arcTo(e,s+i,e,s,l),t.arcTo(e,s,e+r,s,l),t.closePath(),o.fill&&t.fill();o.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.width??0,e.path.height??0,e.path.cornerRadius??0,e.transform,e.styles)}}function Mt(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}function Pt(t,e,s,r){t.save(),Mt(t,r),s&&t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty);const i={x:0,y:0,x1:0,y1:0,x2:0,y2:0};if(t.beginPath(),e){const s=e.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ").split("|||");for(let e=0;e<s.length;e++){const r=s[e];if(0===r.length)continue;const a=r.substring(0,1);"MLHVCSQZmlhvcsqz".includes(a)&&At(t,i,a,r.substring(1).trim().split(" "))}}r.fill&&t.fill(),r.stroke&&t.stroke(),t.restore()}function At(t,e,s,r){switch(s){case"M":e.x=+r[0],e.y=+r[1],t.moveTo(e.x,e.y);break;case"m":e.x+=+r[0],e.y+=+r[1],t.moveTo(e.x,e.y);break;case"L":e.x=+r[0],e.y=+r[1],t.lineTo(e.x,e.y);break;case"l":e.x+=+r[0],e.y+=+r[1],t.lineTo(e.x,e.y);break;case"H":e.x=+r[0],t.lineTo(e.x,e.y);break;case"h":e.x+=+r[0],t.lineTo(e.x,e.y);break;case"V":e.y=+r[0],t.lineTo(e.x,e.y);break;case"v":e.y+=+r[0],t.lineTo(e.x,e.y);break;case"C":e.x1=+r[0],e.y1=+r[1],e.x2=+r[2],e.y2=+r[3],e.x=+r[4],e.y=+r[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"c":e.x1=e.x+ +r[0],e.y1=e.y+ +r[1],e.x2=e.x+ +r[2],e.y2=e.y+ +r[3],e.x+=+r[4],e.y+=+r[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"S":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=+r[0],e.y2=+r[1],e.x=+r[2],e.y=+r[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=+r[0],e.y1=+r[1],e.x=+r[2],e.y=+r[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"s":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=e.x+ +r[0],e.y2=e.y+ +r[1],e.x+=+r[2],e.y+=+r[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=e.x+ +r[0],e.y1=e.y+ +r[1],e.x+=+r[2],e.y+=+r[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"Q":e.x1=+r[0],e.y1=+r[1],e.x=+r[2],e.y=+r[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"q":e.x1=e.x+ +r[0],e.y1=e.y+ +r[1],e.x+=+r[2],e.y+=+r[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"Z":case"z":t.closePath()}}const St=new Uint32Array(256);for(let t=0;t<256;t++){let e,s=t;for(let t=0;t<8;t++)e=-(1&s),s=s>>>1^3988292384&e;St[t]=s}class Rt{width;height;view;pngData=new Uint8Array(0);constructor(t,e){this.width=t,this.height=e;const s=new ArrayBuffer(4*t*e);this.view=new DataView(s)}createChunk(t,e){const s=new Uint8Array(4);new DataView(s.buffer).setUint32(0,e.length,!1);const r=new Uint8Array([t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]),i=new Uint8Array([...r,...e]),a=function(t){const{length:e}=t;let s=4294967295;for(let r=0;r<e;r++)s=St[255&(s^t[r])]^s>>>8;return 4294967295^s}(i),n=new Uint8Array(4);return new DataView(n.buffer).setUint32(0,a>>>0,!1),new Uint8Array([...s,...i,...n])}createIHDRChunk(){const t=new Uint8Array(13),e=new DataView(t.buffer);return e.setUint32(0,this.width,!1),e.setUint32(4,this.height,!1),e.setUint8(8,8),e.setUint8(9,6),e.setUint8(10,0),e.setUint8(11,0),e.setUint8(12,0),this.createChunk("IHDR",t)}createIDATChunk(){const{width:t,height:e,view:s}=this,r=4*t+1,i=new Uint8Array(r*e),a=new Uint8Array(s.buffer);for(let s=0;s<e;s++){const e=s*r;i[e]=0;const n=s*t*4,o=n+4*t;i.set(a.subarray(n,o),e+1)}return this.createChunk("IDAT",Y(i))}createIENDChunk(){return this.createChunk("IEND",new Uint8Array(0))}setPixel(t,e,s){this.view.setUint32(4*(e*this.width+t),s,!1)}write(t){const{width:e,height:s}=this;for(let r=0;r<s;r++)for(let s=0;s<e;s++){const i=4*(r*e+s),a=(t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3])>>>0;this.setPixel(s,r,a)}}flush(){const t=new Uint8Array([137,80,78,71,13,10,26,10]),e=[this.createIHDRChunk(),this.createIDATChunk(),this.createIENDChunk()],s=e.reduce(((t,e)=>t+e.length),0);let r=8;this.pngData=new Uint8Array(r+s),this.pngData.set(t,0);for(const t of e)this.pngData.set(t,r),r+=t.length}toBuffer(){return this.pngData}}class Bt{buffer=[];lengthInBits=0;getAt(t){const e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let s=0;s<e;s++)this.putBit(1==(t>>>e-s-1&1))}putBit(t){const{lengthInBits:e,buffer:s}=this,r=~~(e/8);s.length<=r&&s.push(0),t&&(s[r]|=128>>>e%8),this.lengthInBits+=1}}const Ft={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Ut={L:1,M:0,Q:3,H:2},Ot={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};class Lt{bytes;constructor(t){let e=[];for(let s=0;s<t.length;s++){const r=[],i=t.charCodeAt(s);i>65536?(r[0]=240|(1835008&i)>>>18,r[1]=128|(258048&i)>>>12,r[2]=128|(4032&i)>>>6,r[3]=128|63&i):i>2048?(r[0]=224|(61440&i)>>>12,r[1]=128|(4032&i)>>>6,r[2]=128|63&i):i>128?(r[0]=192|(1984&i)>>>6,r[1]=128|63&i):r[0]=i,e.push(r)}this.bytes=e.flat(1);const{bytes:s}=this;s.length!=t.length&&(s.unshift(191),s.unshift(187),s.unshift(239))}get mode(){return Ft.MODE_8BIT_BYTE}get length(){return this.bytes.length}write(t){const{bytes:e}=this;for(let s=0;s<e.length;s++)t.put(e[s],8)}}const Nt=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class $t{getRSBlockTable(t,e){const{L:s,M:r,Q:i,H:a}=Ut,n=4*(t-1);switch(e){case s:return Nt[n+0];case r:return Nt[n+1];case i:return Nt[n+2];case a:return Nt[n+3];default:throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel: ${e}`)}}getRSBlocks(t,e){const s=this.getRSBlockTable(t,e),r=s.length/3,i=[];for(let t=0;t<r;t++){const e=s[3*t],r=s[3*t+1],a=s[3*t+2];for(let t=0;t<e;t++)i.push({totalCount:r,dataCount:a})}return i}}const Ht=new Array(256),Wt=new Array(256);for(let t=0;t<8;t++)Ht[t]=1<<t;for(let t=8;t<256;t++)Ht[t]=Ht[t-4]^Ht[t-5]^Ht[t-6]^Ht[t-8];for(let t=0;t<255;t++)Wt[Ht[t]]=t;const zt={glog(t){if(t<1)throw new Error(`glog(${t})`);return Wt[t]},gexp:t=>(t<0?t=255+t%255:t>255&&(t%=255),Ht[t])};class Yt{num;constructor(t,e){const{length:s}=t;if(void 0===s)throw new Error(`${s}/${e}`);let r=0;for(;r<s&&0==t[r];)r++;const i=s-r;this.num=new Array(i+e);for(let e=0;e<i;e++)this.num[e]=t[e+r]}get length(){return this.num.length}getAt(t){return this.num[t]}multiply(t){const{glog:e,gexp:s}=zt,r=[];for(let i=0;i<this.length;i++)for(let a=0;a<t.length;a++)r[i+a]^=s(e(this.getAt(i))+e(t.getAt(a)));return new Yt(r,0)}mod(t){if(this.length-t.length<0)return this;const{glog:e,gexp:s}=zt,r=e(this.getAt(0))-e(t.getAt(0)),i=[];for(var a=0;a<this.length;a++){const n=this.getAt(a);i[a]=a<t.length?n^s(e(t.getAt(a))+r):n}return new Yt(i,0).mod(t)}}const Xt=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],_t=t=>0==t?0:Math.log2(t),Kt=_t(1335),Vt=_t(7973),Jt={getBCHTypeInfo(t){let e=t<<10;for(;_t(e)-Kt>=0;)e^=1335<<_t(e)-Kt;return 21522^(t<<10|e)},getBCHTypeNumber(t){let e=t<<12;for(;_t(e)-Vt>=0;)e^=7973<<_t(e)-Vt;return t<<12|e},getPatternPosition:t=>Xt[t-1],getMaskFunction(t){const{PATTERN000:e,PATTERN001:s,PATTERN010:r,PATTERN011:i,PATTERN100:a,PATTERN101:n,PATTERN110:o,PATTERN111:l}=Ot;switch(t){case e:return(t,e)=>(t+e)%2==0;case s:return t=>t%2==0;case r:return(t,e)=>e%3==0;case i:return(t,e)=>(t+e)%3==0;case a:return(t,e)=>(~~(t/2)+~~(e/3))%2==0;case n:return(t,e)=>t*e%2+t*e%3==0;case o:return(t,e)=>(t*e%2+t*e%3)%2==0;case l:return(t,e)=>(t*e%3+(t+e)%2)%2==0;default:throw new Error(`bad maskPattern: ${t}`)}},getErrorCorrectPolynomial(t){let e=new Yt([1],0);for(let s=0;s<t;s++)e=e.multiply(new Yt([1,zt.gexp(s)],0));return e},getLengthInBits(t,e){const{MODE_NUMBER:s,MODE_ALPHA_NUM:r,MODE_8BIT_BYTE:i,MODE_KANJI:a}=Ft;if(e<1||e>40)throw new Error(`type: ${e}`);if(e>=1&&e<10)switch(t){case s:return 10;case r:return 9;case i:case a:return 8}if(e<27)switch(t){case s:return 12;case r:return 11;case i:return 16;case a:return 10}if(e<=40)switch(t){case s:return 14;case r:return 13;case i:return 16;case a:return 12}throw new Error(`mode: ${t}`)},getLostPoint(t){const e=t.getModuleCount();let s=0;for(let r=0;r<e;r++)for(let i=0;i<e;i++){const a=t.isDark(r,i);let n=0;for(let s=-1;s<=1;s++){const o=r+s;if(!(o<0||e<=o))for(let r=-1;r<=1;r++){const l=i+r;l<0||e<=l||(0==s&&0==r||a==t.isDark(o,l)&&n++)}}n>5&&(s+=n+3-5)}for(let r=0;r<e-1;r++)for(let i=0;i<e-1;i++){let e=0;t.isDark(r,i)&&e++,t.isDark(r+1,i)&&e++,t.isDark(r,i+1)&&e++,t.isDark(r+1,i+1)&&e++,0!=e&&4!=e||(s+=3)}for(let r=0;r<e;r++)for(let i=0;i<e-6;i++)t.isDark(r,i)&&!t.isDark(r,i+1)&&t.isDark(r,i+2)&&t.isDark(r,i+3)&&t.isDark(r,i+4)&&!t.isDark(r,i+5)&&t.isDark(r,i+6)&&(s+=40);for(let r=0;r<e;r++)for(let i=0;i<e-6;i++)t.isDark(i,r)&&!t.isDark(i+1,r)&&t.isDark(i+2,r)&&t.isDark(i+3,r)&&t.isDark(i+4,r)&&!t.isDark(i+5,r)&&t.isDark(i+6,r)&&(s+=40);let r=0;for(let s=0;s<e;s++)for(let i=0;i<e;i++)t.isDark(i,s)&&r++;return s+10*(Math.abs(100*r/Math.pow(e,2)-50)/5)}};class qt{typeNumber;errorCorrectLevel;modules=[];moduleCount=0;dataCache=null;dataList=[];constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=Ut[e]}makeImpl(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=(t=>{const e=[];for(let s=0;s<t;s++){e[s]=[];for(let r=0;r<t;r++)e[s][r]=null}return e})(this.moduleCount);const s=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(s,0),this.setupPositionProbePattern(0,s),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)}setupPositionProbePattern(t,e){const{modules:s,moduleCount:r}=this;for(let i=-1;i<=7;i++){const a=t+i;if(!(a<=-1||r<=a))for(let t=-1;t<=7;t++){const n=e+t;n<=-1||r<=n||(s[a][n]=i>=0&&i<=6&&(0==t||6==t)||t>=0&&t<=6&&(0==i||6==i)||i>=2&&i<=4&&t>=2&&t<=4)}}}setupPositionAdjustPattern(){const{typeNumber:t,modules:e}=this,s=Jt.getPatternPosition(t),{length:r}=s;for(let t=0;t<r;t++)for(let i=0;i<r;i++){const r=s[t],a=s[i];if(null==e[r][a])for(let t=-2;t<=2;t++)for(let s=-2;s<=2;s++)e[r+t][a+s]=-2==t||2==t||-2==s||2==s||0==t&&0==s}}setupTimingPattern(){const{moduleCount:t,modules:e}=this,s=t-8;for(let t=8;t<s;t++)null==e[t][6]&&(e[t][6]=t%2==0);for(let t=8;t<s;t++)null==e[6][t]&&(e[6][t]=t%2==0)}setupTypeInfo(t,e){const{errorCorrectLevel:s,modules:r,moduleCount:i}=this,a=s<<3|e,n=Jt.getBCHTypeInfo(a);for(let e=0;e<15;e++){const s=!t&&1==(n>>e&1);e<6?r[e][8]=s:e<8?r[e+1][8]=s:r[i-15+e][8]=s}for(let e=0;e<15;e++){const s=!t&&1==(n>>e&1);e<8?r[8][i-e-1]=s:e<9?r[8][15-e]=s:r[8][15-e-1]=s}r[i-8][8]=!t}getBestMaskPattern(){let t=0,e=0;for(let s=0;s<8;s++){this.makeImpl(!0,s);const r=Jt.getLostPoint(this);(0==s||t>r)&&(t=r,e=s)}return e}setupTypeNumber(t){const{typeNumber:e,modules:s,moduleCount:r}=this,i=Jt.getBCHTypeNumber(e);for(let e=0;e<18;e++){const a=!t&&1==(i>>e&1);s[~~(e/3)][e%3+r-8-3]=a,s[e%3+r-8-3][~~(e/3)]=a}}createData(t,e,s){const r=(new $t).getRSBlocks(t,e),i=new Bt;for(let e=0;e<s.length;e++){const r=s[e];i.put(r.mode,4),i.put(r.length,Jt.getLengthInBits(r.mode,t)),r.write(i)}let a=0;for(let t=0;t<r.length;t++)a+=r[t].dataCount;const n=8*a;if(i.lengthInBits>n)throw new Error(`code length overflow. (${i.lengthInBits} > ${n})`);for(i.lengthInBits+4<=n&&i.put(0,4);i.lengthInBits%8!=0;)i.putBit(!1);for(;!(i.lengthInBits>=n||(i.put(236,8),i.lengthInBits>=n));)i.put(17,8);return this.createBytes(i,r)}mapData(t,e){const{modules:s,moduleCount:r}=this,i=Jt.getMaskFunction(e);let a=-1,n=r-1,o=7,l=0;for(let e=n;e>0;e-=2)for(6==e&&(e-=1);;){for(let r=0;r<2;r++)if(null==s[n][e-r]){let a=!1;l<t.length&&(a=1==(t[l]>>>o&1)),i(n,e-r)&&(a=!a),s[n][e-r]=a,o--,-1==o&&(l++,o=7)}if(n+=a,n<0||r<=n){n-=a,a=-a;break}}}createBytes(t,e){const s=[],r=[];let i=0,a=0,n=0;for(let o=0;o<e.length;o++){const l=e[o].dataCount,h=e[o].totalCount-l;a=Math.max(a,l),n=Math.max(n,h),s[o]=[];for(let e=0;e<l;e++)s[o][e]=255&t.buffer[e+i];i+=l;const c=Jt.getErrorCorrectPolynomial(h),u=new Yt(s[o],c.length-1).mod(c);r[o]=new Array(c.length-1);for(let t=0;t<r[o].length;t++){const e=t+u.length-r[o].length;r[o][t]=e>=0?u.getAt(e):0}}let o=0;for(let t=0;t<e.length;t++)o+=e[t].totalCount;const l=new Array(o);let h=0;for(let t=0;t<a;t++)for(let r=0;r<e.length;r++)t<s[r].length&&(l[h++]=s[r][t]);for(let t=0;t<n;t++)for(let s=0;s<e.length;s++)t<r[s].length&&(l[h++]=r[s][t]);return l}isDark(t,e){const{moduleCount:s}=this;if(t<0||s<=t||e<0||s<=e)throw new Error(`${t}, ${e}`);return this.modules[t][e]}addData(t){this.dataList.push(new Lt(t)),this.dataCache=null}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}}function jt(t,e){const{typeNumber:s,errorCorrectLevel:r,size:i,black:a,white:n}=function(t={}){const e={...t};return{typeNumber:e.typeNumber??4,errorCorrectLevel:e.errorCorrectLevel??"M",size:e.size??500,black:e.black??"#000000FF",white:e.white??"#FFFFFFFF"}}(e);let o;try{o=new qt(s,r),o.addData(t),o.make()}catch(e){if(s>=40)throw new Error("Text too long to encode");return arguments.callee(t,{size:i,errorCorrectLevel:r,typeNumber:s+1,black:a,white:n})}const l=o.getModuleCount(),{margin:h,cellSize:c}=((t,e)=>{const s=~~(e/t);return{margin:~~((e-t*s)/2),cellSize:s||2}})(l,i),u=l*c+h,f=+a.replace("#","0x"),d=+n.replace("#","0x"),m=new Rt(i,i);for(let t=0;t<i;t++)for(let e=0;e<i;e++)if(h<=e&&e<u&&h<=t&&t<u){const s=~~((e-h)/c),r=~~((t-h)/c);m.setPixel(e,t,o.isDark(r,s)?f:d)}else m.setPixel(e,t,d);return m.flush(),ot.decode.toDataURL(m.toBuffer())}function Qt(t){const{width:e,height:s,data:r}=t,i=new Rt(e,s);return i.write(r),i.flush(),ot.decode.toDataURL(i.toBuffer())}class Gt{point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];parser=new It;get length(){return this.buckets.length}updateRemainPoints(){this.point<Math.ceil(this.maxRemain/2)?(this.remainStart=0,this.remainEnd=this.maxRemain):this.length-this.point<Math.floor(this.maxRemain/2)?(this.remainStart=this.remainEnd-this.maxRemain,this.remainEnd=this.length):(this.remainStart=Math.floor(this.point-this.maxRemain/2),this.remainEnd=this.remainStart+this.maxRemain)}updateBucketOperators(t){const{remainStart:e,remainEnd:s}=this;return this.point=t,this.updateRemainPoints(),e===s?[{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>s||this.remainEnd<e?[{action:"remove",start:e,end:s},{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>e&&this.remainEnd>s?[{action:"remove",start:e,end:this.remainStart},{action:"add",start:s,end:this.remainEnd}]:this.remainStart<e&&this.remainEnd<s?[{action:"remove",start:this.remainEnd,end:s},{action:"add",start:this.remainStart,end:e}]:[]}async getBucket(t){if(t<0||t>=this.length)return this.buckets[this.point];const e=this.updateBucketOperators(t);if(e.length){const t=[];e.forEach((({action:e,start:s,end:r})=>{for(let i=s;i<r;i++){const s=this.buckets[i];"remove"===e?s.entity=null:"add"===e&&(s.promise=this.parser.load(s.local||s.origin),"whole"!==this.loadMode&&this.point!==i||t.push(s.promise))}})),await Promise.all(t)}return this.get()}setLoadMode(t){this.loadMode=t}async prepare(t,e,s){const{parser:r,loadMode:i}=this,{global:a,path:n,local:o}=ot,{env:l}=a;this.point="number"==typeof e&&e>0&&e<t.length?e:0,this.maxRemain="number"==typeof s&&s>0?s:3,this.updateRemainPoints(),this.buckets=await Promise.all(t.map((async(t,e)=>{const s={origin:t,local:"",entity:null,promise:null};if("h5"===l||"tt"===l)return s.local=t,this.remainStart<=e&&e<this.remainEnd&&("whole"===i||e===this.point?s.entity=await r.load(t):s.promise=r.load(t)),s;const a=n.resolve(n.filename(t),"full"),h=r.download(s.origin),c=async r=>r&&(await o.write(r,a),s.local=a,this.remainStart<=e&&e<this.remainEnd)?It.parseVideo(r,t):null;return"whole"===i||e===this.point?s.entity=await c(await h):s.promise=h.then(c),s})))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise,t.promise=null,t):null===t.entity?(t.entity=await this.parser.load(t.local||t.origin),t):t}prev(){return this.getBucket(this.point-1)}next(){return this.getBucket(this.point+1)}go(t){return this.getBucket(t)}getPoint(){return this.point}clear(){const{global:t,local:e}=ot,{buckets:s}=this;return this.buckets=[],this.point=this.remainStart=this.remainEnd=0,this.maxRemain=3,Promise.all(s.map((s=>"h5"!==t.env&&"tt"!==t.env?e.remove(s.local):s.local)))}}class Zt{images=[];bitmaps=[];materials=new Map;getMaterials(){return this.materials}async loadImages(t,e,s){const{load:r,isImage:i,isImageBitmap:a}=ot.image,n=[],o=[],l=[];Object.keys(t).forEach((h=>{const c=t[h];if(i(c))o.push(c);else{const t=r(e,c,s,h).then((t=>(this.materials.set(h,t),i(t)?o.push(t):a(t)&&l.push(t),t)));n.push(t)}})),await Promise.all(n),this.images=o,this.bitmaps=l}createImage(t){return this.images.shift()||ot.image.create(t)}clear(){this.materials.clear();for(let t=0;t<this.images.length;t++){const e=this.images[t];e.onload=null,e.onerror=null,e.src=""}for(let t=0;t<this.bitmaps.length;t++)this.bitmaps[t].close();this.bitmaps=[]}}const{noop:te}=ot;class ee{mode;W;H;X=null;XC=null;Y=null;YC=null;model={};IM=new Zt;globalTransform;constructor(t="animation",e=0,s=0){this.mode=t,this.W=e,this.H=s}setModel(t){const{model:e}=this,{env:s,sys:r}=ot.global;e.type=t,"O"===t&&"h5"===s&&navigator.userAgent.includes("Firefox")?e.clear="CR":e.clear="O"===t&&"tt"===s||"alipay"===s?"CL":"RE",e.render="C"===t&&("tt"===s||"IOS"===r&&"alipay"===s)||"O"===t&&"weapp"===s?"PU":"DR",it.line(4),it.log("brush type",e.type),it.log("brush clear",e.clear),it.log("brush render",e.render),it.line(4)}async register(t,e,s){const{model:r,mode:i}=this,{getCanvas:a,getOfsCanvas:n}=ot;if("poster"===i){const{W:t,H:e}=this;if(!(t>0&&e>0))throw new Error("Poster mode must set width and height when create Brush instance");const{canvas:s,context:r}=n({width:t,height:e});this.X=s,this.XC=r}else{const{canvas:e,context:r}=await a(t,s),{width:i,height:n}=e;this.X=e,this.XC=r,this.W=i,this.H=n}if("poster"===i)this.Y=this.X,this.YC=this.XC,this.setModel("O");else{let t;"string"==typeof e&&""!==e?(t=await a(e,s),t.canvas.width=this.W,t.canvas.height=this.H,this.setModel("C")):(t=n({width:this.W,height:this.H}),this.setModel("O")),this.Y=t.canvas,this.YC=t.context}if("CL"===r.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===i)this.clearSecondary=this.stick=te;else{switch(r.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:s,context:r}=n({width:t,height:e});this.Y=s,this.YC=r};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:s}=this;s.width=t,s.height=e}}switch(r.render){case"DR":this.stick=()=>{const{W:t,H:e}=this;this.XC.drawImage(this.Y,0,0,t,e)};break;case"PU":this.stick=()=>{const{W:t,H:e}=this,s=this.YC.getImageData(0,0,t,e);this.XC.putImageData(s,0,0,0,0,t,e)}}}}loadImages(t,e){return this.IM.loadImages(t,this,e)}createImage(){return this.IM.createImage(this.X)}getImageData(){return this.XC.getImageData(0,0,this.W,this.H)}resize(t,e){const{Y:s}=this;let r=1,i=1,a=0,n=0;if("fill"===t)r=s.width/e.width,i=s.height/e.height;else if(["aspect-fill","aspect-fit"].includes(t)){const o=e.width/e.height,l=s.width/s.height;o>=l&&"aspect-fit"===t||o<=l&&"aspect-fill"===t?(r=i=s.width/e.width,n=(s.height-e.height*i)/2):(o<l&&"aspect-fit"===t||o>l&&"aspect-fill"===t)&&(r=i=s.height/e.height,a=(s.width-e.width*r)/2)}this.globalTransform={a:r,b:0,c:0,d:i,tx:a,ty:n}}flush(t){ot.rAF(this.X,t)}clearContainer=te;clearSecondary=te;clearMaterials(){this.IM.clear()}draw(t,e,s,r){!function(t,e,s,r,i,a,n){const{sprites:o,replaceElements:l,dynamicElements:h}=s;for(let s=i;s<a;s++){const i=o[s],{imageKey:a}=i;Et(t,i,r,e.get(a),l[a],h[a],n)}}(this.YC,this.IM.getMaterials(),t,e,s,r,this.globalTransform)}stick=te;destroy(){this.clearContainer(),this.clearSecondary(),this.clearMaterials(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=te}}const{noop:se}=ot;class re{brush;isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onStart=se;onUpdate=se;onEnd=se;constructor(t){this.brush=t}setConfig(t,e,s,r){this.duration=t,this.loopStart=e,this.loopDuration=t*s+r-e}start(){this.isRunning=!0,this.startTime=ot.now(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=ot.now(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(ot.now()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1,this.loopStart=0}doFrame(){this.isRunning&&(this.doDeltaTime(ot.now()-this.startTime),this.isRunning&&this.brush.flush((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:s,loopDuration:r}=this;let i,a=!1;t>=r?(i=1,a=!0,this.stop()):i=(t+s)%e/e,it.time("update partial",(()=>this.onUpdate(i))),!this.isRunning&&a&&this.onEnd()}}class ie{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:s,startFrame:r,endFrame:i,fillMode:a,loop:n}=this,{fps:o,sprites:l}=t;let{frames:h}=t;const c=l.length,u=r>0?r:0,f=i>0&&i<h?i:h;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<h?h=f-u:u>0&&(h-=u);let d=s,m=0;"forwards"===e?(d===f-1&&(d=u),"forwards"===a&&(m=1)):(0===d&&(d=f-1),"backwards"===a&&(m=1));const p=1e3/o;return{currFrame:d,startFrame:u,endFrame:f,totalFrame:h,spriteCount:c,aniConfig:{duration:Math.floor(h*p*10**6)/10**6,loopStart:s>u?(s-u)*p:0,loop:0===n?1/0:n,fillValue:m*p}}}}class ae{entity=void 0;config=new ie;brush=new ee;animator=null;async setConfig(t,e){let s;s="string"==typeof t?{container:t}:t,this.config.register(s),await this.brush.register(s.container,s.secondary,e),this.animator=new re(this.brush)}setItem(t,e){this.config.setItem(t,e)}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:s}=t;return this.animator.stop(),this.entity=t,this.brush.clearSecondary(),this.brush.clearMaterials(),this.brush.loadImages(e,s)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.brush.clearContainer(),this.brush.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.brush.destroy(),this.animator=null,this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.startAnimation())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:s}=this.entity;this.stepToFrame(Math.round((t<0?0:t)*s)%s,e)}startAnimation(){const{entity:t,config:e,animator:s,brush:r}=this,{global:i,now:a}=ot,{playMode:n,contentMode:o}=e,{currFrame:l,startFrame:h,endFrame:c,totalFrame:u,spriteCount:f,aniConfig:d}=e.getConfig(t),{duration:m,loopStart:p,loop:g,fillValue:y}=d,b="fallbacks"===n;let w,v,k,x,C,T,I,E,D=l,M=0;if(s.setConfig(m,p,g,y),r.resize(o,t.size),i.isPerf){const e=8,s=3,i=65,n=1;let o,l,h,c=4;E=u=>{for(o=a(),u();M<f;)if(l=Math.min(c,f-M),w=M+l,r.draw(t,D,M,w),M=w,h=a()-o,h<s)c=Math.min(2*c,i);else if(h>e){c=Math.max(c/2,n);break}}}else{const e=1.05,s=2;E=i=>{i(),M<f&&(w=I?0|Math.min(f*T*e+s,f):f,w>M&&(r.draw(t,D,M,w),M=w))}}s.onUpdate=t=>{E((()=>{C=b?1-t:t,x=C*u,b?(k=(0===t?c:Math.ceil(x))-1,T=Math.abs(1-x+D),C=D/u):(k=1===t?h:Math.floor(x),T=Math.abs(x-D)),I=D===k})),I||(r.clearContainer(),r.stick(),r.clearSecondary(),v=D,D=k,M=0,this.onProcess?.(~~(100*C)/100,v))},s.onEnd=()=>this.onEnd?.(),s.start()}}class ne{entity=void 0;frame=0;contentMode="fill";brush;constructor(t,e){this.brush=new ee("poster",t,e)}setConfig(t,e){let s;return s="string"==typeof t?{container:t}:t,s.contentMode&&(this.contentMode=s.contentMode),"number"==typeof s.frame&&(this.frame=s.frame),this.brush.register(s.container,"",e)}setContentMode(t){this.contentMode=t}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:s}=t;return this.entity=t,this.brush.clearMaterials(),this.brush.loadImages(e,s)}onStart;onEnd;setReplaceElement(t,e){this.entity&&(this.entity.replaceElements[t]=e)}async setReplaceElementByUrl(t,e){this.entity&&(this.entity.replaceElements[t]=await ot.image.load(this.brush,e,e))}setDynamicElement(t,e){this.entity&&(this.entity.dynamicElements[t]=e)}async setDynamicElementByUrl(t,e){this.entity&&(this.entity.dynamicElements[t]=await ot.image.load(this.brush,e,e))}draw(){if(!this.entity)return;const{brush:t,entity:e,contentMode:s,frame:r,onStart:i,onEnd:a}=this;i?.(),t.clearContainer(),t.resize(s,e.size),t.draw(e,r,0,e.sprites.length),a?.()}toDataURL(){return Qt(this.brush.getImageData())}clear(){this.brush.clearContainer(),this.brush.clearMaterials()}destroy(){this.brush.destroy(),this.entity=void 0}}export{ee as Brush,Zt as ImageManager,Rt as PNGEncoder,It as Parser,ae as Player,ne as Poster,qt as QRCode,Ct as SVGADecoder,Gt as VideoManager,jt as createQRCodeToPNG,Qt as getDataURLFromImageData,ot as platform};
//# sourceMappingURL=index.js.map

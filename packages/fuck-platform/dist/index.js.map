{"version":3,"file":"index.js","sources":["../../src/extensions/noop.ts","../../src/extensions/retry.ts","../../src/platform.ts","../../src/definePlugin.ts","../../src/plugins/plugin-canvas.ts","../../src/plugins/plugin-decode.ts","../../src/plugins/plugin-download.ts","../../src/plugins/plugin-fsm.ts","../../src/plugins/plugin-image.ts","../../src/plugins/plugin-now.ts","../../src/plugins/plugin-ofs-canvas.ts","../../src/plugins/plugin-path.ts","../../src/plugins/plugin-raf.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","async","retry","fn","intervals","times","err","length","Promise","resolve","setTimeout","Platform","plugins","version","global","env","br","dpr","constructor","this","autoEnv","init","useBridge","usePixelRatio","reduce","acc","plugin","name","pluginNames","map","installPlugins","window","tt","my","wx","Error","globalThis","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","usedPlugins","forEach","pluginName","undefined","Array","isArray","dependencies","value","install","call","Reflect","set","definePlugin","pluginCanvas","initCanvas","canvas","width","height","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","slice","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","utf8","buffer","start","end","RangeError","codes","asciiCodes","fromCharCode","String","asciiPos","i","t","push","codePoint","join","pluginDecode","b64Wrap","b64","decode","toBuffer","data","byteOffset","byteLength","textDecoder","TextDecoder","toBitmap","createImageBitmap","Blob","toDataURL","btoa","subarray","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","cachedImages","Set","loadImage","img","src","onload","has","delete","onerror","createImage","_","Image","genImageSource","isImage","isImageBitmap","ImageBitmap","create","load","_filename","_prefix","Uint8Array","filename","prefix","add","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","type","pluginPath","substring","lastIndexOf","USER_DATA_PATH","getEnvInfoSync","common","pluginRaf","callback","requestAnimationFrame"],"mappings":"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"}
{"version":3,"file":"index.js","sources":["../../src/extensions/noop.ts","../../src/extensions/retry.ts","../../src/definePlugin.ts","../../src/plugins/plugin-canvas.ts","../../src/plugins/plugin-decode.ts","../../src/plugins/plugin-download.ts","../../src/plugins/plugin-fsm.ts","../../src/plugins/plugin-image.ts","../../src/plugins/plugin-now.ts","../../src/plugins/plugin-ofs-canvas.ts","../../src/plugins/plugin-path.ts","../../src/plugins/plugin-raf.ts","../../src/index.ts"],"sourcesContent":[null,null,null,null,null,null,null,null,null,null,null,null,null],"names":["noop","async","retry","fn","intervals","times","err","length","Promise","resolve","setTimeout","definePlugin","plugin","pluginCanvas","name","install","this","env","br","dpr","global","initCanvas","canvas","width","height","Error","MAX_SIZE","context","getContext","virtualWidth","virtualHeight","querySelector","selector","document","slice","clientWidth","clientHeight","component","reject","query","createSelectorQuery","in","select","fields","node","size","res","e","exec","utf8","buffer","start","end","RangeError","codes","asciiCodes","Array","fromCharCode","String","asciiPos","i","t","push","codePoint","join","pluginDecode","b64Wrap","b64","decode","toBuffer","data","byteOffset","byteLength","textDecoder","TextDecoder","toBitmap","globalThis","createImageBitmap","Blob","toDataURL","btoa","subarray","arrayBufferToBase64","pluginDownload","isRemote","url","test","is","fetch","then","response","ok","arrayBuffer","status","statusText","download","enableCache","request","dataType","responseType","success","fail","catch","errorMessage","errMsg","message","includes","pluginFsm","fsm","getFileSystemManager","write","filePath","writeFile","read","readFile","remove","unlink","pluginImage","local","path","cachedImages","Set","loadImage","img","src","onload","has","delete","onerror","createImage","_","Image","genImageSource","isImage","isImageBitmap","ImageBitmap","create","load","_filename","_prefix","Uint8Array","undefined","filename","prefix","add","ex","console","warn","pluginNow","perf","performance","getPerformance","now","Date","pluginOfsCanvas","createOffscreenCanvas","options","OffscreenCanvas","my","tt","wx","type","pluginPath","substring","lastIndexOf","USER_DATA_PATH","getEnvInfoSync","common","pluginRaf","callback","requestAnimationFrame","Platform","plugins","version","constructor","autoEnv","init","useBridge","usePixelRatio","reduce","acc","pluginNames","map","installPlugins","window","devicePixelRatio","getWindowInfo","pixelRatio","getSystemInfoSync","usedPlugins","forEach","pluginName","isArray","dependencies","value","call","Reflect","set"],"mappings":"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"}
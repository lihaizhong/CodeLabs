class t{width;height;devicePixelRatio;canvas;ctx;constructor(t){this.width=t.width,this.height=t.height,this.devicePixelRatio=t.devicePixelRatio||1,this.canvas=new OffscreenCanvas(1,1),this.ctx=this.canvas.getContext("2d")}measureText(t,e,i="sans-serif",n,h){if(!t)return{width:0,height:0,lines:[]};const s=h||1.2*e;this.ctx.font=`${e}px ${i}`;const l=this.ctx.measureText(t);return!n||l.width<=n?{width:l.width,height:s,lines:[t]}:this.breakTextIntoLines(t,e,i,n,s)}breakTextIntoLines(t,e,i,n,h){this.ctx.font=`${e}px ${i}`;const s=t.split(" "),l=[];let r="",o=0;for(let t=0;t<s.length;t++){const e=s[t],i=r?`${r} ${e}`:e;this.ctx.measureText(i).width<=n||!r?r=i:(l.push(r),o=Math.max(o,this.ctx.measureText(r).width),r=e)}return r&&(l.push(r),o=Math.max(o,this.ctx.measureText(r).width)),{width:o,height:l.length*h,lines:l}}measureCJKText(t,e,i="sans-serif",n,h){if(!t)return{width:0,height:0,lines:[]};const s=h||1.2*e;this.ctx.font=`${e}px ${i}`;const l=this.ctx.measureText(t);return!n||l.width<=n?{width:l.width,height:s,lines:[t]}:this.breakCJKTextIntoLines(t,e,i,n,s)}breakCJKTextIntoLines(t,e,i,n,h){this.ctx.font=`${e}px ${i}`;const s=Array.from(t),l=[];let r="",o=0;for(let t=0;t<s.length;t++){const e=s[t],i=r+e;this.ctx.measureText(i).width<=n||!r?r=i:(l.push(r),o=Math.max(o,this.ctx.measureText(r).width),r=e)}return r&&(l.push(r),o=Math.max(o,this.ctx.measureText(r).width)),{width:o,height:l.length*h,lines:l}}}var e,i,n,h,s,l,r;!function(t){t.TEXT="text",t.IMAGE="image",t.CONTAINER="container"}(e||(e={})),function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify"}(i||(i={})),function(t){t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(n||(n={})),function(t){t.ROW="row",t.ROW_REVERSE="row-reverse",t.COLUMN="column",t.COLUMN_REVERSE="column-reverse"}(h||(h={})),function(t){t.FLEX_START="flex-start",t.FLEX_END="flex-end",t.CENTER="center",t.SPACE_BETWEEN="space-between",t.SPACE_AROUND="space-around",t.SPACE_EVENLY="space-evenly"}(s||(s={})),function(t){t.FLEX_START="flex-start",t.FLEX_END="flex-end",t.CENTER="center",t.STRETCH="stretch",t.BASELINE="baseline"}(l||(l={})),function(t){t.NOWRAP="nowrap",t.WRAP="wrap",t.WRAP_REVERSE="wrap-reverse"}(r||(r={}));class o{id;type;content;style;children;parent;rect;textMetrics;constructor(t){this.id=t.id||Math.random().toString(36).substring(2,9),this.type=t.type,this.content=t.content||"",this.style=t.style||{},this.children=[],this.parent=null,this.rect={x:0,y:0,width:0,height:0},this.textMetrics=null,t.children&&t.children.length>0&&(this.children=t.children.map((t=>{const e=new o(t);return e.setParent(this),e})))}getId(){return this.id}getType(){return this.type}getContent(){return this.content}getStyle(){return this.style}getChildren(){return this.children}getParent(){return this.parent}setParent(t){this.parent=t}appendChild(t){this.children.push(t),t.setParent(this)}getRect(){return this.rect}setRect(t){this.rect=t}getTextMetrics(){return this.textMetrics}setTextMetrics(t){this.textMetrics=t}measure(t){if(this.type===e.TEXT&&this.content){const e=this.style.fontSize||16,i=this.style.fontFamily||"sans-serif",n=this.style.lineHeight||1.2*e,h=this.style.width||t.width;this.textMetrics=t.measureText(this.content,e,i,h,n),this.rect.width=this.style.width||this.textMetrics.width,this.rect.height=this.style.height||this.textMetrics.height}else this.type,e.IMAGE,this.rect.width=this.style.width||0,this.rect.height=this.style.height||0;for(const e of this.children)e.measure(t)}}class c{layout(t,e){t.measure(e),this.layoutNode(t,0,0,e)}layoutNode(t,e,i,n){const h=t.getStyle(),s=t.getRect(),l=h.marginTop||0,r=h.marginLeft||0;s.x=e+r,s.y=i+l;const o=h.paddingTop||0,c=h.paddingLeft||0,g=h.paddingRight||0,a=h.paddingBottom||0;let d=s.x+c,x=s.y+o,E=0,f=0;const R=t.getChildren();for(let t=0;t<R.length;t++){const e=R[t],i=e.getRect(),h=e.getStyle(),l=h.marginRight||0,r=h.marginBottom||0;f>0&&f+i.width>s.width-c-g&&(d=s.x+c,x+=E,E=0,f=0);const o=this.layoutNode(e,d,x,n);E=Math.max(E,o+r),d+=i.width+l,f+=i.width+l}return R.length>0&&h.textAlign&&this.alignChildrenInLine(t,h.textAlign),R.length>0&&h.verticalAlign&&this.alignChildrenVertically(t,h.verticalAlign),s.height+o+a}alignChildrenInLine(t,e){const n=t.getRect(),h=t.getStyle(),s=t.getChildren(),l=h.paddingLeft||0,r=h.paddingRight||0,o=n.width-l-r,c=[];let g=[],a=0;for(const t of s){const e=t.getRect(),i=t.getStyle().marginRight||0;a>0&&a+e.width>o?(c.push(g),g=[t],a=e.width+i):(g.push(t),a+=e.width+i)}g.length>0&&c.push(g);for(const t of c){let n=0;for(const e of t){const t=e.getRect(),i=e.getStyle().marginRight||0;n+=t.width+i}let h=0;if(e===i.CENTER)h=(o-n)/2;else if(e===i.RIGHT)h=o-n;else if(e===i.JUSTIFY&&t.length>1&&c[c.length-1]!==t){const e=(o-n)/(t.length-1);let i=0;for(let n=0;n<t.length;n++){t[n].getRect().x+=i,n<t.length-1&&(i+=e)}continue}if(h>0)for(const e of t){e.getRect().x+=h}}}alignChildrenVertically(t,e){const i=t.getRect(),h=t.getStyle(),s=t.getChildren(),l=h.paddingTop||0,r=h.paddingBottom||0,o=i.height-l-r;let c=0;for(const t of s){const e=t.getRect(),i=t.getStyle().marginBottom||0;c+=e.height+i}let g=0;if(e===n.MIDDLE?g=(o-c)/2:e===n.BOTTOM&&(g=o-c),g>0)for(const t of s){t.getRect().y+=g}}}class g{layout(t,e){t.measure(e),this.layoutNode(t,0,0,e)}layoutNode(t,e,i,n){const h=t.getStyle(),s=t.getRect(),l=h.marginTop||0,r=h.marginLeft||0;if(s.x=e+r,s.y=i+l,"flex"===h.display)this.layoutFlexContainer(t,n);else{const e=t.getChildren(),i=h.paddingLeft||0,l=h.paddingTop||0;for(const t of e)this.layoutNode(t,s.x+i,s.y+l,n)}}layoutFlexContainer(t,e){const i=t.getStyle(),n=t.getRect();if(0===t.getChildren().length)return;const o=i.flexDirection||h.ROW,c=i.justifyContent||s.FLEX_START,g=i.alignItems||l.STRETCH,a=i.flexWrap||r.NOWRAP,d=i.paddingLeft||0,x=i.paddingTop||0,E=i.paddingRight||0,f=i.paddingBottom||0,R=o===h.ROW||o===h.ROW_REVERSE,u=R?n.width-d-E:n.height-x-f,y=R?n.height-x-f:n.width-d-E;a===r.NOWRAP?this.layoutFlexItemsNoWrap(t,u,y,R,o,c,g):this.layoutFlexItemsWrap(t,u,y,R,o,c,g,a)}layoutFlexItemsNoWrap(t,e,i,n,l,r,o){const c=t.getStyle(),g=t.getRect(),a=t.getChildren(),d=c.paddingLeft||0,x=c.paddingTop||0;c.paddingRight,c.paddingBottom;let E=0,f=0,R=0;for(const t of a){const e=t.getStyle(),i=t.getRect();E+=e.flexGrow||0,f+=e.flexShrink||1,R+=n?i.width:i.height}let u=e-R;if(u>0&&E>0){for(const t of a){const e=t.getStyle(),i=t.getRect(),h=e.flexGrow||0;if(h>0){const t=h/E*u;n?i.width+=t:i.height+=t}}u=0}else if(u<0&&f>0){for(const t of a){const e=t.getStyle(),i=t.getRect(),h=e.flexShrink||1;if(h>0){const t=h/f*-u;n?i.width=Math.max(0,i.width-t):i.height=Math.max(0,i.height-t)}}u=0}let y=0;if(r===s.FLEX_END)y=u;else if(r===s.CENTER)y=u/2;else if(r===s.SPACE_BETWEEN&&a.length>1)y=0,u/=a.length-1;else if(r===s.SPACE_AROUND&&a.length>0){const t=u/a.length;y=t/2,u=t}else if(r===s.SPACE_EVENLY&&a.length>0){const t=u/(a.length+1);y=t,u=t}const p=l===h.ROW_REVERSE||l===h.COLUMN_REVERSE;let T=y;for(let e=0;e<a.length;e++){const i=a[p?a.length-1-e:e],h=i.getRect();n?h.x=g.x+d+T:h.y=g.y+x+T,this.alignFlexItem(i,t,n,o),r===s.SPACE_BETWEEN||r===s.SPACE_AROUND||r===s.SPACE_EVENLY?T+=(n?h.width:h.height)+u:T+=n?h.width:h.height}}layoutFlexItemsWrap(t,e,i,n,o,c,g,a){const d=t.getStyle(),x=t.getRect(),E=t.getChildren(),f=d.paddingLeft||0,R=d.paddingTop||0,u=o===h.ROW_REVERSE||o===h.COLUMN_REVERSE,y=a===r.WRAP_REVERSE,p=[];let T=[],w=0;for(let t=0;t<E.length;t++){const i=E[t],h=i.getRect(),s=n?h.width:h.height;w+s>e&&T.length>0?(p.push(T),T=[i],w=s):(T.push(i),w+=s)}T.length>0&&p.push(T);const C=[],S=[];for(const t of p){let e=0,i=0;for(const h of t){const t=h.getRect();e+=n?t.width:t.height,i=Math.max(i,n?t.height:t.width)}C.push(e),S.push(i)}const m=S.reduce(((t,e)=>t+e),0);let N=0;g===l.CENTER?N=(i-m)/2:g===l.FLEX_END&&(N=i-m),y&&(N=i-m-N);let L=N;for(let t=0;t<p.length;t++){const i=y?p.length-1-t:t,h=p[i],r=C[i],o=S[i],a=e-r;let d=0;if(c===s.FLEX_END)d=a;else if(c===s.CENTER)d=a/2;else if(c===s.SPACE_BETWEEN&&h.length>1)d=0,h.length;else if(c===s.SPACE_AROUND&&h.length>0){d=a/h.length/2}else c===s.SPACE_EVENLY&&h.length>0&&(d=a/(h.length+1));let E=d;for(let t=0;t<h.length;t++){const e=u?h.length-1-t:t,i=h[e].getRect(),r=n?i.width:i.height,d=n?i.height:i.width;n?i.x=x.x+f+E:i.y=x.y+R+E,n?(i.y=x.y+R+L,g===l.STRETCH?i.height=o:g===l.CENTER?i.y+=(o-d)/2:g===l.FLEX_END&&(i.y+=o-d)):(i.x=x.x+f+L,g===l.STRETCH?i.width=o:g===l.CENTER?i.x+=(o-d)/2:g===l.FLEX_END&&(i.x+=o-d)),E+=r,c===s.SPACE_BETWEEN&&h.length>1&&e<h.length-1?E+=a/(h.length-1):c===s.SPACE_AROUND&&e<h.length-1?E+=a/h.length:c===s.SPACE_EVENLY&&e<h.length-1&&(E+=a/(h.length+1))}L+=o}}alignFlexItem(t,e,i,n){const h=e.getRect(),s=e.getStyle(),r=t.getRect(),o=s.paddingTop||0,c=s.paddingLeft||0;if(i){const t=h.height-(s.paddingTop||0)-(s.paddingBottom||0),e=r.height;n===l.STRETCH?(r.height=t,r.y=h.y+o):n===l.CENTER?r.y=h.y+o+(t-e)/2:n===l.FLEX_END?r.y=h.y+o+t-e:r.y=h.y+o}else{const t=h.width-(s.paddingLeft||0)-(s.paddingRight||0),e=r.width;n===l.STRETCH?(r.width=t,r.x=h.x+c):n===l.CENTER?r.x=h.x+c+(t-e)/2:n===l.FLEX_END?r.x=h.x+c+t-e:r.x=h.x+c}}}class a{context;flowLayout;flexLayout;renderer;constructor(e){this.context=new t(e),this.flowLayout=new c,this.flexLayout=new g,this.renderer=null}setRenderer(t){this.renderer=t}getContext(){return this.context}createLayoutTree(t){return new o(t)}render(t){if(!this.renderer)throw new Error("No renderer set. Call setRenderer() before rendering.");this.renderer.render(t)}layoutAndRender(t,e=!1){e?this.flexLayout.layout(t,this.context):this.flowLayout.layout(t,this.context),this.render(t)}}class d{canvas;ctx;devicePixelRatio;constructor(t,e=1){this.canvas=t,this.ctx=t.getContext("2d"),this.devicePixelRatio=e,this.updateCanvasSize()}updateCanvasSize(){const t=this.canvas.width,e=this.canvas.height;this.canvas instanceof HTMLCanvasElement?(this.canvas.width=t*this.devicePixelRatio,this.canvas.height=e*this.devicePixelRatio,this.canvas.style.width=`${t}px`,this.canvas.style.height=`${e}px`):(this.canvas.width=t*this.devicePixelRatio,this.canvas.height=e*this.devicePixelRatio),this.ctx.scale(this.devicePixelRatio,this.devicePixelRatio)}clear(){this.ctx.clearRect(0,0,this.canvas.width/this.devicePixelRatio,this.canvas.height/this.devicePixelRatio)}render(t){this.clear(),this.renderNode(t)}renderNode(t){const i=t.getRect(),n=t.getStyle();n.backgroundColor&&(this.ctx.fillStyle=n.backgroundColor,this.ctx.fillRect(i.x,i.y,i.width,i.height)),t.getType()===e.TEXT?this.renderText(t):t.getType()===e.IMAGE&&this.renderImage(t);for(const e of t.getChildren())this.renderNode(e)}renderText(t){const e=t.getRect(),i=t.getStyle(),n=t.getTextMetrics();if(!n)return;const h=i.fontSize||16,s=i.lineHeight||1.2*h,l=i.color||"#000000";this.ctx.font=`${h}px sans-serif`,this.ctx.fillStyle=l,this.ctx.textBaseline="top",i.textAlign?this.ctx.textAlign=i.textAlign:this.ctx.textAlign="left";const r=n.lines;for(let t=0;t<r.length;t++){const i=r[t],n=e.y+t*s;let h=e.x;"center"===this.ctx.textAlign?h=e.x+e.width/2:"right"===this.ctx.textAlign&&(h=e.x+e.width),this.ctx.fillText(i,h,n)}}renderImage(t){const e=t.getRect(),i=t.getContent();if(!i)return;const n=new Image;n.src=i,n.onload=()=>{this.ctx.drawImage(n,e.x,e.y,e.width,e.height)}}getCanvas(){return this.canvas}getContext(){return this.ctx}}export{l as AlignItems,d as CanvasRenderer,h as FlexDirection,g as FlexLayout,r as FlexWrap,c as FlowLayout,s as JustifyContent,t as LayoutContext,a as LayoutEngine,o as LayoutNode,e as NodeType,i as TextAlign,n as VerticalAlign};
//# sourceMappingURL=index.js.map

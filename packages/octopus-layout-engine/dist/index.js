var t,e,i,n,s,r,h;!function(t){t.TEXT="text",t.IMAGE="image",t.CONTAINER="container"}(t||(t={})),function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.JUSTIFY="justify"}(e||(e={})),function(t){t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(i||(i={})),function(t){t.ROW="row",t.ROW_REVERSE="row-reverse",t.COLUMN="column",t.COLUMN_REVERSE="column-reverse"}(n||(n={})),function(t){t.FLEX_START="flex-start",t.FLEX_END="flex-end",t.CENTER="center",t.SPACE_BETWEEN="space-between",t.SPACE_AROUND="space-around",t.SPACE_EVENLY="space-evenly"}(s||(s={})),function(t){t.FLEX_START="flex-start",t.FLEX_END="flex-end",t.CENTER="center",t.STRETCH="stretch",t.BASELINE="baseline"}(r||(r={})),function(t){t.NOWRAP="nowrap",t.WRAP="wrap",t.WRAP_REVERSE="wrap-reverse"}(h||(h={}));class o{context;constructor(t){this.context=t}calculateLayout(t){t.measure(this);const{style:e}=t;"flex"===e.display?this.calculateFlexLayout(t):this.calculateFlowLayout(t)}calculateFlexLayout(t){const{style:e,rect:i,children:o}=t;if(0===o.length)return;const c=e.flexDirection||n.ROW,a=e.justifyContent||s.FLEX_START,l=e.alignItems||r.FLEX_START;e.flexWrap||h.NOWRAP;const x=e.paddingLeft||0,d=e.paddingTop||0,g=e.paddingRight||0,u=e.paddingBottom||0,E=i.width-x-g,f=i.height-d-u,T=c===n.ROW||c===n.ROW_REVERSE,w=T?E:f,R=T?f:E,m=c===n.ROW_REVERSE||c===n.COLUMN_REVERSE;let y=0;for(const t of o){const e=t.style,i=t.rect,n=e.flexGrow||0;e.flexShrink;const s=T?i.width:i.height,r=T?(e.marginLeft||0)+(e.marginRight||0):(e.marginTop||0)+(e.marginBottom||0);n>0||(y+=s+r)}let p=w-y;let L=m?w:0;if(!(p<0))switch(a){case s.FLEX_END:L=m?0:p;break;case s.CENTER:L=p/2;break;case s.SPACE_BETWEEN:case s.SPACE_AROUND:case s.SPACE_EVENLY:break;default:L=m?w:0}for(const t of o){const e=t.style,n=t.rect,s=e.marginLeft||0,h=e.marginTop||0,o=e.marginRight||0,c=e.marginBottom||0,a=T?n.width:n.height,g=T?n.height:n.width;let u,E;switch(m?(u=L-a-(T?o:c),L-=a+(T?s+o:h+c)):(u=L+(T?s:h),L+=a+(T?s+o:h+c)),l){case r.FLEX_END:E=R-g-(T?c:o);break;case r.CENTER:E=(R-g)/2+(T?h-c:s-o)/2;break;case r.STRETCH:default:E=T?h:s}const f=T?u:E,w=T?E:u,y=i.x+x+f,p=i.y+d+w;t.setPosition(y,p),this.calculateLayout(t)}}calculateFlowLayout(t){const{style:e,rect:i,children:n}=t;if(0===n.length)return;const s=e.paddingLeft||0;e.paddingTop,e.paddingRight,e.paddingBottom;i.width,i.height;let r=0,h=0;for(const t of n){const e=t.style,n=t.rect,o=e.marginLeft||0,c=e.marginTop||0,a=(e.marginRight,e.marginBottom||0);n.width;const l=s+o,x=r+c;t.setPosition(i.x+l,i.y+x),h=Math.max(h,n.height+c+a),r+=h,this.calculateLayout(t)}}measureText(t,e,i="sans-serif",n,s){if(!t)return{width:0,height:0,lines:[]};const r=s||1.2*e;this.context.font=`${e}px ${i}`;const h=this.context.measureText(t);return!n||h.width<=n?{width:h.width,height:r,lines:[t]}:this.breakTextIntoLines(t,e,i,n,r)}breakTextIntoLines(t,e,i,n,s){this.context.font=`${e}px ${i}`;const r=t.split(" "),h=[];let o="",c=0;for(let t=0;t<r.length;t++){const e=r[t],i=o?`${o} ${e}`:e;this.context.measureText(i).width<=n||!o?o=i:(h.push(o),c=Math.max(c,this.context.measureText(o).width),o=e)}return o&&(h.push(o),c=Math.max(c,this.context.measureText(o).width)),{width:c,height:h.length*s,lines:h}}measureCJKText(t,e,i="sans-serif",n,s){if(!t)return{width:0,height:0,lines:[]};const r=s||1.2*e;this.context.font=`${e}px ${i}`;const h=this.context.measureText(t);return!n||h.width<=n?{width:h.width,height:r,lines:[t]}:this.breakCJKTextIntoLines(t,e,i,n,r)}breakCJKTextIntoLines(t,e,i,n,s){this.context.font=`${e}px ${i}`;const r=Array.from(t),h=[];let o="",c=0;for(let t=0;t<r.length;t++){const e=r[t],i=o+e;this.context.measureText(i).width<=n||!o?o=i:(h.push(o),c=Math.max(c,this.context.measureText(o).width),o=e)}return o&&(h.push(o),c=Math.max(c,this.context.measureText(o).width)),{width:c,height:h.length*s,lines:h}}}class c{type;content;style;children;parent;rect;textMetrics=null;constructor(t,e=null){this.type=t.type,this.content=t.content||"",this.style=t.style||{},this.parent=e,this.rect={x:0,y:0,width:0,height:0},this.children=(t.children||[]).map((t=>new c(t,this)))}setPosition(t,e){this.rect.x=t,this.rect.y=e}getTextMetrics(){return this.textMetrics}setTextMetrics(t){this.textMetrics=t}measure(t){const{style:e,type:i}=this,{width:n,height:s}=e,r=n,h=e.fontSize||16,o=e.fontFamily||"sans-serif",c=e.lineHeight||1.2*h;"text"===i?(this.textMetrics=t.measureText(this.content,h,o,r,c),this.rect.width=n||this.textMetrics.width,this.rect.height=s||this.textMetrics.height):(this.rect.width=n||0,this.rect.height=s||0);for(const e of this.children)e.measure(t)}}class a{context;devicePixelRatio;width;height;constructor(t,e=1){this.context=t,this.devicePixelRatio=e;const{canvas:i}=this.context,{width:n,height:s}=i;i.width=n*this.devicePixelRatio,i.height=s*this.devicePixelRatio,this.width=n,this.height=s,this.context.scale(this.devicePixelRatio,this.devicePixelRatio)}clear(){this.context.clearRect(0,0,this.width,this.height)}render(t){this.clear(),this.renderNode(t)}getCanvas(){return this.context.canvas}getContext(){return this.context}renderNode(e){const{rect:i,style:n,type:s,children:r}=e;n.backgroundColor&&(this.context.fillStyle=n.backgroundColor,this.context.fillRect(i.x,i.y,i.width,i.height)),s===t.TEXT?this.renderText(e):s===t.IMAGE&&this.renderImage(e);for(const t of r)this.renderNode(t)}renderText(t){const{rect:e,style:i}=t,n=t.getTextMetrics();if(!n)return;const s=i.fontSize||16,r=i.lineHeight||1.2*s,h=i.color||"#000000";this.context.font=`${s}px sans-serif`,this.context.fillStyle=h,this.context.textBaseline="top",i.textAlign?this.context.textAlign=i.textAlign:this.context.textAlign="left";const{lines:o}=n;for(let t=0;t<o.length;t++){const i=o[t],n=e.y+t*r;let s=e.x;"center"===this.context.textAlign?s=e.x+e.width/2:"right"===this.context.textAlign&&(s=e.x+e.width),this.context.fillText(i,s,n)}}renderImage(t){const{rect:e,content:i}=t;if(!i)return;const n=new Image;n.onload=()=>{const{width:t,height:i,x:s,y:r}=e;this.context.drawImage(n,s,r,t,i)},n.src=i}}class l{context;renderer;constructor(t){const e=t.getContext("2d");this.renderer=new a(e),this.context=new o(e)}getContext(){return this.context}createLayoutTree(t){return new c(t)}layout(t){this.context.calculateLayout(t)}render(t){if(!this.renderer)throw new Error("No renderer set. Call setRenderer() before rendering.");this.renderer.render(t)}layoutAndRender(t){this.layout(t),this.render(t)}}export{r as AlignItems,n as FlexDirection,h as FlexWrap,s as JustifyContent,o as LayoutContext,l as LayoutEngine,c as LayoutNode,a as LayoutRenderer,t as NodeType,e as TextAlign,i as VerticalAlign};
//# sourceMappingURL=index.js.map

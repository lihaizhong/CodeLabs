var t=Uint8Array,e=Uint16Array,i=Int32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),r=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),s=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),a=function(t,n){for(var r=new e(31),s=0;s<31;++s)r[s]=n+=1<<t[s-1];var a=new i(r[30]);for(s=1;s<30;++s)for(var o=r[s];o<r[s+1];++o)a[o]=o-r[s]<<5|s;return{b:r,r:a}},o=a(n,2),l=o.b,c=o.r;l[28]=258,c[258]=28;for(var h=a(r,0).b,u=new e(32768),d=0;d<32768;++d){var f=(43690&d)>>1|(21845&d)<<1;f=(61680&(f=(52428&f)>>2|(13107&f)<<2))>>4|(3855&f)<<4,u[d]=((65280&f)>>8|(255&f)<<8)>>1}var p=function(t,i,n){for(var r=t.length,s=0,a=new e(i);s<r;++s)t[s]&&++a[t[s]-1];var o,l=new e(i);for(s=1;s<i;++s)l[s]=l[s-1]+a[s-1]<<1;if(n){o=new e(1<<i);var c=15-i;for(s=0;s<r;++s)if(t[s])for(var h=s<<4|t[s],d=i-t[s],f=l[t[s]-1]++<<d,p=f|(1<<d)-1;f<=p;++f)o[u[f]>>c]=h}else for(o=new e(r),s=0;s<r;++s)t[s]&&(o[s]=u[l[t[s]-1]++]>>15-t[s]);return o},y=new t(288);for(d=0;d<144;++d)y[d]=8;for(d=144;d<256;++d)y[d]=9;for(d=256;d<280;++d)y[d]=7;for(d=280;d<288;++d)y[d]=8;var m=new t(32);for(d=0;d<32;++d)m[d]=5;var w=p(y,9,1),b=p(m,5,1),g=function(t){for(var e=t[0],i=1;i<t.length;++i)t[i]>e&&(e=t[i]);return e},v=function(t,e,i){var n=e/8|0;return(t[n]|t[n+1]<<8)>>(7&e)&i},x=function(t,e){var i=e/8|0;return(t[i]|t[i+1]<<8|t[i+2]<<16)>>(7&e)},k=function(t){return(t+7)/8|0},E=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],I=function(t,e,i){var n=new Error(e||E[t]);if(n.code=t,Error.captureStackTrace&&Error.captureStackTrace(n,I),!i)throw n;return n},F=function(e,i,a,o){var c=e.length;if(!c||i.f&&!i.l)return a||new t(0);var u=!a,d=u||2!=i.i,f=i.i;u&&(a=new t(3*c));var y=function(e){var i=a.length;if(e>i){var n=new t(Math.max(2*i,e));n.set(a),a=n}},m=i.f||0,E=i.p||0,F=i.b||0,C=i.l,T=i.d,D=i.m,S=i.n,R=8*c;do{if(!C){m=v(e,E,1);var M=v(e,E+1,3);if(E+=3,!M){var P=e[(q=k(E)+4)-4]|e[q-3]<<8,A=q+P;if(A>c){f&&I(0);break}d&&y(F+P),a.set(e.subarray(q,A),F),i.b=F+=P,i.p=E=8*A,i.f=m;continue}if(1==M)C=w,T=b,D=9,S=5;else if(2==M){var O=v(e,E,31)+257,L=v(e,E+10,15)+4,B=O+v(e,E+5,31)+1;E+=14;for(var z=new t(B),$=new t(19),W=0;W<L;++W)$[s[W]]=v(e,E+3*W,7);E+=3*L;var V=g($),K=(1<<V)-1,U=p($,V,1);for(W=0;W<B;){var q,J=U[v(e,E,K)];if(E+=15&J,(q=J>>4)<16)z[W++]=q;else{var N=0,H=0;for(16==q?(H=3+v(e,E,3),E+=2,N=z[W-1]):17==q?(H=3+v(e,E,7),E+=3):18==q&&(H=11+v(e,E,127),E+=7);H--;)z[W++]=N}}var j=z.subarray(0,O),X=z.subarray(O);D=g(j),S=g(X),C=p(j,D,1),T=p(X,S,1)}else I(1);if(E>R){f&&I(0);break}}d&&y(F+131072);for(var Y=(1<<D)-1,G=(1<<S)-1,Q=E;;Q=E){var Z=(N=C[x(e,E)&Y])>>4;if((E+=15&N)>R){f&&I(0);break}if(N||I(2),Z<256)a[F++]=Z;else{if(256==Z){Q=E,C=null;break}var _=Z-254;if(Z>264){var tt=n[W=Z-257];_=v(e,E,(1<<tt)-1)+l[W],E+=tt}var et=T[x(e,E)&G],it=et>>4;et||I(3),E+=15&et;X=h[it];if(it>3){tt=r[it];X+=x(e,E)&(1<<tt)-1,E+=tt}if(E>R){f&&I(0);break}d&&y(F+131072);var nt=F+_;if(F<X){var rt=0-X,st=Math.min(X,nt);for(rt+F<0&&I(3);F<st;++F)a[F]=o[rt+F]}for(;F<nt;++F)a[F]=a[F-X]}}i.l=C,i.p=Q,i.b=F,i.f=m,C&&(m=1,i.m=D,i.d=T,i.n=S)}while(!m);return F!=a.length&&u?function(e,i,n){return(null==n||n>e.length)&&(n=e.length),new t(e.subarray(i,n))}(a,0,F):a.subarray(0,F)},C=new t(0);function T(t,e){return F(t.subarray(function(t,e){return(8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&I(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&I(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)}(t,e),-4),{i:2},e,e)}var D,S,R="undefined"!=typeof TextDecoder&&new TextDecoder;try{R.decode(C,{stream:!0})}catch(M){}function M(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var P,A=M(function(){if(S)return D;function t(t){return"undefined"!=typeof Float32Array?function(){var e=new Float32Array([-0]),i=new Uint8Array(e.buffer),n=128===i[3];function r(t,n,r){e[0]=t,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3]}function s(t,n,r){e[0]=t,n[r]=i[3],n[r+1]=i[2],n[r+2]=i[1],n[r+3]=i[0]}function a(t,n){return i[0]=t[n],i[1]=t[n+1],i[2]=t[n+2],i[3]=t[n+3],e[0]}function o(t,n){return i[3]=t[n],i[2]=t[n+1],i[1]=t[n+2],i[0]=t[n+3],e[0]}t.writeFloatLE=n?r:s,t.writeFloatBE=n?s:r,t.readFloatLE=n?a:o,t.readFloatBE=n?o:a}():function(){function s(t,e,i,n){var r=e<0?1:0;if(r&&(e=-e),0===e)t(1/e>0?0:2147483648,i,n);else if(isNaN(e))t(2143289344,i,n);else if(e>34028234663852886e22)t((r<<31|2139095040)>>>0,i,n);else if(e<11754943508222875e-54)t((r<<31|Math.round(e/1401298464324817e-60))>>>0,i,n);else{var s=Math.floor(Math.log(e)/Math.LN2);t((r<<31|s+127<<23|8388607&Math.round(e*Math.pow(2,-s)*8388608))>>>0,i,n)}}function a(t,e,i){var n=t(e,i),r=2*(n>>31)+1,s=n>>>23&255,a=8388607&n;return 255===s?a?NaN:r*(1/0):0===s?1401298464324817e-60*r*a:r*Math.pow(2,s-150)*(a+8388608)}t.writeFloatLE=s.bind(null,e),t.writeFloatBE=s.bind(null,i),t.readFloatLE=a.bind(null,n),t.readFloatBE=a.bind(null,r)}(),"undefined"!=typeof Float64Array?function(){var e=new Float64Array([-0]),i=new Uint8Array(e.buffer),n=128===i[7];function r(t,n,r){e[0]=t,n[r]=i[0],n[r+1]=i[1],n[r+2]=i[2],n[r+3]=i[3],n[r+4]=i[4],n[r+5]=i[5],n[r+6]=i[6],n[r+7]=i[7]}function s(t,n,r){e[0]=t,n[r]=i[7],n[r+1]=i[6],n[r+2]=i[5],n[r+3]=i[4],n[r+4]=i[3],n[r+5]=i[2],n[r+6]=i[1],n[r+7]=i[0]}function a(t,n){return i[0]=t[n],i[1]=t[n+1],i[2]=t[n+2],i[3]=t[n+3],i[4]=t[n+4],i[5]=t[n+5],i[6]=t[n+6],i[7]=t[n+7],e[0]}function o(t,n){return i[7]=t[n],i[6]=t[n+1],i[5]=t[n+2],i[4]=t[n+3],i[3]=t[n+4],i[2]=t[n+5],i[1]=t[n+6],i[0]=t[n+7],e[0]}t.writeDoubleLE=n?r:s,t.writeDoubleBE=n?s:r,t.readDoubleLE=n?a:o,t.readDoubleBE=n?o:a}():function(){function s(t,e,i,n,r,s){var a=n<0?1:0;if(a&&(n=-n),0===n)t(0,r,s+e),t(1/n>0?0:2147483648,r,s+i);else if(isNaN(n))t(0,r,s+e),t(2146959360,r,s+i);else if(n>17976931348623157e292)t(0,r,s+e),t((a<<31|2146435072)>>>0,r,s+i);else{var o;if(n<22250738585072014e-324)t((o=n/5e-324)>>>0,r,s+e),t((a<<31|o/4294967296)>>>0,r,s+i);else{var l=Math.floor(Math.log(n)/Math.LN2);1024===l&&(l=1023),t(4503599627370496*(o=n*Math.pow(2,-l))>>>0,r,s+e),t((a<<31|l+1023<<20|1048576*o&1048575)>>>0,r,s+i)}}}function a(t,e,i,n,r){var s=t(n,r+e),a=t(n,r+i),o=2*(a>>31)+1,l=a>>>20&2047,c=4294967296*(1048575&a)+s;return 2047===l?c?NaN:o*(1/0):0===l?5e-324*o*c:o*Math.pow(2,l-1075)*(c+4503599627370496)}t.writeDoubleLE=s.bind(null,e,0,4),t.writeDoubleBE=s.bind(null,i,4,0),t.readDoubleLE=a.bind(null,n,0,4),t.readDoubleBE=a.bind(null,r,4,0)}(),t}function e(t,e,i){e[i]=255&t,e[i+1]=t>>>8&255,e[i+2]=t>>>16&255,e[i+3]=t>>>24}function i(t,e,i){e[i]=t>>>24,e[i+1]=t>>>16&255,e[i+2]=t>>>8&255,e[i+3]=255&t}function n(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function r(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}return S=1,D=t(t)}()),O={},L=(P||(P=1,function(){var t=O;t.length=function(t){for(var e=0,i=0,n=0;n<t.length;++n)(i=t.charCodeAt(n))<128?e+=1:i<2048?e+=2:55296==(64512&i)&&56320==(64512&t.charCodeAt(n+1))?(++n,e+=4):e+=3;return e},t.read=function(t,e,i){if(i-e<1)return"";for(var n,r=null,s=[],a=0;e<i;)(n=t[e++])<128?s[a++]=n:n>191&&n<224?s[a++]=(31&n)<<6|63&t[e++]:n>239&&n<365?(n=((7&n)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,s[a++]=55296+(n>>10),s[a++]=56320+(1023&n)):s[a++]=(15&n)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,s)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,s.slice(0,a))),r.join("")):String.fromCharCode.apply(String,s.slice(0,a))},t.write=function(t,e,i){for(var n,r,s=i,a=0;a<t.length;++a)(n=t.charCodeAt(a))<128?e[i++]=n:n<2048?(e[i++]=n>>6|192,e[i++]=63&n|128):55296==(64512&n)&&56320==(64512&(r=t.charCodeAt(a+1)))?(n=65536+((1023&n)<<10)+(1023&r),++a,e[i++]=n>>18|240,e[i++]=n>>12&63|128,e[i++]=n>>6&63|128,e[i++]=63&n|128):(e[i++]=n>>12|224,e[i++]=n>>6&63|128,e[i++]=63&n|128);return i-s}}()),O),B=M(L);class z{static create(t){if(t instanceof Uint8Array)return new z(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}slice(t,e,i){return t.subarray(e,i)}indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}uint32(){let t=4294967295;if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,this.indexOutOfRange(this,10);return t}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=A.readFloatLE(this.buf,this.pos);return this.pos+=4,t}bytes(){const t=this.uint32(),e=this.pos,i=this.pos+t;if(i>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,e===i?new Uint8Array(0):this.slice(this.buf,e,i)}string(){const t=this.bytes();return B.read(t,0,t.length)}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw this.indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class ${static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new W;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.width=t.float();break;case 4:n.height=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class W{static create(t){return new W(t)}x=0;y=0;width=0;height=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height))}}class V{static decode(t,e){t instanceof z||(t=z.create(t));let i=void 0===e?t.len:t.pos+e,n=new K;for(;t.pos<i;){let e=t.uint32();switch(e>>>3){case 1:n.a=t.float();break;case 2:n.b=t.float();break;case 3:n.c=t.float();break;case 4:n.d=t.float();break;case 5:n.tx=t.float();break;case 6:n.ty=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class K{static create(t){return new K(t)}a=0;b=0;c=0;d=0;tx=0;ty=0;constructor(t){t&&(null!=t.a&&(this.a=t.a),null!=t.b&&(this.b=t.b),null!=t.c&&(this.c=t.c),null!=t.d&&(this.d=t.d),null!=t.tx&&(this.tx=t.tx),null!=t.ty&&(this.ty=t.ty))}}class U{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new q;for(;t.pos<i;){const e=t.uint32();e>>>3==1?n.d=t.string():t.skipType(7&e)}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class q{static create(t){return new q(t)}d="";constructor(t){t&&null!=t.d&&(this.d=t.d)}}class J{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new N;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.width=t.float();break;case 4:n.height=t.float();break;case 5:n.cornerRadius=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class N{static create(t){return new N(t)}x=0;y=0;width=0;height=0;cornerRadius=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.cornerRadius&&(this.cornerRadius=t.cornerRadius))}}class H{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new j;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.x=t.float();break;case 2:n.y=t.float();break;case 3:n.radiusX=t.float();break;case 4:n.radiusY=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class j{static create(t){return new j(t)}x=0;y=0;radiusX=0;radiusY=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.radiusX&&(this.radiusX=t.radiusX),null!=t.radiusY&&(this.radiusY=t.radiusY))}}class X{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new Y;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.r=t.float();break;case 2:n.g=t.float();break;case 3:n.b=t.float();break;case 4:n.a=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class Y{static create(t){return new Y(t)}r=0;g=0;b=0;a=0;constructor(t){t&&(null!=t.r&&(this.r=t.r),null!=t.g&&(this.g=t.g),null!=t.b&&(this.b=t.b),null!=t.a&&(this.a=t.a))}}class G{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new Q;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.fill=X.decode(t,t.uint32());break;case 2:n.stroke=X.decode(t,t.uint32());break;case 3:n.strokeWidth=t.float();break;case 4:n.lineCap=t.int32();break;case 5:n.lineJoin=t.int32();break;case 6:n.miterLimit=t.float();break;case 7:n.lineDashI=t.float();break;case 8:n.lineDashII=t.float();break;case 9:n.lineDashIII=t.float();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class Q{static create(t){return new Q(t)}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0;constructor(t){t&&(null!=t.fill&&(this.fill=t.fill),null!=t.lineCap&&(this.lineCap=t.lineCap),null!=t.lineDashI&&(this.lineDashI=t.lineDashI),null!=t.lineDashII&&(this.lineDashII=t.lineDashII),null!=t.lineDashIII&&(this.lineDashIII=t.lineDashIII),null!=t.lineJoin&&(this.lineJoin=t.lineJoin),null!=t.miterLimit&&(this.miterLimit=t.miterLimit),null!=t.stroke&&(this.stroke=t.stroke),null!=t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}}class Z{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new _;for(;t.pos<i;){let e=t.uint32();switch(e>>>3){case 1:n.type=t.int32();break;case 2:n.shape=U.decode(t,t.uint32());break;case 3:n.rect=J.decode(t,t.uint32());break;case 4:n.ellipse=H.decode(t,t.uint32());break;case 10:n.styles=G.decode(t,t.uint32());break;case 11:n.transform=V.decode(t,t.uint32());break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class _{static create(t){return new _(t)}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null;$oneOfFields=["shape","rect","ellipse"];$fieldMap={};get args(){const t=Object.keys(this);for(let e=t.length-1;e>-1;--e){const i=t[e],n=this[i];if(1===this.$fieldMap[i]&&null!=n)return i}return""}set args(t){for(var e=0;e<this.$oneOfFields.length;++e){const i=this.$oneOfFields[e];i!==t&&delete this[i]}}constructor(t){t&&(null!=t.type&&(this.type=t.type),null!=t.ellipse&&(this.ellipse=t.ellipse),null!=t.rect&&(this.rect=t.rect),null!=t.shape&&(this.shape=t.shape),null!=t.styles&&(this.styles=t.styles),null!=t.transform&&(this.transform=t.transform));for(var e=0;e<this.$oneOfFields.length;++e)this.$fieldMap[this.$oneOfFields[e]]=1}}class et{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new it;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.alpha=t.float();break;case 2:n.layout=$.decode(t,t.uint32());break;case 3:n.transform=V.decode(t,t.uint32());break;case 4:n.clipPath=t.string();break;case 5:n.shapes&&n.shapes.length||(n.shapes=[]),n.shapes.push(Z.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class it{static create(t){return new it(t)}shapes=[];alpha=0;layout=null;transform=null;clipPath="";constructor(t){t&&(null!=t.alpha&&(this.alpha=t.alpha),null!=t.clipPath&&(this.clipPath=t.clipPath),null!=t.layout&&(this.layout=t.layout),null!=t.shapes&&(this.shapes=t.shapes),null!=t.transform&&(this.transform=t.transform))}}class nt{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new rt;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.imageKey=t.string();break;case 2:n.frames&&n.frames.length||(n.frames=[]),n.frames.push(et.decode(t,t.uint32()));break;case 3:n.matteKey=t.string();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class rt{static create(t){return new rt(t)}frames=[];imageKey="";matteKey="";constructor(t){t&&(null!=t.frames&&(this.frames=t.frames),null!=t.imageKey&&(this.imageKey=t.imageKey),null!=t.matteKey&&(this.matteKey=t.matteKey))}}class st{static decode(t,e){t instanceof z||(t=z.create(t));let i=void 0===e?t.len:t.pos+e,n=new at;for(;t.pos<i;){let e=t.uint32();switch(e>>>3){case 1:n.viewBoxWidth=t.float();break;case 2:n.viewBoxHeight=t.float();break;case 3:n.fps=t.int32();break;case 4:n.frames=t.int32();break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class at{static create(t){return new at(t)}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0;constructor(t){t&&(null!=t.viewBoxWidth&&(this.viewBoxWidth=t.viewBoxWidth),null!=t.viewBoxHeight&&(this.viewBoxHeight=t.viewBoxHeight),null!=t.fps&&(this.fps=t.fps),null!=t.frames&&(this.frames=t.frames))}}const ot=Object.freeze({});class lt{static decode(t,e){t instanceof z||(t=z.create(t));const i=void 0===e?t.len:t.pos+e,n=new ct;let r,s;for(;t.pos<i;){const e=t.uint32();switch(e>>>3){case 1:n.version=t.string();break;case 2:n.params=st.decode(t,t.uint32());break;case 3:{n.images===ot&&(n.images={});const e=t.uint32()+t.pos;for(r="",s=[];t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:r=t.string();break;case 2:s=t.bytes();break;default:t.skipType(7&e)}}n.images[r]=s;break}case 4:n.sprites&&n.sprites.length||(n.sprites=[]),n.sprites.push(nt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return n}static decodeDelimited(t){return t instanceof z||(t=new z(t)),this.decode(t,t.uint32())}}class ct{static create(t){return new ct(t)}version="";params=null;images=ot;sprites=[];constructor(t){t&&(null!=t.version&&(this.version=t.version),null!=t.images&&(this.images=t.images),null!=t.params&&(this.params=t.params),null!=t.sprites&&(this.sprites=t.sprites))}}const ht=1,ut=2,dt=3,ft=4,pt=0,yt=()=>new Error("Unsupported platform");const mt="undefined"!=typeof tt?dt:"undefined"!=typeof my?ut:"undefined"!=typeof wx?ht:"undefined"!=typeof window?ft:pt;let wt=null;function bt(){if(wt)return wt;if(mt===ht)return wt=wx,wx;if(mt===ft)return wt=window,window;if(mt===ut)return wt=my,my;if(mt===dt)return wt=tt,tt;throw yt()}function gt(t){return/^http(s):\/\//.test(t)?function(t){if(mt===ft)return fetch(t,{cache:"no-cache"}).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)}));if(mt!==pt){const e=bt();return new Promise(((i,n)=>{e.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:!0,success(t){i(t.data)},fail:n})}))}return Promise.reject(yt())}(t):mt!==ft?function(t){return new Promise(((e,i)=>{bt().getFileSystemManager().readFile({filePath:t,success:t=>e(t.data),fail:i})}))}(t):Promise.reject(yt())}class vt{version;size={width:0,height:0};fps=20;frames=0;images={};replaceElements={};dynamicElements={};sprites=[];constructor(t,e={}){this.version=t.version;const{viewBoxWidth:i,viewBoxHeight:n,fps:r,frames:s}=t.params;this.size.width=i,this.size.height=n,this.fps=r,this.frames=s,this.sprites=[],t.sprites?.forEach((t=>{const e={imageKey:t.imageKey,frames:[]};let i;t.frames.forEach((t=>{const n={x:t.layout?.x??0,y:t.layout?.y??0,width:t.layout?.width??0,height:t.layout?.height??0},r={a:t.transform?.a??1,b:t.transform?.b??0,c:t.transform?.c??0,d:t.transform?.d??1,tx:t.transform?.tx??0,ty:t.transform?.ty??0},s=t.clipPath??"";let a=[];t.shapes.forEach((t=>{const e=t.styles;if(null===e)return;const i=[];null!==e.lineDashI&&e.lineDashI>0&&i.push(e.lineDashI),null!==e.lineDashII&&e.lineDashII>0&&(i.length<1&&i.push(0),i.push(e.lineDashII)),null!==e.lineDashIII&&e.lineDashIII>0&&(i.length<2&&(i.push(0),i.push(0)),i[2]=e.lineDashIII);let n=null;switch(e.lineCap){case 0:n="butt";break;case 1:n="round";break;case 2:n="square"}let r=null;switch(e.lineJoin){case 2:r="bevel";break;case 1:r="round";break;case 0:r="miter"}let s=null;null!==e.fill&&(s=`rgba(${parseInt((255*e.fill.r).toString())}, ${parseInt((255*e.fill.g).toString())}, ${parseInt((255*e.fill.b).toString())}, ${parseInt((1*e.fill.a).toString())})`);let o=null;null!==e.stroke&&(o=`rgba(${parseInt((255*e.stroke.r).toString())}, ${parseInt((255*e.stroke.g).toString())}, ${parseInt((255*e.stroke.b).toString())}, ${parseInt((1*e.stroke.a).toString())})`);const{strokeWidth:l,miterLimit:c}=e,h={lineDash:i,fill:s,stroke:o,lineCap:n,lineJoin:r,strokeWidth:l,miterLimit:c},u={a:t.transform?.a??1,b:t.transform?.b??0,c:t.transform?.c??0,d:t.transform?.d??1,tx:t.transform?.tx??0,ty:t.transform?.ty??0};0===t.type&&null!==t.shape?a.push({type:"shape",path:t.shape,styles:h,transform:u}):1===t.type&&null!==t.rect?a.push({type:"rect",path:t.rect,styles:h,transform:u}):2===t.type&&null!==t.ellipse&&a.push({type:"ellipse",path:t.ellipse,styles:h,transform:u})})),void 0!==t.shapes[0]&&3===t.shapes[0].type&&void 0!==i?a=i:i=a;const o=r.a*n.x+r.c*n.y+r.tx,l=r.a*(n.x+n.width)+r.c*n.y+r.tx,c=r.a*n.x+r.c*(n.y+n.height)+r.tx,h=r.a*(n.x+n.width)+r.c*(n.y+n.height)+r.tx,u=r.b*n.x+r.d*n.y+r.ty,d=r.b*(n.x+n.width)+r.d*n.y+r.ty,f=r.b*n.x+r.d*(n.y+n.height)+r.ty,p=r.b*(n.x+n.width)+r.d*(n.y+n.height)+r.ty,y=Math.min(Math.min(c,h),Math.min(o,l)),m=Math.min(Math.min(f,p),Math.min(u,d)),w=s.length>0?{d:s,transform:void 0,styles:{fill:"rgba(0, 0, 0, 0)",stroke:null,strokeWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null}}:null;e.frames.push({alpha:t.alpha??0,layout:n,transform:r,clipPath:s,shapes:a,nx:y,ny:m,maskPath:w})})),this.sprites.push(e)})),this.images=e}}const xt={};var kt={count:20,label(t){console.log(t)},time(t,e){void 0===xt[t]?xt[t]=1:xt[t]++,0!==this.count&&xt[t]>this.count?e():(console.time(t),e(),console.timeEnd(t))},clearTime(t){delete xt[t]},line(t=30){console.log("-".repeat(t))}};class Et{static parseVideoEntity(t){const e=new Uint8Array(t,0,4),i=new Uint8Array(t);if("80,75,3,4"===e.toString())throw new Error("this parser only support version@2 of SVGA.");const n=T(i),r=lt.decode(n);return new vt(r,r.images)}static parsePlacardEntity(t){}async load(t){const e=await gt(t);return kt.line(),kt.label(t),Et.parseVideoEntity(e)}}function It(t){if(mt===ht)return wx.createOffscreenCanvas({...t,type:"2d"});if(mt===ft)return new OffscreenCanvas(t.width,t.height);if(mt===ut)return my.createOffscreenCanvas({width:t.width,height:t.height});if(mt===dt){const e=tt.createOffscreenCanvas();return e.width=t.width,e.height=t.height,e}throw yt()}function Ft(t,e){return new Promise(((i,n)=>{const r=bt(),s=(t,e=0,r=0)=>{if(!t)return void n("canvas not found.");const s=t.getContext("2d");if(!s)return void n("canvas context not found.");const a=function(){if(mt===ft)return window.devicePixelRatio;if(mt!==pt){const t=bt();if("getWindowInfo"in t){const{pixelRatio:e}=t.getWindowInfo();return e}const{pixelRatio:e}=t.getSystemInfoSync();return e}throw yt()}();t.width=e*a,t.height=r*a,i({canvas:t,ctx:s})};if(mt===ft){const e=document.querySelector(t),{width:i,height:n}=e.style;s(e,parseFloat(i),parseFloat(n))}else if(mt!==pt){let i=r.createSelectorQuery();e&&(i=i.in(e)),i.select(t).fields({node:!0,size:!0},(t=>{if(t?.node){const{node:e,width:i,height:n}=t;s(e,i,n)}else n(new Error("canvas not found!"))})).exec()}else n(yt())}))}function Ct(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function Tt(t){return"string"==typeof t?t:function(t){const e=Ct(t);let i;return i=mt===ft?btoa(String.fromCharCode(...new Uint8Array(e))):bt().arrayBufferToBase64(e),`data:image/png;base64,${i}`}(t)}function Dt(t,e){return mt===ft&&"createImageBitmap"in window?function(t){const e=Ct(t);return createImageBitmap(new Blob([e]))}(e):new Promise(((i,n)=>{const r=function(t){return mt===ft?new Image:mt!==pt?t.createImage():null}(t);r?(r.onload=()=>i(r),r.onerror=t=>n(new Error(`[SVGA LOADING FAILURE]: ${t.message}`)),r.width=t.width,r.height=t.height,r.src=Tt(e)):n(yt())}))}class St{canvas;isRunning=!1;startTime=0;currentFrication=0;startValue=0;endValue=0;duration=0;loopStart=0;loop=1;fillRule=0;onStart=()=>{};onUpdate=()=>{};onEnd=()=>{};constructor(t){this.canvas=t}currentTimeMillSecond(){return mt===ft&&performance?performance.now():Date.now()}start(){this.isRunning=!0,this.startTime=this.currentTimeMillSecond(),this.currentFrication=0,this.onStart(),this.doFrame()}stop(){this.isRunning=!1}get animatedValue(){return this.currentFrication?Math.floor((this.endValue-this.startValue)*this.currentFrication+this.startValue):Math.floor(this.startValue)}doFrame(){this.isRunning&&(this.doDeltaTime(this.currentTimeMillSecond()-this.startTime),this.isRunning&&function(t,e){if(mt===ft)return requestAnimationFrame(e);if(mt!==pt)return t.requestAnimationFrame(e);throw yt()}(this.canvas,this.doFrame.bind(this)))}doDeltaTime(t){t>=this.loopStart+(this.duration-this.loopStart)*this.loop?(this.currentFrication=1===this.fillRule?0:1,this.isRunning=!1):this.currentFrication=t<=this.duration?t/this.duration:((t-this.loopStart)%(this.duration-this.loopStart)+this.loopStart)/this.duration,this.onUpdate(this.animatedValue),this.isRunning||this.onEnd()}}function Rt(t,e,i,n){if(null===t)throw new Error("Render Context cannot be null");const{replaceElements:r,dynamicElements:s}=i;i.sprites.forEach((i=>{const a=e[i.imageKey],o=r[i.imageKey],l=s[i.imageKey];!function(t,e,i,n,r,s){const a=e.frames[i];if(a.alpha<.05)return;t.save(),t.globalAlpha=a.alpha,t.transform(a.transform?.a??1,a.transform?.b??0,a.transform?.c??0,a.transform?.d??1,a.transform?.tx??0,a.transform?.ty??0),void 0!==n&&(null!==a.maskPath&&(Pt(t,a.maskPath.d,a.maskPath.transform,a.maskPath.styles),t.clip()),void 0!==r?t.drawImage(r,0,0,a.layout.width,a.layout.height):t.drawImage(n,0,0,a.layout.width,a.layout.height));void 0!==s&&t.drawImage(s,(a.layout.width-s.width)/2,(a.layout.height-s.height)/2);a.shapes.forEach((e=>function(t,e){switch(e.type){case"shape":Pt(t,e.path.d,e.transform,e.styles);break;case"ellipse":!function(t,e,i,n,r,s,a){t.save(),Mt(t,a),void 0!==s&&t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty);e-=n,i-=r;const o=2*n,l=2*r,c=.5522848,h=o/2*c,u=l/2*c,d=e+o,f=i+l,p=e+o/2,y=i+l/2;t.beginPath(),t.moveTo(e,y),t.bezierCurveTo(e,y-u,p-h,i,p,i),t.bezierCurveTo(p+h,i,d,y-u,d,y),t.bezierCurveTo(d,y+u,p+h,f,p,f),t.bezierCurveTo(p-h,f,e,y+u,e,y),null!==a.fill&&t.fill();null!==a.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.radiusX??0,e.path.radiusY??0,e.transform,e.styles);break;case"rect":!function(t,e,i,n,r,s,a,o){t.save(),Mt(t,o),void 0!==a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty);let l=s;n<2*l&&(l=n/2);r<2*l&&(l=r/2);t.beginPath(),t.moveTo(e+l,i),t.arcTo(e+n,i,e+n,i+r,l),t.arcTo(e+n,i+r,e,i+r,l),t.arcTo(e,i+r,e,i,l),t.arcTo(e,i,e+n,i,l),t.closePath(),null!==o.fill&&t.fill();null!==o.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.width??0,e.path.height??0,e.path.cornerRadius??0,e.transform,e.styles)}}(t,e))),t.restore()}(t,i,n,a,o,l)}))}function Mt(t,e){void 0!==e&&(null!==e.stroke?t.strokeStyle=e.stroke:t.strokeStyle="transparent",null!==e.strokeWidth&&e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),null!==e.miterLimit&&e.miterLimit>0&&(t.miterLimit=e.miterLimit),null!==e.lineCap&&(t.lineCap=e.lineCap),null!==e.lineJoin&&(t.lineJoin=e.lineJoin),null!==e.fill?t.fillStyle=e.fill:t.fillStyle="transparent",null!==e.lineDash&&t.setLineDash(e.lineDash))}function Pt(t,e,i,n){t.save(),Mt(t,n),void 0!==i&&t.transform(i.a,i.b,i.c,i.d,i.tx,i.ty);const r={x:0,y:0,x1:0,y1:0,x2:0,y2:0};t.beginPath(),void 0!==e&&(e=e.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ")).split("|||").forEach((e=>{if(0===e.length)return;const i=e.substring(0,1);if("MLHVCSQRZmlhvcsqrz".includes(i)){const n=e.substr(1).trim().split(" ");!function(t,e,i,n){switch(i){case"M":e.x=+n[0],e.y=+n[1],t.moveTo(e.x,e.y);break;case"m":e.x+=+n[0],e.y+=+n[1],t.moveTo(e.x,e.y);break;case"L":e.x=+n[0],e.y=+n[1],t.lineTo(e.x,e.y);break;case"l":e.x+=+n[0],e.y+=+n[1],t.lineTo(e.x,e.y);break;case"H":e.x=+n[0],t.lineTo(e.x,e.y);break;case"h":e.x+=+n[0],t.lineTo(e.x,e.y);break;case"V":e.y=+n[0],t.lineTo(e.x,e.y);break;case"v":e.y+=+n[0],t.lineTo(e.x,e.y);break;case"C":e.x1=+n[0],e.y1=+n[1],e.x2=+n[2],e.y2=+n[3],e.x=+n[4],e.y=+n[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"c":e.x1=e.x+ +n[0],e.y1=e.y+ +n[1],e.x2=e.x+ +n[2],e.y2=e.y+ +n[3],e.x+=+n[4],e.y+=+n[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"S":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=+n[0],e.y2=+n[1],e.x=+n[2],e.y=+n[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=+n[0],e.y1=+n[1],e.x=+n[2],e.y=+n[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"s":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=e.x+ +n[0],e.y2=e.y+ +n[1],e.x+=+n[2],e.y+=+n[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=e.x+ +n[0],e.y1=e.y+ +n[1],e.x+=+n[2],e.y+=+n[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"Q":e.x1=+n[0],e.y1=+n[1],e.x=+n[2],e.y=+n[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"q":e.x1=e.x+ +n[0],e.y1=e.y+ +n[1],e.x+=+n[2],e.y+=+n[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"A":case"a":break;case"Z":case"z":t.closePath()}}(t,r,i,n)}})),null!==n.fill&&t.fill(),null!==n.stroke&&t.stroke(),t.restore()}class At{currentFrame=0;totalFrames=0;videoEntity=void 0;config={container:null,context:null,loop:0,fillMode:"forwards",playMode:"forwards",startFrame:0,endFrame:0,loopStartFrame:0};selector="#svga-board";animator=null;ofsCanvas=null;ofsContext=null;bitmapsCache={};isReady=!1;async setConfig(t,e){let i;if(i="string"==typeof t?{container:t}:t,void 0!==i.startFrame&&void 0!==i.endFrame&&i.startFrame>i.endFrame)throw new Error("StartFrame should > EndFrame");const n=await Ft(i.container||this.selector,e);this.config.container=n.canvas,this.config.context=n.ctx,this.config.loop=i.loop??0,this.config.fillMode=i.fillMode??"forwards",this.config.playMode=i.playMode??"forwards",this.config.startFrame=i.startFrame??0,this.config.endFrame=i.endFrame??0,this.config.loopStartFrame=i.loopStartFrame??0,this.ofsCanvas=It({width:n.canvas.width,height:n.canvas.height}),this.ofsContext=this.ofsCanvas.getContext("2d"),this.animator=new St(n.canvas),this.animator.onEnd=()=>{void 0!==this.onEnd&&this.onEnd()},this.isReady=!0}async mount(t,e,i){if(e&&await this.setConfig(e,i),this.currentFrame=0,this.totalFrames=t.frames-1,this.videoEntity=t,this.clearContainer(),this.setSize(),kt.clearTime("render"),void 0===this.videoEntity)return;const{images:n}=this.videoEntity;if(0===Object.keys(n).length)return;let r=[];for(let t in n){const e=n[t],i=Dt(this.ofsCanvas,e).then((e=>{this.bitmapsCache[t]=e}));r.push(i)}return Promise.all(r)}onStart;onResume;onPause;onStop;onProcess;onEnd;clearContainer(){if(!this.isReady)return;const{container:t}=this.config;if(null!==t){const{width:e}=t;t.width=e}}start(){if(this.isReady){if(void 0===this.videoEntity)throw new Error("videoEntity undefined");this.clearContainer(),this.startAnimation(),void 0!==this.onStart&&this.onStart()}}resume(){this.isReady&&(this.startAnimation(),void 0!==this.onResume&&this.onResume())}pause(){this.isReady&&(this.animator.stop(),void 0!==this.onPause&&this.onPause())}stop(){this.isReady&&(this.animator.stop(),this.currentFrame=0,this.clearContainer(),void 0!==this.onStop&&this.onStop())}clear(){this.isReady&&this.clearContainer()}destroy(){this.isReady&&(this.animator.stop(),this.clearContainer(),this.animator=null,this.videoEntity=void 0)}startAnimation(){if(void 0===this.videoEntity)throw new Error("videoEntity undefined");const{config:t,totalFrames:e,videoEntity:i}=this,{playMode:n,startFrame:r,endFrame:s,loopStartFrame:a,fillMode:o,loop:l}=t;this.currentFrame===e&&(this.currentFrame=r>0?r:0),"forwards"===n?(this.animator.startValue=r>0?r:0,this.animator.endValue=s>0?s:e):(this.animator.startValue=s>0?s:e,this.animator.endValue=r>0?r:0);let c=i.frames;s>0&&s>r?c=s-r:s<=0&&r>0&&(c=i.frames-r),this.animator.duration=c*(1/i.fps)*1e3,this.animator.loopStart=a>r?(a-r)*(1/i.fps)*100:0,this.animator.loop=!0===l||l<=0?1/0:!1===l?1:l,this.animator.fillRule="backwards"===o?1:0,this.animator.onUpdate=t=>{this.currentFrame!==t&&(this.currentFrame=t,this.drawFrame(),void 0!==this.onProcess&&this.onProcess())},this.animator.start()}setSize(){if(void 0===this.videoEntity)throw new Error("videoEntity undefined");const{container:t}=this.config,{width:e,height:i}=this.videoEntity.size;t.width=e,t.height=i}drawFrame(){if(void 0===this.videoEntity)throw new Error("Player VideoEntity undefined");kt.time("render",(()=>{this.clearContainer();const{context:t,container:e}=this.config;if(null===t)throw new Error("Canvas Context cannot be null");const{width:i=0,height:n=0}=e;let{ofsCanvas:r,ofsContext:s}=this;mt===ft&&navigator.userAgent.includes("Firefox")?r=It({width:i,height:n}):(r.width=i,r.height=n),Rt(s,this.bitmapsCache,this.videoEntity,this.currentFrame);const a=s.getImageData(0,0,i,n);t.putImageData(a,0,0,0,0,i,n)}))}}export{Et as Parser,At as Player};
//# sourceMappingURL=index.js.map

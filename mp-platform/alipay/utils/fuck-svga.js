var t;!function(t){t.WECHAT="weapp",t.ALIPAY="alipay",t.DOUYIN="tt",t.H5="h5"}(t||(t={}));let e=function(){if("undefined"!=typeof window)return t.H5;if("undefined"!=typeof tt)return t.DOUYIN;if("undefined"!=typeof my)return t.ALIPAY;if("undefined"!=typeof wx)return t.WECHAT;throw new Error("Unsupported app")}();const s={is:t=>e===t,not:t=>e!==t,get:()=>e,set:t=>{e=t}};var i=Uint8Array,r=Uint16Array,a=Int32Array,n=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(t,e){for(var s=new r(31),i=0;i<31;++i)s[i]=e+=1<<t[i-1];var n=new a(s[30]);for(i=1;i<30;++i)for(var o=s[i];o<s[i+1];++o)n[o]=o-s[i]<<5|i;return{b:s,r:n}},c=h(n,2),u=c.b,f=c.r;u[28]=258,f[258]=28;for(var d=h(o,0).b,p=new r(32768),m=0;m<32768;++m){var y=(43690&m)>>1|(21845&m)<<1;y=(61680&(y=(52428&y)>>2|(13107&y)<<2))>>4|(3855&y)<<4,p[m]=((65280&y)>>8|(255&y)<<8)>>1}var g=function(t,e,s){for(var i=t.length,a=0,n=new r(e);a<i;++a)t[a]&&++n[t[a]-1];var o,l=new r(e);for(a=1;a<e;++a)l[a]=l[a-1]+n[a-1]<<1;if(s){o=new r(1<<e);var h=15-e;for(a=0;a<i;++a)if(t[a])for(var c=a<<4|t[a],u=e-t[a],f=l[t[a]-1]++<<u,d=f|(1<<u)-1;f<=d;++f)o[p[f]>>h]=c}else for(o=new r(i),a=0;a<i;++a)t[a]&&(o[a]=p[l[t[a]-1]++]>>15-t[a]);return o},b=new i(288);for(m=0;m<144;++m)b[m]=8;for(m=144;m<256;++m)b[m]=9;for(m=256;m<280;++m)b[m]=7;for(m=280;m<288;++m)b[m]=8;var w=new i(32);for(m=0;m<32;++m)w[m]=5;var x=g(b,9,1),k=g(w,5,1),v=function(t){for(var e=t[0],s=1;s<t.length;++s)t[s]>e&&(e=t[s]);return e},I=function(t,e,s){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&s},C=function(t,e){var s=e/8|0;return(t[s]|t[s+1]<<8|t[s+2]<<16)>>(7&e)},T=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],S=function(t,e,s){var i=new Error(e||T[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,S),!s)throw i;return i},E=function(t,e,s,r){var a=t.length;if(!a||e.f&&!e.l)return s||new i(0);var h=!s,c=h||2!=e.i,f=e.i;h&&(s=new i(3*a));var p=function(t){var e=s.length;if(t>e){var r=new i(Math.max(2*e,t));r.set(s),s=r}},m=e.f||0,y=e.p||0,b=e.b||0,w=e.l,T=e.d,E=e.m,A=e.n,M=8*a;do{if(!w){m=I(t,y,1);var P=I(t,y+1,3);if(y+=3,!P){var D=t[(z=4+((y+7)/8|0))-4]|t[z-3]<<8,F=z+D;if(F>a){f&&S(0);break}c&&p(b+D),s.set(t.subarray(z,F),b),e.b=b+=D,e.p=y=8*F,e.f=m;continue}if(1==P)w=x,T=k,E=9,A=5;else if(2==P){var R=I(t,y,31)+257,O=I(t,y+10,15)+4,H=R+I(t,y+5,31)+1;y+=14;for(var Y=new i(H),W=new i(19),L=0;L<O;++L)W[l[L]]=I(t,y+3*L,7);y+=3*O;var U=v(W),$=(1<<U)-1,B=g(W,U,1);for(L=0;L<H;){var z,X=B[I(t,y,$)];if(y+=15&X,(z=X>>4)<16)Y[L++]=z;else{var N=0,K=0;for(16==z?(K=3+I(t,y,3),y+=2,N=Y[L-1]):17==z?(K=3+I(t,y,7),y+=3):18==z&&(K=11+I(t,y,127),y+=7);K--;)Y[L++]=N}}var J=Y.subarray(0,R),q=Y.subarray(R);E=v(J),A=v(q),w=g(J,E,1),T=g(q,A,1)}else S(1);if(y>M){f&&S(0);break}}c&&p(b+131072);for(var V=(1<<E)-1,_=(1<<A)-1,j=y;;j=y){var G=(N=w[C(t,y)&V])>>4;if((y+=15&N)>M){f&&S(0);break}if(N||S(2),G<256)s[b++]=G;else{if(256==G){j=y,w=null;break}var Q=G-254;if(G>264){var Z=n[L=G-257];Q=I(t,y,(1<<Z)-1)+u[L],y+=Z}var tt=T[C(t,y)&_],et=tt>>4;tt||S(3),y+=15&tt;q=d[et];if(et>3){Z=o[et];q+=C(t,y)&(1<<Z)-1,y+=Z}if(y>M){f&&S(0);break}c&&p(b+131072);var st=b+Q;if(b<q){var it=0-q,rt=Math.min(q,st);for(it+b<0&&S(3);b<rt;++b)s[b]=r[it+b]}for(;b<st;++b)s[b]=s[b-q]}}e.l=w,e.p=j,e.b=b,e.f=m,w&&(m=1,e.m=E,e.d=T,e.n=A)}while(!m);return b!=s.length&&h?function(t,e,s){return(null==s||s>t.length)&&(s=t.length),new i(t.subarray(e,s))}(s,0,b):s.subarray(0,b)},A=new i(0);function M(t,e){return E(t.subarray(((8!=(15&(s=t)[0])||s[0]>>4>7||(s[0]<<8|s[1])%31)&&S(6,"invalid zlib data"),1==(s[1]>>5&1)&&S(6,"invalid zlib data: "+(32&s[1]?"need":"unexpected")+" dictionary"),2+(s[1]>>3&4)),-4),{i:2},e,e);var s}var P="undefined"!=typeof TextDecoder&&new TextDecoder;try{P.decode(A,{stream:!0})}catch(t){}var D={readFloatLE(t,e){const s=((t,e)=>(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0)(t,e),i=2*(s>>31)+1,r=s>>>23&255,a=8388607&s;return 255===r?a?NaN:i*(1/0):0===r?1401298464324817e-60*i*a:i*2**(r-150)*(a+8388608)}},F={read(t,e,s){if(s-e<1)return"";const i=t=>String.fromCharCode(t);let r="";for(let a=e;a<s;){const e=t[a++];if(e<=127)r+=i(e);else if(e>=192&&e<224)r+=i((31&e)<<6|63&t[a++]);else if(e>=224&&e<240)r+=i((15&e)<<12|(63&t[a++])<<6|63&t[a++]);else if(e>=240){const s=((7&e)<<18|(63&t[a++])<<12|(63&t[a++])<<6|63&t[a++])-65536;r+=i(55296+(s>>10)),r+=i(56320+(1023&s))}}return r}};class R{static create(t){if(t instanceof R)return t;if(t instanceof Uint8Array)return new R(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}slice(t,e,s){return t.subarray(e,s)}indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}uint32(){let t=4294967295;if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,this.indexOutOfRange(this,10);return t}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=D.readFloatLE(this.buf,this.pos);return this.pos+=4,t}bytes(){const t=this.uint32(),e=this.pos,s=this.pos+t;if(s>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,e==s?new Uint8Array(0):this.slice(this.buf,e,s)}string(){const t=this.bytes();return F.read(t,0,t.length)}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw this.indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class O{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new O;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.x=t.float();break;case 2:i.y=t.float();break;case 3:i.width=t.float();break;case 4:i.height=t.float();break;default:t.skipType(7&e)}}return i}x=0;y=0;width=0;height=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height))}}class H{static decode(t,e){t=R.create(t);let s=null==e?t.len:t.pos+e,i=new H;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:i.a=t.float();break;case 2:i.b=t.float();break;case 3:i.c=t.float();break;case 4:i.d=t.float();break;case 5:i.tx=t.float();break;case 6:i.ty=t.float();break;default:t.skipType(7&e)}}return i}a=0;b=0;c=0;d=0;tx=0;ty=0;constructor(t){t&&(null!=t.a&&(this.a=t.a),null!=t.b&&(this.b=t.b),null!=t.c&&(this.c=t.c),null!=t.d&&(this.d=t.d),null!=t.tx&&(this.tx=t.tx),null!=t.ty&&(this.ty=t.ty))}}class Y{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new Y;for(;t.pos<s;){const e=t.uint32();if(e>>>3==1)i.d=t.string();else t.skipType(7&e)}return i}d="";constructor(t){t&&null!=t.d&&(this.d=t.d)}}class W{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new W;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.x=t.float();break;case 2:i.y=t.float();break;case 3:i.width=t.float();break;case 4:i.height=t.float();break;case 5:i.cornerRadius=t.float();break;default:t.skipType(7&e)}}return i}x=0;y=0;width=0;height=0;cornerRadius=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.cornerRadius&&(this.cornerRadius=t.cornerRadius))}}class L{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new L;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.x=t.float();break;case 2:i.y=t.float();break;case 3:i.radiusX=t.float();break;case 4:i.radiusY=t.float();break;default:t.skipType(7&e)}}return i}x=0;y=0;radiusX=0;radiusY=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.radiusX&&(this.radiusX=t.radiusX),null!=t.radiusY&&(this.radiusY=t.radiusY))}}class U{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new U;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.r=t.float();break;case 2:i.g=t.float();break;case 3:i.b=t.float();break;case 4:i.a=t.float();break;default:t.skipType(7&e)}}return i}r=0;g=0;b=0;a=0;constructor(t){t&&(null!=t.r&&(this.r=t.r),null!=t.g&&(this.g=t.g),null!=t.b&&(this.b=t.b),null!=t.a&&(this.a=t.a))}}class ${static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new $;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.fill=U.decode(t,t.uint32());break;case 2:i.stroke=U.decode(t,t.uint32());break;case 3:i.strokeWidth=t.float();break;case 4:i.lineCap=t.int32();break;case 5:i.lineJoin=t.int32();break;case 6:i.miterLimit=t.float();break;case 7:i.lineDashI=t.float();break;case 8:i.lineDashII=t.float();break;case 9:i.lineDashIII=t.float();break;default:t.skipType(7&e)}}return i}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0;constructor(t){t&&(null!=t.fill&&(this.fill=t.fill),null!=t.lineCap&&(this.lineCap=t.lineCap),null!=t.lineDashI&&(this.lineDashI=t.lineDashI),null!=t.lineDashII&&(this.lineDashII=t.lineDashII),null!=t.lineDashIII&&(this.lineDashIII=t.lineDashIII),null!=t.lineJoin&&(this.lineJoin=t.lineJoin),null!=t.miterLimit&&(this.miterLimit=t.miterLimit),null!=t.stroke&&(this.stroke=t.stroke),null!=t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}}class B{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new B;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:i.type=t.int32();break;case 2:i.shape=Y.decode(t,t.uint32());break;case 3:i.rect=W.decode(t,t.uint32());break;case 4:i.ellipse=L.decode(t,t.uint32());break;case 10:i.styles=$.decode(t,t.uint32());break;case 11:i.transform=H.decode(t,t.uint32());break;default:t.skipType(7&e)}}return i}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null;$oneOfFields=["shape","rect","ellipse"];$fieldMap={};get args(){const t=Object.keys(this);for(let e=t.length-1;e>-1;--e){const s=t[e],i=this[s];if(1==this.$fieldMap[s]&&null!=i)return s}return""}set args(t){for(var e=0;e<this.$oneOfFields.length;++e){const s=this.$oneOfFields[e];s!=t&&delete this[s]}}constructor(t){t&&(null!=t.type&&(this.type=t.type),null!=t.ellipse&&(this.ellipse=t.ellipse),null!=t.rect&&(this.rect=t.rect),null!=t.shape&&(this.shape=t.shape),null!=t.styles&&(this.styles=t.styles),null!=t.transform&&(this.transform=t.transform));for(var e=0;e<this.$oneOfFields.length;++e)this.$fieldMap[this.$oneOfFields[e]]=1}}class z{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new z;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.alpha=t.float();break;case 2:i.layout=O.decode(t,t.uint32());break;case 3:i.transform=H.decode(t,t.uint32());break;case 4:i.clipPath=t.string();break;case 5:i.shapes&&i.shapes.length||(i.shapes=[]),i.shapes.push(B.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return i}shapes=[];alpha=0;layout=null;transform=null;clipPath="";constructor(t){t&&(null!=t.alpha&&(this.alpha=t.alpha),null!=t.clipPath&&(this.clipPath=t.clipPath),null!=t.layout&&(this.layout=t.layout),null!=t.shapes&&(this.shapes=t.shapes),null!=t.transform&&(this.transform=t.transform))}}class X{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new X;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.imageKey=t.string();break;case 2:i.frames&&i.frames.length||(i.frames=[]),i.frames.push(z.decode(t,t.uint32()));break;case 3:i.matteKey=t.string();break;default:t.skipType(7&e)}}return i}frames=[];imageKey="";matteKey="";constructor(t){t&&(null!=t.frames&&(this.frames=t.frames),null!=t.imageKey&&(this.imageKey=t.imageKey),null!=t.matteKey&&(this.matteKey=t.matteKey))}}class N{static decode(t,e){t=R.create(t);let s=null==e?t.len:t.pos+e,i=new N;for(;t.pos<s;){let e=t.uint32();switch(e>>>3){case 1:i.viewBoxWidth=t.float();break;case 2:i.viewBoxHeight=t.float();break;case 3:i.fps=t.int32();break;case 4:i.frames=t.int32();break;default:t.skipType(7&e)}}return i}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0;constructor(t){t&&(null!=t.viewBoxWidth&&(this.viewBoxWidth=t.viewBoxWidth),null!=t.viewBoxHeight&&(this.viewBoxHeight=t.viewBoxHeight),null!=t.fps&&(this.fps=t.fps),null!=t.frames&&(this.frames=t.frames))}}const K=Object.freeze({});class J{static decode(t,e){t=R.create(t);const s=null==e?t.len:t.pos+e,i=new J;let r,a;for(;t.pos<s;){const e=t.uint32();switch(e>>>3){case 1:i.version=t.string();break;case 2:i.params=N.decode(t,t.uint32());break;case 3:{i.images==K&&(i.images={});const e=t.uint32()+t.pos;for(r="",a=[];t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:r=t.string();break;case 2:a=t.bytes();break;default:t.skipType(7&e)}}i.images[r]=a;break}case 4:i.sprites&&i.sprites.length||(i.sprites=[]),i.sprites.push(X.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return i}version="";params=null;images=K;sprites=[];constructor(t){t&&(null!=t.version&&(this.version=t.version),null!=t.images&&(this.images=t.images),null!=t.params&&(this.params=t.params),null!=t.sprites&&(this.sprites=t.sprites))}}const q=new Array(256),V=new Array(256);for(let t=0;t<8;t++)q[t]=1<<t;for(let t=8;t<256;t++)q[t]=q[t-4]^q[t-5]^q[t-6]^q[t-8];for(let t=0;t<255;t++)V[q[t]]=t;var _=Uint8Array,j=Uint16Array,G=Int32Array,Q=new _([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Z=new _([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),et=function(t,e){for(var s=new j(31),i=0;i<31;++i)s[i]=e+=1<<t[i-1];var r=new G(s[30]);for(i=1;i<30;++i)for(var a=s[i];a<s[i+1];++a)r[a]=a-s[i]<<5|i;return{b:s,r:r}},st=et(Q,2),it=st.b,rt=st.r;it[28]=258,rt[258]=28,et(Z,0);for(var at=new j(32768),nt=0;nt<32768;++nt){var ot=(43690&nt)>>1|(21845&nt)<<1;ot=(61680&(ot=(52428&ot)>>2|(13107&ot)<<2))>>4|(3855&ot)<<4,at[nt]=((65280&ot)>>8|(255&ot)<<8)>>1}var lt=new _(288);for(nt=0;nt<144;++nt)lt[nt]=8;for(nt=144;nt<256;++nt)lt[nt]=9;for(nt=256;nt<280;++nt)lt[nt]=7;for(nt=280;nt<288;++nt)lt[nt]=8;var ht=new _(32);for(nt=0;nt<32;++nt)ht[nt]=5;var ct=new _(0),ut="undefined"!=typeof TextDecoder&&new TextDecoder;try{ut.decode(ct,{stream:!0})}catch(t){}var ft,dt,pt={};
/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */ft||(ft=1,dt=function(t){t.version="1.2.2";var e=function(){for(var t=0,e=new Array(256),s=0;256!=s;++s)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=s)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[s]=t;return"undefined"!=typeof Int32Array?new Int32Array(e):e}(),s=function(t){var e=0,s=0,i=0,r="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(i=0;256!=i;++i)r[i]=t[i];for(i=0;256!=i;++i)for(s=t[i],e=256+i;e<4096;e+=256)s=r[e]=s>>>8^t[255&s];var a=[];for(i=1;16!=i;++i)a[i-1]="undefined"!=typeof Int32Array?r.subarray(256*i,256*i+256):r.slice(256*i,256*i+256);return a}(e),i=s[0],r=s[1],a=s[2],n=s[3],o=s[4],l=s[5],h=s[6],c=s[7],u=s[8],f=s[9],d=s[10],p=s[11],m=s[12],y=s[13],g=s[14];t.table=e,t.bstr=function(t,s){for(var i=~s,r=0,a=t.length;r<a;)i=i>>>8^e[255&(i^t.charCodeAt(r++))];return~i},t.buf=function(t,s){for(var b=~s,w=t.length-15,x=0;x<w;)b=g[t[x++]^255&b]^y[t[x++]^b>>8&255]^m[t[x++]^b>>16&255]^p[t[x++]^b>>>24]^d[t[x++]]^f[t[x++]]^u[t[x++]]^c[t[x++]]^h[t[x++]]^l[t[x++]]^o[t[x++]]^n[t[x++]]^a[t[x++]]^r[t[x++]]^i[t[x++]]^e[t[x++]];for(w+=15;x<w;)b=b>>>8^e[255&(b^t[x++])];return~b},t.str=function(t,s){for(var i=~s,r=0,a=t.length,n=0,o=0;r<a;)(n=t.charCodeAt(r++))<128?i=i>>>8^e[255&(i^n)]:n<2048?i=(i=i>>>8^e[255&(i^(192|n>>6&31))])>>>8^e[255&(i^(128|63&n))]:n>=55296&&n<57344?(n=64+(1023&n),o=1023&t.charCodeAt(r++),i=(i=(i=(i=i>>>8^e[255&(i^(240|n>>8&7))])>>>8^e[255&(i^(128|n>>2&63))])>>>8^e[255&(i^(128|o>>6&15|(3&n)<<4))])>>>8^e[255&(i^(128|63&o))]):i=(i=(i=i>>>8^e[255&(i^(224|n>>12&15))])>>>8^e[255&(i^(128|n>>6&63))])>>>8^e[255&(i^(128|63&n))];return~i}},"undefined"==typeof DO_NOT_EXPORT_CRC?dt(pt):dt({}));const mt=s.is(t.H5)?globalThis:s.is(t.ALIPAY)?my:s.is(t.DOUYIN)?tt:wx;const yt=s.is(t.H5)?globalThis.devicePixelRatio:"getWindowInfo"in mt?mt.getWindowInfo().pixelRatio:"getSystemInfoSync"in mt?mt.getSystemInfoSync().pixelRatio:1;function gt(e,i){return new Promise(((r,a)=>{const n=(t,e=0,s=0)=>{if(!t)return void a(new Error("canvas not found."));const i=t.getContext("2d");t.width=e*yt,t.height=s*yt,i.scale(yt,yt),r({canvas:t,ctx:i})};if(s.is(t.H5)){const t=document.querySelector(e),{clientWidth:s,clientHeight:i}=t;n(t,s,i)}else{let t=mt.createSelectorQuery();i&&(t=t.in(i)),t.select(e).fields({node:!0,size:!0},(t=>{const{node:e,width:s,height:i}=t||{};n(e,s,i)})).exec()}}))}function bt(e){const i=function(e){if(s.is(t.H5))return new OffscreenCanvas(e.width,e.height);if(s.is(t.ALIPAY))return my.createOffscreenCanvas({width:e.width,height:e.height});if(s.is(t.DOUYIN)){const t=tt.createOffscreenCanvas();return t.width=e.width,t.height=e.height,t}return wx.createOffscreenCanvas({...e,type:"2d"})}(e),r=i.getContext("2d");return{canvas:i,ctx:r}}const wt=t=>/^http(s)?:\/\//.test(t);const xt={time(t){console.time?.(t)},timeEnd(t){console.timeEnd?.(t)}};var kt={count:20,label(t){console.log(t)},async time(t,e){xt.time(t);const s=await e();return xt.timeEnd(t),s},line(t=40){console.log("-".repeat(t))},log(...t){console.log("【benchmark】",...t)}};const{USER_DATA_PATH:vt=""}=s.is(t.H5)?{}:s.is(t.DOUYIN)?tt.getEnvInfoSync().common:mt.env;function It(t,e){return`${vt}/${e?`${e}.`:""}${t}`}let Ct=null;function Tt(){null===Ct&&(Ct=mt.getFileSystemManager())}function St(t,e){return Tt(),kt.log(`write file: ${e}`),new Promise(((s,i)=>{Ct.access({path:e,success(){s(e)},fail(){Ct.writeFile({filePath:e,data:t,success(){s(e)},fail(t){kt.log(`write fail: ${e}`,t),i(t)}})}})}))}function Et(t){return Tt(),new Promise((e=>{Ct.access({path:t,success(){kt.log(`remove file: ${t}`),Ct.unlink({filePath:t,success:()=>e(t),fail(s){kt.log(`remove fail: ${t}`,s),e(t)}})},fail(s){kt.log(`access fail: ${t}`,s),e(t)}})}))}const At="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Mt(e){return`data:image/png;base64,${function(e){if(s.is(t.H5))return btoa(e);let i,r,a,n,o="",l=e.length%3;for(let t=0;t<e.length;){if((r=e.charCodeAt(t++))>255||(a=e.charCodeAt(t++))>255||(n=e.charCodeAt(t++))>255)throw new TypeError('Failed to execute "btoa" on "Window": The string to be encoded contains characters outside of the Latin1 range.');i=r<<16|a<<8|n,o+=At.charAt(i>>18&63)+At.charAt(i>>12&63)+At.charAt(i>>6&63)+At.charAt(63&i)}return l?o.slice(0,l-3)+"===".substring(l):o}(String.fromCharCode(...e))}`}function Pt(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function Dt(t,e){return new Promise(((s,i)=>{const r=t.createImage();r.onload=()=>{e.startsWith("data:")||"string"==typeof e?s(r):Et(e).then((()=>s(r))).catch((()=>s(r)))},r.onerror=()=>i(new Error(`SVGA LOADING FAILURE: ${r.src}`)),r.src=e}))}function Ft(e,i,r,a){if(s.is(t.H5)){if(i instanceof Uint8Array&&"createImageBitmap"in globalThis)return function(t){return globalThis.createImageBitmap(new Blob([Pt(t)]))}(i);if(i instanceof ImageBitmap)return Promise.resolve(i)}return"string"==typeof i&&wt(i)?Dt(e,i):async function(e,i,r){if("string"==typeof e)return e;if(s.is(t.H5)||s.is(t.ALIPAY)&&mt.isIDE)return Mt(e);try{return await St(Pt(e),It(i,r))}catch(t){return console.warn(`图片缓存失败：${t.message}`),Mt(e)}}(i,r,a).then((t=>Dt(e,t)))}const Rt=()=>{};const Ot=function(){if(s.is(t.H5)){const t=navigator.userAgent;if(/(Android)/i.test(t))return"Android";if(/(iPhone|iPad|iPod|iOS)/i.test(t))return"iOS";if(/(OpenHarmony|ArkWeb)/i.test(t))return"OpenHarmony"}else{if(s.is(t.ALIPAY))return mt.getDeviceBaseInfo().platform;if(s.is(t.DOUYIN))return mt.getDeviceInfoSync().platform;if(s.is(t.WECHAT))return mt.getDeviceInfo().platform}return"UNKNOWN"}().toLocaleUpperCase(),Ht=()=>"undefined"!=typeof performance?performance.now():Date.now();class Yt{version;filename;size={width:0,height:0};fps=20;frames=0;images={};replaceElements={};dynamicElements={};sprites=[];constructor(t,e){const{viewBoxWidth:s,viewBoxHeight:i,fps:r,frames:a}=t.params;this.version=t.version,this.filename=e,this.size.width=s,this.size.height=i,this.fps=r,this.frames=a,this.images=t.images||{},this.sprites=this.formatSprites(t.sprites||[])}formatSprites(t){return t.map((t=>({imageKey:t.imageKey,frames:this.formatFrames(t.frames||[])})))}formatFrames(t){let e;return t.map((t=>{const{layout:s,transform:i,alpha:r}=t,a={x:s?.x+.5|0,y:s?.y+.5|0,width:s?.width+.5|0,height:s?.height+.5|0},n={a:i?.a??1,b:i?.b??0,c:i?.c??0,d:i?.d??1,tx:i?.tx??0,ty:i?.ty??0};let o=this.formatShapes(t.shapes||[]);3===t.shapes[0]?.type&&e?o=e:e=o;const l=n.a*a.x+n.c*a.y+n.tx,h=n.a*(a.x+a.width)+n.c*a.y+n.tx,c=n.a*a.x+n.c*(a.y+a.height)+n.tx,u=n.a*(a.x+a.width)+n.c*(a.y+a.height)+n.tx,f=n.b*a.x+n.d*a.y+n.ty,d=n.b*(a.x+a.width)+n.d*a.y+n.ty,p=n.b*a.x+n.d*(a.y+a.height)+n.ty,m=n.b*(a.x+a.width)+n.d*(a.y+a.height)+n.ty,y=Math.min(c,u,l,h)+.5|0,g=Math.min(p,m,f,d)+.5|0,b=t.clipPath??"";return{alpha:r??0,layout:a,transform:n,clipPath:b,shapes:o,nx:y,ny:g,maskPath:b.length>0?{d:b,transform:void 0,styles:{fill:"rgba(0, 0, 0, 0)",stroke:null,strokeWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null}}:null}}))}formatShapes(t){const e=[];for(let s of t){const t=s.styles;if(null==t)continue;const i=[],{lineDashI:r,lineDashII:a,lineDashIII:n}=t;r>0&&i.push(r),a>0&&(i.length<1&&i.push(0),i.push(a)),n>0&&(i.length<2&&(i.push(0),i.push(0)),i[2]=n);let o=null;switch(t.lineCap){case 0:o="butt";break;case 1:o="round";break;case 2:o="square"}let l=null;switch(t.lineJoin){case 2:l="bevel";break;case 1:l="round";break;case 0:l="miter"}const{fill:h,stroke:c}=t;let u=null;h&&(u=`rgba(${255*h.r|0}, ${255*h.g|0}, ${255*h.b|0}, ${1*h.a|0})`);let f=null;c&&(f=`rgba(${255*c.r|0}, ${255*c.g|0}, ${255*c.b|0}, ${1*c.a|0})`);const d={lineDash:i,fill:u,stroke:f,lineCap:o,lineJoin:l,strokeWidth:t.strokeWidth,miterLimit:t.miterLimit},{transform:p,shape:m,rect:y,ellipse:g}=s,b={a:p?.a??1,b:p?.b??0,c:p?.c??0,d:p?.d??1,tx:p?.tx??0,ty:p?.ty??0};0===s.type&&m?e.push({type:"shape",path:m,styles:d,transform:b}):1===s.type&&y?e.push({type:"rect",path:y,styles:d,transform:b}):2===s.type&&g&&e.push({type:"ellipse",path:g,styles:d,transform:b})}return e}}class Wt{static getFileName(t){return t.substring(t.lastIndexOf("/")+1)}static parseVideo(t,e){const s=new Uint8Array(t,0,4),i=new Uint8Array(t);if("80,75,3,4"===s.toString())throw new Error("this parser only support version@2 of SVGA.");let r;return kt.time("unzlibSync",(()=>{const t=M(i),s=J.decode(t);r=new Yt(s,Wt.getFileName(e))})),r}download(e){return wt(e)?function(e){return s.is(t.H5)?fetch(e).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)})):new Promise(((t,s)=>{mt.request({url:e,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:!0,success:e=>t(e.data),fail:s})}))}(e):s.not(t.H5)?(i=e,Tt(),new Promise(((t,e)=>{Ct.access({path:i,success(){Ct.readFile({filePath:i,success:e=>t(e.data),fail:e})},fail:e})}))):Promise.resolve(null);var i}async load(t){const e=await this.download(t);return kt.label(t),kt.line(),Wt.parseVideo(e,t)}}function Lt(t,e,s,i,r,a,n){const o=e.frames[s];if(!(o.alpha<.05)){t.save(),n&&t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty),t.globalAlpha=o.alpha,t.transform(o.transform?.a??1,o.transform?.b??0,o.transform?.c??0,o.transform?.d??1,o.transform?.tx??0,o.transform?.ty??0),i&&(o.maskPath&&(Bt(t,o.maskPath.d,o.maskPath.transform,o.maskPath.styles),t.clip()),t.drawImage(r||i,0,0,o.layout.width,o.layout.height)),a&&t.drawImage(a,(o.layout.width-a.width)/2,(o.layout.height-a.height)/2);for(let e=0;e<o.shapes.length;e++)Ut(t,o.shapes[e]);t.restore()}}function Ut(t,e){switch(e.type){case"shape":Bt(t,e.path.d,e.transform,e.styles);break;case"ellipse":!function(t,e,s,i,r,a,n){t.save(),$t(t,n),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty);e-=i;const o=2*i,l=2*r,h=.5522848,c=o/2*h,u=l/2*h,f=e+o,d=(s-=r)+l,p=e+o/2,m=s+l/2;t.beginPath(),t.moveTo(e,m),t.bezierCurveTo(e,m-u,p-c,s,p,s),t.bezierCurveTo(p+c,s,f,m-u,f,m),t.bezierCurveTo(f,m+u,p+c,d,p,d),t.bezierCurveTo(p-c,d,e,m+u,e,m),n.fill&&t.fill();n.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.radiusX??0,e.path.radiusY??0,e.transform,e.styles);break;case"rect":!function(t,e,s,i,r,a,n,o){t.save(),$t(t,o),n&&t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty);let l=a;i<2*l&&(l=i/2);r<2*l&&(l=r/2);t.beginPath(),t.moveTo(e+l,s),t.arcTo(e+i,s,e+i,s+r,l),t.arcTo(e+i,s+r,e,s+r,l),t.arcTo(e,s+r,e,s,l),t.arcTo(e,s,e+i,s,l),t.closePath(),o.fill&&t.fill();o.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.width??0,e.path.height??0,e.path.cornerRadius??0,e.transform,e.styles)}}function $t(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}function Bt(t,e,s,i){t.save(),$t(t,i),s&&t.transform(s.a,s.b,s.c,s.d,s.tx,s.ty);const r={x:0,y:0,x1:0,y1:0,x2:0,y2:0};if(t.beginPath(),e){const s=e.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ").split("|||");for(let e=0;e<s.length;e++){const i=s[e];if(0===i.length)continue;const a=i.substring(0,1);"MLHVCSQZmlhvcsqz".includes(a)&&zt(t,r,a,i.substring(1).trim().split(" "))}}i.fill&&t.fill(),i.stroke&&t.stroke(),t.restore()}function zt(t,e,s,i){switch(s){case"M":e.x=+i[0],e.y=+i[1],t.moveTo(e.x,e.y);break;case"m":e.x+=+i[0],e.y+=+i[1],t.moveTo(e.x,e.y);break;case"L":e.x=+i[0],e.y=+i[1],t.lineTo(e.x,e.y);break;case"l":e.x+=+i[0],e.y+=+i[1],t.lineTo(e.x,e.y);break;case"H":e.x=+i[0],t.lineTo(e.x,e.y);break;case"h":e.x+=+i[0],t.lineTo(e.x,e.y);break;case"V":e.y=+i[0],t.lineTo(e.x,e.y);break;case"v":e.y+=+i[0],t.lineTo(e.x,e.y);break;case"C":e.x1=+i[0],e.y1=+i[1],e.x2=+i[2],e.y2=+i[3],e.x=+i[4],e.y=+i[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"c":e.x1=e.x+ +i[0],e.y1=e.y+ +i[1],e.x2=e.x+ +i[2],e.y2=e.y+ +i[3],e.x+=+i[4],e.y+=+i[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"S":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=+i[0],e.y2=+i[1],e.x=+i[2],e.y=+i[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=+i[0],e.y1=+i[1],e.x=+i[2],e.y=+i[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"s":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=e.x+ +i[0],e.y2=e.y+ +i[1],e.x+=+i[2],e.y+=+i[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=e.x+ +i[0],e.y1=e.y+ +i[1],e.x+=+i[2],e.y+=+i[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"Q":e.x1=+i[0],e.y1=+i[1],e.x=+i[2],e.y=+i[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"q":e.x1=e.x+ +i[0],e.y1=e.y+ +i[1],e.x+=+i[2],e.y+=+i[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"Z":case"z":t.closePath()}}class Xt{pool=[];materials=new Map;isImage(e){return s.is(t.H5)&&e instanceof Image||void 0!==e.src&&void 0!==e.width&&void 0!==e.height}getMaterials(){return this.materials}clear(){this.materials.clear();for(let t=0;t<this.pool.length;t++){const e=this.pool[t];e.onload=null,e.onerror=null,e.src=""}}async loadImage(t,e,s){const i=[];Object.keys(t).forEach((r=>{const a=t[r];if(this.isImage(a))i.push(Promise.resolve(a));else{const t=Ft(e,a,s,r).then((t=>(this.materials.set(r,t),t)));i.push(t)}}));const r=await Promise.all(i);this.pool=r.filter((t=>this.isImage(t)))}createImage(e){const[i]=this.pool.splice(0,1);return i||(s.is(t.H5)?new Image:e.createImage())}}class Nt{mode;X=null;XC=null;Y=null;YC=null;W=0;H=0;model={};IM=new Xt;globalTransform;constructor(t="animation"){this.mode=t}setModel(e){const{model:i}=this;i.type=e,"O"===e&&s.is(t.H5)&&navigator.userAgent.includes("Firefox")?i.clear="CR":"O"===e&&s.is(t.DOUYIN)||s.is(t.ALIPAY)?i.clear="CL":i.clear="RE","C"===e&&(s.is(t.DOUYIN)||"IOS"===Ot&&s.is(t.ALIPAY))||"O"===e&&s.is(t.WECHAT)?i.render="PU":i.render="DR",kt.line(4),kt.log("brush type",i.type),kt.log("brush clear",i.clear),kt.log("brush render",i.render),kt.line(4)}async register(t,e,s){const{model:i,mode:r}=this,{canvas:a,ctx:n}=await gt(t,s),{width:o,height:l}=a;if(this.X=a,this.XC=n,this.W=o,this.H=l,"poster"===r)this.Y=this.X,this.YC=this.XC,this.setModel("C");else{let t;"string"==typeof e&&""!==e?(t=await gt(e,s),t.canvas.width=o,t.canvas.height=l,this.setModel("C")):(t=bt({width:o,height:l}),this.setModel("O")),this.Y=t.canvas,this.YC=t.ctx}if("CL"===i.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===r)this.clearSecondary=this.stick=Rt;else{switch(i.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:s,ctx:i}=bt({width:t,height:e});this.Y=s,this.YC=i};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:s}=this;s.width=t,s.height=e}}switch(i.render){case"DR":this.stick=()=>{const{W:t,H:e}=this;this.XC.drawImage(this.Y,0,0,t,e)};break;case"PU":this.stick=()=>{const{W:t,H:e}=this,s=this.YC.getImageData(0,0,t,e);this.XC.putImageData(s,0,0,0,0,t,e)}}}}loadImages(t,e){return this.IM.loadImage(t,this,e)}createImage(){return this.IM.createImage(this.X)}getImage(t="image/png",e=.92){return this.X.toDataURL(t,e)}resize(t,e){const{Y:s}=this;let i=1,r=1,a=0,n=0;if("fill"===t)i=s.width/e.width,r=s.height/e.height;else if(["aspect-fill","aspect-fit"].includes(t)){const o=e.width/e.height,l=s.width/s.height;o>=l&&"aspect-fit"===t||o<=l&&"aspect-fill"===t?(i=r=s.width/e.width,n=(s.height-e.height*r)/2):(o<l&&"aspect-fit"===t||o>l&&"aspect-fill"===t)&&(i=r=s.height/e.height,a=(s.width-e.width*i)/2)}this.globalTransform={a:i,b:0,c:0,d:r,tx:a,ty:n}}flush(e){(s.is(t.H5)?mt:this.X).requestAnimationFrame(e)}clearContainer=Rt;clearSecondary=Rt;clearMaterials(){this.IM.clear()}draw(t,e,s,i){!function(t,e,s,i,r,a,n){const{sprites:o,replaceElements:l,dynamicElements:h}=s;for(let s=r;s<a;s++){const r=o[s],{imageKey:a}=r;Lt(t,r,i,e.get(a),l[a],h[a],n)}}(this.YC,this.IM.getMaterials(),t,e,s,i,this.globalTransform)}stick=Rt;destroy(){this.clearContainer(),this.clearSecondary(),this.clearMaterials(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=Rt}}class Kt{brush;isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onStart=Rt;onUpdate=Rt;onEnd=Rt;constructor(t){this.brush=t}setConfig(t,e,s,i){this.duration=t,this.loopStart=e,this.loopDuration=t*s+i-e}start(){this.isRunning=!0,this.startTime=Ht(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=Ht(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(Ht()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1}doFrame(){this.isRunning&&(this.doDeltaTime(Ht()-this.startTime),this.isRunning&&this.brush.flush((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:s,loopDuration:i}=this;let r,a=!1;t>=i?(r=1,a=!0,this.stop()):r=(t+s)%e/e,kt.time("update partial",(()=>this.onUpdate(r))),!this.isRunning&&a&&this.onEnd()}}class Jt{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:s,startFrame:i,endFrame:r,fillMode:a,loop:n}=this,{fps:o,sprites:l}=t;let{frames:h}=t;const c=l.length,u=i>0?i:0,f=r>0&&r<h?r:h;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<h?h=f-u:u>0&&(h-=u);let d=s,p=0;"forwards"===e?(d===f-1&&(d=u),"forwards"===a&&(p=1)):(0===d&&(d=f-1),"backwards"===a&&(p=1));const m=1e3/o;return{currFrame:d,startFrame:u,endFrame:f,totalFrame:h,spriteCount:c,aniConfig:{duration:Math.floor(h*m*10**6)/10**6,loopStart:s>u?(s-u)*m:0,loop:0===n?1/0:n,fillValue:p*m}}}}class qt{entity=void 0;config=new Jt;brush=new Nt;animator=null;async setConfig(t,e){let s;s="string"==typeof t?{container:t}:t,this.config.register(s),await this.brush.register(s.container,s.secondary,e),this.animator=new Kt(this.brush)}setItem(t,e){this.config.setItem(t,e)}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:s}=t;return this.animator.stop(),this.entity=t,this.brush.clearSecondary(),this.brush.clearMaterials(),this.brush.loadImages(e,s)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.brush.clearContainer(),this.brush.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.brush.destroy(),this.animator=null,this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.startAnimation())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:s}=this.entity;this.stepToFrame(Math.round((t<0?0:t)*s)%s,e)}startAnimation(){const{entity:t,config:e,animator:s,brush:i}=this,{playMode:r,contentMode:a}=e,{currFrame:n,startFrame:o,endFrame:l,totalFrame:h,spriteCount:c,aniConfig:u}=e.getConfig(t),{duration:f,loopStart:d,loop:p,fillValue:m}=u;let y,g,b,w=0,x=0,k=n;s.setConfig(f,d,p,m),i.resize(a,t.size),s.onUpdate=e=>{"fallbacks"===r?(g=1-e,y=(0==e?l:Math.ceil(g*h))-1,b=Math.abs(1-g*h+k)):(g=e,y=1===e?o:Math.floor(g*h),b=Math.abs(g*h-k));const s=k===y;if(x!==c){const e=s?Math.min(c*b*1.15+2,c)|0:c;e>x&&(w=x,x=e,i.draw(t,k,w,x))}if(s)return;const a=k;i.clearContainer(),i.stick(),i.clearSecondary(),k=y,x=0,this.onProcess?.(~~(100*g)/100,a)},s.onEnd=()=>this.onEnd?.(),s.start()}}class Vt{entity=void 0;frame=0;contentMode="fill";brush=new Nt("poster");setConfig(t,e){let s;return s="string"==typeof t?{container:t}:t,s.contentMode&&(this.contentMode=s.contentMode),"number"==typeof s.frame&&(this.frame=s.frame),this.brush.register(s.container,"",e)}setContentMode(t){this.contentMode=t}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:s}=t;return this.entity=t,this.brush.clearMaterials(),this.brush.loadImages(e,s)}onStart;onEnd;setReplaceElement(t,e){this.entity&&(this.entity.replaceElements[t]=e)}async setReplaceElementByUrl(t,e){this.entity&&(this.entity.replaceElements[t]=await Ft(this.brush,e,e))}setDynamicElement(t,e){this.entity&&(this.entity.dynamicElements[t]=e)}async setDynamicElementByUrl(t,e){this.entity&&(this.entity.dynamicElements[t]=await Ft(this.brush,e,e))}draw(){if(!this.entity)return;const{brush:t,entity:e,contentMode:s,frame:i,onStart:r,onEnd:a}=this;r?.(),t.clearContainer(),t.resize(s,e.size),t.draw(e,i,0,e.sprites.length),a?.()}toDataURL(t,e){return this.brush.getImage(t,e)}clear(){this.brush.clearContainer(),this.brush.clearMaterials()}destroy(){this.brush.destroy(),this.entity=void 0}}class _t{point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];parser=new Wt;get length(){return this.buckets.length}updateRemainPoints(){this.point<Math.ceil(this.maxRemain/2)?(this.remainStart=0,this.remainEnd=this.maxRemain):this.length-this.point<Math.floor(this.maxRemain/2)?(this.remainStart=this.remainEnd-this.maxRemain,this.remainEnd=this.length):(this.remainStart=Math.floor(this.point-this.maxRemain/2),this.remainEnd=this.remainStart+this.maxRemain)}updateBucketOperators(t){const{remainStart:e,remainEnd:s}=this;return this.point=t,this.updateRemainPoints(),e===s?[{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>s||this.remainEnd<e?[{action:"remove",start:e,end:s},{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>e&&this.remainEnd>s?[{action:"remove",start:e,end:this.remainStart},{action:"add",start:s,end:this.remainEnd}]:this.remainStart<e&&this.remainEnd<s?[{action:"remove",start:this.remainEnd,end:s},{action:"add",start:this.remainStart,end:e}]:[]}async getBucket(t){if(t<0||t>=this.length)return this.buckets[this.point];const e=this.updateBucketOperators(t);if(e.length){const t=[];e.forEach((({action:e,start:s,end:i})=>{for(let r=s;r<i;r++){const s=this.buckets[r];"remove"===e?s.entity=null:"add"===e&&(s.promise=this.parser.load(s.local||s.origin),"whole"!==this.loadMode&&this.point!==r||t.push(s.promise))}})),await Promise.all(t)}return this.get()}setLoadMode(t){this.loadMode=t}async prepare(e,i,r){const{parser:a,loadMode:n}=this;this.point="number"==typeof i&&i>0&&i<e.length?i:0,this.maxRemain="number"==typeof r&&r>0?r:3,this.updateRemainPoints(),this.buckets=await Promise.all(e.map((async(e,i)=>{const r={origin:e,local:"",entity:null,promise:null};if(s.is(t.H5))return r.local=e,this.remainStart<=i&&i<this.remainEnd&&("whole"===n||i===this.point?r.entity=await a.load(e):r.promise=a.load(e)),r;const o=It(Wt.getFileName(e),"full"),l=a.download(r.origin),h=async t=>t&&(await St(t,o),r.local=o,this.remainStart<=i&&i<this.remainEnd)?Wt.parseVideo(t,e):null;return"whole"===n||i===this.point?r.entity=await h(await l):r.promise=l.then(h),r})))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise,t.promise=null,t):null===t.entity?(t.entity=await this.parser.load(t.local||t.origin),t):t}prev(){return this.getBucket(this.point-1)}next(){return this.getBucket(this.point+1)}go(t){return this.getBucket(t)}clear(){const{buckets:t}=this;return this.buckets=[],this.point=this.remainStart=this.remainEnd=0,this.maxRemain=3,Promise.all(t.map((t=>Et(t.local))))}}const jt={env:s,SUPPORTED_ENV:t};export{Nt as Brush,Wt as Parser,qt as Player,Vt as Poster,jt as Svga,_t as VideoManager,gt as getCanvas,bt as getOffscreenCanvas};
//# sourceMappingURL=index.js.map

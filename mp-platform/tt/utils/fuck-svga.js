var t;!function(t){t.WECHAT="weapp",t.ALIPAY="alipay",t.DOUYIN="tt",t.H5="h5"}(t||(t={}));let e=function(){if("undefined"!=typeof window)return t.H5;if("undefined"!=typeof tt)return t.DOUYIN;if("undefined"!=typeof my)return t.ALIPAY;if("undefined"!=typeof wx)return t.WECHAT;throw new Error("Unsupported app")}();const r={is:t=>e===t,not:t=>e!==t,get:()=>e,set:t=>{e=t}};var s=Uint8Array,i=Uint16Array,n=Int32Array,a=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),o=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),h=function(t,e){for(var r=new i(31),s=0;s<31;++s)r[s]=e+=1<<t[s-1];var a=new n(r[30]);for(s=1;s<30;++s)for(var o=r[s];o<r[s+1];++o)a[o]=o-r[s]<<5|s;return{b:r,r:a}},c=h(a,2),u=c.b,f=c.r;u[28]=258,f[258]=28;for(var d=h(o,0),p=d.b,m=d.r,y=new i(32768),g=0;g<32768;++g){var w=(43690&g)>>1|(21845&g)<<1;w=(61680&(w=(52428&w)>>2|(13107&w)<<2))>>4|(3855&w)<<4,y[g]=((65280&w)>>8|(255&w)<<8)>>1}var b=function(t,e,r){for(var s=t.length,n=0,a=new i(e);n<s;++n)t[n]&&++a[t[n]-1];var o,l=new i(e);for(n=1;n<e;++n)l[n]=l[n-1]+a[n-1]<<1;if(r){o=new i(1<<e);var h=15-e;for(n=0;n<s;++n)if(t[n])for(var c=n<<4|t[n],u=e-t[n],f=l[t[n]-1]++<<u,d=f|(1<<u)-1;f<=d;++f)o[y[f]>>h]=c}else for(o=new i(s),n=0;n<s;++n)t[n]&&(o[n]=y[l[t[n]-1]++]>>15-t[n]);return o},k=new s(288);for(g=0;g<144;++g)k[g]=8;for(g=144;g<256;++g)k[g]=9;for(g=256;g<280;++g)k[g]=7;for(g=280;g<288;++g)k[g]=8;var v=new s(32);for(g=0;g<32;++g)v[g]=5;var x=b(k,9,0),C=b(k,9,1),I=b(v,5,0),T=b(v,5,1),A=function(t){for(var e=t[0],r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},E=function(t,e,r){var s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&r},P=function(t,e){var r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},M=function(t){return(t+7)/8|0},S=function(t,e,r){return(null==r||r>t.length)&&(r=t.length),new s(t.subarray(e,r))},D=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],B=function(t,e,r){var s=new Error(e||D[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,B),!r)throw s;return s},R=function(t,e,r){r<<=7&e;var s=e/8|0;t[s]|=r,t[s+1]|=r>>8},$=function(t,e,r){r<<=7&e;var s=e/8|0;t[s]|=r,t[s+1]|=r>>8,t[s+2]|=r>>16},F=function(t,e){for(var r=[],n=0;n<t.length;++n)t[n]&&r.push({s:n,f:t[n]});var a=r.length,o=r.slice();if(!a)return{t:Y,l:0};if(1==a){var l=new s(r[0].s+1);return l[r[0].s]=1,{t:l,l:1}}r.sort((function(t,e){return t.f-e.f})),r.push({s:-1,f:25001});var h=r[0],c=r[1],u=0,f=1,d=2;for(r[0]={s:-1,f:h.f+c.f,l:h,r:c};f!=a-1;)h=r[r[u].f<r[d].f?u++:d++],c=r[u!=f&&r[u].f<r[d].f?u++:d++],r[f++]={s:-1,f:h.f+c.f,l:h,r:c};var p=o[0].s;for(n=1;n<a;++n)o[n].s>p&&(p=o[n].s);var m=new i(p+1),y=O(r[f-1],m,0);if(y>e){n=0;var g=0,w=y-e,b=1<<w;for(o.sort((function(t,e){return m[e.s]-m[t.s]||t.f-e.f}));n<a;++n){var k=o[n].s;if(!(m[k]>e))break;g+=b-(1<<y-m[k]),m[k]=e}for(g>>=w;g>0;){var v=o[n].s;m[v]<e?g-=1<<e-m[v]++-1:++n}for(;n>=0&&g;--n){var x=o[n].s;m[x]==e&&(--m[x],++g)}y=e}return{t:new s(m),l:y}},O=function(t,e,r){return-1==t.s?Math.max(O(t.l,e,r+1),O(t.r,e,r+1)):e[t.s]=r},L=function(t){for(var e=t.length;e&&!t[--e];);for(var r=new i(++e),s=0,n=t[0],a=1,o=function(t){r[s++]=t},l=1;l<=e;++l)if(t[l]==n&&l!=e)++a;else{if(!n&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(n),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(n);a=1,n=t[l]}return{c:r.subarray(0,s),n:e}},N=function(t,e){for(var r=0,s=0;s<e.length;++s)r+=t[s]*e[s];return r},U=function(t,e,r){var s=r.length,i=M(e+2);t[i]=255&s,t[i+1]=s>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var n=0;n<s;++n)t[i+n+4]=r[n];return 8*(i+4+s)},H=function(t,e,r,s,n,h,c,u,f,d,p){R(e,p++,r),++n[256];for(var m=F(n,15),y=m.t,g=m.l,w=F(h,15),C=w.t,T=w.l,A=L(y),E=A.c,P=A.n,M=L(C),S=M.c,D=M.n,B=new i(19),O=0;O<E.length;++O)++B[31&E[O]];for(O=0;O<S.length;++O)++B[31&S[O]];for(var H=F(B,7),z=H.t,Y=H.l,W=19;W>4&&!z[l[W-1]];--W);var X,_,K,J,V=d+5<<3,q=N(n,k)+N(h,v)+c,j=N(n,y)+N(h,C)+c+14+3*W+N(B,z)+2*B[16]+3*B[17]+7*B[18];if(f>=0&&V<=q&&V<=j)return U(e,p,t.subarray(f,f+d));if(R(e,p,1+(j<q)),p+=2,j<q){X=b(y,g,0),_=y,K=b(C,T,0),J=C;var Q=b(z,Y,0);R(e,p,P-257),R(e,p+5,D-1),R(e,p+10,W-4),p+=14;for(O=0;O<W;++O)R(e,p+3*O,z[l[O]]);p+=3*W;for(var Z=[E,S],G=0;G<2;++G){var tt=Z[G];for(O=0;O<tt.length;++O){var et=31&tt[O];R(e,p,Q[et]),p+=z[et],et>15&&(R(e,p,tt[O]>>5&127),p+=tt[O]>>12)}}}else X=x,_=k,K=I,J=v;for(O=0;O<u;++O){var rt=s[O];if(rt>255){$(e,p,X[(et=rt>>18&31)+257]),p+=_[et+257],et>7&&(R(e,p,rt>>23&31),p+=a[et]);var st=31&rt;$(e,p,K[st]),p+=J[st],st>3&&($(e,p,rt>>5&8191),p+=o[st])}else $(e,p,X[rt]),p+=_[rt]}return $(e,p,X[256]),p+_[256]},z=new n([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),Y=new s(0),W=function(){var t=1,e=0;return{p:function(r){for(var s=t,i=e,n=0|r.length,a=0;a!=n;){for(var o=Math.min(a+2655,n);a<o;++a)i+=s+=r[a];s=(65535&s)+15*(s>>16),i=(65535&i)+15*(i>>16)}t=s,e=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(e%=65521))<<8|e>>8}}},X=function(t,e,r,l,h){if(!h&&(h={l:1},e.dictionary)){var c=e.dictionary.subarray(-32768),u=new s(c.length+t.length);u.set(c),u.set(t,c.length),t=u,h.w=c.length}return function(t,e,r,l,h,c){var u=c.z||t.length,d=new s(l+u+5*(1+Math.ceil(u/7e3))+h),p=d.subarray(l,d.length-h),y=c.l,g=7&(c.r||0);if(e){g&&(p[0]=c.r>>3);for(var w=z[e-1],b=w>>13,k=8191&w,v=(1<<r)-1,x=c.p||new i(32768),C=c.h||new i(v+1),I=Math.ceil(r/3),T=2*I,A=function(e){return(t[e]^t[e+1]<<I^t[e+2]<<T)&v},E=new n(25e3),P=new i(288),D=new i(32),B=0,R=0,$=c.i||0,F=0,O=c.w||0,L=0;$+2<u;++$){var N=A($),Y=32767&$,W=C[N];if(x[Y]=W,C[N]=Y,O<=$){var X=u-$;if((B>7e3||F>24576)&&(X>423||!y)){g=H(t,p,0,E,P,D,R,F,L,$-L,g),F=B=R=0,L=$;for(var _=0;_<286;++_)P[_]=0;for(_=0;_<30;++_)D[_]=0}var K=2,J=0,V=k,q=Y-W&32767;if(X>2&&N==A($-q))for(var j=Math.min(b,X)-1,Q=Math.min(32767,$),Z=Math.min(258,X);q<=Q&&--V&&Y!=W;){if(t[$+K]==t[$+K-q]){for(var G=0;G<Z&&t[$+G]==t[$+G-q];++G);if(G>K){if(K=G,J=q,G>j)break;var tt=Math.min(q,G-2),et=0;for(_=0;_<tt;++_){var rt=$-q+_&32767,st=rt-x[rt]&32767;st>et&&(et=st,W=rt)}}}q+=(Y=W)-(W=x[Y])&32767}if(J){E[F++]=268435456|f[K]<<18|m[J];var it=31&f[K],nt=31&m[J];R+=a[it]+o[nt],++P[257+it],++D[nt],O=$+K,++B}else E[F++]=t[$],++P[t[$]]}}for($=Math.max($,O);$<u;++$)E[F++]=t[$],++P[t[$]];g=H(t,p,y,E,P,D,R,F,L,$-L,g),y||(c.r=7&g|p[g/8|0]<<3,g-=7,c.h=C,c.p=x,c.i=$,c.w=O)}else{for($=c.w||0;$<u+y;$+=65535){var at=$+65535;at>=u&&(p[g/8|0]=y,at=u),g=U(p,g+1,t.subarray($,at))}c.i=u}return S(d,0,l+M(g)+h)}(t,null==e.level?6:e.level,null==e.mem?h.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,r,l,h)},_=function(t,e,r){for(;r;++e)t[e]=r,r>>>=8};function K(t,e){e||(e={});var r=W();r.p(t);var s=X(t,e,e.dictionary?6:2,4);return function(t,e){var r=e.level,s=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=s<<6|(e.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){var i=W();i.p(e.dictionary),_(t,2,i.d())}}(s,e),_(s,s.length-4,r.d()),s}function J(t,e){return function(t,e,r,i){var n=t.length;if(!n||e.f&&!e.l)return r||new s(0);var h=!r,c=h||2!=e.i,f=e.i;h&&(r=new s(3*n));var d=function(t){var e=r.length;if(t>e){var i=new s(Math.max(2*e,t));i.set(r),r=i}},m=e.f||0,y=e.p||0,g=e.b||0,w=e.l,k=e.d,v=e.m,x=e.n,I=8*n;do{if(!w){m=E(t,y,1);var D=E(t,y+1,3);if(y+=3,!D){var R=t[(X=M(y)+4)-4]|t[X-3]<<8,$=X+R;if($>n){f&&B(0);break}c&&d(g+R),r.set(t.subarray(X,$),g),e.b=g+=R,e.p=y=8*$,e.f=m;continue}if(1==D)w=C,k=T,v=9,x=5;else if(2==D){var F=E(t,y,31)+257,O=E(t,y+10,15)+4,L=F+E(t,y+5,31)+1;y+=14;for(var N=new s(L),U=new s(19),H=0;H<O;++H)U[l[H]]=E(t,y+3*H,7);y+=3*O;var z=A(U),Y=(1<<z)-1,W=b(U,z,1);for(H=0;H<L;){var X,_=W[E(t,y,Y)];if(y+=15&_,(X=_>>4)<16)N[H++]=X;else{var K=0,J=0;for(16==X?(J=3+E(t,y,3),y+=2,K=N[H-1]):17==X?(J=3+E(t,y,7),y+=3):18==X&&(J=11+E(t,y,127),y+=7);J--;)N[H++]=K}}var V=N.subarray(0,F),q=N.subarray(F);v=A(V),x=A(q),w=b(V,v,1),k=b(q,x,1)}else B(1);if(y>I){f&&B(0);break}}c&&d(g+131072);for(var j=(1<<v)-1,Q=(1<<x)-1,Z=y;;Z=y){var G=(K=w[P(t,y)&j])>>4;if((y+=15&K)>I){f&&B(0);break}if(K||B(2),G<256)r[g++]=G;else{if(256==G){Z=y,w=null;break}var tt=G-254;if(G>264){var et=a[H=G-257];tt=E(t,y,(1<<et)-1)+u[H],y+=et}var rt=k[P(t,y)&Q],st=rt>>4;if(rt||B(3),y+=15&rt,q=p[st],st>3&&(et=o[st],q+=P(t,y)&(1<<et)-1,y+=et),y>I){f&&B(0);break}c&&d(g+131072);var it=g+tt;if(g<q){var nt=0-q,at=Math.min(q,it);for(nt+g<0&&B(3);g<at;++g)r[g]=i[nt+g]}for(;g<it;++g)r[g]=r[g-q]}}e.l=w,e.p=Z,e.b=g,e.f=m,w&&(m=1,e.m=v,e.d=k,e.n=x)}while(!m);return g!=r.length&&h?S(r,0,g):r.subarray(0,g)}(t.subarray(((8!=(15&(r=t)[0])||r[0]>>4>7||(r[0]<<8|r[1])%31)&&B(6,"invalid zlib data"),1==(r[1]>>5&1)&&B(6,"invalid zlib data: "+(32&r[1]?"need":"unexpected")+" dictionary"),2+(r[1]>>3&4)),-4),{i:2},e,e);var r}var V="undefined"!=typeof TextDecoder&&new TextDecoder;try{V.decode(Y,{stream:!0})}catch(t){}var q={readFloatLE(t,e){const r=((t,e)=>(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0)(t,e),s=2*(r>>31)+1,i=r>>>23&255,n=8388607&r;return 255===i?n?NaN:s*(1/0):0===i?1401298464324817e-60*s*n:s*2**(i-150)*(n+8388608)}},j={read(t,e,r){if(r-e<1)return"";const s=t=>String.fromCharCode(t);let i="";for(let n=e;n<r;){const e=t[n++];if(e<=127)i+=s(e);else if(e>=192&&e<224)i+=s((31&e)<<6|63&t[n++]);else if(e>=224&&e<240)i+=s((15&e)<<12|(63&t[n++])<<6|63&t[n++]);else if(e>=240){const r=((7&e)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;i+=s(55296+(r>>10)),i+=s(56320+(1023&r))}}return i}};class Q{static create(t){if(t instanceof Q)return t;if(t instanceof Uint8Array)return new Q(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}slice(t,e,r){return t.subarray(e,r)}indexOutOfRange(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}uint32(){let t=4294967295;if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,this.indexOutOfRange(this,10);return t}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=q.readFloatLE(this.buf,this.pos);return this.pos+=4,t}bytes(){const t=this.uint32(),e=this.pos,r=this.pos+t;if(r>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,e==r?new Uint8Array(0):this.slice(this.buf,e,r)}string(){const t=this.bytes();return j.read(t,0,t.length)}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw this.indexOutOfRange(this)}while(128&this.buf[this.pos++]);return this}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class Z{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new Z;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;width=0;height=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height))}}class G{static decode(t,e){t=Q.create(t);let r=null==e?t.len:t.pos+e,s=new G;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.a=t.float();break;case 2:s.b=t.float();break;case 3:s.c=t.float();break;case 4:s.d=t.float();break;case 5:s.tx=t.float();break;case 6:s.ty=t.float();break;default:t.skipType(7&e)}}return s}a=0;b=0;c=0;d=0;tx=0;ty=0;constructor(t){t&&(null!=t.a&&(this.a=t.a),null!=t.b&&(this.b=t.b),null!=t.c&&(this.c=t.c),null!=t.d&&(this.d=t.d),null!=t.tx&&(this.tx=t.tx),null!=t.ty&&(this.ty=t.ty))}}class et{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new et;for(;t.pos<r;){const e=t.uint32();if(e>>>3==1)s.d=t.string();else t.skipType(7&e)}return s}d="";constructor(t){t&&null!=t.d&&(this.d=t.d)}}class rt{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new rt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;case 5:s.cornerRadius=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;width=0;height=0;cornerRadius=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.width&&(this.width=t.width),null!=t.height&&(this.height=t.height),null!=t.cornerRadius&&(this.cornerRadius=t.cornerRadius))}}class st{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new st;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.radiusX=t.float();break;case 4:s.radiusY=t.float();break;default:t.skipType(7&e)}}return s}x=0;y=0;radiusX=0;radiusY=0;constructor(t){t&&(null!=t.x&&(this.x=t.x),null!=t.y&&(this.y=t.y),null!=t.radiusX&&(this.radiusX=t.radiusX),null!=t.radiusY&&(this.radiusY=t.radiusY))}}class it{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new it;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.r=t.float();break;case 2:s.g=t.float();break;case 3:s.b=t.float();break;case 4:s.a=t.float();break;default:t.skipType(7&e)}}return s}r=0;g=0;b=0;a=0;constructor(t){t&&(null!=t.r&&(this.r=t.r),null!=t.g&&(this.g=t.g),null!=t.b&&(this.b=t.b),null!=t.a&&(this.a=t.a))}}class nt{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new nt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.fill=it.decode(t,t.uint32());break;case 2:s.stroke=it.decode(t,t.uint32());break;case 3:s.strokeWidth=t.float();break;case 4:s.lineCap=t.int32();break;case 5:s.lineJoin=t.int32();break;case 6:s.miterLimit=t.float();break;case 7:s.lineDashI=t.float();break;case 8:s.lineDashII=t.float();break;case 9:s.lineDashIII=t.float();break;default:t.skipType(7&e)}}return s}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0;constructor(t){t&&(null!=t.fill&&(this.fill=t.fill),null!=t.lineCap&&(this.lineCap=t.lineCap),null!=t.lineDashI&&(this.lineDashI=t.lineDashI),null!=t.lineDashII&&(this.lineDashII=t.lineDashII),null!=t.lineDashIII&&(this.lineDashIII=t.lineDashIII),null!=t.lineJoin&&(this.lineJoin=t.lineJoin),null!=t.miterLimit&&(this.miterLimit=t.miterLimit),null!=t.stroke&&(this.stroke=t.stroke),null!=t.strokeWidth&&(this.strokeWidth=t.strokeWidth))}}class at{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new at;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.type=t.int32();break;case 2:s.shape=et.decode(t,t.uint32());break;case 3:s.rect=rt.decode(t,t.uint32());break;case 4:s.ellipse=st.decode(t,t.uint32());break;case 10:s.styles=nt.decode(t,t.uint32());break;case 11:s.transform=G.decode(t,t.uint32());break;default:t.skipType(7&e)}}return s}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null;$oneOfFields=["shape","rect","ellipse"];$fieldMap={};get args(){const t=Object.keys(this);for(let e=t.length-1;e>-1;--e){const r=t[e],s=this[r];if(1==this.$fieldMap[r]&&null!=s)return r}return""}set args(t){for(var e=0;e<this.$oneOfFields.length;++e){const r=this.$oneOfFields[e];r!=t&&delete this[r]}}constructor(t){t&&(null!=t.type&&(this.type=t.type),null!=t.ellipse&&(this.ellipse=t.ellipse),null!=t.rect&&(this.rect=t.rect),null!=t.shape&&(this.shape=t.shape),null!=t.styles&&(this.styles=t.styles),null!=t.transform&&(this.transform=t.transform));for(var e=0;e<this.$oneOfFields.length;++e)this.$fieldMap[this.$oneOfFields[e]]=1}}class ot{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new ot;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.alpha=t.float();break;case 2:s.layout=Z.decode(t,t.uint32());break;case 3:s.transform=G.decode(t,t.uint32());break;case 4:s.clipPath=t.string();break;case 5:s.shapes&&s.shapes.length||(s.shapes=[]),s.shapes.push(at.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return s}shapes=[];alpha=0;layout=null;transform=null;clipPath="";constructor(t){t&&(null!=t.alpha&&(this.alpha=t.alpha),null!=t.clipPath&&(this.clipPath=t.clipPath),null!=t.layout&&(this.layout=t.layout),null!=t.shapes&&(this.shapes=t.shapes),null!=t.transform&&(this.transform=t.transform))}}class lt{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new lt;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.imageKey=t.string();break;case 2:s.frames&&s.frames.length||(s.frames=[]),s.frames.push(ot.decode(t,t.uint32()));break;case 3:s.matteKey=t.string();break;default:t.skipType(7&e)}}return s}frames=[];imageKey="";matteKey="";constructor(t){t&&(null!=t.frames&&(this.frames=t.frames),null!=t.imageKey&&(this.imageKey=t.imageKey),null!=t.matteKey&&(this.matteKey=t.matteKey))}}class ht{static decode(t,e){t=Q.create(t);let r=null==e?t.len:t.pos+e,s=new ht;for(;t.pos<r;){let e=t.uint32();switch(e>>>3){case 1:s.viewBoxWidth=t.float();break;case 2:s.viewBoxHeight=t.float();break;case 3:s.fps=t.int32();break;case 4:s.frames=t.int32();break;default:t.skipType(7&e)}}return s}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0;constructor(t){t&&(null!=t.viewBoxWidth&&(this.viewBoxWidth=t.viewBoxWidth),null!=t.viewBoxHeight&&(this.viewBoxHeight=t.viewBoxHeight),null!=t.fps&&(this.fps=t.fps),null!=t.frames&&(this.frames=t.frames))}}const ct=Object.freeze({});class ut{static decode(t,e){t=Q.create(t);const r=null==e?t.len:t.pos+e,s=new ut;let i,n;for(;t.pos<r;){const e=t.uint32();switch(e>>>3){case 1:s.version=t.string();break;case 2:s.params=ht.decode(t,t.uint32());break;case 3:{s.images==ct&&(s.images={});const e=t.uint32()+t.pos;for(i="",n=[];t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:i=t.string();break;case 2:n=t.bytes();break;default:t.skipType(7&e)}}s.images[i]=n;break}case 4:s.sprites&&s.sprites.length||(s.sprites=[]),s.sprites.push(lt.decode(t,t.uint32()));break;default:t.skipType(7&e)}}return s}version="";params=null;images=ct;sprites=[];constructor(t){t&&(null!=t.version&&(this.version=t.version),null!=t.images&&(this.images=t.images),null!=t.params&&(this.params=t.params),null!=t.sprites&&(this.sprites=t.sprites))}}const ft=r.is(t.H5)?globalThis:r.is(t.ALIPAY)?my:r.is(t.DOUYIN)?tt:wx;const dt=r.is(t.H5)?globalThis.devicePixelRatio:"getWindowInfo"in ft?ft.getWindowInfo().pixelRatio:"getSystemInfoSync"in ft?ft.getSystemInfoSync().pixelRatio:1;function pt(e,s){return new Promise(((i,n)=>{const a=(t,e=0,r=0)=>{if(!t)return void n(new Error("canvas not found."));const s=t.getContext("2d");t.width=e*dt,t.height=r*dt,s.scale(dt,dt),i({canvas:t,ctx:s})};if(r.is(t.H5)){const t=document.querySelector(e),{clientWidth:r,clientHeight:s}=t;a(t,r,s)}else{let t=ft.createSelectorQuery();s&&(t=t.in(s)),t.select(e).fields({node:!0,size:!0},(t=>{const{node:e,width:r,height:s}=t||{};a(e,r,s)})).exec()}}))}function mt(e){const s=function(e){if(r.is(t.H5))return new OffscreenCanvas(e.width,e.height);if(r.is(t.ALIPAY))return my.createOffscreenCanvas({width:e.width,height:e.height});if(r.is(t.DOUYIN)){const t=tt.createOffscreenCanvas();return t.width=e.width,t.height=e.height,t}return wx.createOffscreenCanvas({...e,type:"2d"})}(e),i=s.getContext("2d");return{canvas:s,ctx:i}}const yt=t=>/^http(s)?:\/\//.test(t);const gt={time(t){console.time?.(t)},timeEnd(t){console.timeEnd?.(t)}};var wt={count:20,label(t){console.log(t)},async time(t,e){gt.time(t);const r=await e();return gt.timeEnd(t),r},line(t=40){console.log("-".repeat(t))},log(...t){console.log("【benchmark】",...t)}};const{USER_DATA_PATH:bt=""}=r.is(t.H5)?{}:r.is(t.DOUYIN)?tt.getEnvInfoSync().common:ft.env;function kt(t,e){return`${bt}/${e?`${e}.`:""}${t}`}let vt=null;function xt(){null===vt&&(vt=ft.getFileSystemManager())}function Ct(t,e){return xt(),wt.log(`write file: ${e}`),new Promise(((r,s)=>{vt.access({path:e,success(){r(e)},fail(){vt.writeFile({filePath:e,data:t,success(){r(e)},fail(t){wt.log(`write fail: ${e}`,t),s(t)}})}})}))}function It(t){return xt(),new Promise((e=>{vt.access({path:t,success(){wt.log(`remove file: ${t}`),vt.unlink({filePath:t,success:()=>e(t),fail(r){wt.log(`remove fail: ${t}`,r),e(t)}})},fail(r){wt.log(`access fail: ${t}`,r),e(t)}})}))}const Tt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function At(e){return`data:image/png;base64,${function(e){if(r.is(t.H5))return btoa(e);let s,i,n,a,o="",l=e.length%3;for(let t=0;t<e.length;){if((i=e.charCodeAt(t++))>255||(n=e.charCodeAt(t++))>255||(a=e.charCodeAt(t++))>255)throw new TypeError('Failed to execute "btoa" on "Window": The string to be encoded contains characters outside of the Latin1 range.');s=i<<16|n<<8|a,o+=Tt.charAt(s>>18&63)+Tt.charAt(s>>12&63)+Tt.charAt(s>>6&63)+Tt.charAt(63&s)}return l?o.slice(0,l-3)+"===".substring(l):o}(String.fromCharCode(...e))}`}function Et(t){return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}function Pt(t,e){return new Promise(((r,s)=>{const i=t.createImage();i.onload=()=>{e.startsWith("data:")||"string"==typeof e?r(i):It(e).then((()=>r(i))).catch((()=>r(i)))},i.onerror=()=>s(new Error(`SVGA LOADING FAILURE: ${i.src}`)),i.src=e}))}function Mt(e,s,i,n){if(r.is(t.H5)){if(s instanceof Uint8Array&&"createImageBitmap"in globalThis)return function(t){return globalThis.createImageBitmap(new Blob([Et(t)]))}(s);if(s instanceof ImageBitmap)return Promise.resolve(s)}return"string"==typeof s&&yt(s)?Pt(e,s):async function(e,s,i){if("string"==typeof e)return e;if(r.is(t.H5)||r.is(t.ALIPAY)&&ft.isIDE)return At(e);try{return await Ct(Et(e),kt(s,i))}catch(t){return console.warn(`图片缓存失败：${t.message}`),At(e)}}(s,i,n).then((t=>Pt(e,t)))}const St=()=>{};const Dt=function(){if(r.is(t.H5)){const t=navigator.userAgent;if(/(Android)/i.test(t))return"Android";if(/(iPhone|iPad|iPod|iOS)/i.test(t))return"iOS";if(/(OpenHarmony|ArkWeb)/i.test(t))return"OpenHarmony"}else{if(r.is(t.ALIPAY))return ft.getDeviceBaseInfo().platform;if(r.is(t.DOUYIN))return ft.getDeviceInfoSync().platform;if(r.is(t.WECHAT))return ft.getDeviceInfo().platform}return"UNKNOWN"}().toLocaleUpperCase(),Bt=()=>"undefined"!=typeof performance?performance.now():Date.now();class Rt{version;filename;size={width:0,height:0};fps=20;frames=0;images={};replaceElements={};dynamicElements={};sprites=[];constructor(t,e){const{viewBoxWidth:r,viewBoxHeight:s,fps:i,frames:n}=t.params;this.version=t.version,this.filename=e,this.size.width=r,this.size.height=s,this.fps=i,this.frames=n,this.images=t.images||{},this.sprites=this.formatSprites(t.sprites||[])}formatSprites(t){return t.map((t=>({imageKey:t.imageKey,frames:this.formatFrames(t.frames||[])})))}formatFrames(t){let e;return t.map((t=>{const{layout:r,transform:s,alpha:i}=t,n={x:r?.x+.5|0,y:r?.y+.5|0,width:r?.width+.5|0,height:r?.height+.5|0},a={a:s?.a??1,b:s?.b??0,c:s?.c??0,d:s?.d??1,tx:s?.tx??0,ty:s?.ty??0};let o=this.formatShapes(t.shapes||[]);3===t.shapes[0]?.type&&e?o=e:e=o;const l=a.a*n.x+a.c*n.y+a.tx,h=a.a*(n.x+n.width)+a.c*n.y+a.tx,c=a.a*n.x+a.c*(n.y+n.height)+a.tx,u=a.a*(n.x+n.width)+a.c*(n.y+n.height)+a.tx,f=a.b*n.x+a.d*n.y+a.ty,d=a.b*(n.x+n.width)+a.d*n.y+a.ty,p=a.b*n.x+a.d*(n.y+n.height)+a.ty,m=a.b*(n.x+n.width)+a.d*(n.y+n.height)+a.ty,y=Math.min(c,u,l,h)+.5|0,g=Math.min(p,m,f,d)+.5|0,w=t.clipPath??"";return{alpha:i??0,layout:n,transform:a,clipPath:w,shapes:o,nx:y,ny:g,maskPath:w.length>0?{d:w,transform:void 0,styles:{fill:"rgba(0, 0, 0, 0)",stroke:null,strokeWidth:null,lineCap:null,lineJoin:null,miterLimit:null,lineDash:null}}:null}}))}formatShapes(t){const e=[];for(let r of t){const t=r.styles;if(null==t)continue;const s=[],{lineDashI:i,lineDashII:n,lineDashIII:a}=t;i>0&&s.push(i),n>0&&(s.length<1&&s.push(0),s.push(n)),a>0&&(s.length<2&&(s.push(0),s.push(0)),s[2]=a);let o=null;switch(t.lineCap){case 0:o="butt";break;case 1:o="round";break;case 2:o="square"}let l=null;switch(t.lineJoin){case 2:l="bevel";break;case 1:l="round";break;case 0:l="miter"}const{fill:h,stroke:c}=t;let u=null;h&&(u=`rgba(${255*h.r|0}, ${255*h.g|0}, ${255*h.b|0}, ${1*h.a|0})`);let f=null;c&&(f=`rgba(${255*c.r|0}, ${255*c.g|0}, ${255*c.b|0}, ${1*c.a|0})`);const d={lineDash:s,fill:u,stroke:f,lineCap:o,lineJoin:l,strokeWidth:t.strokeWidth,miterLimit:t.miterLimit},{transform:p,shape:m,rect:y,ellipse:g}=r,w={a:p?.a??1,b:p?.b??0,c:p?.c??0,d:p?.d??1,tx:p?.tx??0,ty:p?.ty??0};0===r.type&&m?e.push({type:"shape",path:m,styles:d,transform:w}):1===r.type&&y?e.push({type:"rect",path:y,styles:d,transform:w}):2===r.type&&g&&e.push({type:"ellipse",path:g,styles:d,transform:w})}return e}}class $t{static getFileName(t){return t.substring(t.lastIndexOf("/")+1)}static parseVideo(t,e){const r=new Uint8Array(t,0,4),s=new Uint8Array(t);if("80,75,3,4"===r.toString())throw new Error("this parser only support version@2 of SVGA.");let i;return wt.time("unzlibSync",(()=>{const t=J(s),r=ut.decode(t);i=new Rt(r,$t.getFileName(e))})),i}download(e){return yt(e)?function(e){return r.is(t.H5)?fetch(e).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)})):new Promise(((t,r)=>{ft.request({url:e,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:!0,success:e=>t(e.data),fail:r})}))}(e):r.not(t.H5)?(s=e,xt(),new Promise(((t,e)=>{vt.access({path:s,success(){vt.readFile({filePath:s,success:e=>t(e.data),fail:e})},fail:e})}))):Promise.resolve(null);var s}async load(t){const e=await this.download(t);return wt.label(t),wt.line(),$t.parseVideo(e,t)}}function Ft(t,e,r,s,i,n,a){const o=e.frames[r];if(!(o.alpha<.05)){t.save(),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty),t.globalAlpha=o.alpha,t.transform(o.transform?.a??1,o.transform?.b??0,o.transform?.c??0,o.transform?.d??1,o.transform?.tx??0,o.transform?.ty??0),s&&(o.maskPath&&(Nt(t,o.maskPath.d,o.maskPath.transform,o.maskPath.styles),t.clip()),t.drawImage(i||s,0,0,o.layout.width,o.layout.height)),n&&t.drawImage(n,(o.layout.width-n.width)/2,(o.layout.height-n.height)/2);for(let e=0;e<o.shapes.length;e++)Ot(t,o.shapes[e]);t.restore()}}function Ot(t,e){switch(e.type){case"shape":Nt(t,e.path.d,e.transform,e.styles);break;case"ellipse":!function(t,e,r,s,i,n,a){t.save(),Lt(t,a),n&&t.transform(n.a,n.b,n.c,n.d,n.tx,n.ty);e-=s;const o=2*s,l=2*i,h=.5522848,c=o/2*h,u=l/2*h,f=e+o,d=(r-=i)+l,p=e+o/2,m=r+l/2;t.beginPath(),t.moveTo(e,m),t.bezierCurveTo(e,m-u,p-c,r,p,r),t.bezierCurveTo(p+c,r,f,m-u,f,m),t.bezierCurveTo(f,m+u,p+c,d,p,d),t.bezierCurveTo(p-c,d,e,m+u,e,m),a.fill&&t.fill();a.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.radiusX??0,e.path.radiusY??0,e.transform,e.styles);break;case"rect":!function(t,e,r,s,i,n,a,o){t.save(),Lt(t,o),a&&t.transform(a.a,a.b,a.c,a.d,a.tx,a.ty);let l=n;s<2*l&&(l=s/2);i<2*l&&(l=i/2);t.beginPath(),t.moveTo(e+l,r),t.arcTo(e+s,r,e+s,r+i,l),t.arcTo(e+s,r+i,e,r+i,l),t.arcTo(e,r+i,e,r,l),t.arcTo(e,r,e+s,r,l),t.closePath(),o.fill&&t.fill();o.stroke&&t.stroke();t.restore()}(t,e.path.x??0,e.path.y??0,e.path.width??0,e.path.height??0,e.path.cornerRadius??0,e.transform,e.styles)}}function Lt(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}function Nt(t,e,r,s){t.save(),Lt(t,s),r&&t.transform(r.a,r.b,r.c,r.d,r.tx,r.ty);const i={x:0,y:0,x1:0,y1:0,x2:0,y2:0};if(t.beginPath(),e){const r=e.replace(/([a-zA-Z])/g,"|||$1 ").replace(/,/g," ").split("|||");for(let e=0;e<r.length;e++){const s=r[e];if(0===s.length)continue;const n=s.substring(0,1);"MLHVCSQZmlhvcsqz".includes(n)&&Ut(t,i,n,s.substring(1).trim().split(" "))}}s.fill&&t.fill(),s.stroke&&t.stroke(),t.restore()}function Ut(t,e,r,s){switch(r){case"M":e.x=+s[0],e.y=+s[1],t.moveTo(e.x,e.y);break;case"m":e.x+=+s[0],e.y+=+s[1],t.moveTo(e.x,e.y);break;case"L":e.x=+s[0],e.y=+s[1],t.lineTo(e.x,e.y);break;case"l":e.x+=+s[0],e.y+=+s[1],t.lineTo(e.x,e.y);break;case"H":e.x=+s[0],t.lineTo(e.x,e.y);break;case"h":e.x+=+s[0],t.lineTo(e.x,e.y);break;case"V":e.y=+s[0],t.lineTo(e.x,e.y);break;case"v":e.y+=+s[0],t.lineTo(e.x,e.y);break;case"C":e.x1=+s[0],e.y1=+s[1],e.x2=+s[2],e.y2=+s[3],e.x=+s[4],e.y=+s[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"c":e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x2=e.x+ +s[2],e.y2=e.y+ +s[3],e.x+=+s[4],e.y+=+s[5],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y);break;case"S":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=+s[0],e.y2=+s[1],e.x=+s[2],e.y=+s[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=+s[0],e.y1=+s[1],e.x=+s[2],e.y=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"s":void 0!==e.x1&&void 0!==e.y1&&void 0!==e.x2&&void 0!==e.y2?(e.x1=e.x-e.x2+e.x,e.y1=e.y-e.y2+e.y,e.x2=e.x+ +s[0],e.y2=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.bezierCurveTo(e.x1,e.y1,e.x2,e.y2,e.x,e.y)):(e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y));break;case"Q":e.x1=+s[0],e.y1=+s[1],e.x=+s[2],e.y=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"q":e.x1=e.x+ +s[0],e.y1=e.y+ +s[1],e.x+=+s[2],e.y+=+s[3],t.quadraticCurveTo(e.x1,e.y1,e.x,e.y);break;case"Z":case"z":t.closePath()}}class Ht{pool=[];materials=new Map;isImage(e){return r.is(t.H5)&&e instanceof Image||void 0!==e.src&&void 0!==e.width&&void 0!==e.height}getMaterials(){return this.materials}clear(){this.materials.clear();for(let t=0;t<this.pool.length;t++){const e=this.pool[t];e.onload=null,e.onerror=null,e.src=""}}async loadImage(t,e,r){const s=[];Object.keys(t).forEach((i=>{const n=t[i];if(this.isImage(n))s.push(Promise.resolve(n));else{const t=Mt(e,n,r,i).then((t=>(this.materials.set(i,t),t)));s.push(t)}}));const i=await Promise.all(s);this.pool=i.filter((t=>this.isImage(t)))}createImage(e){const[s]=this.pool.splice(0,1);return s||(r.is(t.H5)?new Image:e.createImage())}}class zt{mode;X=null;XC=null;Y=null;YC=null;W=0;H=0;model={};IM=new Ht;globalTransform;constructor(t="animation"){this.mode=t}setModel(e){const{model:s}=this;s.type=e,"O"===e&&r.is(t.H5)&&navigator.userAgent.includes("Firefox")?s.clear="CR":"O"===e&&r.is(t.DOUYIN)||r.is(t.ALIPAY)?s.clear="CL":s.clear="RE","C"===e&&(r.is(t.DOUYIN)||"IOS"===Dt&&r.is(t.ALIPAY))||"O"===e&&r.is(t.WECHAT)?s.render="PU":s.render="DR",wt.line(4),wt.log("brush type",s.type),wt.log("brush clear",s.clear),wt.log("brush render",s.render),wt.line(4)}async register(t,e,r){const{model:s,mode:i}=this,{canvas:n,ctx:a}=await pt(t,r),{width:o,height:l}=n;if(this.X=n,this.XC=a,this.W=o,this.H=l,"poster"===i)this.Y=this.X,this.YC=this.XC,this.setModel("C");else{let t;"string"==typeof e&&""!==e?(t=await pt(e,r),t.canvas.width=o,t.canvas.height=l,this.setModel("C")):(t=mt({width:o,height:l}),this.setModel("O")),this.Y=t.canvas,this.YC=t.ctx}if("CL"===s.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===i)this.clearSecondary=this.stick=St;else{switch(s.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:r,ctx:s}=mt({width:t,height:e});this.Y=r,this.YC=s};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:r}=this;r.width=t,r.height=e}}switch(s.render){case"DR":this.stick=()=>{const{W:t,H:e}=this;this.XC.drawImage(this.Y,0,0,t,e)};break;case"PU":this.stick=()=>{const{W:t,H:e}=this,r=this.YC.getImageData(0,0,t,e);this.XC.putImageData(r,0,0,0,0,t,e)}}}}loadImages(t,e){return this.IM.loadImage(t,this,e)}createImage(){return this.IM.createImage(this.X)}getImage(t="image/png",e=.92){return this.X.toDataURL(t,e)}resize(t,e){const{Y:r}=this;let s=1,i=1,n=0,a=0;if("fill"===t)s=r.width/e.width,i=r.height/e.height;else if(["aspect-fill","aspect-fit"].includes(t)){const o=e.width/e.height,l=r.width/r.height;o>=l&&"aspect-fit"===t||o<=l&&"aspect-fill"===t?(s=i=r.width/e.width,a=(r.height-e.height*i)/2):(o<l&&"aspect-fit"===t||o>l&&"aspect-fill"===t)&&(s=i=r.height/e.height,n=(r.width-e.width*s)/2)}this.globalTransform={a:s,b:0,c:0,d:i,tx:n,ty:a}}flush(e){(r.is(t.H5)?ft:this.X).requestAnimationFrame(e)}clearContainer=St;clearSecondary=St;clearMaterials(){this.IM.clear()}draw(t,e,r,s){!function(t,e,r,s,i,n,a){const{sprites:o,replaceElements:l,dynamicElements:h}=r;for(let r=i;r<n;r++){const i=o[r],{imageKey:n}=i;Ft(t,i,s,e.get(n),l[n],h[n],a)}}(this.YC,this.IM.getMaterials(),t,e,r,s,this.globalTransform)}stick=St;destroy(){this.clearContainer(),this.clearSecondary(),this.clearMaterials(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=St}}class Yt{brush;isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onStart=St;onUpdate=St;onEnd=St;constructor(t){this.brush=t}setConfig(t,e,r,s){this.duration=t,this.loopStart=e,this.loopDuration=t*r+s-e}start(){this.isRunning=!0,this.startTime=Bt(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=Bt(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(Bt()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1}doFrame(){this.isRunning&&(this.doDeltaTime(Bt()-this.startTime),this.isRunning&&this.brush.flush((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:r,loopDuration:s}=this;let i,n=!1;t>=s?(i=1,n=!0,this.stop()):i=(t+r)%e/e,wt.time("update partial",(()=>this.onUpdate(i))),!this.isRunning&&n&&this.onEnd()}}class Wt{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:r,startFrame:s,endFrame:i,fillMode:n,loop:a}=this,{fps:o,sprites:l}=t;let{frames:h}=t;const c=l.length,u=s>0?s:0,f=i>0&&i<h?i:h;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<h?h=f-u:u>0&&(h-=u);let d=r,p=0;"forwards"===e?(d===f-1&&(d=u),"forwards"===n&&(p=1)):(0===d&&(d=f-1),"backwards"===n&&(p=1));const m=1e3/o;return{currFrame:d,startFrame:u,endFrame:f,totalFrame:h,spriteCount:c,aniConfig:{duration:Math.floor(h*m*10**6)/10**6,loopStart:r>u?(r-u)*m:0,loop:0===a?1/0:a,fillValue:p*m}}}}class Xt{entity=void 0;config=new Wt;brush=new zt;animator=null;async setConfig(t,e){let r;r="string"==typeof t?{container:t}:t,this.config.register(r),await this.brush.register(r.container,r.secondary,e),this.animator=new Yt(this.brush)}setItem(t,e){this.config.setItem(t,e)}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:r}=t;return this.animator.stop(),this.entity=t,this.brush.clearSecondary(),this.brush.clearMaterials(),this.brush.loadImages(e,r)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.brush.clearContainer(),this.brush.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.brush.destroy(),this.animator=null,this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.startAnimation())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:r}=this.entity;this.stepToFrame(Math.round((t<0?0:t)*r)%r,e)}startAnimation(){const{entity:t,config:e,animator:r,brush:s}=this,{playMode:i,contentMode:n}=e,{currFrame:a,startFrame:o,endFrame:l,totalFrame:h,spriteCount:c,aniConfig:u}=e.getConfig(t),{duration:f,loopStart:d,loop:p,fillValue:m}=u;let y,g,w,b=0,k=0,v=a;r.setConfig(f,d,p,m),s.resize(n,t.size),r.onUpdate=e=>{"fallbacks"===i?(g=1-e,y=(0==e?l:Math.ceil(g*h))-1,w=Math.abs(1-g*h+v)):(g=e,y=1===e?o:Math.floor(g*h),w=Math.abs(g*h-v));const r=v===y;if(k!==c){const e=r?Math.min(c*w*1.15+2,c)|0:c;e>k&&(b=k,k=e,s.draw(t,v,b,k))}if(r)return;const n=v;s.clearContainer(),s.stick(),s.clearSecondary(),v=y,k=0,this.onProcess?.(~~(100*g)/100,n)},r.onEnd=()=>this.onEnd?.(),r.start()}}class _t{entity=void 0;frame=0;contentMode="fill";brush=new zt("poster");setConfig(t,e){let r;return r="string"==typeof t?{container:t}:t,r.contentMode&&(this.contentMode=r.contentMode),"number"==typeof r.frame&&(this.frame=r.frame),this.brush.register(r.container,"",e)}setContentMode(t){this.contentMode=t}mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:r}=t;return this.entity=t,this.brush.clearMaterials(),this.brush.loadImages(e,r)}onStart;onEnd;setReplaceElement(t,e){this.entity&&(this.entity.replaceElements[t]=e)}async setReplaceElementByUrl(t,e){this.entity&&(this.entity.replaceElements[t]=await Mt(this.brush,e,e))}setDynamicElement(t,e){this.entity&&(this.entity.dynamicElements[t]=e)}async setDynamicElementByUrl(t,e){this.entity&&(this.entity.dynamicElements[t]=await Mt(this.brush,e,e))}draw(){if(!this.entity)return;const{brush:t,entity:e,contentMode:r,frame:s,onStart:i,onEnd:n}=this;i?.(),t.clearContainer(),t.resize(r,e.size),t.draw(e,s,0,e.sprites.length),n?.()}toDataURL(t,e){return this.brush.getImage(t,e)}clear(){this.brush.clearContainer(),this.brush.clearMaterials()}destroy(){this.brush.destroy(),this.entity=void 0}}class Kt{point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];parser=new $t;get length(){return this.buckets.length}updateRemainPoints(){this.point<Math.ceil(this.maxRemain/2)?(this.remainStart=0,this.remainEnd=this.maxRemain):this.length-this.point<Math.floor(this.maxRemain/2)?(this.remainStart=this.remainEnd-this.maxRemain,this.remainEnd=this.length):(this.remainStart=Math.floor(this.point-this.maxRemain/2),this.remainEnd=this.remainStart+this.maxRemain)}updateBucketOperators(t){const{remainStart:e,remainEnd:r}=this;return this.point=t,this.updateRemainPoints(),e===r?[{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>r||this.remainEnd<e?[{action:"remove",start:e,end:r},{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>e&&this.remainEnd>r?[{action:"remove",start:e,end:this.remainStart},{action:"add",start:r,end:this.remainEnd}]:this.remainStart<e&&this.remainEnd<r?[{action:"remove",start:this.remainEnd,end:r},{action:"add",start:this.remainStart,end:e}]:[]}async getBucket(t){if(t<0||t>=this.length)return this.buckets[this.point];const e=this.updateBucketOperators(t);if(e.length){const t=[];e.forEach((({action:e,start:r,end:s})=>{for(let i=r;i<s;i++){const r=this.buckets[i];"remove"===e?r.entity=null:"add"===e&&(r.promise=this.parser.load(r.local||r.origin),"whole"!==this.loadMode&&this.point!==i||t.push(r.promise))}})),await Promise.all(t)}return this.get()}setLoadMode(t){this.loadMode=t}async prepare(e,s,i){const{parser:n,loadMode:a}=this;this.point="number"==typeof s&&s>0&&s<e.length?s:0,this.maxRemain="number"==typeof i&&i>0?i:3,this.updateRemainPoints(),this.buckets=await Promise.all(e.map((async(e,s)=>{const i={origin:e,local:"",entity:null,promise:null};if(r.is(t.H5))return i.local=e,this.remainStart<=s&&s<this.remainEnd&&("whole"===a||s===this.point?i.entity=await n.load(e):i.promise=n.load(e)),i;const o=kt($t.getFileName(e),"full"),l=n.download(i.origin),h=async t=>t&&(await Ct(t,o),i.local=o,this.remainStart<=s&&s<this.remainEnd)?$t.parseVideo(t,e):null;return"whole"===a||s===this.point?i.entity=await h(await l):i.promise=l.then(h),i})))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise,t.promise=null,t):null===t.entity?(t.entity=await this.parser.load(t.local||t.origin),t):t}prev(){return this.getBucket(this.point-1)}next(){return this.getBucket(this.point+1)}go(t){return this.getBucket(t)}clear(){const{buckets:t}=this;return this.buckets=[],this.point=this.remainStart=this.remainEnd=0,this.maxRemain=3,Promise.all(t.map((t=>It(t.local))))}}class Jt{buffer=[];lengthInBits=0;getAt(t){const e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))}putBit(t){const{lengthInBits:e,buffer:r}=this,s=~~(e/8);r.length<=s&&r.push(0),t&&(r[s]|=128>>>e%8),this.lengthInBits+=1}}const Vt={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},qt={L:1,M:0,Q:3,H:2},jt={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};class Qt{bytes;constructor(t){let e=[];for(let r=0;r<t.length;r++){const s=[],i=t.charCodeAt(r);i>65536?(s[0]=240|(1835008&i)>>>18,s[1]=128|(258048&i)>>>12,s[2]=128|(4032&i)>>>6,s[3]=128|63&i):i>2048?(s[0]=224|(61440&i)>>>12,s[1]=128|(4032&i)>>>6,s[2]=128|63&i):i>128?(s[0]=192|(1984&i)>>>6,s[1]=128|63&i):s[0]=i,e.push(s)}this.bytes=e.flat(1);const{bytes:r}=this;r.length!=t.length&&(r.unshift(191),r.unshift(187),r.unshift(239))}get mode(){return Vt.MODE_8BIT_BYTE}get length(){return this.bytes.length}write(t){const{bytes:e}=this;for(let r=0;r<e.length;r++)t.put(e[r],8)}}const Zt=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class Gt{getRSBlockTable(t,e){const{L:r,M:s,Q:i,H:n}=qt,a=4*(t-1);switch(e){case r:return Zt[a+0];case s:return Zt[a+1];case i:return Zt[a+2];case n:return Zt[a+3];default:throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel: ${e}`)}}getRSBlocks(t,e){const r=this.getRSBlockTable(t,e),s=r.length/3,i=[];for(let t=0;t<s;t++){const e=r[3*t],s=r[3*t+1],n=r[3*t+2];for(let t=0;t<e;t++)i.push({totalCount:s,dataCount:n})}return i}}class te{data;pos=0;buffer=0;buflen=0;constructor(t){this.data=t}decode(t){if(t>=65&&t<=90)return t-65;if(t>=97&&t<=122)return t-97+26;if(t>=48&&t<=57)return t-48+52;if(43==t)return 62;if(47==t)return 63;throw new Error(`c: ${t}`)}read(){for(;this.buflen<8;){if(this.pos>=this.data.length){if(0==this.buflen)return-1;throw new Error(`unexpected end of file./${this.buflen}`)}const t=this.data.charAt(this.pos);if(this.pos++,"="==t)return this.buflen=0,-1;t.match(/^\s$/)||(this.buffer=this.buffer<<6|this.decode(t.charCodeAt(0)),this.buflen+=6)}this.buflen-=8;return this.buffer>>>this.buflen&255}}const ee=new Array(256),re=new Array(256);for(let t=0;t<8;t++)ee[t]=1<<t;for(let t=8;t<256;t++)ee[t]=ee[t-4]^ee[t-5]^ee[t-6]^ee[t-8];for(let t=0;t<255;t++)re[ee[t]]=t;const se={glog(t){if(t<1)throw new Error(`glog(${t})`);return re[t]},gexp:t=>(t<0?t=255+t%255:t>255&&(t%=255),ee[t])};class ie{num;constructor(t,e){const{length:r}=t;if(void 0===r)throw new Error(`${r}/${e}`);let s=0;for(;s<r&&0==t[s];)s++;const i=r-s;this.num=new Array(i+e);for(let e=0;e<i;e++)this.num[e]=t[e+s]}get length(){return this.num.length}getAt(t){return this.num[t]}multiply(t){const{glog:e,gexp:r}=se,s=[];for(let i=0;i<this.length;i++)for(let n=0;n<t.length;n++)s[i+n]^=r(e(this.getAt(i))+e(t.getAt(n)));return new ie(s,0)}mod(t){if(this.length-t.length<0)return this;const{glog:e,gexp:r}=se,s=e(this.getAt(0))-e(t.getAt(0)),i=[];for(var n=0;n<this.length;n++){const a=this.getAt(n);i[n]=n<t.length?a^r(e(t.getAt(n))+s):a}return new ie(i,0).mod(t)}}const ne=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],ae=t=>0==t?0:Math.log2(t),oe=ae(1335),le=ae(7973),he={getBCHTypeInfo(t){let e=t<<10;for(;ae(e)-oe>=0;)e^=1335<<ae(e)-oe;return 21522^(t<<10|e)},getBCHTypeNumber(t){let e=t<<12;for(;ae(e)-le>=0;)e^=7973<<ae(e)-le;return t<<12|e},getPatternPosition:t=>ne[t-1],getMaskFunction(t){const{PATTERN000:e,PATTERN001:r,PATTERN010:s,PATTERN011:i,PATTERN100:n,PATTERN101:a,PATTERN110:o,PATTERN111:l}=jt;switch(t){case e:return(t,e)=>(t+e)%2==0;case r:return t=>t%2==0;case s:return(t,e)=>e%3==0;case i:return(t,e)=>(t+e)%3==0;case n:return(t,e)=>(~~(t/2)+~~(e/3))%2==0;case a:return(t,e)=>t*e%2+t*e%3==0;case o:return(t,e)=>(t*e%2+t*e%3)%2==0;case l:return(t,e)=>(t*e%3+(t+e)%2)%2==0;default:throw new Error(`bad maskPattern: ${t}`)}},getErrorCorrectPolynomial(t){let e=new ie([1],0);for(let r=0;r<t;r++)e=e.multiply(new ie([1,se.gexp(r)],0));return e},getLengthInBits(t,e){const{MODE_NUMBER:r,MODE_ALPHA_NUM:s,MODE_8BIT_BYTE:i,MODE_KANJI:n}=Vt;if(e<1||e>40)throw new Error(`type: ${e}`);if(e>=1&&e<10)switch(t){case r:return 10;case s:return 9;case i:case n:return 8}if(e<27)switch(t){case r:return 12;case s:return 11;case i:return 16;case n:return 10}if(e<=40)switch(t){case r:return 14;case s:return 13;case i:return 16;case n:return 12}throw new Error(`mode: ${t}`)},getLostPoint(t){const e=t.getModuleCount();let r=0;for(let s=0;s<e;s++)for(let i=0;i<e;i++){const n=t.isDark(s,i);let a=0;for(let r=-1;r<=1;r++){const o=s+r;if(!(o<0||e<=o))for(let s=-1;s<=1;s++){const l=i+s;l<0||e<=l||(0==r&&0==s||n==t.isDark(o,l)&&a++)}}a>5&&(r+=a+3-5)}for(let s=0;s<e-1;s++)for(let i=0;i<e-1;i++){let e=0;t.isDark(s,i)&&e++,t.isDark(s+1,i)&&e++,t.isDark(s,i+1)&&e++,t.isDark(s+1,i+1)&&e++,0!=e&&4!=e||(r+=3)}for(let s=0;s<e;s++)for(let i=0;i<e-6;i++)t.isDark(s,i)&&!t.isDark(s,i+1)&&t.isDark(s,i+2)&&t.isDark(s,i+3)&&t.isDark(s,i+4)&&!t.isDark(s,i+5)&&t.isDark(s,i+6)&&(r+=40);for(let s=0;s<e;s++)for(let i=0;i<e-6;i++)t.isDark(i,s)&&!t.isDark(i+1,s)&&t.isDark(i+2,s)&&t.isDark(i+3,s)&&t.isDark(i+4,s)&&!t.isDark(i+5,s)&&t.isDark(i+6,s)&&(r+=40);let s=0;for(let r=0;r<e;r++)for(let i=0;i<e;i++)t.isDark(i,r)&&s++;return r+10*(Math.abs(100*s/Math.pow(e,2)-50)/5)}};class ce{typeNumber;static stringToBytes(t){const e=[];for(let r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e}static createStringToBytes(t,e){const r=(()=>{const r=new te(t),s=()=>{const t=r.read();if(-1==t)throw new Error("character defect!");return t},i={};let n=0;for(;;){const t=r.read();if(-1==t)break;const e=s(),a=s()<<8|s();i[String.fromCharCode(t<<8|e)]=a,n+=1}if(n!=e)throw new Error(`${n} != ${e}`);return i})(),s="?".charCodeAt(0);return t=>{const e=[];for(let i=0;i<t.length;i++){const n=t.charCodeAt(i);if(n<128)e.push(n);else{const n=r[t.charAt(i)];"number"==typeof n?(255&n)==n?e.push(n):(e.push(n>>>8),e.push(255&n)):e.push(s)}}return e}}errorCorrectLevel;modules=[];moduleCount=0;dataCache=null;dataList=[];constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=qt[e]}makeImpl(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=(t=>{const e=[];for(let r=0;r<t;r++){e[r]=[];for(let s=0;s<t;s++)e[r][s]=null}return e})(this.moduleCount);const r=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(r,0),this.setupPositionProbePattern(0,r),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)}setupPositionProbePattern(t,e){const{modules:r,moduleCount:s}=this;for(let i=-1;i<=7;i++){const n=t+i;if(!(n<=-1||s<=n))for(let t=-1;t<=7;t++){const a=e+t;a<=-1||s<=a||(r[n][a]=i>=0&&i<=6&&(0==t||6==t)||t>=0&&t<=6&&(0==i||6==i)||i>=2&&i<=4&&t>=2&&t<=4)}}}setupPositionAdjustPattern(){const{typeNumber:t,modules:e}=this,r=he.getPatternPosition(t),{length:s}=r;for(let t=0;t<s;t++)for(let i=0;i<s;i++){const s=r[t],n=r[i];if(null==e[s][n])for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)e[s+t][n+r]=-2==t||2==t||-2==r||2==r||0==t&&0==r}}setupTimingPattern(){const{moduleCount:t,modules:e}=this,r=t-8;for(let t=8;t<r;t++)null==e[t][6]&&(e[t][6]=t%2==0);for(let t=8;t<r;t++)null==e[6][t]&&(e[6][t]=t%2==0)}setupTypeInfo(t,e){const{errorCorrectLevel:r,modules:s,moduleCount:i}=this,n=r<<3|e,a=he.getBCHTypeInfo(n);for(let e=0;e<15;e++){const r=!t&&1==(a>>e&1);e<6?s[e][8]=r:e<8?s[e+1][8]=r:s[i-15+e][8]=r}for(let e=0;e<15;e++){const r=!t&&1==(a>>e&1);e<8?s[8][i-e-1]=r:e<9?s[8][15-e]=r:s[8][15-e-1]=r}s[i-8][8]=!t}getBestMaskPattern(){let t=0,e=0;for(let r=0;r<8;r++){this.makeImpl(!0,r);const s=he.getLostPoint(this);(0==r||t>s)&&(t=s,e=r)}return e}setupTypeNumber(t){const{typeNumber:e,modules:r,moduleCount:s}=this,i=he.getBCHTypeNumber(e);for(let e=0;e<18;e++){const n=!t&&1==(i>>e&1);r[~~(e/3)][e%3+s-8-3]=n,r[e%3+s-8-3][~~(e/3)]=n}}createData(t,e,r){const s=(new Gt).getRSBlocks(t,e),i=new Jt;for(let e=0;e<r.length;e++){const s=r[e];i.put(s.mode,4),i.put(s.length,he.getLengthInBits(s.mode,t)),s.write(i)}let n=0;for(let t=0;t<s.length;t++)n+=s[t].dataCount;const a=8*n;if(i.lengthInBits>a)throw new Error(`code length overflow. (${i.lengthInBits} > ${a})`);for(i.lengthInBits+4<=a&&i.put(0,4);i.lengthInBits%8!=0;)i.putBit(!1);for(;!(i.lengthInBits>=a||(i.put(236,8),i.lengthInBits>=a));)i.put(17,8);return this.createBytes(i,s)}mapData(t,e){const{modules:r,moduleCount:s}=this,i=he.getMaskFunction(e);let n=-1,a=s-1,o=7,l=0;for(let e=a;e>0;e-=2)for(6==e&&(e-=1);;){for(let s=0;s<2;s++)if(null==r[a][e-s]){let n=!1;l<t.length&&(n=1==(t[l]>>>o&1)),i(a,e-s)&&(n=!n),r[a][e-s]=n,o--,-1==o&&(l++,o=7)}if(a+=n,a<0||s<=a){a-=n,n=-n;break}}}createBytes(t,e){const r=[],s=[];let i=0,n=0,a=0;for(let o=0;o<e.length;o++){const l=e[o].dataCount,h=e[o].totalCount-l;n=Math.max(n,l),a=Math.max(a,h),r[o]=[];for(let e=0;e<l;e++)r[o][e]=255&t.buffer[e+i];i+=l;const c=he.getErrorCorrectPolynomial(h),u=new ie(r[o],c.length-1).mod(c);s[o]=new Array(c.length-1);for(let t=0;t<s[o].length;t++){const e=t+u.length-s[o].length;s[o][t]=e>=0?u.getAt(e):0}}let o=0;for(let t=0;t<e.length;t++)o+=e[t].totalCount;const l=new Array(o);let h=0;for(let t=0;t<n;t++)for(let s=0;s<e.length;s++)t<r[s].length&&(l[h++]=r[s][t]);for(let t=0;t<a;t++)for(let r=0;r<e.length;r++)t<s[r].length&&(l[h++]=s[r][t]);return l}isDark(t,e){const{moduleCount:r}=this;if(t<0||r<=t||e<0||r<=e)throw new Error(`${t}, ${e}`);return this.modules[t][e]}addData(t){this.dataList.push(new Qt(t)),this.dataCache=null}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}}class ue{out;bit=0;bitlen=0;constructor(t){this.out=t}write(t,e){if(t>>>e!=0)throw new Error("length over");for(;this.bitlen+e>=8;)this.out.writeByte(255&(t<<this.bitlen|this.bit)),e-=8-this.bitlen,t>>>=8-this.bitlen,this.bit=this.bitlen=0;this.bit=t<<this.bitlen|this.bit,this.bitlen+=e}flush(){this.bitlen>0&&this.out.writeByte(this.bit)}}class fe{bytes=[];writeByte(t){this.bytes.push(255&t)}writeBytes(t,e,r){const s=e||0,i=r||t.length;for(let e=0;e<i;e++)this.writeByte(t[e+s])}writeShort(t){this.writeByte(t),this.writeByte(t>>>8)}writeString(t){for(let e=0;e<t.length;e++)this.writeByte(t.charCodeAt(e))}toByteArray(){return this.bytes}toString(){return`[${this.bytes.join(",")}]`}}class de{map={};mapSize=0;get size(){return this.mapSize}add(t){if(this.contains(t))throw new Error(`dup key: ${t}`);this.map[t]=this.mapSize,this.mapSize++}indexOf(t){return this.map[t]??-1}contains(t){return null!=this.map[t]}}class pe{buffer=0;buflen=0;length=0;base64="";encode(t){if(t<26)return 65+t;if(t<52)return t-26+97;if(t<62)return t-52+48;if(62==t)return 43;if(63==t)return 47;throw new Error(`n: ${t}`)}writeEncoded(t){this.base64+=String.fromCharCode(this.encode(63&t))}writeByte(t){for(this.buffer=this.buffer<<8|255&t,this.buflen+=8,this.length+=1;this.buflen>=6;)this.buflen-=6,this.writeEncoded(this.buffer>>>this.buflen)}flush(){const{buffer:t,buflen:e,length:r}=this;if(e>0&&(this.writeEncoded(t<<6-e),this.buffer=0,this.buflen=0),r%3!=0){const t=3-r%3;for(let e=0;e<t;e++)this.base64+="="}}toString(){return this.base64}}class me{width;height;data=[];constructor(t,e){this.width=t,this.height=e}getLZWRaster(t){const{data:e}=this,r=1<<t,s=r+1;let i=t+1;const n=new de,a=t=>String.fromCharCode(t);for(let t=0;t<r;t+=1)n.add(a(t));n.add(a(r)),n.add(a(s));const o=new fe,l=new ue(o);l.write(r,i);let h=0,c=a(e[h++]);for(;h<e.length;){const t=a(e[h++]);n.contains(c+t)?c+=t:(l.write(n.indexOf(c),i),n.size<4095&&(n.size==1<<i&&i++,n.add(c+t)),c=t)}return l.write(n.indexOf(c),i),l.write(s,i),l.flush(),o.toByteArray()}setPixel(t,e,r){this.data[e*this.width+t]=r}write(t,e="#000000",r="#ffffff"){const{width:s,height:i}=this;t.writeString("GIF87a"),t.writeShort(s),t.writeShort(i),t.writeByte(128),t.writeByte(0),t.writeByte(0);const n=e.split("");t.writeByte(parseInt(`${n[1]}${n[2]}`,16)),t.writeByte(parseInt(`${n[3]}${n[4]}`,16)),t.writeByte(parseInt(`${n[5]}${n[6]}`,16));const a=r.split("");t.writeByte(parseInt(`${a[1]}${a[2]}`,16)),t.writeByte(parseInt(`${a[3]}${a[4]}`,16)),t.writeByte(parseInt(`${a[5]}${a[6]}`,16)),t.writeString(","),t.writeShort(0),t.writeShort(0),t.writeShort(s),t.writeShort(i),t.writeByte(0);const o=this.getLZWRaster(2);t.writeByte(2);let l=0;for(;o.length-l>255;)t.writeByte(255),t.writeBytes(o,l,255),l+=255;const h=o.length-l;t.writeByte(h),t.writeBytes(o,l,h),t.writeByte(0),t.writeString(";")}}var ye,ge={};
/*! crc32.js (C) 2014-present SheetJS -- http://sheetjs.com */var we,be=(ye||(ye=1,we=function(t){t.version="1.2.2";var e=function(){for(var t=0,e=new Array(256),r=0;256!=r;++r)t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=1&(t=r)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1)?-306674912^t>>>1:t>>>1,e[r]=t;return"undefined"!=typeof Int32Array?new Int32Array(e):e}(),r=function(t){var e=0,r=0,s=0,i="undefined"!=typeof Int32Array?new Int32Array(4096):new Array(4096);for(s=0;256!=s;++s)i[s]=t[s];for(s=0;256!=s;++s)for(r=t[s],e=256+s;e<4096;e+=256)r=i[e]=r>>>8^t[255&r];var n=[];for(s=1;16!=s;++s)n[s-1]="undefined"!=typeof Int32Array?i.subarray(256*s,256*s+256):i.slice(256*s,256*s+256);return n}(e),s=r[0],i=r[1],n=r[2],a=r[3],o=r[4],l=r[5],h=r[6],c=r[7],u=r[8],f=r[9],d=r[10],p=r[11],m=r[12],y=r[13],g=r[14];t.table=e,t.bstr=function(t,r){for(var s=~r,i=0,n=t.length;i<n;)s=s>>>8^e[255&(s^t.charCodeAt(i++))];return~s},t.buf=function(t,r){for(var w=~r,b=t.length-15,k=0;k<b;)w=g[t[k++]^255&w]^y[t[k++]^w>>8&255]^m[t[k++]^w>>16&255]^p[t[k++]^w>>>24]^d[t[k++]]^f[t[k++]]^u[t[k++]]^c[t[k++]]^h[t[k++]]^l[t[k++]]^o[t[k++]]^a[t[k++]]^n[t[k++]]^i[t[k++]]^s[t[k++]]^e[t[k++]];for(b+=15;k<b;)w=w>>>8^e[255&(w^t[k++])];return~w},t.str=function(t,r){for(var s=~r,i=0,n=t.length,a=0,o=0;i<n;)(a=t.charCodeAt(i++))<128?s=s>>>8^e[255&(s^a)]:a<2048?s=(s=s>>>8^e[255&(s^(192|a>>6&31))])>>>8^e[255&(s^(128|63&a))]:a>=55296&&a<57344?(a=64+(1023&a),o=1023&t.charCodeAt(i++),s=(s=(s=(s=s>>>8^e[255&(s^(240|a>>8&7))])>>>8^e[255&(s^(128|a>>2&63))])>>>8^e[255&(s^(128|o>>6&15|(3&a)<<4))])>>>8^e[255&(s^(128|63&o))]):s=(s=(s=s>>>8^e[255&(s^(224|a>>12&15))])>>>8^e[255&(s^(128|a>>6&63))])>>>8^e[255&(s^(128|63&a))];return~s}},"undefined"==typeof DO_NOT_EXPORT_CRC?we(ge):we({})),ge);class ke{width;height;data;constructor(t,e){this.width=t,this.height=e,this.data=new Uint32Array(t*e)}toInt8(t){const e=new ArrayBuffer(1);return new DataView(e).setUint8(0,t),e}toInt32(t){const e=new ArrayBuffer(4);return new DataView(e).setUint32(0,t,!1),e}addChunk(t,e,r=[]){const s=new Uint8Array(e);return new Uint8Array([...new Uint8Array(this.toInt32(t)),...s,...r,...new Uint8Array(this.toInt32(be.buf([...s,...r])))])}setPixel(t,e,r){this.data[e*this.width+t]=r}write(t){const{width:e,height:r}=this,s=new Uint8Array([137,80,78,71,13,10,26,10]),i=this.addChunk(13,[73,72,68,82],new Uint8Array([...new Uint8Array(this.toInt32(e)),...new Uint8Array(this.toInt32(r)),...new Uint8Array(this.toInt8(1)),...new Uint8Array(this.toInt8(0)),...new Uint8Array(this.toInt8(0)),...new Uint8Array(this.toInt8(0)),...new Uint8Array(this.toInt8(0))])),n=K(new Uint8Array(this.data.buffer)),a=this.addChunk(n.length,[73,68,65,84],n),o=this.addChunk(0,[73,69,78,68]);t.writeBytes(new Uint8Array([...s,...i,...a,...o]))}}function ve(t={}){const e={...t};return{typeNumber:e.typeNumber??4,errorCorrectLevel:e.errorCorrectLevel??"M",size:e.size??500,black:e.black??"#000000FF",white:e.white??"#FFFFFFFF"}}const xe=(t,e)=>{const r=~~(e/t);return{margin:~~((e-t*r)/2),cellSize:r||2}};function Ce(t,e){const{typeNumber:r,errorCorrectLevel:s,size:i,black:n,white:a}=ve(e);let o;try{o=new ce(r,s),o.addData(t),o.make()}catch(e){if(r>=40)throw new Error("Text too long to encode");return arguments.callee(t,{size:i,errorCorrectLevel:s,typeNumber:r+1,black:n,white:a})}const l=o.getModuleCount(),{margin:h,cellSize:c}=xe(l,i),u=l*c+h;return function(t,e,r,s,i){const n=new me(t,e);for(let s=0;s<e;s++)for(let e=0;e<t;e++)n.setPixel(e,s,r(e,s));const a=new fe;n.write(a,s,i);const o=new pe,l=a.toByteArray();for(let t=0;t<l.length;t++)o.writeByte(l[t]);return o.flush(),`data:image/gif;base64,${o}`}(i,i,((t,e)=>{if(h<=t&&t<u&&h<=e&&e<u){const r=~~((t-h)/c),s=~~((e-h)/c);return o.isDark(s,r)?0:1}return 1}),n,a)}function Ie(t,e){const{typeNumber:r,errorCorrectLevel:s,size:i,black:n,white:a}=ve(e);let o;try{o=new ce(r,s),o.addData(t),o.make()}catch(e){if(r>=40)throw new Error("Text too long to encode");return arguments.callee(t,{size:i,errorCorrectLevel:s,typeNumber:r+1,black:n,white:a})}const l=o.getModuleCount(),{margin:h,cellSize:c}=xe(l,i),u=l*c+h,f=+n.replace("#","0x"),d=+a.replace("#","0x");return function(t,e,r){const s=new ke(t,e);for(let i=0;i<e;i++)for(let e=0;e<t;e++)s.setPixel(e,i,r(e,i));const i=new fe;s.write(i);const n=new pe,a=i.toByteArray();for(let t=0;t<a.length;t++)n.writeByte(a[t]);return n.flush(),`data:image/png;base64,${n}`}(i,i,((t,e)=>{if(h<=t&&t<u&&h<=e&&e<u){const r=~~((t-h)/c),s=~~((e-h)/c);return o.isDark(s,r)?f:d}return d}))}function Te(t,e){const{typeNumber:r,errorCorrectLevel:s,size:i,black:n,white:a}=ve(e);let o;try{o=new ce(r,s),o.addData(t),o.make()}catch(e){if(r>=40)throw new Error("Text too long to encode");return arguments.callee(t,{size:i,errorCorrectLevel:s,typeNumber:r+1,black:n,white:a})}const l=o.getModuleCount(),{margin:h,cellSize:c}=xe(l,i),u="border-width: 0px; border-style: none; border-collapse: collapse; padding: 0px;";let f=`<table style="${u} margin: ${h}px;"><tbody>`;for(let t=0;t<l;t++){f+="<tr>";for(let e=0;e<l;e++)f+=`<td style="${u} margin: 0px; width: ${c}px; height: ${c}px; background-color: ${o.isDark(t,e)?"#000000":"#ffffff"};"/>`;f+="</tr>"}return f+"</tbody></table>"}const Ae={env:r,SUPPORTED_ENV:t};export{zt as Brush,ut as MovieEntity,$t as Parser,Xt as Player,_t as Poster,ce as QRCode,Ae as Svga,Kt as VideoManager,Ce as createQRCodeToGIF,Te as createQRCodeToHTML,Ie as createQRCodeToPNG,pt as getCanvas,mt as getOffscreenCanvas};
//# sourceMappingURL=index.js.map

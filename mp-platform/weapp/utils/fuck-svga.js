const t=()=>{},e=async(t,r=[],s=0)=>{try{return t()}catch(i){if(s>=r.length)throw i;return n=()=>e(t,r,++s),a=r[s],new Promise((t=>setTimeout((()=>t(n())),a)))}var n,a},r=4096,s=new Uint16Array(r);function n(t,e,n){if(e<0||n>t.length)throw new RangeError("Index out of range");if(n-e<1)return"";const a=[];let i=0;const o=t=>{a.push(String.fromCharCode.apply(null,Array.from(t)))};let l=!0;for(let r=e;r<n;r++)if(t[r]>127){l=!1;break}if(l){for(let a=e;a<n;a+=r){const e=Math.min(a+r,n)-a;for(let r=0;r<e;r++)s[r]=t[a+r];o(s.subarray(0,e))}return a.join("")}for(let a=e;a<n;){const e=t[a++];if(e<128){s[i++]=e,i===r&&(o(s),i=0);continue}let l;if(i>0&&(o(s.subarray(0,i)),i=0),192==(224&e)&&a<n)l=(31&e)<<6|63&t[a++];else if(224==(240&e)&&a+1<n)l=(15&e)<<12|(63&t[a++])<<6|63&t[a++];else if(240==(248&e)&&a+2<n){if(l=(7&e)<<18|(63&t[a++])<<12|(63&t[a++])<<6|63&t[a++],l>65535){l-=65536,s[i++]=55296+(l>>10),s[i++]=56320+(1023&l),i>=4094&&(o(s.subarray(0,i)),i=0);continue}}else for(l=65533;a<n&&128==(192&t[a]);)a++;s[i++]=l,i>=4093&&(o(s.subarray(0,i)),i=0)}return i>0&&o(s.subarray(0,i)),a.join("")}class a{plugins=[];platformVersion="0.0.1";version="";globals={env:"unknown",br:null,dpr:1};noop=t;retry=e;constructor(t,e){this.version=e||"",this.plugins=t,this.globals.env=this.autoEnv()}init(){this.globals.br=this.useBridge(),this.globals.dpr=this.usePixelRatio();const t=this.plugins.reduce(((t,e)=>(t[e.name]=e,t)),{}),e=this.plugins.map((t=>t.name));this.usePlugins(t,e,{})}autoEnv(){if("undefined"!=typeof window)return"h5";if("undefined"!=typeof tt)return"tt";if("undefined"!=typeof my)return"alipay";if("undefined"!=typeof wx)return"weapp";throw new Error("Unsupported app")}useBridge(){switch(this.globals.env){case"h5":return globalThis;case"alipay":return my;case"tt":return tt;case"weapp":return wx}return{}}usePixelRatio(){const{env:t,br:e}=this.globals;return"h5"===t?devicePixelRatio:"getWindowInfo"in e?e.getWindowInfo().pixelRatio:"getSystemInfoSync"in e?e.getSystemInfoSync().pixelRatio:1}usePlugins(t,e,r){e.forEach((e=>{const s=t[e];if(!r[e]){if(void 0===s)throw new Error(`Plugin ${e} not found`);if(Array.isArray(s.dependencies)){for(const r of s.dependencies)if("function"!=typeof t[r]?.install)throw new Error(`Plugin ${e} depends on plugin ${r}, but ${r} is not found`);this.usePlugins(t,s.dependencies,r)}this.installPlugin(s),r[s.name]=!0}}))}switch(t){this.globals.env=t,this.init()}}var i={name:"getCanvas",install(){const{retry:t}=this,{env:e,br:r,dpr:s}=this.globals,n=[50,100,100];function a(t,e,r){if(!t)throw new Error("canvas not found.");const n=t.getContext("2d");return t.width=e*s,t.height=r*s,{canvas:t,context:n}}if("h5"===e){const e=t=>document.querySelector(t);return r=>t((()=>{const t=e(`canvas[canvas-id=${r.slice(1)}]`)||e(r);return a(t,t?.clientWidth,t?.clientHeight)}),n)}return(e,s)=>t((()=>new Promise(((t,n)=>{let i=r.createSelectorQuery();s&&(i=i.in(s)),i.select(e).fields({node:!0,size:!0},(e=>{const{node:r,width:s,height:i}=e||{};try{t(a(r,s,i))}catch(t){n(t)}})).exec()}))),n)}},o={name:"decode",install(){const{env:t,br:e}=this.globals,r=(t,e="image/png")=>`data:${e};base64,${t}`,s={toBuffer(t){const{buffer:e,byteOffset:r,byteLength:s}=t;return e.slice(r,r+s)},bytesToString(t){let e="";for(let r=0;r<t.length;r+=8192){const s=t.slice(r,r+8192);e+=String.fromCharCode.apply(null,Array.from(s))}return e}};if("h5"===t){const t=new TextDecoder("utf-8",{fatal:!0});s.toDataURL=t=>r(btoa(s.bytesToString(t))),s.utf8=(e,r,s)=>t.decode(e.subarray(r,s))}else s.toDataURL=t=>r(e.arrayBufferToBase64(s.toBuffer(t))),s.utf8=n;return s}},l={name:"remote",install(){const{env:t,br:e}=this.globals,r=t=>/^(blob:)?http(s)?:\/\//.test(t);if("h5"===t)return{is:r,fetch:t=>fetch(t).then((t=>{if(t.ok)return t.arrayBuffer();throw new Error(`HTTP error, status=${t.status}, statusText=${t.statusText}`)}))};function s(t,r){return new Promise(((s,n)=>{e.request({url:t,dataType:"arraybuffer",responseType:"arraybuffer",enableCache:r,success:t=>s(t.data),fail:n})})).catch((e=>{const r=e.errMsg||e.errorMessage||e.message;if(r.includes("ERR_CACHE_WRITE_FAILURE")||r.includes("ERR_CACHE_WRITE_FAILED"))return s(t,!1);throw e}))}return{is:r,fetch:t=>s(t,!0)}}},c={name:"local",install(){const{env:t,br:e}=this.globals;if("h5"===t)return null;const r=e.getFileSystemManager();return{write:(t,e)=>new Promise(((s,n)=>{r.writeFile({filePath:e,data:t,success:()=>s(e),fail:n})})),read:t=>new Promise(((e,s)=>{r.readFile({filePath:t,success:t=>e(t.data),fail:s})})),remove:t=>new Promise(((e,s)=>{r.unlink({filePath:t,success:()=>e(t),fail:s})}))}}},h={name:"image",dependencies:["local","path","decode"],install(){const{local:t,decode:e}=this,{env:r}=this.globals;let s=(t,r)=>"string"==typeof t?t:e.toDataURL(t);function n(t,e){return new Promise(((r,s)=>{t.onload=()=>r(t),t.onerror=()=>s(new Error(`SVGA LOADING FAILURE: ${t.src}`)),t.src=e}))}function a(t){t.onload=null,t.onerror=null,t.src=""}return"h5"===r?{create:t=>new Image,load:(t,r,a)=>r instanceof Uint8Array&&"createImageBitmap"in globalThis?createImageBitmap(new Blob([e.toBuffer(r)])):r instanceof ImageBitmap?Promise.resolve(r):n(t(),s(r,a)),release:a}:("weapp"===r&&(s=async(r,s)=>"string"==typeof r?r:t.write(e.toBuffer(r),s).catch((t=>(console.warn(`image write fail: ${t.errorMessage||t.errMsg||t.message}`),e.toDataURL(r))))),{create:t=>t.createImage(),load:async(t,e,r)=>{const a=await s(e,r);return n(t(),a)},release:a})}},u={name:"now",install(){const{env:t,br:e}=this.globals,r="h5"===t?performance:"tt"===t?e.performance:e.getPerformance();return"function"==typeof r?.now?r.now()-Date.now()>0?()=>r.now()/1e3:()=>r.now():()=>Date.now()}},f={name:"getOfsCanvas",install(){const{env:t}=this.globals;let e;return e="h5"===t?t=>new OffscreenCanvas(t.width,t.height):"alipay"===t?t=>my.createOffscreenCanvas(t):"tt"===t?t=>{const e=tt.createOffscreenCanvas();return e.width=t.width,e.height=t.height,e}:t=>wx.createOffscreenCanvas(t),t=>{const r=t.type||"2d",s=e({...t,type:r}),n=s.getContext(r);return{canvas:s,context:n}}}},d={name:"path",install(){const{env:t,br:e}=this.globals,r=t=>t.substring(t.lastIndexOf("/")+1);if("h5"===t)return{USER_DATA_PATH:"",filename:r,resolve:(t,e)=>`${e?`${e}__`:""}${t}`};const{USER_DATA_PATH:s}="tt"===t?tt.getEnvInfoSync().common:e.env;return{USER_DATA_PATH:s,filename:r,resolve:(t,e)=>`${s}/${e?`${e}__`:""}${t}`}}},p={name:"rAF",dependencies:["now"],install(){const{env:t}=this.globals;function e(){return t=>setTimeout(t,Math.max(0,16-Date.now()%16))}if("h5"===t){const t="requestAnimationFrame"in globalThis?requestAnimationFrame:e();return(e,r)=>t(r)}return(t,r)=>{try{return t.requestAnimationFrame(r)}catch(t){return console.warn(t.message),e()(r)}}}};const m=new class extends a{now;path;remote;local;decode;image;rAF;getCanvas;getOfsCanvas;constructor(){super([i,f,o,l,c,h,u,d,p],"0.2.0"),this.init()}installPlugin(t){const e=t.install.call(this);Object.defineProperty(this,t.name,{get:()=>e,enumerable:!0,configurable:!0})}};const g=function(){const t=Array(4).fill(0).map((()=>new DataView(new ArrayBuffer(8))));let e=0;return function(r,s){if(s<0||s+4>r.length)throw new RangeError("Index out of range");const n=t[e];e=(e+1)%4;const a=new Uint8Array(n.buffer);return a[0]=r[s],a[1]=r[s+1],a[2]=r[s+2],a[3]=r[s+3],n.getFloat32(0,!0)}}();class y{static EMPTY_UINT8ARRAY=new Uint8Array(0);static create(t){if(t instanceof y)return t;if(t instanceof Uint8Array)return new y(t);throw Error("illegal buffer")}buf;pos;len;constructor(t){this.buf=t,this.pos=0,this.len=t.length}indexOutOfRange(t,e){return new RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}readVarint32Slow(){let t=this.buf[this.pos++],e=127&t,r=7;do{if(this.pos>=this.len)throw this.indexOutOfRange(this);t=this.buf[this.pos++],e|=(127&t)<<r,r+=7}while(t>=128&&r<32);return e>>>0}uint32(){const t=this.buf[this.pos];return t<128?(this.pos++,t):this.readVarint32Slow()}int32(){return 0|this.uint32()}float(){if(this.pos+4>this.len)throw this.indexOutOfRange(this,4);const t=g(this.buf,this.pos);return this.pos+=4,t}getBytesRange(){const t=this.uint32(),e=this.pos,r=e+t;if(r>this.len)throw this.indexOutOfRange(this,t);return[e,r,t]}bytes(){const[t,e,r]=this.getBytesRange();return this.pos+=r,0===r?y.EMPTY_UINT8ARRAY:this.buf.subarray(t,e)}string(){const[t,e]=this.getBytesRange(),r=m.decode.utf8(this.buf,t,e);return this.pos=e,r}skip(t){if("number"==typeof t){if(this.pos+t>this.len)throw this.indexOutOfRange(this,t);return this.pos+=t,this}const e=this.buf;let r=this.pos;const s=this.len;for(;r<s;){if(!(128&e[r++]))return this.pos=r,this;if(r<s&&128&e[r]&&(r++,r<s&&128&e[r]&&(r++,r<s&&128&e[r]))){for(r++;r<s&&128&e[r];)if(r++,r-this.pos>=10)throw Error("invalid varint encoding");if(r<s)return this.pos=r+1,this}}throw this.indexOutOfRange(this)}skipType(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!=(t=7&this.uint32());)this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this}}class w{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new w;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;default:t.skipType(7&n)}return w.format(s)}static format(t){const{x:e,y:r,width:s,height:n}=t;return{x:e+.5||0,y:r+.5||0,width:s+.5||0,height:n+.5||0}}x=0;y=0;width=0;height=0}class b{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new b;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.a=t.float();break;case 2:s.b=t.float();break;case 3:s.c=t.float();break;case 4:s.d=t.float();break;case 5:s.tx=t.float();break;case 6:s.ty=t.float();break;default:t.skipType(7&n)}return s}a=0;b=0;c=0;d=0;tx=0;ty=0}class k{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new k;let n;for(;t.pos<r;)if(n=t.uint32(),n>>>3==1)s.d=t.string();else t.skipType(7&n);return s}d=""}class x{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new x;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.width=t.float();break;case 4:s.height=t.float();break;case 5:s.cornerRadius=t.float();break;default:t.skipType(7&n)}return s}x=0;y=0;width=0;height=0;cornerRadius=0}class v{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new v;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.x=t.float();break;case 2:s.y=t.float();break;case 3:s.radiusX=t.float();break;case 4:s.radiusY=t.float();break;default:t.skipType(7&n)}return s}x=0;y=0;radiusX=0;radiusY=0}class T{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new T;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.r=t.float();break;case 2:s.g=t.float();break;case 3:s.b=t.float();break;case 4:s.a=t.float();break;default:t.skipType(7&n)}return T.format(s)}static format(t){const{r:e,g:r,b:s,a:n}=t;return`rgba(${255*e|0}, ${255*r|0}, ${255*s|0}, ${1*n|0})`}r=0;g=0;b=0;a=0}class C{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new C;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.fill=T.decode(t,t.uint32());break;case 2:s.stroke=T.decode(t,t.uint32());break;case 3:s.strokeWidth=t.float();break;case 4:s.lineCap=t.int32();break;case 5:s.lineJoin=t.int32();break;case 6:s.miterLimit=t.float();break;case 7:s.lineDashI=t.float();break;case 8:s.lineDashII=t.float();break;case 9:s.lineDashIII=t.float();break;default:t.skipType(7&n)}return C.format(s)}static format(t){const{fill:e,stroke:r,strokeWidth:s,miterLimit:n,lineDashI:a,lineDashII:i,lineDashIII:o}=t,l=[];let c,h;switch(a>0&&l.push(a),i>0&&(l.length<1&&l.push(0),l.push(i)),o>0&&(l.length<2&&l.push(0,0),l.push(o)),t.lineCap){case 0:c="butt";break;case 1:c="round";break;case 2:c="square"}switch(t.lineJoin){case 0:h="miter";break;case 1:h="round";break;case 2:h="bevel"}return{lineDash:l,fill:e||null,stroke:r||null,lineCap:c,lineJoin:h,strokeWidth:s,miterLimit:n}}fill=null;stroke=null;strokeWidth=0;lineCap=0;lineJoin=0;miterLimit=0;lineDashI=0;lineDashII=0;lineDashIII=0}class E{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new E;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.type=t.int32();break;case 2:s.shape=k.decode(t,t.uint32());break;case 3:s.rect=x.decode(t,t.uint32());break;case 4:s.ellipse=v.decode(t,t.uint32());break;case 10:s.styles=C.decode(t,t.uint32());break;case 11:s.transform=b.decode(t,t.uint32());break;default:t.skipType(7&n)}return E.format(s)}static format(t){const{type:e,shape:r,rect:s,ellipse:n,styles:a,transform:i}=t;switch(e){case 0:return{type:"shape",path:r,styles:a,transform:i};case 1:return{type:"rect",path:s,styles:a,transform:i};case 2:return{type:"ellipse",path:n,styles:a,transform:i}}return null}type=0;shape=null;rect=null;ellipse=null;styles=null;transform=null}class A{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new A;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.alpha=t.float();break;case 2:s.layout=w.decode(t,t.uint32());break;case 3:s.transform=b.decode(t,t.uint32());break;case 4:s.clipPath=t.string();break;case 5:{s.shapes&&s.shapes.length||(s.shapes=[]);const e=E.decode(t,t.uint32());null!==e&&s.shapes.push(e);break}default:t.skipType(7&n)}return A.format(s)}static format(t){if(t.alpha<.05)return{alpha:0};const{alpha:e,layout:r,transform:s,shapes:n}=t;return{alpha:e,layout:r,transform:s,shapes:n}}shapes=[];alpha=0;layout=null;transform=null;clipPath=""}class P{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new P;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.imageKey=t.string();break;case 2:s.frames&&s.frames.length||(s.frames=[]),s.frames.push(A.decode(t,t.uint32()));break;case 3:s.matteKey=t.string();break;default:t.skipType(7&n)}return s}frames=[];imageKey="";matteKey=""}class R{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new R;let n;for(;t.pos<r;)switch(n=t.uint32(),n>>>3){case 1:s.viewBoxWidth=t.float();break;case 2:s.viewBoxHeight=t.float();break;case 3:s.fps=t.int32();break;case 4:s.frames=t.int32();break;default:t.skipType(7&n)}return s}viewBoxWidth=0;viewBoxHeight=0;fps=0;frames=0}class M{static decode(t,e){t=y.create(t);const r=void 0===e?t.len:t.pos+e,s=new M;let n,a,i;for(;t.pos<r;)switch(i=t.uint32(),i>>>3){case 1:s.version=t.string();break;case 2:s.params=R.decode(t,t.uint32());break;case 3:{const e=t.uint32()+t.pos;for(n="",a=new Uint8Array(0);t.pos<e;){let e=t.uint32();switch(e>>>3){case 1:n=t.string();break;case 2:a=t.bytes();break;default:t.skipType(7&e)}}s.images[n]=a;break}case 4:s.sprites&&s.sprites.length||(s.sprites=[]),s.sprites.push(P.decode(t,t.uint32()));break;default:t.skipType(7&i)}return M.format(s)}static format(t){const{version:e,images:r,sprites:s}=t,{fps:n,frames:a,viewBoxWidth:i,viewBoxHeight:o}=t.params;return{version:e,filename:"",locked:!1,dynamicElements:{},size:{width:i,height:o},fps:n,frames:a,images:r,sprites:s}}version="";params=null;images={};sprites=[]}class S{pool=[];acquire(){const{pool:t}=this;return t.length>0?t.pop():{x:0,y:0,x1:0,y1:0,x2:0,y2:0}}release(t){t.x=t.y=t.x1=t.y1=t.x2=t.y2=0,this.pool.push(t)}}class I{context;static SVG_PATH=new Set(["M","L","H","V","Z","C","S","Q","m","l","h","v","z","c","s","q"]);static SVG_LETTER_REGEXP=/[a-zA-Z]/;static parseSVGPath(t){const{SVG_LETTER_REGEXP:e}=I,r=[];let s=0,n=0,a="",i="";for(;s<t.length;){const o=t[s];switch(n){case 0:e.test(o)&&(a=o,n=1);break;case 1:e.test(o)?(r.push({command:a,args:i.trim()}),a=o,i=""):i+=o}s++}return a&&1===n&&r.push({command:a,args:i.trim()}),r}static fillOrStroke(t,e){e&&(e.fill&&t.fill(),e.stroke&&t.stroke())}static resetShapeStyles(t,e){e&&(t.strokeStyle=e.stroke||"transparent",e.strokeWidth>0&&(t.lineWidth=e.strokeWidth),e.miterLimit>0&&(t.miterLimit=e.miterLimit),e.lineCap&&(t.lineCap=e.lineCap),e.lineJoin&&(t.lineJoin=e.lineJoin),t.fillStyle=e.fill||"transparent",e.lineDash&&t.setLineDash(e.lineDash))}static calculateScale(t,e,r){const s=e.width/e.height,n=r.width/r.height,a="aspect-fit"===t,i=(t,e,r)=>({scaleX:t,scaleY:t,translateX:e,translateY:r});if(s>=n&&a||s<=n&&!a){const t=r.width/e.width;return i(t,0,(r.height-e.height*t)/2)}const o=r.height/e.height;return i(o,(r.width-e.width*o)/2,0)}pointPool=new S;currentPoint;lastResizeKey="";globalTransform=void 0;constructor(t){this.context=t,this.currentPoint=this.pointPool.acquire()}setTransform(t){t&&this.context&&this.context.transform(t.a,t.b,t.c,t.d,t.tx,t.ty)}drawBezier(t,e,r){const{context:s,pointPool:n}=this;if(this.currentPoint=n.acquire(),s.save(),I.resetShapeStyles(s,r),this.setTransform(e),s.beginPath(),t){const e=I.parseSVGPath(t);for(const{command:t,args:r}of e)I.SVG_PATH.has(t)&&this.drawBezierElement(this.currentPoint,t,r.split(/[\s,]+/).filter(Boolean))}I.fillOrStroke(s,r),n.release(this.currentPoint),s.restore()}drawBezierElement(t,e,r){const{context:s}=this;switch(e){case"M":t.x=+r[0],t.y=+r[1],s.moveTo(t.x,t.y);break;case"m":t.x+=+r[0],t.y+=+r[1],s.moveTo(t.x,t.y);break;case"L":t.x=+r[0],t.y=+r[1],s.lineTo(t.x,t.y);break;case"l":t.x+=+r[0],t.y+=+r[1],s.lineTo(t.x,t.y);break;case"H":t.x=+r[0],s.lineTo(t.x,t.y);break;case"h":t.x+=+r[0],s.lineTo(t.x,t.y);break;case"V":t.y=+r[0],s.lineTo(t.x,t.y);break;case"v":t.y+=+r[0],s.lineTo(t.x,t.y);break;case"C":t.x1=+r[0],t.y1=+r[1],t.x2=+r[2],t.y2=+r[3],t.x=+r[4],t.y=+r[5],s.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"c":t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x2=t.x+ +r[2],t.y2=t.y+ +r[3],t.x+=+r[4],t.y+=+r[5],s.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y);break;case"S":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=+r[0],t.y2=+r[1],t.x=+r[2],t.y=+r[3],s.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=+r[0],t.y1=+r[1],t.x=+r[2],t.y=+r[3],s.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"s":void 0!==t.x1&&void 0!==t.y1&&void 0!==t.x2&&void 0!==t.y2?(t.x1=t.x-t.x2+t.x,t.y1=t.y-t.y2+t.y,t.x2=t.x+ +r[0],t.y2=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],s.bezierCurveTo(t.x1,t.y1,t.x2,t.y2,t.x,t.y)):(t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],s.quadraticCurveTo(t.x1,t.y1,t.x,t.y));break;case"Q":t.x1=+r[0],t.y1=+r[1],t.x=+r[2],t.y=+r[3],s.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"q":t.x1=t.x+ +r[0],t.y1=t.y+ +r[1],t.x+=+r[2],t.y+=+r[3],s.quadraticCurveTo(t.x1,t.y1,t.x,t.y);break;case"Z":case"z":s.closePath()}}drawEllipse(t,e,r,s,n,a){const{context:i}=this;i.save(),I.resetShapeStyles(i,a),this.setTransform(n);const o=2*r,l=2*s,c=.5522848,h=o/2*c,u=l/2*c,f=(t-=r)+o,d=(e-=s)+l,p=t+o/2,m=e+l/2;i.beginPath(),i.moveTo(t,m),i.bezierCurveTo(t,m-u,p-h,e,p,e),i.bezierCurveTo(p+h,e,f,m-u,f,m),i.bezierCurveTo(f,m+u,p+h,d,p,d),i.bezierCurveTo(p-h,d,t,m+u,t,m),I.fillOrStroke(i,a),i.restore()}drawRect(t,e,r,s,n,a,i){const{context:o}=this;o.save(),I.resetShapeStyles(o,i),this.setTransform(a);let l=n;r<2*l&&(l=r/2),s<2*l&&(l=s/2),o.beginPath(),o.moveTo(t+l,e),o.arcTo(t+r,e,t+r,e+s,l),o.arcTo(t+r,e+s,t,e+s,l),o.arcTo(t,e+s,t,e,l),o.arcTo(t,e,t+r,e,l),o.closePath(),I.fillOrStroke(o,i),o.restore()}drawShape(t){const{type:e,path:r,transform:s,styles:n}=t;switch(e){case"shape":this.drawBezier(r.d,s,n);break;case"ellipse":this.drawEllipse(r.x??0,r.y??0,r.radiusX??0,r.radiusY??0,s,n);break;case"rect":this.drawRect(r.x??0,r.y??0,r.width??0,r.height??0,r.cornerRadius??0,s,n)}}drawSprite(t,e,r){if(0===t.alpha)return;const{context:s}=this,{alpha:n,transform:a,layout:i,shapes:o}=t,{a:l=1,b:c=0,c:h=0,d:u=1,tx:f=0,ty:d=0}=a??{};s.save(),this.setTransform(this.globalTransform),s.globalAlpha=n,s.transform(l,c,h,u,f,d),e&&s.drawImage(e,0,0,i.width,i.height),r&&s.drawImage(r,(i.width-r.width)/2,(i.height-r.height)/2);for(let t=0;t<o.length;t++)this.drawShape(o[t]);s.restore()}resize(t,e,r){const{width:s,height:n}=r,{width:a,height:i}=e,o=`${t}-${a}-${i}-${s}-${n}`,l=this.globalTransform;if(this.lastResizeKey===o&&l)return;let c={scaleX:1,scaleY:1,translateX:0,translateY:0};"fill"===t?(c.scaleX=s/a,c.scaleY=n/i):c=I.calculateScale(t,e,r),this.lastResizeKey=o,this.globalTransform={a:c.scaleX,b:0,c:0,d:c.scaleY,tx:c.translateX,ty:c.translateY}}render(t,e,r,s,n,a){let i,o,l,c;for(let h=n;h<a;h++)i=t.sprites[h],o=i.imageKey,l=e.get(o),c=r.get(o),this.drawSprite(i.frames[s],l,c)}destroy(){this.globalTransform=void 0,this.lastResizeKey="",this.context=null}}class D{isRunning=!1;startTime=0;duration=0;loopStart=0;loopDuration=0;onAnimate=m.noop;onStart=m.noop;onUpdate=m.noop;onEnd=m.noop;setConfig(t,e,r,s){this.duration=t,this.loopStart=e,this.loopDuration=t*r+s-e}start(){this.isRunning=!0,this.startTime=m.now(),this.onStart(),this.doFrame()}resume(){this.isRunning=!0,this.startTime=m.now(),this.doFrame()}pause(){this.isRunning=!1,this.loopStart=(m.now()-this.startTime+this.loopStart)%this.duration}stop(){this.isRunning=!1,this.loopStart=0}doFrame(){this.isRunning&&(this.doDeltaTime(m.now()-this.startTime),this.isRunning&&this.onAnimate((()=>this.doFrame())))}doDeltaTime(t){const{duration:e,loopStart:r,loopDuration:s}=this;let n,a=!1;t>=s?(n=1,a=!0,this.stop()):n=(t+r)%e/e,this.onUpdate(n),!this.isRunning&&a&&this.onEnd()}}const B=Uint8Array,F=Uint16Array,U=Int32Array,O=new B([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),L=new B([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),N=new B([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$=(t,e)=>{const r=new F(31);for(let s=0;s<31;++s)r[s]=e+=1<<t[s-1];const s=new U(r[30]);for(let t=1;t<30;++t)for(let e=r[t];e<r[t+1];++e)s[e]=e-r[t]<<5|t;return{b:r,r:s}},{b:H,r:_}=$(O,2);H[28]=258,_[258]=28;const{b:z,r:W}=$(L,0),Y=new F(32768);for(let t=0;t<32768;++t){let e=(43690&t)>>1|(21845&t)<<1;e=(52428&e)>>2|(13107&e)<<2,e=(61680&e)>>4|(3855&e)<<4,Y[t]=((65280&e)>>8|(255&e)<<8)>>1}const X=(t,e,r)=>{const s=t.length;let n=0;const a=new F(e);for(;n<s;++n)t[n]&&++a[t[n]-1];const i=new F(e);for(n=1;n<e;++n)i[n]=i[n-1]+a[n-1]<<1;let o;if(r){o=new F(1<<e);const r=15-e;for(n=0;n<s;++n)if(t[n]){const s=n<<4|t[n],a=e-t[n];let l=i[t[n]-1]++<<a;for(const t=l|(1<<a)-1;l<=t;++l)o[Y[l]>>r]=s}}else for(o=new F(s),n=0;n<s;++n)t[n]&&(o[n]=Y[i[t[n]-1]++]>>15-t[n]);return o},V=new B(288);for(let t=0;t<144;++t)V[t]=8;for(let t=144;t<256;++t)V[t]=9;for(let t=256;t<280;++t)V[t]=7;for(let t=280;t<288;++t)V[t]=8;const q=new B(32);for(let t=0;t<32;++t)q[t]=5;const K=X(V,9,0),G=X(V,9,1),j=X(q,5,0),J=X(q,5,1),Q=t=>{let e=t[0];for(let r=1;r<t.length;++r)t[r]>e&&(e=t[r]);return e},Z=(t,e,r)=>{const s=e/8|0;return(t[s]|t[s+1]<<8)>>(7&e)&r},et=(t,e)=>{const r=e/8|0;return(t[r]|t[r+1]<<8|t[r+2]<<16)>>(7&e)},rt=t=>(t+7)/8|0,st=(t,e,r)=>((null==r||r>t.length)&&(r=t.length),new B(t.subarray(e,r))),nt=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],at=(t,e,r)=>{const s=new Error(e||nt[t]);if(s.code=t,Error.captureStackTrace&&Error.captureStackTrace(s,at),!r)throw s;return s},it=(t,e,r)=>{r<<=7&e;const s=e/8|0;t[s]|=r,t[s+1]|=r>>8},ot=(t,e,r)=>{r<<=7&e;const s=e/8|0;t[s]|=r,t[s+1]|=r>>8,t[s+2]|=r>>16},lt=(t,e)=>{const r=[];for(let e=0;e<t.length;++e)t[e]&&r.push({s:e,f:t[e]});const s=r.length,n=r.slice();if(!s)return{t:mt,l:0};if(1==s){const t=new B(r[0].s+1);return t[r[0].s]=1,{t:t,l:1}}r.sort(((t,e)=>t.f-e.f)),r.push({s:-1,f:25001});let a=r[0],i=r[1],o=0,l=1,c=2;for(r[0]={s:-1,f:a.f+i.f,l:a,r:i};l!=s-1;)a=r[r[o].f<r[c].f?o++:c++],i=r[o!=l&&r[o].f<r[c].f?o++:c++],r[l++]={s:-1,f:a.f+i.f,l:a,r:i};let h=n[0].s;for(let t=1;t<s;++t)n[t].s>h&&(h=n[t].s);const u=new F(h+1);let f=ct(r[l-1],u,0);if(f>e){let t=0,r=0;const a=f-e,i=1<<a;for(n.sort(((t,e)=>u[e.s]-u[t.s]||t.f-e.f));t<s;++t){const s=n[t].s;if(!(u[s]>e))break;r+=i-(1<<f-u[s]),u[s]=e}for(r>>=a;r>0;){const s=n[t].s;u[s]<e?r-=1<<e-u[s]++-1:++t}for(;t>=0&&r;--t){const s=n[t].s;u[s]==e&&(--u[s],++r)}f=e}return{t:new B(u),l:f}},ct=(t,e,r)=>-1==t.s?Math.max(ct(t.l,e,r+1),ct(t.r,e,r+1)):e[t.s]=r,ht=t=>{let e=t.length;for(;e&&!t[--e];);const r=new F(++e);let s=0,n=t[0],a=1;const i=t=>{r[s++]=t};for(let r=1;r<=e;++r)if(t[r]==n&&r!=e)++a;else{if(!n&&a>2){for(;a>138;a-=138)i(32754);a>2&&(i(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(i(n),--a;a>6;a-=6)i(8304);a>2&&(i(a-3<<5|8208),a=0)}for(;a--;)i(n);a=1,n=t[r]}return{c:r.subarray(0,s),n:e}},ut=(t,e)=>{let r=0;for(let s=0;s<e.length;++s)r+=t[s]*e[s];return r},ft=(t,e,r)=>{const s=r.length,n=rt(e+2);t[n]=255&s,t[n+1]=s>>8,t[n+2]=255^t[n],t[n+3]=255^t[n+1];for(let e=0;e<s;++e)t[n+e+4]=r[e];return 8*(n+4+s)},dt=(t,e,r,s,n,a,i,o,l,c,h)=>{it(e,h++,r),++n[256];const{t:u,l:f}=lt(n,15),{t:d,l:p}=lt(a,15),{c:m,n:g}=ht(u),{c:y,n:w}=ht(d),b=new F(19);for(let t=0;t<m.length;++t)++b[31&m[t]];for(let t=0;t<y.length;++t)++b[31&y[t]];const{t:k,l:x}=lt(b,7);let v=19;for(;v>4&&!k[N[v-1]];--v);const T=c+5<<3,C=ut(n,V)+ut(a,q)+i,E=ut(n,u)+ut(a,d)+i+14+3*v+ut(b,k)+2*b[16]+3*b[17]+7*b[18];if(l>=0&&T<=C&&T<=E)return ft(e,h,t.subarray(l,l+c));let A,P,R,M;if(it(e,h,1+(E<C)),h+=2,E<C){A=X(u,f,0),P=u,R=X(d,p,0),M=d;const t=X(k,x,0);it(e,h,g-257),it(e,h+5,w-1),it(e,h+10,v-4),h+=14;for(let t=0;t<v;++t)it(e,h+3*t,k[N[t]]);h+=3*v;const r=[m,y];for(let s=0;s<2;++s){const n=r[s];for(let r=0;r<n.length;++r){const s=31&n[r];it(e,h,t[s]),h+=k[s],s>15&&(it(e,h,n[r]>>5&127),h+=n[r]>>12)}}}else A=K,P=V,R=j,M=q;for(let t=0;t<o;++t){const r=s[t];if(r>255){const t=r>>18&31;ot(e,h,A[t+257]),h+=P[t+257],t>7&&(it(e,h,r>>23&31),h+=O[t]);const s=31&r;ot(e,h,R[s]),h+=M[s],s>3&&(ot(e,h,r>>5&8191),h+=L[s])}else ot(e,h,A[r]),h+=P[r]}return ot(e,h,A[256]),h+P[256]},pt=new U([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),mt=new B(0),gt=()=>{let t=1,e=0;return{p(r){let s=t,n=e;const a=0|r.length;for(let t=0;t!=a;){const e=Math.min(t+2655,a);for(;t<e;++t)n+=s+=r[t];s=(65535&s)+15*(s>>16),n=(65535&n)+15*(n>>16)}t=s,e=n},d:()=>(t%=65521,e%=65521,(255&t)<<24|(65280&t)<<8|(255&e)<<8|e>>8)}},yt=(t,e,r,s,n)=>{if(!n&&(n={l:1},e.dictionary)){const r=e.dictionary.subarray(-32768),s=new B(r.length+t.length);s.set(r),s.set(t,r.length),t=s,n.w=r.length}return((t,e,r,s,n,a)=>{const i=a.z||t.length,o=new B(s+i+5*(1+Math.ceil(i/7e3))+n),l=o.subarray(s,o.length-n),c=a.l;let h=7&(a.r||0);if(e){h&&(l[0]=a.r>>3);const s=pt[e-1],n=s>>13,o=8191&s,u=(1<<r)-1,f=a.p||new F(32768),d=a.h||new F(u+1),p=Math.ceil(r/3),m=2*p,g=e=>(t[e]^t[e+1]<<p^t[e+2]<<m)&u,y=new U(25e3),w=new F(288),b=new F(32);let k=0,x=0,v=a.i||0,T=0,C=a.w||0,E=0;for(;v+2<i;++v){const e=g(v);let r=32767&v,s=d[e];if(f[r]=s,d[e]=r,C<=v){const a=i-v;if((k>7e3||T>24576)&&(a>423||!c)){h=dt(t,l,0,y,w,b,x,T,E,v-E,h),T=k=x=0,E=v;for(let t=0;t<286;++t)w[t]=0;for(let t=0;t<30;++t)b[t]=0}let u=2,d=0,p=o,m=r-s&32767;if(a>2&&e==g(v-m)){const e=Math.min(n,a)-1,i=Math.min(32767,v),o=Math.min(258,a);for(;m<=i&&--p&&r!=s;){if(t[v+u]==t[v+u-m]){let r=0;for(;r<o&&t[v+r]==t[v+r-m];++r);if(r>u){if(u=r,d=m,r>e)break;const t=Math.min(m,r-2);let n=0;for(let e=0;e<t;++e){const t=v-m+e&32767,r=t-f[t]&32767;r>n&&(n=r,s=t)}}}r=s,s=f[r],m+=r-s&32767}}if(d){y[T++]=268435456|_[u]<<18|W[d];const t=31&_[u],e=31&W[d];x+=O[t]+L[e],++w[257+t],++b[e],C=v+u,++k}else y[T++]=t[v],++w[t[v]]}}for(v=Math.max(v,C);v<i;++v)y[T++]=t[v],++w[t[v]];h=dt(t,l,c,y,w,b,x,T,E,v-E,h),c||(a.r=7&h|l[h/8|0]<<3,h-=7,a.h=d,a.p=f,a.i=v,a.w=C)}else{for(let e=a.w||0;e<i+c;e+=65535){let r=e+65535;r>=i&&(l[h/8|0]=c,r=i),h=ft(l,h+1,t.subarray(e,r))}a.i=i}return st(o,0,s+rt(h)+n)})(t,null==e.level?6:e.level,null==e.mem?n.l?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(t.length)))):20:12+e.mem,r,s,n)},wt=(t,e,r)=>{for(;r;++e)t[e]=r,r>>>=8};function bt(t,e={}){const r=gt();r.p(t);const s=yt(t,e,e.dictionary?6:2,4);return((t,e)=>{const r=e.level??0,s=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=s<<6|((e.dictionary??0)&&32),t[1]|=31-(t[0]<<8|t[1])%31,e.dictionary){const r=gt();r.p(e.dictionary),wt(t,2,r.d())}})(s,e),wt(s,s.length-4,r.d()),s}function kt(t,e={}){return((t,e,r,s)=>{const n=t.length,a=s?s.length:0;if(!n||e.f&&!e.l)return r||new B(0);const i=!r,o=i||2!=e.i,l=e.i;i&&(r=new B(3*n));const c=t=>{let e=r.length;if(t>e){const s=new B(Math.max(2*e,t));s.set(r),r=s}};let h=e.f||0,u=e.p||0,f=e.b||0,d=e.l,p=e.d,m=e.m,g=e.n;const y=8*n;do{if(!d){h=Z(t,u,1);const s=Z(t,u+1,3);if(u+=3,!s){const s=rt(u)+4,a=t[s-4]|t[s-3]<<8,i=s+a;if(i>n){l&&at(0);break}o&&c(f+a),r.set(t.subarray(s,i),f),e.b=f+=a,e.p=u=8*i,e.f=h;continue}if(1==s)d=G,p=J,m=9,g=5;else if(2==s){const e=Z(t,u,31)+257,r=Z(t,u+10,15)+4,s=e+Z(t,u+5,31)+1;u+=14;const n=new B(s),a=new B(19);for(let e=0;e<r;++e)a[N[e]]=Z(t,u+3*e,7);u+=3*r;const i=Q(a),o=(1<<i)-1,l=X(a,i,1);for(let e=0;e<s;){const r=l[Z(t,u,o)];u+=15&r;const s=r>>4;if(s<16)n[e++]=s;else{let r=0,a=0;for(16==s?(a=3+Z(t,u,3),u+=2,r=n[e-1]):17==s?(a=3+Z(t,u,7),u+=3):18==s&&(a=11+Z(t,u,127),u+=7);a--;)n[e++]=r}}const c=n.subarray(0,e),h=n.subarray(e);m=Q(c),g=Q(h),d=X(c,m,1),p=X(h,g,1)}else at(1);if(u>y){l&&at(0);break}}o&&c(f+131072);const i=(1<<m)-1,w=(1<<g)-1;let b=u;for(;;b=u){const e=d[et(t,u)&i],n=e>>4;if(u+=15&e,u>y){l&&at(0);break}if(e||at(2),n<256)r[f++]=n;else{if(256==n){b=u,d=void 0;break}{let e=n-254;if(n>264){const r=n-257,s=O[r];e=Z(t,u,(1<<s)-1)+H[r],u+=s}const i=p[et(t,u)&w],h=i>>4;i||at(3),u+=15&i;let d=z[h];if(h>3){const e=L[h];d+=et(t,u)&(1<<e)-1,u+=e}if(u>y){l&&at(0);break}o&&c(f+131072);const m=f+e;if(f<d){const t=a-d,e=Math.min(d,m);for(t+f<0&&at(3);f<e;++f)r[f]=s[t+f]}for(;f<m;++f)r[f]=r[f-d]}}}e.l=d,e.p=b,e.b=f,e.f=h,d&&(h=1,e.m=m,e.d=p,e.n=g)}while(!h);return f!=r.length&&i?st(r,0,f):r.subarray(0,f)})(t.subarray(((t,e)=>((8!=(15&t[0])||t[0]>>4>7||(t[0]<<8|t[1])%31)&&at(6,"invalid zlib data"),(t[1]>>5&1)==+!e&&at(6,"invalid zlib data: "+(32&t[1]?"need":"unexpected")+" dictionary"),2+(t[1]>>3&4)))(t,e.dictionary),-4),{i:2},e&&e.out,e&&e.dictionary)}class xt{static table=function(){return Uint32Array.from(Array(256),((t,e)=>{let r=e;for(let t=0;t<8;t++)r=1&r?3988292384^r>>>1:r>>>1;return r>>>0}))}();cache=new Map;calculate(t){if(!(t&&t instanceof Uint8Array))throw new TypeError("Input must be a Uint8Array");const{table:e}=xt,{cache:r}=this,s=m.decode.bytesToString(t);if(r.has(s))return r.get(s);let n=4294967295;const{length:a}=t;for(let r=0;r<a;r++)n=n>>>8^e[255&(n^t[r])];const i=(4294967295^n)>>>0;return r.set(s,i),i}clear(){this.cache.clear()}}class vt{width;height;view;crc32=new xt;constructor(t,e){this.width=t,this.height=e,this.view=new DataView(new ArrayBuffer(4*t*e))}createChunk(t,e){const r=new Uint8Array(4);new DataView(r.buffer).setUint32(0,e.length,!1);const s=Uint8Array.from(t,(t=>t.charCodeAt(0))),n=new Uint8Array(s.length+e.length);n.set(s),n.set(e,s.length);const a=new Uint8Array(4);new DataView(a.buffer).setUint32(0,this.crc32.calculate(n)>>>0,!1);const i=new Uint8Array(r.length+n.length+a.length);return i.set(r),i.set(n,r.length),i.set(a,r.length+n.length),i}createIHDRChunk(){const t=new Uint8Array(13),e=new DataView(t.buffer);return e.setUint32(0,this.width,!1),e.setUint32(4,this.height,!1),e.setUint8(8,8),e.setUint8(9,6),e.setUint8(10,0),e.setUint8(11,0),e.setUint8(12,0),this.createChunk("IHDR",t)}createIDATChunk(){const{width:t,height:e,view:r}=this,s=4*t+1,n=new Uint8Array(s*e),a=new Uint8Array(r.buffer);for(let r=0;r<e;r++){const e=r*s;n[e]=0;const i=r*t*4,o=i+4*t;n.set(a.subarray(i,o),e+1)}return this.createChunk("IDAT",bt(n))}createIENDChunk(){return this.createChunk("IEND",new Uint8Array(0))}setPixel(t,e,r){this.view.setUint32(4*(e*this.width+t),r,!1)}write(t){const{width:e,height:r}=this;for(let s=0;s<r;s++)for(let r=0;r<e;r++){const n=4*(s*e+r),a=(t[n]<<24|t[n+1]<<16|t[n+2]<<8|t[n+3])>>>0;this.setPixel(r,s,a)}return this}flush(){const t=new Uint8Array([137,80,78,71,13,10,26,10]),e=this.createIHDRChunk(),r=this.createIDATChunk(),s=this.createIENDChunk(),n=8+e.length+r.length+s.length,a=new Uint8Array(n);let i=0;return a.set(t,i),i+=t.length,a.set(e,i),i+=e.length,a.set(r,i),i+=r.length,a.set(s,i),this.crc32.clear(),a}}class Tt{buffer=[];lengthInBits=0;getAt(t){const e=~~(t/8);return 1==(this.buffer[e]>>>7-t%8&1)}put(t,e){for(let r=0;r<e;r++)this.putBit(1==(t>>>e-r-1&1))}putBit(t){const{lengthInBits:e,buffer:r}=this,s=~~(e/8);r.length<=s&&r.push(0),t&&(r[s]|=128>>>e%8),this.lengthInBits+=1}}const Ct={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},Et={L:1,M:0,Q:3,H:2},At={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};class Pt{bytes;constructor(t){let e=[];for(let r=0;r<t.length;r++){const s=[],n=t.charCodeAt(r);n>65536?(s[0]=240|(1835008&n)>>>18,s[1]=128|(258048&n)>>>12,s[2]=128|(4032&n)>>>6,s[3]=128|63&n):n>2048?(s[0]=224|(61440&n)>>>12,s[1]=128|(4032&n)>>>6,s[2]=128|63&n):n>128?(s[0]=192|(1984&n)>>>6,s[1]=128|63&n):s[0]=n,e.push(s)}this.bytes=e.flat(1);const{bytes:r}=this;r.length!==t.length&&(r.unshift(191),r.unshift(187),r.unshift(239))}get mode(){return Ct.MODE_8BIT_BYTE}get length(){return this.bytes.length}write(t){const{bytes:e}=this;for(let r=0;r<e.length;r++)t.put(e[r],8)}}const Rt=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]];class Mt{getRSBlockTable(t,e){const{L:r,M:s,Q:n,H:a}=Et,i=4*(t-1);switch(e){case r:return Rt[i+0];case s:return Rt[i+1];case n:return Rt[i+2];case a:return Rt[i+3];default:throw new Error(`bad rs block @ typeNumber:${t}/errorCorrectLevel: ${e}`)}}getRSBlocks(t,e){const r=this.getRSBlockTable(t,e),s=r.length/3,n=[];for(let t=0;t<s;t++){const e=r[3*t],s=r[3*t+1],a=r[3*t+2];for(let t=0;t<e;t++)n.push({totalCount:s,dataCount:a})}return n}}const St=new Array(256),It=new Array(256);for(let t=0;t<8;t++)St[t]=1<<t;for(let t=8;t<256;t++)St[t]=St[t-4]^St[t-5]^St[t-6]^St[t-8];for(let t=0;t<255;t++)It[St[t]]=t;const Dt={glog(t){if(t<1)throw new Error(`glog(${t})`);return It[t]},gexp:t=>(t<0?t=255+t%255:t>255&&(t%=255),St[t])};class Bt{num;constructor(t,e){const{length:r}=t;if(void 0===r)throw new Error(`${r}/${e}`);let s=0;for(;s<r&&0===t[s];)s++;const n=r-s;this.num=new Array(n+e);for(let e=0;e<n;e++)this.num[e]=t[e+s]}get length(){return this.num.length}getAt(t){return this.num[t]}multiply(t){const{glog:e,gexp:r}=Dt,s=[];for(let n=0;n<this.length;n++)for(let a=0;a<t.length;a++)s[n+a]^=r(e(this.getAt(n))+e(t.getAt(a)));return new Bt(s,0)}mod(t){if(this.length-t.length<0)return this;const{glog:e,gexp:r}=Dt,s=e(this.getAt(0))-e(t.getAt(0)),n=[];for(var a=0;a<this.length;a++){const i=this.getAt(a);n[a]=a<t.length?i^r(e(t.getAt(a))+s):i}return new Bt(n,0).mod(t)}}const Ft=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],Ut=t=>0===t?0:Math.log2(t),Ot=Ut(1335),Lt=Ut(7973),Nt={getBCHTypeInfo(t){let e=t<<10;for(;Ut(e)-Ot>=0;)e^=1335<<Ut(e)-Ot;return 21522^(t<<10|e)},getBCHTypeNumber(t){let e=t<<12;for(;Ut(e)-Lt>=0;)e^=7973<<Ut(e)-Lt;return t<<12|e},getPatternPosition:t=>Ft[t-1],getMaskFunction(t){const{PATTERN000:e,PATTERN001:r,PATTERN010:s,PATTERN011:n,PATTERN100:a,PATTERN101:i,PATTERN110:o,PATTERN111:l}=At;switch(t){case e:return(t,e)=>(t+e)%2==0;case r:return t=>t%2==0;case s:return(t,e)=>e%3==0;case n:return(t,e)=>(t+e)%3==0;case a:return(t,e)=>(~~(t/2)+~~(e/3))%2==0;case i:return(t,e)=>t*e%2+t*e%3==0;case o:return(t,e)=>(t*e%2+t*e%3)%2==0;case l:return(t,e)=>(t*e%3+(t+e)%2)%2==0;default:throw new Error(`bad maskPattern: ${t}`)}},getErrorCorrectPolynomial(t){let e=new Bt([1],0);for(let r=0;r<t;r++)e=e.multiply(new Bt([1,Dt.gexp(r)],0));return e},getLengthInBits(t,e){const{MODE_NUMBER:r,MODE_ALPHA_NUM:s,MODE_8BIT_BYTE:n,MODE_KANJI:a}=Ct;if(e<1||e>40)throw new Error(`type: ${e}`);if(e>=1&&e<10)switch(t){case r:return 10;case s:return 9;case n:case a:return 8}if(e<27)switch(t){case r:return 12;case s:return 11;case n:return 16;case a:return 10}if(e<=40)switch(t){case r:return 14;case s:return 13;case n:return 16;case a:return 12}throw new Error(`mode: ${t}`)},getLostPoint(t){const e=t.getModuleCount();let r=0;for(let s=0;s<e;s++)for(let n=0;n<e;n++){const a=t.isDark(s,n);let i=0;for(let r=-1;r<=1;r++){const o=s+r;if(!(o<0||e<=o))for(let s=-1;s<=1;s++){const l=n+s;l<0||e<=l||(0===r&&0===s||a===t.isDark(o,l)&&i++)}}i>5&&(r+=i+3-5)}for(let s=0;s<e-1;s++)for(let n=0;n<e-1;n++){let e=0;t.isDark(s,n)&&e++,t.isDark(s+1,n)&&e++,t.isDark(s,n+1)&&e++,t.isDark(s+1,n+1)&&e++,0!==e&&4!==e||(r+=3)}for(let s=0;s<e;s++)for(let n=0;n<e-6;n++)t.isDark(s,n)&&!t.isDark(s,n+1)&&t.isDark(s,n+2)&&t.isDark(s,n+3)&&t.isDark(s,n+4)&&!t.isDark(s,n+5)&&t.isDark(s,n+6)&&(r+=40);for(let s=0;s<e;s++)for(let n=0;n<e-6;n++)t.isDark(n,s)&&!t.isDark(n+1,s)&&t.isDark(n+2,s)&&t.isDark(n+3,s)&&t.isDark(n+4,s)&&!t.isDark(n+5,s)&&t.isDark(n+6,s)&&(r+=40);let s=0;for(let r=0;r<e;r++)for(let n=0;n<e;n++)t.isDark(n,r)&&s++;return r+10*(Math.abs(100*s/Math.pow(e,2)-50)/5)}};class $t{typeNumber;errorCorrectLevel;modules=[];moduleCount=0;dataCache=null;dataList=[];constructor(t,e){this.typeNumber=t,this.errorCorrectLevel=Et[e]}makeImpl(t,e){this.moduleCount=4*this.typeNumber+17,this.modules=(t=>{const e=[];for(let r=0;r<t;r++){e[r]=[];for(let s=0;s<t;s++)e[r][s]=null}return e})(this.moduleCount);const r=this.moduleCount-7;this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(r,0),this.setupPositionProbePattern(0,r),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,e),this.typeNumber>=7&&this.setupTypeNumber(t),null===this.dataCache&&(this.dataCache=this.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,e)}setupPositionProbePattern(t,e){const{modules:r,moduleCount:s}=this;for(let n=-1;n<=7;n++){const a=t+n;if(!(a<=-1||s<=a))for(let t=-1;t<=7;t++){const i=e+t;i<=-1||s<=i||(r[a][i]=n>=0&&n<=6&&(0===t||6===t)||t>=0&&t<=6&&(0===n||6===n)||n>=2&&n<=4&&t>=2&&t<=4)}}}setupPositionAdjustPattern(){const{typeNumber:t,modules:e}=this,r=Nt.getPatternPosition(t),{length:s}=r;for(let t=0;t<s;t++)for(let n=0;n<s;n++){const s=r[t],a=r[n];if(null==e[s][a])for(let t=-2;t<=2;t++)for(let r=-2;r<=2;r++)e[s+t][a+r]=-2===t||2===t||-2===r||2===r||0===t&&0===r}}setupTimingPattern(){const{moduleCount:t,modules:e}=this,r=t-8;for(let t=8;t<r;t++)null==e[t][6]&&(e[t][6]=t%2==0);for(let t=8;t<r;t++)null==e[6][t]&&(e[6][t]=t%2==0)}setupTypeInfo(t,e){const{errorCorrectLevel:r,modules:s,moduleCount:n}=this,a=r<<3|e,i=Nt.getBCHTypeInfo(a);for(let e=0;e<15;e++){const r=!t&&1==(i>>e&1);e<6?s[e][8]=r:e<8?s[e+1][8]=r:s[n-15+e][8]=r}for(let e=0;e<15;e++){const r=!t&&1==(i>>e&1);e<8?s[8][n-e-1]=r:e<9?s[8][15-e]=r:s[8][15-e-1]=r}s[n-8][8]=!t}getBestMaskPattern(){let t=0,e=0;for(let r=0;r<8;r++){this.makeImpl(!0,r);const s=Nt.getLostPoint(this);(0===r||t>s)&&(t=s,e=r)}return e}setupTypeNumber(t){const{typeNumber:e,modules:r,moduleCount:s}=this,n=Nt.getBCHTypeNumber(e);for(let e=0;e<18;e++){const a=!t&&1==(n>>e&1);r[~~(e/3)][e%3+s-8-3]=a,r[e%3+s-8-3][~~(e/3)]=a}}createData(t,e,r){const s=(new Mt).getRSBlocks(t,e),n=new Tt;for(let e=0;e<r.length;e++){const s=r[e];n.put(s.mode,4),n.put(s.length,Nt.getLengthInBits(s.mode,t)),s.write(n)}let a=0;for(let t=0;t<s.length;t++)a+=s[t].dataCount;const i=8*a;if(n.lengthInBits>i)throw new Error(`code length overflow. (${n.lengthInBits} > ${i})`);for(n.lengthInBits+4<=i&&n.put(0,4);n.lengthInBits%8!=0;)n.putBit(!1);for(;!(n.lengthInBits>=i||(n.put(236,8),n.lengthInBits>=i));)n.put(17,8);return this.createBytes(n,s)}mapData(t,e){const{modules:r,moduleCount:s}=this,n=Nt.getMaskFunction(e);let a=-1,i=s-1,o=7,l=0;for(let e=i;e>0;e-=2)for(6===e&&(e-=1);;){for(let s=0;s<2;s++)if(null==r[i][e-s]){let a=!1;l<t.length&&(a=1==(t[l]>>>o&1)),n(i,e-s)&&(a=!a),r[i][e-s]=a,o--,-1===o&&(l++,o=7)}if(i+=a,i<0||s<=i){i-=a,a=-a;break}}}createBytes(t,e){const r=[],s=[];let n=0,a=0,i=0;for(let o=0;o<e.length;o++){const l=e[o].dataCount,c=e[o].totalCount-l;a=Math.max(a,l),i=Math.max(i,c),r[o]=[];for(let e=0;e<l;e++)r[o][e]=255&t.buffer[e+n];n+=l;const h=Nt.getErrorCorrectPolynomial(c),u=new Bt(r[o],h.length-1).mod(h);s[o]=new Array(h.length-1);for(let t=0;t<s[o].length;t++){const e=t+u.length-s[o].length;s[o][t]=e>=0?u.getAt(e):0}}let o=0;for(let t=0;t<e.length;t++)o+=e[t].totalCount;const l=new Array(o);let c=0;for(let t=0;t<a;t++)for(let s=0;s<e.length;s++)t<r[s].length&&(l[c++]=r[s][t]);for(let t=0;t<i;t++)for(let r=0;r<e.length;r++)t<s[r].length&&(l[c++]=s[r][t]);return l}isDark(t,e){const{moduleCount:r}=this;if(t<0||r<=t||e<0||r<=e)throw new Error(`${t}, ${e}`);return this.modules[t][e]}addData(t){this.dataList.push(new Pt(t)),this.dataCache=null}getModuleCount(){return this.moduleCount}make(){this.makeImpl(!1,this.getBestMaskPattern())}}class Ht{painter;static isBitmap(t){return"h5"===m.globals.env&&t instanceof ImageBitmap}static releaseOne(t){Ht.isBitmap(t)?t.close():""!==t.src&&("weapp"===m.globals.env&&t.src.includes(m.path.USER_DATA_PATH)&&m.local.remove(t.src),m.image.release(t))}caches=[];dynamicMaterials=new Map;materials=new Map;point=0;constructor(t){this.painter=t}createImage(){let t=null;return this.point>0&&(this.point--,t=this.caches.shift()),t||(t=m.image.create(this.painter.X)),this.caches.push(t),t}inertBitmapIntoCaches(t){Ht.isBitmap(t)&&this.caches.push(t)}loadExtImage(t,e){return m.image.load((()=>this.createImage()),t,m.path.resolve(e,"ext")).then((t=>(this.inertBitmapIntoCaches(t),t)))}async loadImagesWithRecord(t,e,r="normal"){const s=[];Object.entries(t).forEach((([t,n])=>{const a=m.image.load((()=>this.createImage()),n,m.path.resolve(e,"dynamic"===r?`dynamic_${t}`:t)).then((e=>{this.inertBitmapIntoCaches(e),"dynamic"===r?this.dynamicMaterials.set(t,e):this.materials.set(t,e)}));s.push(a)})),await Promise.all(s)}release(){for(const t of this.caches)Ht.releaseOne(t);this.materials.clear(),this.dynamicMaterials.clear(),["alipay","h5"].includes(m.globals.env)?this.cleanup():this.tidyUp()}tidyUp(){this.caches=Array.from(new Set(this.caches)),this.point=this.caches.length}cleanup(){this.caches.length=0,this.point=0}}class _t{static parseVideo(t,e){const r=new Uint8Array(t);if("80,75,3,4"===r.subarray(0,4).toString())throw new Error("this parser only support version@2 of SVGA.");return function(t,e){if(t instanceof Uint8Array){const r=M.decode(t);return r.filename=e,r}throw new Error("Invalid data type")}(kt(r),m.path.filename(e))}static download(t){const{remote:e,local:r,globals:s}=m;return e.is(t)?e.fetch(t):"h5"!==s.env?r.read(t):Promise.resolve(null)}static async load(t){return _t.parseVideo(await _t.download(t),t)}}const{noop:zt}=m;class Wt{mode;X=null;XC=null;Y=null;YC=null;W;H;model={};constructor(t="animation",e=0,r=0){this.mode=t;const{dpr:s}=m.globals;this.W=e*s,this.H=r*s}setModel(t){const{model:e}=this,{env:r}=m.globals;e.type=t,"O"===t&&"h5"===r&&navigator.userAgent.includes("Firefox")?e.clear="CR":e.clear="O"===t&&"tt"===r||"alipay"===r?"CL":"RE"}async register(t,e,r){const{model:s,mode:n}=this,{getCanvas:a,getOfsCanvas:i}=m,{env:o}=m.globals;if("poster"!==n||"h5"===o&&!("OffscreenCanvas"in globalThis)){const{canvas:e,context:s}=await a(t,r),{width:i,height:o}=e;this.X=e,this.XC=s,"poster"===n?(e.width=i,e.height=o,this.setModel("C")):(this.W=i,this.H=o)}else{const{W:t,H:e}=this;if(!(t>0&&e>0))throw new Error("Poster mode must set width and height when create Brush instance");const{canvas:r,context:s}=i({width:t,height:e});this.X=r,this.XC=s,this.setModel("O")}if("poster"===n)this.Y=this.X,this.YC=this.XC;else{let t;"string"==typeof e&&""!==e?(t=await a(e,r),t.canvas.width=this.W,t.canvas.height=this.H,this.setModel("C")):(t=i({width:this.W,height:this.H}),this.setModel("O")),this.Y=t.canvas,this.YC=t.context}if("CL"===s.clear?this.clearContainer=()=>{const{W:t,H:e}=this;this.XC.clearRect(0,0,t,e)}:this.clearContainer=()=>{const{W:t,H:e}=this;this.X.width=t,this.X.height=e},"poster"===n)this.clearSecondary=this.stick=zt;else switch(s.clear){case"CR":this.clearSecondary=()=>{const{W:t,H:e}=this,{canvas:r,context:s}=i({width:t,height:e});this.Y=r,this.YC=s};break;case"CL":this.clearSecondary=()=>{const{W:t,H:e}=this;this.YC.clearRect(0,0,t,e)};break;default:this.clearSecondary=()=>{const{W:t,H:e,Y:r}=this;r.width=t,r.height=e}}}clearContainer=zt;clearSecondary=zt;stick(){const{W:t,H:e,mode:r}=this;"poster"!==r&&this.XC.drawImage(this.YC.canvas,0,0,t,e)}destroy(){this.clearContainer(),this.clearSecondary(),this.X=this.XC=this.Y=this.YC=null,this.clearContainer=this.clearSecondary=this.stick=zt}}class Yt{fillMode="backwards";playMode="forwards";contentMode="fill";startFrame=0;endFrame=0;loopStartFrame=0;loop=0;register(t){"number"==typeof t.loop&&t.loop>=0&&(this.loop=t.loop),t.fillMode&&["forwards","backwards","none"].includes(t.fillMode)&&(this.fillMode=t.fillMode),t.playMode&&["forwards","fallbacks"].includes(t.playMode)&&(this.playMode=t.playMode),"number"==typeof t.startFrame&&t.startFrame>=0&&(this.startFrame=t.startFrame),"number"==typeof t.endFrame&&t.endFrame>=0&&(this.endFrame=t.endFrame),"number"==typeof t.loopStartFrame&&t.loopStartFrame>=0&&(this.loopStartFrame=t.loopStartFrame),"string"==typeof t.contentMode&&(this.contentMode=t.contentMode)}setItem(t,e){this.register({[t]:e})}getConfig(t){const{playMode:e,loopStartFrame:r,startFrame:s,endFrame:n,fillMode:a,loop:i}=this,{fps:o,sprites:l}=t;let{frames:c}=t;const h=l.length,u=s>0?s:0,f=n>0&&n<c?n:c,d=1e3/o;if(u>f)throw new Error("StartFrame should greater than EndFrame");f<c?c=f-u:u>0&&(c-=u);const p=Math.floor(c*d*10**6)/10**6;let m,g=0,y=0;return"forwards"===e?(g=Math.max(r,s),"forwards"===a&&(y=1),m=r>u?(r-u)*d:0):(g=Math.min(r,f-1),"backwards"===a&&(y=1),m=r<f?(f-r)*d:0),{currFrame:g,startFrame:u,endFrame:f,totalFrame:c,spriteCount:h,aniConfig:{duration:p,loopStart:m,loop:0===i?1/0:i,fillValue:y*d}}}}class Xt{entity;config=new Yt;resource=null;painter=new Wt;animator=new D;renderer=null;async setConfig(t,e){const r="string"==typeof t?{container:t}:t;this.config.register(r),await this.painter.register(r.container,r.secondary,e),this.renderer=new I(this.painter.YC),this.resource=new Ht(this.painter),this.animator.onAnimate=m.rAF.bind(null,this.painter.X)}setItem(t,e){this.config.setItem(t,e)}async mount(t){if(!t)throw new Error("videoEntity undefined");const{images:e,filename:r}=t;this.animator.stop(),this.painter.clearSecondary(),this.resource.release(),this.entity=t,await this.resource.loadImagesWithRecord(e,r)}onStart;onResume;onPause;onStop;onProcess;onEnd;start(){this.startAnimation(),this.onStart?.()}resume(){this.animator.resume(),this.onResume?.()}pause(){this.animator.pause(),this.onPause?.()}stop(){this.animator.stop(),this.painter.clearContainer(),this.painter.clearSecondary(),this.onStop?.()}destroy(){this.animator.stop(),this.painter.destroy(),this.renderer?.destroy(),this.resource?.release(),this.resource?.cleanup(),this.entity=void 0}stepToFrame(t,e=!1){!this.entity||t<0||t>=this.entity.frames||(this.pause(),this.config.loopStartFrame=t,e&&this.start())}stepToPercentage(t,e=!1){if(!this.entity)return;const{frames:r}=this.entity;let s=t<0?0:Math.round(t*r);s>=r&&(s=r-1),this.stepToFrame(s,e)}startAnimation(){const{entity:t,config:e,animator:r,painter:s,renderer:n,resource:a}=this,{W:i,H:o}=s,{fillMode:l,playMode:c,contentMode:h}=e,{currFrame:u,startFrame:f,endFrame:d,totalFrame:p,spriteCount:g,aniConfig:y}=e.getConfig(t),{duration:w,loopStart:b,loop:k,fillValue:x}=y,v="fallbacks"===c;let T,C,E,A,P,R,M=u,S=0;r.setConfig(w,b,k,x),n.resize(h,t.size,{width:i,height:o});let I,D,B,F=4;r.onUpdate=e=>{(e=>{for(I=m.now(),e();S<g;)if(D=Math.min(F,g-S),T=S+D|0,n.render(t,a.materials,a.dynamicMaterials,M,S,T),S=T,B=m.now()-I,B<3)F=Math.min(2*F,34);else if(B>8){F=Math.max(F/2,1);break}})((()=>{P=v?1-e:e,A=P*p,v?(E=(0===e?d:Math.ceil(A))-1,P=M/p):E=1===e?f:Math.floor(A),R=M===E})),R||(s.clearContainer(),s.stick(),s.clearSecondary(),C=M,M=E,S=0,this.onProcess?.(~~(100*P)/100,C))},r.onStart=()=>{t.locked=!0},r.onEnd=()=>{t.locked=!1,"none"===l&&s.clearContainer(),this.onEnd?.()},r.start()}}function Vt(t){const{code:e,typeNumber:r,correctLevel:s,size:n,codeColor:a,backgroundColor:i}=function(t){const e=t.typeNumber??4,r=t.correctLevel??"H",s=t.codeColor??"#000000",n=t.backgroundColor??"#FFFFFF";return{code:t.code,size:t.size,typeNumber:e,correctLevel:r,codeColor:s,backgroundColor:n}}(t);let o;try{o=new $t(r,s),o.addData(e),o.make()}catch(t){if(r>=40)throw new Error("Text too long to encode");return arguments.callee({code:e,size:n,correctLevel:s,typeNumber:r+1,codeColor:a,backgroundColor:i})}const l=o.getModuleCount(),{padding:c,cellSize:h}=((t,e)=>{const r=~~(e/t);return{padding:~~((e-t*r)/2),cellSize:r||2}})(l,n),u=l*h+c,f=+`${a.replace("#","0x")}FF`,d=+`${i.replace("#","0x")}FF`,p=new vt(n,n);for(let t=0;t<n;t++)for(let e=0;e<n;e++)if(c<=e&&e<u&&c<=t&&t<u){const r=~~((e-c)/h),s=~~((t-c)/h);p.setPixel(e,t,o.isDark(s,r)?f:d)}else p.setPixel(e,t,d);return p.flush()}function qt(t){const e=Vt(t);return m.decode.toDataURL(e)}function Kt(t){const{width:e,height:r,data:s}=t;return new vt(e,r).write(s).flush()}function Gt(t){const e=Kt(t);return m.decode.toDataURL(e)}class jt{point=0;maxRemain=3;remainStart=0;remainEnd=0;loadMode="fast";buckets=[];get length(){return this.buckets.length}get current(){return this.point}updateRemainPoints(){this.point<Math.ceil(this.maxRemain/2)?(this.remainStart=0,this.remainEnd=this.maxRemain):this.length-this.point<Math.floor(this.maxRemain/2)?(this.remainStart=this.remainEnd-this.maxRemain,this.remainEnd=this.length):(this.remainStart=Math.floor(this.point-this.maxRemain/2),this.remainEnd=this.remainStart+this.maxRemain)}updateBucketOperators(t){const{remainStart:e,remainEnd:r}=this;return this.point=t,this.updateRemainPoints(),e===r?[{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>r||this.remainEnd<e?[{action:"remove",start:e,end:r},{action:"add",start:this.remainStart,end:this.remainEnd}]:this.remainStart>e&&this.remainEnd>r?[{action:"remove",start:e,end:this.remainStart},{action:"add",start:r,end:this.remainEnd}]:this.remainStart<e&&this.remainEnd<r?[{action:"remove",start:this.remainEnd,end:r},{action:"add",start:this.remainStart,end:e}]:[]}async getBucket(t){const{length:e,buckets:r,loadMode:s}=this;if(t<0||t>=e)return r[t];const n=this.updateBucketOperators(t);if(n.length){const e=[];n.forEach((({action:n,start:a,end:i})=>{for(let o=a;o<i;o++){const a=r[o];"remove"===n?a.entity=null:"add"===n&&null===a.entity&&(null===a.promise&&(a.promise=_t.load(a.local||a.origin)),"whole"!==s&&t!==o||e.push(a.promise))}})),await Promise.all(e)}return this.get()}async createBucket(t,e=!0,r=!0){const{globals:s,path:n,local:a}=m,{env:i}=s,o={origin:t,local:"",entity:null,promise:null,status:0};if("h5"===i||"tt"===i)return o.local=t,e&&(r?o.entity=await _t.load(t):o.promise=_t.load(t)),o;const l=n.resolve(n.filename(t),"full"),c=_t.download(o.origin),h=async r=>{if(r){try{await a.write(r,l),o.local=l}catch(t){console.error(t)}if(e)return _t.parseVideo(r,t)}return null};return r?o.entity=await h(await c):o.promise=c.then(h),o}setLoadMode(t){this.loadMode=t}async prepare(t,e,r){let s=null;this.point="number"==typeof e&&e>0&&e<t.length?e:0,this.maxRemain="number"==typeof r&&r>0?r:3,this.updateRemainPoints(),"fast"===this.loadMode&&(s=await this.createBucket(t[this.point])),this.buckets=await Promise.all(t.map(((t,e)=>{if(s&&e===this.point)return s;const{loadMode:r,remainStart:n,remainEnd:a,point:i}=this;return this.createBucket(t,n<=e&&e<a,"whole"===r||e===i)})))}async get(){const t=this.buckets[this.point];return t.promise?(t.entity=await t.promise,t.promise=null,t):null===t.entity?(t.entity=await _t.load(t.local||t.origin),t):t}go(t){return this.getBucket(t)}clear(){const{globals:t,local:e}=m,{env:r}=t,{buckets:s}=this;return this.buckets=[],this.point=this.remainStart=this.remainEnd=0,this.maxRemain=3,Promise.all(s.map((t=>"h5"!==r&&"tt"!==r?e.remove(t.local):t.local)))}}class Jt{painter;resource;entity;constructor(t,e,r){this.painter=t,this.resource=e,this.entity=r}async set(t,e,r="R"){const{entity:s,resource:n}=this;"A"===r?await n.loadImagesWithRecord({[t]:e},s.filename,"dynamic"):s.images[t]=e}getContext(){return this.painter.YC}hasValidKey(t){const{images:e}=this.entity;return"function"==typeof Object.hasOwn?Object.hasOwn(e,t):Object.prototype.hasOwnProperty.call(e,t)}loadImage(t,e){return this.resource.loadExtImage(t,m.path.filename(e))}async setCanvas(t,e,r){if(this.entity.locked)return;const{canvas:s}=e,n=r?.width??s.width,a=r?.height??s.height,i=Kt(e.getImageData(0,0,n,a));await this.set(t,new Uint8Array(i),r?.mode)}async setImage(t,e,r){if(!this.entity.locked)if(e.startsWith("data:image"))await this.set(t,e,r?.mode);else{const s=await m.remote.fetch(e);await this.set(t,new Uint8Array(s),r?.mode)}}async setQRCode(t,e,r){if(this.entity.locked)return;const s=Vt({...r,code:e});await this.set(t,new Uint8Array(s),r?.mode)}}class Qt{entity;frame=0;contentMode="fill";isConfigured=!1;painter;resource=null;renderer=null;constructor(t,e){this.painter=new Wt("poster",t,e)}async register(t="",e){await this.painter.register(t,"",e),this.renderer=new I(this.painter.YC),this.resource=new Ht(this.painter)}async setConfig(t={},e){const r="string"==typeof t?{container:t}:t;void 0===r.container&&(r.container=""),void 0!==r.contentMode&&(this.contentMode=r.contentMode),this.frame="number"==typeof r.frame?r.frame:0,this.isConfigured=!0,await this.register(r.container,e)}setContentMode(t){this.contentMode=t}setFrame(t){this.frame=t}async mount(t){if(!t)throw new Error("videoEntity undefined");this.isConfigured||(await this.register(),this.isConfigured=!0);const{images:e,filename:r}=t;this.painter.clearContainer(),this.resource.release(),this.entity=t,await this.resource.loadImagesWithRecord(e,r)}draw(){if(!this.entity)return;const{painter:t,renderer:e,resource:r,entity:s,contentMode:n,frame:a}=this;e.resize(n,s.size,t.X),e.render(s,r.materials,r.dynamicMaterials,a,0,s.sprites.length)}toDataURL(){const{XC:t,W:e,H:r}=this.painter;return Gt(t.getImageData(0,0,e,r))}destroy(){this.painter.destroy(),this.renderer?.destroy(),this.resource?.release(),this.resource?.cleanup(),this.entity=void 0}}const Zt="【benchmark】",te="undefined"!=typeof window?"h5":"undefined"!=typeof tt?"tt":"undefined"!=typeof my?"alipay":"undefined"!=typeof wx?"weapp":"unknown",ee=("alipay"===te?my.getDeviceBaseInfo().platform:"tt"===te?tt.getDeviceInfoSync().platform:"weapp"===te?wx.getDeviceInfo().platform:"unknown").toLocaleLowerCase(),re="h5"===te?()=>performance.now()/1e3:"weapp"===te?()=>wx.getPerformance().now()/1e3:"alipay"===te?()=>my.getPerformance().now()/1e3:()=>Date.now();const se=new class{label="";startTime=0;isRealMachine=["ios","android","openharmony"].includes(ee);start(t){this.isRealMachine?(this.label=t,this.startTime=re()):console.time(t)}stop(t){this.isRealMachine?console.log(`${this.label}: ${re()-this.startTime}`):console.timeEnd(t)}};var ne={label(t){console.log(Zt,t)},async time(t,e){se.start(t);const r=await e();return se.stop(t),r},line(t=40){console.log("-".repeat(t))},log(...t){console.log(Zt,...t)}};export{_t as Parser,Xt as Player,Qt as Poster,Jt as VideoEditor,jt as VideoManager,ne as benchmark,Vt as generateImageBufferFromCode,qt as generateImageFromCode,Kt as getBufferFromImageData,Gt as getDataURLFromImageData,m as platform};
//# sourceMappingURL=index.js.map
